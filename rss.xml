<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Tech Blog]]></title><description><![CDATA[Notes on tech by Matthew Curtis.]]></description><link>https://gatsby-starter-blog-demo.netlify.com</link><generator>GatsbyJS</generator><lastBuildDate>Wed, 05 Mar 2025 15:26:14 GMT</lastBuildDate><item><title><![CDATA[11ty Off-By-One Date]]></title><description><![CDATA[For my new personal blog I’ve been playing around with 11ty. It’s definitely not perfect, but it’s a lot faster and more straight-forward…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/eleventy-date/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/eleventy-date/</guid><pubDate>Wed, 05 Mar 2025 03:25:23 GMT</pubDate><content:encoded>&lt;p&gt;For my new personal blog I’ve been playing around with 11ty. It’s definitely not perfect, but it’s a lot faster and more straight-forward than Gatsby (which is what I use for this blog).&lt;/p&gt;
&lt;p&gt;My honeymoon period was cracked a little bit when I noticed the dates on my site were wrong due to a difference between local time and UTC. This is considered a common pitfall &lt;a href=&quot;https://www.11ty.dev/docs/dates/#dates-off-by-one-day&quot;&gt;in the docs&lt;/a&gt;, but they don’t offer a solution for Liquid in the docs or in the &lt;a href=&quot;https://github.com/11ty/eleventy/issues/603&quot;&gt;original ticket&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Since this seemed like a common problem without a clear solution in a quick internet search, I thought I’d share what I did.&lt;/p&gt;
&lt;p&gt;Originally what I was doing:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;liquid&quot;&gt;&lt;pre class=&quot;language-liquid&quot;&gt;&lt;code class=&quot;language-liquid&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div class&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&quot;post&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;list__date&quot;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  {{ post.data.date &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &quot;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;Y&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;m&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;d&quot; }}
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The parser read “2025-03-07” as a UTC date and then converted it to a local date when formatting it in the template; so it rendered as “2025-03-06”.&lt;/p&gt;
&lt;p&gt;I ended up adding a custom filter:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// eleventy.config.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;frontPad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; char &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;0&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; len &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; str &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      str &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; char &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; str&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; str&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;eleventyConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...my other config stuff...&lt;/span&gt;

  eleventyConfig&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addFilter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;dateString&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; year &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; date&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUTCFullYear&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; month &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;frontPad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;date&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUTCMonth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; day &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;frontPad&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;date&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getUTCDate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;year&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;month&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;day&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then in the template:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;liquid&quot;&gt;&lt;pre class=&quot;language-liquid&quot;&gt;&lt;code class=&quot;language-liquid&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div class&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&quot;post&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;list__date&quot;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  {{ post.data.date &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; dateString }}
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;div&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So now a “2025-03-07” date actually renders as “2025-03-07”.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Fun with MIDI]]></title><description><![CDATA[This was originally written for a zine. Code, schematics, etc can be found on Github. Hey 👋 My name is Matthew and I don’t understand…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/fun-with-midi/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/fun-with-midi/</guid><pubDate>Thu, 27 Feb 2025 21:25:23 GMT</pubDate><content:encoded>&lt;p&gt;This was originally written for a zine. Code, schematics, etc can be &lt;a href=&quot;https://github.com/handeyeco/fun-with-midi&quot;&gt;found on Github&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Hey 👋 My name is Matthew and I don’t understand analog circuits.&lt;/p&gt;
&lt;p&gt;Boy have I tried though. Just looking around my desk I can see my copy of There Are No Electrons by Amdahl, Practical Electronics For Inventors by Scherz, and Electronic Projects For Musicians by Anderton. My degree is in Music Business, Performance, and Technology and I’ve worked TWO jobs assembling modular synthesizers - one before and one after my career as an audio engineer, before I made the switch to software development.&lt;/p&gt;
&lt;p&gt;Circuits are hard. I discovered something though - on my 100th attempt at learning electrical engineering - that there’s buckets of fun to be had with a relatively simple circuit and some basic programming skills.&lt;/p&gt;
&lt;p&gt;In this article I’m going to talk a little about MIDI.&lt;/p&gt;
&lt;h2&gt;WARNING&lt;/h2&gt;
&lt;p&gt;Your hearing is fragile, be sure to protect it when programmatically adjusting audio. I recommend getting some cheap, small speakers from a thrift store to use while debugging. Always start each iteration with your volume turned down and carefully turn the volume up when you’re confident your project is working.&lt;/p&gt;
&lt;p&gt;You can always fix bugs, but you can’t fix tinnitus!&lt;/p&gt;
&lt;h2&gt;What we’re doing&lt;/h2&gt;
&lt;p&gt;We’re going to use an Arduino and a simple MIDI out circuit for three sketches:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;To get things started, we’ll run a sketch that makes sure all the buttons, potentiometers, and LEDs are working.&lt;/li&gt;
&lt;li&gt;Then we’ll test our MIDI out circuit by making a vanilla MIDI CC controller that lets us pick a MIDI CC and a value for that CC.&lt;/li&gt;
&lt;li&gt;Finally we’ll look at a more creative application of MIDI by making a random MIDI CC generator that can be used to turn boring synth patches into modular-like bleeps and bloops.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Each sketch will build on the previous sketch so hopefully by the end you can take these ideas and build your own weird MIDI tool!&lt;/p&gt;
&lt;h2&gt;What I’m using&lt;/h2&gt;
&lt;p&gt;For these examples I’m using an Arduino Mega ($50; an Uno should work fine though) and the Sparkfun MIDI Shield ($24). Arduino is designed to be a beginner-friendly platform for people who are learning about microcontrollers. Shields are just circuits that are meant to extend the functionality of another circuit.&lt;/p&gt;
&lt;p&gt;If you want to follow along and have the cash, I highly recommend throwing some dough at both Arduino and Sparkfun - they contribute a lot to the DIY scene. However you can get equally far with a $10 Arduino knock-off and some common components.&lt;/p&gt;
&lt;h2&gt;The circuit&lt;/h2&gt;
&lt;p&gt;Even though MIDI in makes everything more fun, for the sake of simplicity I’m just using MIDI out, two potentiometers, three buttons, and two LEDs. You can see the Sparkfun MIDI Shield schematic on their site, but the parts I’m using for these examples are:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/7e995fa6d909c88a421c98c0552175cf/b85c3/simplified-schematic.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACaUlEQVQ4y21T2U4bQRD0//8PJhAIUhLxlggIOMHE+FjvNffOHrMmgaJmLIMU5aE1u9PT1d3V1ZO+d/i/NekcBoem1XBeIQy8ozXpfu/vOouhtzCNQsf/SXT8a2+gg0cIPbrWwXuTAqypUWwe07sQPFRbwZgKztYpZtIzQ9tpPjZoaT2zxaqG0KJ3GVxxA7H+DlvNWI1B4wR0voTrJIbWQBUrWFYvVnMIXWOiVYFKrFCpDSq5hpY5GpY/dB1sfskkx/DhDLU8gRdbhLFHPzZssUZ9P4P+/RNicQ9DnMZrTCxbcaqEJbrhqUSG0mxR81zcHsON53jBV5TyFDpbYhhZeeSNdPgYl6/QWclEXaJhEuhwrYBta0hf7K2jmQLr2Qn+PF/gGV+g9EcYAo67HoEDi3wqdpLVOYSTb7xP0qRonlnTVKMFB6MrbAj4RECwwsaeQWZsbVAwvkZDDnU6yX/3ro405ZbkGiMQdh2BHSvU5JMtX0+xS4CXKPMjbGfXaEb6G/LMGM93xss3ie0B+ROnK2yGerOAqjNs5j9Qlmv8+jbF+PcTxpfPWG2PUD/M2fJAiiQc2+yoCM3h9AQ/yC0BRoclj0oU6WHUlTUSi7tT7F4uEMhhVk4hlw8ITwOs2qKc30KwOrmYoSg36KKG3wHJWVOhomAVpZE/3DEzdWavoNUUmfgAI8+pyTUBKXQmFct7apGFsCsp8rQEw2EoqVw6ZbVFG1fIij0nFGz5eIXt6oZBGyaJA9Fp/TQ3I66i5V3L1QyHlg9kplWixtL6caXiXeC21CZKyrKa2IVOw4i+eMaKfBs3zabveP8K4gfT+OfabQUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of MIDI out circuit with simple controls&quot;
        title=&quot;Schematic of MIDI out circuit with simple controls&quot;
        src=&quot;/tech-blog/static/7e995fa6d909c88a421c98c0552175cf/fcda8/simplified-schematic.png&quot;
        srcset=&quot;/tech-blog/static/7e995fa6d909c88a421c98c0552175cf/12f09/simplified-schematic.png 148w,
/tech-blog/static/7e995fa6d909c88a421c98c0552175cf/e4a3f/simplified-schematic.png 295w,
/tech-blog/static/7e995fa6d909c88a421c98c0552175cf/fcda8/simplified-schematic.png 590w,
/tech-blog/static/7e995fa6d909c88a421c98c0552175cf/efc66/simplified-schematic.png 885w,
/tech-blog/static/7e995fa6d909c88a421c98c0552175cf/c83ae/simplified-schematic.png 1180w,
/tech-blog/static/7e995fa6d909c88a421c98c0552175cf/b85c3/simplified-schematic.png 2580w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MIDI out, which is just a 5 pin DIN socket with two resistors&lt;/li&gt;
&lt;li&gt;Two potentiometers acting as voltage dividers going into analog pins on the Arduino&lt;/li&gt;
&lt;li&gt;Three switches going into digital pins on the Arduino (we’ll be using the internal pull-up resistors)&lt;/li&gt;
&lt;li&gt;Two LEDs with current limiting resistors&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you’ve been playing with electronics already, there’s a good chance you have most of this stuff lying around except maybe the Arduino and the DIN socket (using a 3.5mm jack for TRS MIDI is also an option).&lt;/p&gt;
&lt;h2&gt;Sketch #1: Board Test&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/handeyeco/fun-with-midi/blob/main/board-test/board-test.ino&quot;&gt;Source code&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;This first sketch is just testing the pots, buttons, and LEDs. First we let the program know which pins we’re using for everything:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// button pins (digital)&lt;/span&gt;
byte S3_PIN &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
byte S4_PIN &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
byte S5_PIN &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// pot pins (analog)&lt;/span&gt;
byte RV1_PIN &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; A1&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
byte RV2_PIN &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; A0&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// LED pins (digital)&lt;/span&gt;
byte GRN_LED_PIN &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
byte RED_LED_PIN &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we declare some variables so we can keep track of what everything is doing as the sketch runs:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// declare read state&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; S3_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; S4_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; S5_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; RV1_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; RV2_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;setup&lt;/code&gt; is the code that runs at the beginning of the sketch:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// setup for printing to our monitor&lt;/span&gt;
  Serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9600&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// the switches use the built-in pull-up resistors&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S3_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; INPUT_PULLUP&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S4_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; INPUT_PULLUP&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S5_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; INPUT_PULLUP&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// the pots don&apos;t use the pull-up resistors&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; INPUT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV2_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; INPUT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// then set up the LEDs as outputs&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;GRN_LED_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; OUTPUT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RED_LED_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; OUTPUT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// do an initial read of everything&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// so we can start looking for changes&lt;/span&gt;
  S3_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;digitalRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S3_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  S4_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;digitalRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S4_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  S5_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;digitalRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S5_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  RV1_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;analogRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  RV2_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;analogRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV2_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;loop&lt;/code&gt; runs over and over again so we can watch for changes:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// pot change threshold,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// for what we consider a change&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; RV_THRESH &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// read pins&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; S3_READ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;digitalRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S3_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; S4_READ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;digitalRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S4_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; S5_READ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;digitalRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S5_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; RV1_READ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;analogRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; RV2_READ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;analogRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV2_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// if any button is pressed, light LED&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; S3_READ &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; S4_READ &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; S5_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;GRN_LED_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RED_LED_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; pressed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// print and update state&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// if a change is detected&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S3_READ &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; S3_STATE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;S3&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    S3_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; S3_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S4_READ &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; S4_STATE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;S4&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    S4_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; S4_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S5_READ &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; S5_STATE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;S5&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    S5_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; S5_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_READ &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; RV1_STATE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; RV_THRESH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;RV1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    RV1_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; RV1_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;abs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV2_READ &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; RV2_STATE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; RV_THRESH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;RV2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    RV2_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; RV2_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What it’s doing:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;If any buttons are pressed, light up the LEDs&lt;/li&gt;
&lt;li&gt;If any button is pressed, print in the serial monitor which button was pressed&lt;/li&gt;
&lt;li&gt;If any pot is turned, print in the serial monitor which pot was turned&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Okay, not super fun so far, but hopefully we have a working Arduino connected to a working MIDI shield. Now let’s actually &lt;em&gt;do&lt;/em&gt; something with the MIDI output.&lt;/p&gt;
&lt;h2&gt;Serial, USB, and MIDI&lt;/h2&gt;
&lt;p&gt;Okay, here’s some bummer news: the &lt;code class=&quot;language-text&quot;&gt;Serial&lt;/code&gt; protocol we used to print messages in the previous example doesn’t play well with hardware MIDI. The problem is that both USB communication and hardware MIDI rely on UART (connected to the TX/RX pins). This is why the MIDI shield has a prog/run switch: when we’re sending our sketch to the Arduino, we can’t also be receiving MIDI or our bits will get all mixed up. The switch turns off MIDI in while we program the microcontroller.&lt;/p&gt;
&lt;p&gt;This isn’t a huge issue for now since we’re only using MIDI out, but it’s something to keep in mind. It does however limit our ability to use &lt;code class=&quot;language-text&quot;&gt;Serial.print&lt;/code&gt; while also using MIDI.&lt;/p&gt;
&lt;p&gt;The good news is that some Arduinos have multiple UARTs; for example the Mega has 4 sets of UART pins. This means you can use one set for programming/debugging and one set for MIDI. Unfortunately the MIDI shield is designed to work with the Uno too, which only has one set, so the issues exists with the shield on the Mega.&lt;/p&gt;
&lt;p&gt;So:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;We won’t use &lt;code class=&quot;language-text&quot;&gt;Serial.print&lt;/code&gt; while also using MIDI&lt;/li&gt;
&lt;li&gt;If we have something plugged into MIDI in, we’ll use the prog/run switch to disconnect it while programming our Arduino&lt;/li&gt;
&lt;li&gt;If in the future we design our own circuits, we’ll use a microcontroller with multiple UARTS so MIDI can be on its own&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Sketch #2: MIDI CC Controller&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/handeyeco/fun-with-midi/blob/main/cc-controller/cc-controller.ino&quot;&gt;Source code&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;I’m not going to explain MIDI or MIDI CC in a lot of detail. You have access to the internet. I’m just going to say that MIDI is how digital music devices communicate with one another and MIDI CC is how we control parameters on one device from another device.&lt;/p&gt;
&lt;p&gt;This script will give us the power to change parameters on a remote device from our Arduino. Imagine being able to change the filter cutoff on your synth from the other side of the room - that &lt;em&gt;can&lt;/em&gt; be a reality for you!&lt;/p&gt;
&lt;p&gt;The code is much more concise as it takes the last example and cuts a lot away from it. We’re only going to use the pots here:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;One pot will control which CC we’re modifying. For instance on the Hydrasynth, filter 1 cutoff is MIDI CC 74 and LFO 1 rate is MIDI CC 72. Your synth’s manual should tell you what CC controls what parameter.&lt;/li&gt;
&lt;li&gt;The other pot will control the value of the MIDI CC. Most of MIDI works with 7 bits which gives us a range between 0 and 127 (128 steps).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;First we import &lt;a href=&quot;https://github.com/FortySevenEffects/arduino_midi_library&quot;&gt;FortySevenEffects’ MIDI library&lt;/a&gt; and initialize it:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;MIDI.h&gt;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;MIDI_CREATE_DEFAULT_INSTANCE&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We set pins and initalize state like before; this time though we also have to start the MIDI library. Additionally I’ve added a helper function to map 0-1023 (the full range that an Arduino’s &lt;code class=&quot;language-text&quot;&gt;analogRead&lt;/code&gt; can supply) to 0-127 (the full range that MIDI can use).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// pot pins&lt;/span&gt;
byte RV1_PIN &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; A1&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
byte RV2_PIN &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; A0&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// declare read state&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; RV1_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; RV2_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;read_and_map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;byte pin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; read &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;analogRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;read&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1023&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  MIDI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;MIDI_CHANNEL_OMNI&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// set pin modes&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; INPUT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV2_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; INPUT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// initialize read state&lt;/span&gt;
  RV1_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;read_and_map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  RV2_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;read_and_map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV2_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now the juicy bit:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// there are 16 MIDI channels,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// I just used the first one&lt;/span&gt;
byte MIDI_CH &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// read pins&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; RV1_READ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;read_and_map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; RV2_READ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;read_and_map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV2_PIN&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// RV1 adjusts which CC channel we&apos;re changing&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_READ &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; RV1_STATE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    RV1_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; RV1_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// RV2 adjusts the CC value&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV2_READ &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; RV2_STATE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    RV2_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; RV2_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// sendControlChange(CC, value, channel)&lt;/span&gt;
    MIDI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendControlChange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_STATE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; RV2_STATE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; MIDI_CH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;What this sketch does:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It watches for changes on the RV1 potentiometer and if it changes we change the MIDI CC we’re going to adjust&lt;/li&gt;
&lt;li&gt;It watches for changes on the RV2 potentiometer and if it changes we send a MIDI CC message to our MIDI output using the MIDI CC from RV1 and the value from RV2&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;In theory we could use RV1 to go to MIDI CC 74 then use RV2 to adjust the filter cutoff on our Hydrasynth. Or use RV1 to go to MIDI CC 81 then use RV2 to adjust envelope 1 attack.&lt;/p&gt;
&lt;p&gt;In practice this is a little tough because we don’t have a display to tell us what MIDI CC we’re on. For now we could use an app like MIDI Monitor to see our work in action and later we could add a cheap I2C OLED screen to tell us what’s happening.&lt;/p&gt;
&lt;h2&gt;Sketch #3: Random CC&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/handeyeco/fun-with-midi/blob/main/random-cc/random-cc.ino&quot;&gt;Source code&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Let’s go one step further and make something that’s actually fun to use without adding a screen or connecting it to a computer. Modular folks think they have all the fun with their bleeps and their bloops and their endless modulation options, but now that we know we can control synths using MIDI CC, we can make our own obnoxious sounds!&lt;/p&gt;
&lt;p&gt;Here’s what this sketch is going to do:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We’re going to pick a MIDI CC and start sending it random values.&lt;/li&gt;
&lt;li&gt;RV2 will determine how often we send a random value: really fast or really slow.&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;RV1 will do different things based on the buttons:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;When we press S3 we’ll turn off all the LEDs and RV1 will change the offset of the MIDI CC. MIDI CC works between 0 and 127; offset will set the lowest possible value our random CC generator will send.&lt;/li&gt;
&lt;li&gt;When we press S4 we’ll turn on the green LED and RV1 will now change the depth of the MIDI CC. This essentially will set the highest possible value our random CC generator will send.&lt;/li&gt;
&lt;li&gt;When we press S5 we’ll turn on the red LED and RV1 will now change the MIDI CC that we’re sending to. Basically chosing what parameter we want to control.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So when “offset” is 0 and “depth” is 127, we’ll get random CCs between 0 and 127. When “offset” is 64 and “depth” is 127, we’ll get random CCs between 64 and 127 (we’ll clamp the maximum output to 127 since that’s the max MIDI CC can handle). When “offset” is 64 and “depth” is 10, we’ll get random CCs between 64 and 74.&lt;/p&gt;
&lt;p&gt;So by default we’ll generate random CCs using the full CC range:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/06abf80ea7eb47c0ac6039f63969c6d3/26162/wide-scatter.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA/ElEQVQoz51TWbLEIAj0/rdNypdUlIYRF4KO72esomJYmmYx3Pct53nKcRxyXZfoYUCY+ScJRFSBUkqScy5oLIQmqzOcHl7vAaUfLkKQakQPUq0CZJpB0UHUbrquD6pQdswQojk4ZciTMQVVfcmMmgim17sxpNIzBcJSJhZGcCx9EnFsQ+tdep2YDdwH6ndUQK7EYdNKaskxRnmeAsitf2MgnrEsjLknJfoeVi05lekOoJGdMAcPZqMdNPX0LT00B5iD9sKmtmnDulKEzZR1/zwAb5q/W2IsK2Ult8y6Aro67Yuvf55su/u7NuW16KSV6X8S45+9JpW08VHQDyIRtqQTuHW7AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Scatter plot of a wide CC range&quot;
        title=&quot;Scatter plot of a wide CC range&quot;
        src=&quot;/tech-blog/static/06abf80ea7eb47c0ac6039f63969c6d3/fcda8/wide-scatter.png&quot;
        srcset=&quot;/tech-blog/static/06abf80ea7eb47c0ac6039f63969c6d3/12f09/wide-scatter.png 148w,
/tech-blog/static/06abf80ea7eb47c0ac6039f63969c6d3/e4a3f/wide-scatter.png 295w,
/tech-blog/static/06abf80ea7eb47c0ac6039f63969c6d3/fcda8/wide-scatter.png 590w,
/tech-blog/static/06abf80ea7eb47c0ac6039f63969c6d3/efc66/wide-scatter.png 885w,
/tech-blog/static/06abf80ea7eb47c0ac6039f63969c6d3/c83ae/wide-scatter.png 1180w,
/tech-blog/static/06abf80ea7eb47c0ac6039f63969c6d3/26162/wide-scatter.png 2020w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;But we can narrow that range using offset and depth:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/15d52dbcd90e019fd64995ecc836fe69/26162/narrow-scatter.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAs0lEQVQoz61TCQ6DMAzr/5+LKCs5h1MyMSTYBCAZEjd13FSU1poPw/CBqrqZXUYREZ+myYkocEcsBH333BbE6wlnXw4xN1Xzmc1FO9Q6ENsmTrBY7MEaYnAOwZxdI3XiLooYeAFz55FjDXnWBpf88oVwGcfRW6Olg0fH7B5dpTvD5uSyRtaceOM4j8zMhzPR9fh77igvndDnLiWGeuLw0i2nyzP8WxOC+Fvg8gy11p81EH0DtpO2iMqzpKkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Scatter plot of a narrow CC range&quot;
        title=&quot;Scatter plot of a narrow CC range&quot;
        src=&quot;/tech-blog/static/15d52dbcd90e019fd64995ecc836fe69/fcda8/narrow-scatter.png&quot;
        srcset=&quot;/tech-blog/static/15d52dbcd90e019fd64995ecc836fe69/12f09/narrow-scatter.png 148w,
/tech-blog/static/15d52dbcd90e019fd64995ecc836fe69/e4a3f/narrow-scatter.png 295w,
/tech-blog/static/15d52dbcd90e019fd64995ecc836fe69/fcda8/narrow-scatter.png 590w,
/tech-blog/static/15d52dbcd90e019fd64995ecc836fe69/efc66/narrow-scatter.png 885w,
/tech-blog/static/15d52dbcd90e019fd64995ecc836fe69/c83ae/narrow-scatter.png 1180w,
/tech-blog/static/15d52dbcd90e019fd64995ecc836fe69/26162/narrow-scatter.png 2020w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This code shares a lot from the first two examples, so I’m just going to talk about the important changes. First we initialize some state:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// what editing mode we&apos;re in:&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 0 = offset (no LEDs)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 1 = depth (green LED)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 2 = CC (red LED)&lt;/span&gt;
byte RV1_edit_mode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// offset is our lowest possible CC&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// depth is how far from&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// the lowest CC we can go&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; depth &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// the MIDI CC we&apos;re sending values for&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 74 is commonly the CC for filter cutoff&lt;/span&gt;
byte cc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;74&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// these are used to set our&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// MIDI message interval&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; MIN_SPEED &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; MAX_SPEED &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; speed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; MAX_SPEED&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; last_cc_sent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Next we check each button to see if they have been pressed and if we detect a change we update the mode we’re in, for example:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;  byte old_RV1_edit_mode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; RV1_edit_mode&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// update edit state if button change detected&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S3_READ &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; S3_STATE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    S3_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; S3_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// set RV1_edit_mode to offset&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S3_STATE &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; LOW&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      RV1_edit_mode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// ...similar for the other buttons...&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// watch for changes to edit mode and update LEDs&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;old_RV1_edit_mode &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; RV1_edit_mode&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;GRN_LED_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; RV1_edit_mode &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RED_LED_PIN&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; RV1_edit_mode &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we read the pots. For RV1, we update the settings based on what mode we’re in. For RV2, we map the read value between our min/max interval speed:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;// if RV1 changes, look at the edit mode&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// to determine which setting should be updated&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_READ &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; RV1_STATE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    RV1_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; RV1_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_edit_mode &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; RV1_STATE&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_edit_mode &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      depth &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; RV1_STATE&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV1_edit_mode &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      cc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; RV1_STATE&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// use RV2 to update the speed of the interval&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV2_READ &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; RV2_STATE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    RV2_STATE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; RV2_READ&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// we map pot reads from 0-1023 to 0-127 for MIDI&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// but now we&apos;re mapping 0-127 to MIN/MAX_SPEED&lt;/span&gt;
    speed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;RV2_STATE&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; MIN_SPEED&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; MAX_SPEED&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Finally we continuously check to see if the current timestamp minus the timestamp for the last message is larger than our interval; if so, send a new message:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;// 1. check the current time&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 2. compare it to the last time we sent a message&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 3. if we&apos;re past our interval, send a new message&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;now &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; last_cc_sent &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; speed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    last_cc_sent &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; now&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// max is offset + depth, as long as it&apos;s between 0 and 127&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; max_val &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;constrain&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;offset &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; depth&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; rand_val &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;offset&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; max_val&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// sendControlChange(CC, value, channel)&lt;/span&gt;
    MIDI&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sendControlChange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;cc&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rand_val&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; MIDI_CH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Adding MIDI in&lt;/h2&gt;
&lt;p&gt;Addind MIDI in isn’t too much work either, it’s just that the MIDI specification require the use of an optocoupler to electrically isolate the receiving circuit from the sending circuit. Looking at the Sparkfun schematic, the important pieces are:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/fa64f6b8ca55a94a9d5085d5870fc2b3/ec09f/midi-in-schematic.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAABYlAAAWJQFJUiTwAAAChUlEQVQ4y5WUW0/bQBCF8/9/Rd/7UnEphIuoCK0AQdWGQCBRQmLHXsf2Xry7tpMgOB2vE1oIqpSHkaVd77dnZs9MI88VrJWovm+i0IgUh9QSqUxQFNnaP9Xa+/VGSQe9NIK2CrPSoKQfSvpqEWIwbIN5XQgRoJybtcN2GcW/QKEYWPcGPPYwVT6SLITQKaT/HSibiHs78L0H8MgntYKg1UHpvlzGECpxIl6B7qYsoRQVWK+N4fgekkoQ3zQhe5+Q3u5ARSE82vM5I/UaeZXJLIfRHJqiqNZegTaDygTmiwKxnIBrBmkEVHiOMvmC6Poz4tRDYhhSE9HlMe2R4lGHBFxDBPcorCBBtcoGH/Qw7XagkxDcTN1iVUMrGcUIKnmESkPMZ5b2E+joDk+LY+j8CKHcB0/3YIVHKo0rRSPpd6GCEfz2LyjL37xySZDMSLCUuTpxEyP4fYKJ2sfi+RRztOBPd+l8j4DWuaWhmAcZjlE6G6xqsf6aVY3LXGN8eYgw28fzSwuLl1Ow+CvU5MEB8wo4odv7BA1FnW7x3o+rtSVwRECRHwA4I2ALISmU4zsUsyVw5SXzkbnfGJ2AloAXB+BL4AsF53tIBm1XHpfyyu0fdcIakBR6pFAWhwRsUfxAHG2D3VxgNs9rhf+FfAS8OkZqa4UFPczYJ2t1LqmT8lrhRsAq5fOme5QKKGcnGAdb5MnbvylvqnDSOcM0P3Tpivk3DCdbSO5/ukfZDOigBiZ+wFPRhMd20A+3qce3qXP6dQ3zjYEZrI5hkwF6nSM8Dq+QxgNkNEwE9bTZTGHtgnoQaJpOAbWfRiBSRII6iNMIpBmwmcKlyQ0NA0aAaoSVRT1oVyPsDzbCTsnEHwoCAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of MIDI in circuit&quot;
        title=&quot;Schematic of MIDI in circuit&quot;
        src=&quot;/tech-blog/static/fa64f6b8ca55a94a9d5085d5870fc2b3/fcda8/midi-in-schematic.png&quot;
        srcset=&quot;/tech-blog/static/fa64f6b8ca55a94a9d5085d5870fc2b3/12f09/midi-in-schematic.png 148w,
/tech-blog/static/fa64f6b8ca55a94a9d5085d5870fc2b3/e4a3f/midi-in-schematic.png 295w,
/tech-blog/static/fa64f6b8ca55a94a9d5085d5870fc2b3/fcda8/midi-in-schematic.png 590w,
/tech-blog/static/fa64f6b8ca55a94a9d5085d5870fc2b3/efc66/midi-in-schematic.png 885w,
/tech-blog/static/fa64f6b8ca55a94a9d5085d5870fc2b3/c83ae/midi-in-schematic.png 1180w,
/tech-blog/static/fa64f6b8ca55a94a9d5085d5870fc2b3/ec09f/midi-in-schematic.png 1916w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;R5 is limiting current&lt;/li&gt;
&lt;li&gt;R6 is a pull-up resistor&lt;/li&gt;
&lt;li&gt;D3 is protection again reverse polarization&lt;/li&gt;
&lt;li&gt;The 6N138 is sending the data from two electrically disconnected circuits&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;To have both hardware MIDI in and MIDI out, you’re looking at eight cheap and highly available components (not including the Arduino). No vactrols, no germanium transistors, no archaic ICs you have to source from estate sales.&lt;/p&gt;
&lt;h2&gt;Closing thoughts&lt;/h2&gt;
&lt;p&gt;The fun thing about this circuit is that you don’t have to control just one thing on one device:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Traditional MIDI CC lets you control 127 parameters&lt;/li&gt;
&lt;li&gt;MIDI NRPN lets you control 16,383 parameters&lt;/li&gt;
&lt;li&gt;Thanks to MIDI channels, you can simultaneously control up to 16 devices&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We’re not just limited to parameter changes either, with MIDI you can:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Control the clock that devices use&lt;/li&gt;
&lt;li&gt;Send program changes to jump between patches on the fly&lt;/li&gt;
&lt;li&gt;Send traditional notes but also microtonal notes now thanks to MIDI MPE&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If you’re interested in open-source MIDI projects, be sure to check out:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://monome.org/docs/norns/&quot;&gt;Norns&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cs.gmu.edu/~sean/projects/gizmo/&quot;&gt;Gizmo&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.midigoblin.com/&quot;&gt;MIDI Goblin&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/pichenettes/midipal&quot;&gt;Midipal&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Finally, I’m working on an open-source generative sequencer called &lt;a href=&quot;https://github.com/handeyeco/Grandbot&quot;&gt;Grandbot&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Midipal on the Arduino Nano]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/nano-midipal/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/nano-midipal/</guid><pubDate>Wed, 26 Feb 2025 21:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;I have not succeeded, this is a WIP and might never be finished. Please let me know if you make more progress than I did.&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;The Goal&lt;/h2&gt;
&lt;p&gt;If you’ve ever read anything on this blog, it’s obvious I’m going through a MIDI phase right now. After working for awhile on &lt;a href=&quot;https://github.com/handeyeco/Grandbot&quot;&gt;Grandbot&lt;/a&gt;, I’ve started thinking about what I want to do next and I was thinking of a MIDI utility tool.&lt;/p&gt;
&lt;p&gt;One Saturday morning I was reading about Mutable Instrument’s &lt;a href=&quot;https://pichenettes.github.io/mutable-instruments-diy-archive/midipal/manual/&quot;&gt;Midipal&lt;/a&gt; and realized the microcontroller used was an ATmega328P, the same MCU as the Arduino Nano (and Arduino Uno). I had an extra 16x2 display from working on the &lt;a href=&quot;https://github.com/handeyeco/minidexed-pcb&quot;&gt;MiniDexed PCB&lt;/a&gt; and some leftover Nanos from working on Grandbot, so I thought it would be a fun weekend project to try and get Midipal running on a Nano.&lt;/p&gt;
&lt;p&gt;I wanted to share my findings so that SynthDIY newbies would have an easy project to build (had I succeeded, which I didn’t).&lt;/p&gt;
&lt;h2&gt;The Schematic&lt;/h2&gt;
&lt;p&gt;I couldn’t actually open the Midipal schematics because they’re EAGLE files. I ended up looking at the schematics of forks and reading through the code for the pins. Here’s what I came up with.&lt;/p&gt;
&lt;p&gt;The main UI schematic:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/e0f010e7014ba4c16822676e1732c27d/0ff19/ui-schematic.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 85.8108108108108%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAAC0klEQVQ4y31U6VLbMBjM+/cx+gCdAcpAoQVKgRlmKJQrzkHinD5kSb7tlGO7kskUGugPjRLJ2m+/3ZVaRRHjrZHnGnmhUb5YK8sYVZmg5ijfOddaWSxT1IsCaZFAaoGqSu26mVPOoVbwOTLum7WS85uApalKsDwOoMYOwu4F5LSDkocMWz+YYjy5w7j7He7NDn/34YvZ2wwN/SQR0DJCLs+Ql18g9DZEuIVcTC3rNFOIgwmi84+YbX+AN7rFYN5HnASWzGtALrSda3TbV3B7XyEXX1E/HeJq+AnKJcs6R1VniIIxtOcgDbtkrUgiQkDmK4B1nWLo9uDc/sKwu4sF9vGIQ8TxDhKClFVmDRE6pI4pwYtGWwIleWPcErS1FNwd9dFxLjFob+M3DgD8QBhuIho4qGhSwYOVPaTtkJTIFDGOG40V2b5gmKHXb8O5usDodusZ8AihvwH/5hz1ffkMmNriVZlDeDMMOYzzZi/WAWruNQzZ8swfYdC9wfByA+XTPgGPEXgEvG4AbcvSQ0hj1PSMeh5j0D+AJ/g/HGNGuWQq0TJVZeJBFSEkP+5drCN93CPgCTxvDR4ZmpYFD439AUYjB9PhJirsoYqZBs+FJjvf7RKHgEZQQf28yQDjQRdifsos7mI4WkPs7yKP5jaLQgVWo1RTK3mE/GGfRq4j7F8ho+Na+VaOlkm6ZkATLsSRZ3XItI+5e4tpOIOvQgR0NyfY4r5AJnyMnA08MAWL9BsEzxpDZCwaU2z1O7bB2EyooaLAaaqoV8CAMxYMdGruNUcg5pjRPLfz2cbKAGaZtPGplrExgDqcQLI1E9wsbwKamXyVyyvZfNzuXOPm5wmm/Q3cMwl1tosiiyzgq2CHkQ/FtqRqrC9eBPXl0GxLskU5PWXxQyT+CSOjVgEz81w9z+89S8sLYF+YktfQmyBL1Erh1t+XJvkv2OsnzjxjjVH/Av4BFw/+AGBjuykAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic for Arduino, LCD, and encoder&quot;
        title=&quot;Schematic for Arduino, LCD, and encoder&quot;
        src=&quot;/tech-blog/static/e0f010e7014ba4c16822676e1732c27d/fcda8/ui-schematic.png&quot;
        srcset=&quot;/tech-blog/static/e0f010e7014ba4c16822676e1732c27d/12f09/ui-schematic.png 148w,
/tech-blog/static/e0f010e7014ba4c16822676e1732c27d/e4a3f/ui-schematic.png 295w,
/tech-blog/static/e0f010e7014ba4c16822676e1732c27d/fcda8/ui-schematic.png 590w,
/tech-blog/static/e0f010e7014ba4c16822676e1732c27d/efc66/ui-schematic.png 885w,
/tech-blog/static/e0f010e7014ba4c16822676e1732c27d/c83ae/ui-schematic.png 1180w,
/tech-blog/static/e0f010e7014ba4c16822676e1732c27d/0ff19/ui-schematic.png 2084w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This is roughly the MIDI schematic (not exact, I just have a stripboard with everything I need for Arduino MIDI on it and I don’t remember the exact values):&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/234c5332198669b73d7642b5f35da08a/a3c4c/midi-schematic.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 83.78378378378379%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAACYElEQVQ4y4VUyW7bMBDV/39Eb7300ktPQY9tgRZNgCaxm0SJN0ncxUWilgAFXodMHGSB48NAJk2+mffmDYth8DgU4xgwTR1cMNBOYaL1e+dTFK8B5sdL4xDgeoW+0+i6Fs7yDH4UMB2a5x4zfTvaYF7ni3EKkK6GlA16KyH4Jv8/HgO0dLhpNmidhGs57m6WiH2LwLbgyz+QisHXK6xpXxD1+QjtItExmsMGBasqdATOt3dofv9EZzj46S+qbos4uEcpjlS4F34aO4z0He8jYvQIooYncC8qOhiyvs/BUoOmJ70PNCVHdDlBS/Q2zRaht7R+STMBtU4TK/Om88Uhu3iSQnmTAcd9JaPPGqa10lXu/kHAkTo9jG8rGZ8nISmYNSRLj1VzDiUrxJzglW2mmSjWVdYuWShdLvkOHa3vp/jgTzoneYnr8pTcUEHvbrC+vYbpX1ZZKFtD/72AurqEWpzDUKdtEBDLC2i+Anc7+MHAyA0G+RX/wheYyxPUZkPGl3kAUhF70xdM7yAXF4jkQ3W1gGaJBlmEtAu6QXn2HZdyC7Eroc8/wSw/wK++QXQCLFDTogEjz2rNHgD9QJNB1NTmFj1NyUy2SVmnqScJLJi+g6IRlGKNKE7QbT+C/fgMHhhqt4LpGCwV4+lukqYwHYcnHVamQUtzGweL/jE8ZbdRPenYmxKDvYI3a4TJwZU3YOTXmPqwp9z2goAEdOCUjX6TLnkvfWmdKKWKc6cz8JA7K7sG1W4BYRhZyz1Zq0gT8l6Mb2bX5YhkFUnaprl//goVx56jQ5GSMXo4XGhfJP0PS+QKgmyZjj0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic for Arduino MIDI I/O&quot;
        title=&quot;Schematic for Arduino MIDI I/O&quot;
        src=&quot;/tech-blog/static/234c5332198669b73d7642b5f35da08a/fcda8/midi-schematic.png&quot;
        srcset=&quot;/tech-blog/static/234c5332198669b73d7642b5f35da08a/12f09/midi-schematic.png 148w,
/tech-blog/static/234c5332198669b73d7642b5f35da08a/e4a3f/midi-schematic.png 295w,
/tech-blog/static/234c5332198669b73d7642b5f35da08a/fcda8/midi-schematic.png 590w,
/tech-blog/static/234c5332198669b73d7642b5f35da08a/efc66/midi-schematic.png 885w,
/tech-blog/static/234c5332198669b73d7642b5f35da08a/c83ae/midi-schematic.png 1180w,
/tech-blog/static/234c5332198669b73d7642b5f35da08a/a3c4c/midi-schematic.png 2196w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Getting Started&lt;/h2&gt;
&lt;p&gt;First &lt;code class=&quot;language-text&quot;&gt;git clone https://github.com/pichenettes/midipal&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;.gitmodules&lt;/code&gt; needs to be updated to use &lt;code class=&quot;language-text&quot;&gt;https://&lt;/code&gt; urls instead of &lt;code class=&quot;language-text&quot;&gt;git://&lt;/code&gt; urls:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[submodule &amp;quot;avrlib&amp;quot;]
	path = avrlib
	url = https://github.com/pichenettes/avril.git
[submodule &amp;quot;tools&amp;quot;]
	path = tools
	url = https://github.com/pichenettes/avril-firmware_tools.git&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;git submodule init&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;git submodule update&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Problem: CrossPack and Microchip Technology’s Acquisition of Atmel&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/obdev/CrossPack-AVR&quot;&gt;CrossPack-AVR&lt;/a&gt; seems to have been a helper for fetching the AVR toolchain. It hardcodes the location of the distribution to &lt;code class=&quot;language-text&quot;&gt;http://distribute.atmel.no/tools/opensource/Atmel-AVR-GNU-Toolchain/$atmelToolchainVersion&lt;/code&gt;. However Atmel was aquired by Microchip Technologies and that link no longer works.&lt;/p&gt;
&lt;p&gt;You can see in Midipal what dependencies we wanted:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// makefile.mk&lt;/span&gt;

CC             &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AVRLIB_TOOLS_PATH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;avr&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;gcc
CXX            &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AVRLIB_TOOLS_PATH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;avr&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;g&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
OBJCOPY        &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AVRLIB_TOOLS_PATH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;avr&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;objcopy
OBJDUMP        &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AVRLIB_TOOLS_PATH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;avr&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;objdump
AR             &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AVRLIB_TOOLS_PATH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;avr&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;ar
SIZE           &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AVRLIB_TOOLS_PATH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;avr&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;size
NM             &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AVRLIB_TOOLS_PATH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;avr&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;nm
AVRDUDE        &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; $&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;AVRLIB_TOOLS_PATH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;avrdude&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you have the Arduino IDE installed, you should pretty much have all this stuff on your computer already. Unfortunately it’s probably not the &lt;code class=&quot;language-text&quot;&gt;3.5.4&lt;/code&gt; version of the toolchain that Midipal uses.&lt;/p&gt;
&lt;p&gt;What I ended up doing was &lt;code class=&quot;language-text&quot;&gt;brew install avrdude&lt;/code&gt;, downloaded the &lt;code class=&quot;language-text&quot;&gt;3.7.0&lt;/code&gt; toolchain &lt;a href=&quot;https://www.microchip.com/en-us/tools-resources/develop/microchip-studio/gcc-compilers&quot;&gt;from here&lt;/a&gt;, updated the &lt;code class=&quot;language-text&quot;&gt;makefile.mk&lt;/code&gt; to point to the directory with the &lt;code class=&quot;language-text&quot;&gt;3.7.0&lt;/code&gt; toolchain, and made a small tweak to &lt;code class=&quot;language-text&quot;&gt;makefile.mk&lt;/code&gt; for &lt;code class=&quot;language-text&quot;&gt;avrdude&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- AVRDUDE        = $(AVRLIB_TOOLS_PATH)avrdude
+ AVRDUDE        = avrdude&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At this point I got a little further with &lt;code class=&quot;language-text&quot;&gt;make&lt;/code&gt; except after that I was getting compilation errors due to incompatibilities between the 3.5.4 and 3.7.0 toolchains. I needed to change a few things in the code:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// &amp;gt;&amp;gt; midipal/resources.h

- extern const prog_char* string_table[];
+ extern const prog_char* const string_table[];

- extern const prog_uint16_t* lookup_table_table[];
+ extern const prog_uint16_t* const lookup_table_table[];

// &amp;gt;&amp;gt; midipal/resources.cc

- PROGMEM const prog_char* string_table[]
+ const prog_char* const string_table[] PROGMEM

- PROGMEM const prog_uint16_t* lookup_table_table[]
+ const prog_uint16_t* const lookup_table_table[] PROGMEM

// &amp;gt;&amp;gt; avrlib/devices/pot_scanner.h

+ #include &amp;lt;string.h&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;At this point I think things were basically compiling.&lt;/p&gt;
&lt;h2&gt;Problem: the Clock&lt;/h2&gt;
&lt;p&gt;While debugging issues, someone on Reddit pointed out a possible problem that I was going to have: Midipal was using a 20Mhz clock and the Nano uses a 16Mhz clock. I’m not totally sure how big of an impact that would have but the Midipal code does make a couple of references to the fact that the clock is running at 20Mhz, so I imagine it would have &lt;em&gt;some&lt;/em&gt; impact.&lt;/p&gt;
&lt;h2&gt;Problem: the Bootloader&lt;/h2&gt;
&lt;p&gt;One of the big things I learned while doing this is that you can’t program the 328’s bootloader over USB. The bootloader is the code that runs when the microcontroller boots and I believe that it needs to be written to the microcontroller via ICSP.&lt;/p&gt;
&lt;p&gt;Why does the bootloader matter? It’s my understanding that the bootloader is what helps the Arduino accept firmware over USB and the Midipal’s bootloader cleverly accepts firmware via MIDI. Put a different way, this is what lets Midipal accept alternative firmware over MIDI.&lt;/p&gt;
&lt;p&gt;Unfortunately this makes having the full Midipal experience on the Nano much more difficult: people would need an ICSP programmer or a second Arduino that could work as an ICSP programmer.&lt;/p&gt;
&lt;p&gt;On top of this, Midipal is manipulating the fuses on the 328. &lt;strong&gt;This makes the whole thing a lot more risky to newbies because a simple mistake could brick the MCU.&lt;/strong&gt;&lt;/p&gt;
&lt;h2&gt;Installing the firmware without the bootloader&lt;/h2&gt;
&lt;p&gt;Just out of curiosity though, I pressed on. At this point I had a &lt;code class=&quot;language-text&quot;&gt;midipal.hex&lt;/code&gt; (which I believe is the firmware) and &lt;code class=&quot;language-text&quot;&gt;muboot.hex&lt;/code&gt; (which I think is the bootloader), so I thought: why don’t I just try to send the firmware to the Arduino without the bootloader and see what happens?&lt;/p&gt;
&lt;p&gt;I made a test script in the Arduino IDE, turned on “show verbose output during compile and upload” in the settings, and sent the script to the Nano. That gave me a command that I then modified to point at &lt;code class=&quot;language-text&quot;&gt;midipal.hex&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;/Users/me/Library/Arduino15/packages/arduino/tools/avrdude/6.3.0-arduino17/bin/avrdude&amp;quot; /
    &amp;quot;-C/Users/me/Library/Arduino15/packages/arduino/tools/avrdude/6.3.0-arduino17/etc/avrdude.conf&amp;quot; /
    -v -V -patmega328p -carduino &amp;quot;-P/dev/cu.usbserial-310&amp;quot; -b115200 -D /
    &amp;quot;-Uflash:w:/Users/me/code/_backups/mutable-instruments/midipal/build/midipal/midipal.hex:i&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Surprisingly…that kinda worked…in the sense that the display was showing the Midipal UI and the encoder navigated around. It’s pretty janky and it’s not handling MIDI correctly - maybe having to do with the clock? It receives and sends MIDI, but the MIDI it’s sending is random/erratic. To be honest, I was shocked to get this far.&lt;/p&gt;
&lt;h2&gt;Where things stand&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;I’m not convinced this will ever work at all due to the clock (without maintaining a fork of the repo)&lt;/li&gt;
&lt;li&gt;Some of the fun features of Midipal depends on a custom bootloader, so I don’t think this would be a good beginner project&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://cs.gmu.edu/~sean/projects/gizmo/&quot;&gt;Gizmo&lt;/a&gt; exists, is easy to make, and is probably more feature-rich than Midipal&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I might keep hacking away at this just as a learning experience, but right now I’m considering this a failed project. It’s important to share the failures too though! Hopefully it’ll save someone some trouble.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Creative Commons on Bandcamp]]></title><description><![CDATA[tl;dr: I made a site to find Creative Commons music on Bandcamp called cc-bc (source). SUPPORT THE ARTISTS SUPPORT THE ARTISTS SUPPORT THE…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/cc-bc/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/cc-bc/</guid><pubDate>Mon, 17 Feb 2025 20:29:13 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;tl;dr&lt;/strong&gt;: I made a site to find Creative Commons music on Bandcamp called &lt;a href=&quot;https://handeyeco.github.io/cc-bc/&quot;&gt;cc-bc&lt;/a&gt; (&lt;a href=&quot;https://github.com/handeyeco/cc-bc&quot;&gt;source&lt;/a&gt;).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SUPPORT THE ARTISTS&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SUPPORT THE ARTISTS&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;SUPPORT THE ARTISTS&lt;/strong&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;We all benefit from open licensing and the shared pool of the public domain, whether we know it or not. From Émilie Gillet releasing her Mutable Instruments code (see my last post) to Linus Torvalds releasing Linux under the GNU General Public License (which the internet is essentially built on) to Jonas Salk choosing to not patent his polio vaccine (which is why many of us are able to walk without crutches), we’ve all been positively affected by people releasing their intellectual property into the world for everyone to use.&lt;/p&gt;
&lt;p&gt;Contributing to this pool of knowledge and shared culture can be thankless though. That’s why I started putting money aside each paycheck to support work that’s open-source hardware (OSH), open-source software (OSS), and/or creative commons (CC) music.&lt;/p&gt;
&lt;p&gt;Unfortunately my favorite place for buying independently released music - &lt;a href=&quot;https://bandcamp.com/&quot;&gt;Bandcamp&lt;/a&gt; - doesn’t have a way to filter music by license (that I’ve found yet; please let me know if you’ve found a way). During my shopping sprees, I was spending hours digging through pages trying to find both (1) music I liked and (2) music with a CC license.&lt;/p&gt;
&lt;h2&gt;Scraping Bandcamp&lt;/h2&gt;
&lt;p&gt;So I started to build a web scraper. At first it was pretty rough, but mostly worked. I sat on this project for a few months until I heard about &lt;a href=&quot;https://bandcamp.com/lafirerelief&quot;&gt;Bandcamp’s LA fire relief fundraiser&lt;/a&gt; and thought it would be cool to make a site to help others find CC music as a way to support artists and the cause.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://handeyeco.github.io/cc-bc&quot;&gt;The site is called cc-bc.&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;It allows people to look for CC music by tag or by license. It’s still a WIP, mainly because I’m still crawling and I need to figure out a way to send fragments of the data rather than sending &gt;1MB of data when loading the page, but it’s already helping me find music that I like. In fact you can see some of my favorites &lt;a href=&quot;https://handeyeco.github.io/cc-bc/#/list?faves=true&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Reflecting on results&lt;/h2&gt;
&lt;p&gt;For the most part I’m happy with the project. I got to practice some of my back-end, SQL, and crawling skills while also exploring new music.&lt;/p&gt;
&lt;p&gt;The main challenge right now (besides splitting the data into more manageable chunks) is trying to “steer” the crawler. I’m still dealing with the fallout from when the crawler went down rabbit holes around “furry” and “barber beats” music. Right now my solution to prevent hyperfocusing on specific genres is to cap each crawl at 50 CC results and restarting the crawler starting at one of my favorite albums (occassionally restarting on a random album from the DB to shake things up).&lt;/p&gt;
&lt;p&gt;Another issue is that tags are picked by the artist and are often not representative of the work they’re tagging. My co-worker was quick to point out that a random “folk” album he listened to would actually be better described as &lt;a href=&quot;https://en.wikipedia.org/wiki/Harsh_noise_wall&quot;&gt;“harsh noise wall”&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Finally there’s the question of legality for some of this “CC” music. It seems like many people mark their derivative work of copyrighted music (remixes, edits, etc.) as creative commons to naively skirt copyright law. Unfortunately I believe this is an incorrect use of CC and sets up futher derivative works for litigation, however unlikely that might be. But &lt;a href=&quot;https://en.wikipedia.org/wiki/IANAL&quot;&gt;IANAL&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Bandcamp has mercifully yet to ban my IP but I have hit some snags on rate limiting, mostly due to bugs in my code. Hopefully they’ll appreciate that I’m trying to send business their way because I love that Bandcamp exists.&lt;/p&gt;
&lt;h2&gt;Semi-open&lt;/h2&gt;
&lt;p&gt;Despite my preaching the benefits of open-source software, the crawler will remain closed-source; crawling can be controversial and I’d be worried that less polite folks would crawl more aggressively/maliciously with my code.&lt;/p&gt;
&lt;p&gt;However the site/data &lt;em&gt;are&lt;/em&gt; open-source and &lt;a href=&quot;https://github.com/handeyeco/cc-bc&quot;&gt;you can find that on Github&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Happy hacking!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[MI Grids Bitwise Shift]]></title><description><![CDATA[I’ve been having a lot fun building a generative melody sequencer for Grandbot and have started looking at other ways to algorithmically…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/grids-bit-shift/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/grids-bit-shift/</guid><pubDate>Mon, 20 Jan 2025 03:25:23 GMT</pubDate><content:encoded>&lt;p&gt;I’ve been having a lot fun building a generative melody sequencer for &lt;a href=&quot;https://github.com/handeyeco/Grandbot&quot;&gt;Grandbot&lt;/a&gt; and have started looking at other ways to algorithmically generate parts of music. Passing Grandbot’s output through my &lt;a href=&quot;https://github.com/handeyeco/norns-ripchord/&quot;&gt;norns-ripchord&lt;/a&gt; has been useful for generating chord progressions and, by using a sampler, I can repurpose Grandbot’s output to trigger chopped breakbeats for some glitchy D’n’B style drums.&lt;/p&gt;
&lt;p&gt;At one point though I had an idea: what if I took a collections of drum patterns and used them to generate a dataset of probabilities - not a collection of &lt;em&gt;sequences&lt;/em&gt;, but a collection of probabilities that could be used to generate novel sequences based on the likelihood that a specific drum would play at a specific step. I knew I would need patterns, that I would need to normalize the data, that this sounded a little like how machine learning works, and…well it all just seemed like a lot of work and maybe a little beyond my skill set.&lt;/p&gt;
&lt;p&gt;So how surprised was I when I discovered &lt;a href=&quot;https://pichenettes.github.io/mutable-instruments-documentation/modules/grids/&quot;&gt;Mutable Instruments Grids&lt;/a&gt; (&lt;a href=&quot;https://github.com/pichenettes/eurorack/tree/08460a69a7e1f7a81c5a2abcc7189c9a6b7208d4/grids&quot;&gt;source&lt;/a&gt;). This is almost exactly how Grids works. Grids is a 5x5 set of pattern probabilities (so 25 patterns) with each pattern containing 32 steps for 3 instruments (bass drum, snare drum, and hi hat); this 5x5 coordinate system is traversed using an X/Y location with the 4 patterns surrounding the X/Y point being combined through a 2D crossfade.&lt;/p&gt;
&lt;p&gt;Before I go any further, I just want to shout out two people: Émilie Gillet (aka pichenettes) who founded Mutable Instruments and who gave one of the greatest gifts ever be given to the Synth DIY scene by open-sourcing her work. Also a big thank you to Adam Thomas (aka devdsp) who who did a &lt;a href=&quot;https://devdsp.com/grids.html&quot;&gt;visualization of Grids&lt;/a&gt; - one that I borrowed and added to. You can &lt;a href=&quot;https://handeyeco.github.io/mi-grids-viz/&quot;&gt;find my version here&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;Understanding Grids&lt;/h2&gt;
&lt;p&gt;Before we get too technical, let’s talk about what Grids is doing. Grids is called a “topographic drum sequencer” because it’s working on a 2D map using the concept coordinates (X/Y point) to traverse this map. Kind of like this:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/74c50a66331cdaf6b96a48c6ab4931de/add4c/4x4-map.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAABX0lEQVQ4y8WUaW6DMBCFff+79BQ9Qn5UIixRwg4GEvatU54lI2OqpI2iNn8svjz7zcwzMNu2iXNOcRxTmqbk+z5ZlrVhnueRqsOqM+hc1yWWZRmpv3EcqSiKDRuGga7X647dbrcN67qOWJIk4mGeZ7G2bStcH7GmaUgWI1ld18SkUHXO83zD+r7fVY1q9KphzIIgoGmahEC2EYahaF1lURStDCsOw+xUHUyZ4zjiT5QPgI0YtspgoOtQyOl02jAE+nQoGMOToXwurCGuBfB0KG/vH3QwXWqb6mehoG8cgge0ARHmA9Yvm9yIUxgnFC+zVXVy3ipDIXdD4TyjuirFYY9CwWH/FcofvSly3rtQzuezcEP5VVWJSi6Xy8rgKr8k9xj24s1hcnNZlkKINnQGE7lZMvlZUxnG9/qWvwsF7i8L5TfXRmfi2hyPR+GOCy0HbRjGjuk6zNk0zZWhUwT8BaFaCk8ldi4VAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;4x4 grid with a single point at 2x2&quot;
        title=&quot;4x4 grid with a single point at 2x2&quot;
        src=&quot;/tech-blog/static/74c50a66331cdaf6b96a48c6ab4931de/fcda8/4x4-map.png&quot;
        srcset=&quot;/tech-blog/static/74c50a66331cdaf6b96a48c6ab4931de/12f09/4x4-map.png 148w,
/tech-blog/static/74c50a66331cdaf6b96a48c6ab4931de/e4a3f/4x4-map.png 295w,
/tech-blog/static/74c50a66331cdaf6b96a48c6ab4931de/fcda8/4x4-map.png 590w,
/tech-blog/static/74c50a66331cdaf6b96a48c6ab4931de/efc66/4x4-map.png 885w,
/tech-blog/static/74c50a66331cdaf6b96a48c6ab4931de/c83ae/4x4-map.png 1180w,
/tech-blog/static/74c50a66331cdaf6b96a48c6ab4931de/add4c/4x4-map.png 1452w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Okay, so I don’t know whether to call this a 5x5 or 4x4 grid; the lines represent the 25 drum patterns (5x5) but the coordinates exist within the 4x4 space between lines. If I make a mistake, chalk it up to a classic off-by-one error. Anyway let’s zoom in:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/3a01fb8e933088213c2d524e06a8a6d3/b79a5/one-cell.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAABYlAAAWJQFJUiTwAAACRElEQVQ4y5VUbWvTUBTO39k3wb/iD/APKAiCHwU/OcZAnagwKQqtTLCg+zAZS5M2zdK0XcykS7ukZe26VrutlXatc0vSPN7ErOS1mwcO93Ke5LnnnPucSzUOmlhLf0Cr18B+S4F2WPW56qy1UNyL1zs1pD4m0eudgPqSSuH5i2fICxxoZgsZlvZ7NgOajYi7bmNZjsXy8hLojc+g+ru7KH+TMc9aIxXXGb9dgNmvgzoSReQEwQnqug7TNH0OC2ieqji//A1raoVwwzCcf7cyDM6OKqC6pRLyhYITdAg8ZllWaO+N2TadTp01w2Qx6ShXhGKIMIogSBZPKPoJg2T2GhWbk2FhBkZlEWf/DoKHcA9Up1gEXy4DgwGMP+expUWROVWRy8Lw0JMhIeM4Dr8Wn+Ki1/tvQmP0E5fqBtFkDpOut+R2G8ZkEkvo7Z1JWmOQftsRY3wMa1AnA5DH2C65WyrOLmXqaX5MWmHZuCvNsPGyicvwKs4JJSTW1nE2Gs7wa3UYNNOVR3FHxu1777Dw8CseLL2HM0pOhjcQtrdvhoutbzJYuJ/GrScS7jx6TUD9ZoRx02HqF1hc/YS7j99Crijhkm0dcu7jYA+6LW6v2/ajPUT/eBw4SvclQWdY8jiQWz6VZYiSNP/50oZoKIO533C8AP1EA5VLp5FMJdFsHkBRFNRqVZ+rag18roxiQYaq7aMawKtVBfW6hkQiASm/CUokOny1sgqR/44cQ8pnywEvQeAlbHM7zj4Kz7MSXq68QWWvgr/l3MuoVXLk3QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;One cell of the 4x4 grid with each edge as a drum pattern&quot;
        title=&quot;One cell of the 4x4 grid with each edge as a drum pattern&quot;
        src=&quot;/tech-blog/static/3a01fb8e933088213c2d524e06a8a6d3/fcda8/one-cell.png&quot;
        srcset=&quot;/tech-blog/static/3a01fb8e933088213c2d524e06a8a6d3/12f09/one-cell.png 148w,
/tech-blog/static/3a01fb8e933088213c2d524e06a8a6d3/e4a3f/one-cell.png 295w,
/tech-blog/static/3a01fb8e933088213c2d524e06a8a6d3/fcda8/one-cell.png 590w,
/tech-blog/static/3a01fb8e933088213c2d524e06a8a6d3/efc66/one-cell.png 885w,
/tech-blog/static/3a01fb8e933088213c2d524e06a8a6d3/c83ae/one-cell.png 1180w,
/tech-blog/static/3a01fb8e933088213c2d524e06a8a6d3/b79a5/one-cell.png 1372w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This point exists in a space between 4 drum patterns - or rather drum &lt;em&gt;probability&lt;/em&gt; patterns. These probability patterns are blended together based on the position of the X/Y point. In this case it will be affected by all 1-4 patterns, but it will be affected by 2 and 3 more than 1 and 4.&lt;/p&gt;
&lt;p&gt;To illustrate this, let’s look at just 4 steps of one of the three instruments while pretending that each pattern has its own step. Note that each pattern’s step is a dark color (indicating a high probability) but that the outputs for 2 and 3 are darker than 1 and 4 (indicating a bias towards 2 and 3 probabilities). However the steps for 1 and 4 still have &lt;em&gt;some&lt;/em&gt; probability.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/fa4e3fd9672750e84d958faf429e7dac/86a1e/simple-blend.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 114.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAAEaElEQVQ4y31UbUxbZRS+2Y+5MEm2BYW4uPmBOGOiUbM5/GMMmm1dnBglggFhtGMUDB9R+aEiaXTww/ADggvRbD9N5g8TTJQgCsmwWwEx2VK++0W/uO29LW0p0Pb29vE9722haPQkJ+899973ec95znNeof1LA15reBFvNJ7Ge50XcN96DwExgEAgAFEU4XA44PP5eBwMBuF0OuHxeHZjr9eLSCQKskwmA+Gld5/AyQsFeFxXiNKLRzA28QvybX5+HolEYjcmMDooZ0pKgV/0YVuJ81gor3kGZZeO4tRbRXi2sgS/TmqAipLMAlqxs7Pzn4DJRBL+gA/xVEwDfJ2V+tj5B/Gk7giee/s47s5Z9mVod7oQjUaQTKaQTqfhdrvh9/v5czKZRCwWQzgU3ivZbJnCjz//wPwWJs2TmDP/juufNeA701V882k9/vxjHDa7EwsLC1hcXMTKygrnleLl5WVOSTQa2wOUgtK+jIZ7DDCUCvjorICrZQIHJ1PTCl/X1tZ4hjnb3t6GFAzsAeb4UFIa8Te+akHnywJ6dEX4pFzAt6am7PcUX6nkfA4TqTSCrnmoIZvG4fr6uoauprMZXsGVpwR8zDJsfppl+PnlfRX4/T4uo5xRw6QAw8goLEMGSDwQHwuMC5vDib/uTHLQG9c+xPAXBhZPYHzcjFvf/8R96raFle3i3C0tLcFqtSIay+OQ+FAUhWstHo9z0Hybnb2HE8fO45HCcyh6oAJnn3+fiVrke3JdDoVCe4Ck+F2Rsp8oWyWVRDrL2cRvt3HiqA6lxZU4eexNvFBWBTFLE1mKce+0+yCJWxqHND45oxMIMN8I8KFDFTheqMPDh87h1KOXkJ+EmlHhWfMjHtMSEOx2O1c/OXWQYpfLpb3zejBvXcQ7FztQ8YoBr55uQLvxGmuKF47VVbjYvza2bsY390omkdKJ1G3ic5X9QF0UGU8U2+02SHKQ8SQjJEsIhGVcN+ihLyhAa3ExjCUlWJ6b29Xqv0qmafi/y0GUZHSfOYPLApMV8zrmUzdvApubUKnkfzaFAAk4Z8Rp/uUgyjJ6yss1wAMH8AEBDg8DkqQBElfUfhqhaDTKAUkKFG9tbfGYZLHNnsl9LIGvKys5oPHwYegPHsT9qSl+WJolJNCmcDiMjY0NDkS3CL3LOcWUIT2TTqmKODt4jYnazYbCzxpIFWVUVWsKgVHZ5JSJzEqamZlhgp7lK8VU9vT0NCwWCxyss5sMWGL/hlgSMltTWc1yQBof2kQDH4lEMDQ0hKqqKuj1etTU1KCvrw9GoxF1dXXcW1pauBJkxhk11J29fVRV1XRos9l2x4d4GxwcRG1tLVpbWzmoyWRCW1sbmpqauBMgaZX2EE0ESvNsNpsxNjamARI/9JGa09/fj+rqajQ3N6O+vh7d3d0cpLGxkR9gMBg4IO0hUAKkxlKVNBBC7ualbtKL0dFRtLe3o6urCx0dHRgZGUFvby86Ozv5+4GBAQ5IVNHtTTqlZHL2N580BesyJWURAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Simple blending example showing blending bias towards 2 and 3&quot;
        title=&quot;Simple blending example showing blending bias towards 2 and 3&quot;
        src=&quot;/tech-blog/static/fa4e3fd9672750e84d958faf429e7dac/fcda8/simple-blend.png&quot;
        srcset=&quot;/tech-blog/static/fa4e3fd9672750e84d958faf429e7dac/12f09/simple-blend.png 148w,
/tech-blog/static/fa4e3fd9672750e84d958faf429e7dac/e4a3f/simple-blend.png 295w,
/tech-blog/static/fa4e3fd9672750e84d958faf429e7dac/fcda8/simple-blend.png 590w,
/tech-blog/static/fa4e3fd9672750e84d958faf429e7dac/efc66/simple-blend.png 885w,
/tech-blog/static/fa4e3fd9672750e84d958faf429e7dac/c83ae/simple-blend.png 1180w,
/tech-blog/static/fa4e3fd9672750e84d958faf429e7dac/86a1e/simple-blend.png 1296w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Now let’s look at a more likely example. In the next diagram:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;All patterns have a high probability for step 1 which means the output for step 1 has a high probability.&lt;/li&gt;
&lt;li&gt;Similarly, all patterns have a 0% chance probability for step 2, so the output for step 2 has a 0% probability.&lt;/li&gt;
&lt;li&gt;Pattern 3 has a medium probability for step 3, pattern 4 has a low probability, and patterns 1 and 2 have a 0% chance; I didn’t do that math, but that should result in a low-to-medium probability since pattern 3 pulls it up and pattern 2 pulls it down.&lt;/li&gt;
&lt;li&gt;Finally step 4 output is a very low probability because patterns 1 and 4 have some probability, but that’s brought down by patterns 2 and 3 having a 0% probability.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/301b25e5de1131f3ef4acb10c338f13c/5f652/complex-blend.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 112.83783783783782%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAAFC0lEQVQ4y1VVe0zTVxT+BbIwlmxG/WPZ0G3RmQ2yGd3ETHCZUzZd3XSRRQPKmJqpRJchEWUaFuem2WaWPczmY4HpnEhUhpMYKdKWgS1SBi2vPnmWvmhLW6ClQB/fzr3QIjc5+d3z+/V+nO/7zrkIBWf247XMJUjLSsG6j1fiX7kUw65h2GxW2O12GI1GDA4O8r19yA6LyQqx8g5+uHcc52pO4fs7RVAZlWArFA5B2LB7FZ5/7wm8tGUBFmU8jr8qLuPRxQDHxsZi+ZjXh2uyi/hJUYTfGk/iW0k+xKpKBMNTiEQiEN7Zk4oXNiXiZQJ8LiMRZX9f4QfD9NeigCMjIzHAUc8Yyup+x8/yL3Be8RW+qy1Ajfr2LODOY9uQ/NFirMxehuU7lqKq5jYQAfzjfkxNTXHA4eFhTE5O8nA7Pah4cBVnpYX4pa4Yp+99DrlGOku57OJpHNy+HId3rUZx3kZoO9ug0xug0+mg0WjQ09MDg8EArVYLrU4LvV4PQ7ceDf/JoFA1oF4phc1u44C8wq93vIKjqwUcfzMOh1cJqL5ZOk05NE2ZgT1K2el0oq+vL5aHgxE4HQ7azFD+JnsFjqQLKHo7EflrBNTMmBIKBmMaej1eLgNbDjocBYxEwpggGRzWQYQcWsoB4Uz2qzixVsCXG+JRmCZAfOuPOS6zCgMBfywfGfWgt7c3loeIiYPaCcHxacDyCz8iPzMDhVmbcXJ/FnRdHegm3VhlBtKyv78PysZ21FY3QSJWorFBhYGBAa5ld3c319ZBMsQ03LKpAAsTNyFp/lYkLfgAlRVicjMAt9sDn28MXZ0aHNxxGdvXXkDWW5eQKzqPznYtdYGPa8s0HRoamgVc/8ZeLJ4nwrKnP0TSk+/i2p+VM304LVoHHc7Pvo68rTdwKPMW9r5fgo423SOUg7DbhmAbHOVnhPQVOVj4WAYWPSXC/Ph1uFJ6c46G7eou5G27ij0br2Pf5hvYlXERbSpN7Dszxmazw+MKTFd44tg5pL+ei/Vpn0K04RAUihaiYIfJZILFYuZ9eLb4H+TnXEHBJ1dx6sgN0rgPVpp1s8WCftLT6XLNUv51dy4OzJ+Hz559BgUvLkGzVALbkAMWs5kALWSOAb3yBvRJa9Evk8DYUAdDsxJGsRi9Uim0d+/CSuZwwHAYQsHSpdgtCNhHsZPizqVLc9tGq4P9gRyTKhWm1GqYZDLopDKE2tSYoHyksREW+hYmc3iFR1NSsJeADsTHI5eed0vnToqR2sMul2O8pQWB1laY6uqgp5igvZ/CrVDA3NyMSRpTZqNQvGYNcgiIgTLAmvJyhOlDYHwcQZoWHfWZqb4eHjroffiQ09SwnCrzUG6j3KLTzVL2UqkDHR0wdXZyLdiNwm4Xt9sNF4kdmJigO9CLYbpgWYx6PDQ5ATitVp67bDZM0Rk2JpzyIImvaGrCQ6US6vZ2/mMGyIIBjlOlbM8cZRF956Cni94zh1kR071LFaampkIgqtEoKyvjH9khNqdstOqJYiNRbCKKtffvo4MYealqxsJKlZqpqOgSUsgUBhQXF8efpTOmhGZMYfeinExpIVNU5KaUNOvq6sIESeHz+Tgom232vpnMEZKTkzlQPLnMniUlJbHy2WKXgIIMaSVH1dQmUUBG0+/3w0Oammd6lt1CgkgkitFNSEhAVVUVH3qmFdOO3doSiYQHA6uurkY7ac0miQGx6439V4yu/wEOxs0BDkj2bwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Complex blending example showing how patterns interact with one another&quot;
        title=&quot;Complex blending example showing how patterns interact with one another&quot;
        src=&quot;/tech-blog/static/301b25e5de1131f3ef4acb10c338f13c/fcda8/complex-blend.png&quot;
        srcset=&quot;/tech-blog/static/301b25e5de1131f3ef4acb10c338f13c/12f09/complex-blend.png 148w,
/tech-blog/static/301b25e5de1131f3ef4acb10c338f13c/e4a3f/complex-blend.png 295w,
/tech-blog/static/301b25e5de1131f3ef4acb10c338f13c/fcda8/complex-blend.png 590w,
/tech-blog/static/301b25e5de1131f3ef4acb10c338f13c/efc66/complex-blend.png 885w,
/tech-blog/static/301b25e5de1131f3ef4acb10c338f13c/c83ae/complex-blend.png 1180w,
/tech-blog/static/301b25e5de1131f3ef4acb10c338f13c/5f652/complex-blend.png 1302w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;So which notes play? That’s where the “fill” control comes in. Fill is basically a threshold for triggering a gate. If the output probability is higher than the fill threshold, the gate is triggered. In the next diagram, I’ll indicate notes that don’t play with blue and notes that do play with orange. The probabilities stay the same each time, but as the threshold drops more notes play.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/3ef5e4599989b7deaf24e57f5da2660b/f43e4/threshold.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 118.24324324324324%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAYCAYAAAD6S912AAAACXBIWXMAABYlAAAWJQFJUiTwAAAFQUlEQVQ4y22UfUzUdRzHf82lf9Vq1VprrVatLdOaKWqmpoWuaVtamXPZnIpLpQcIC5PEUAQcypNPyPGUgqbp1IE8CALHcYBw8nwcd3gcdwf3yPEQzyC8+v1+6AXVb/vc7/f77nevfd7vz4MwOTnJ9GtiYkK+9w8M0NLSgkajoblZ5z2f/v3/PQvSj9vlwmI2MzQ4KB96uty0Ge/T7eliaGiIdpOJ1laD+KcpqHTmdru9oEchA8fGxykuVZOVk4++1Sgf1ja1kFtYgqXTIb/XNWrJzS+kp+8v+d3pdKLVameAHsGF8MQ/me2zjWdW7WHR5mB+O69kdYQK38gyvjqp5ppKR1qphVSlmQyVCbPVxsjwMIOimp6eHsbGxmZkKnwbkYowdwuzfHbw0pq9bI/NxyesnGVH1Kw/XkFKYQtpaidp5WKoOrDYXDP81uv1ZGdnU19fPyV59xEFwisbEeZv5dmVfnx9Io/5B9UsCC3jIzFLRYEORZmTJJUTRYllBlDKzm63YzQacbmmzoVcdT2fBcawKSiW4NiLFNaYOJBRxYHMak7nNNFotJNdbeKWxoyy0Yq7q4vu7m45usTn/3hYnpVGwk4fTu1ZwR+hX3Cp4B57UmvwT9Vw+Go95VorNzWd3KjuIL+2A1eXR6zyIP39A/T19XnbyQtMC9uB/1sCAUsEwnznsDPyEvNCK1l4aEpyYl4TyaJkRZkLRbEZk9XuBYyOjtLe3o5SqRTbqnVKcvpDYOBigcO+s/GLzOTt0HJ8DilZG1nKORGoUDmmQvRwOlDyUAJWVFTIdxmovJ5C9LaFxOxazvlfNpB6u4Etima2KrTsu2ygTGvjhsbGzXsOcutsouRuxsTMpOz6+/sZF/t4+iXUqW9z8qfNnAnewqWEg1hrctFfDKTlUhCWvOPojFZyNO3kVLehEovikYvhlqv676JIvSlL3vumQJCPwL4Pn+JO1EZsx96gI3oelpjFXMwu5myZB0Wp/T+SpSyl5pZmXqp6c3MzwvnwXQQsENi/QoyPn6ck+nNcse/giPfBdnI5V/NUpFR4SFc75Imx2t1eoCTX4XCQlZWFTqeT+1HITokg2PdpDn7yApHbl1Gd+SuGuNXo49fQlryZ/PIGualTVHYyyzux2pyMjAwzLI5fb2/vDA8NBgOCvr6S36O+58KxH7h1IZ4OXRUN1yJovHaU1qJ0bOZWmquK0FUX09ZUJUrsxuPxyNtGuk8fQ6nqwoWI3Xw3X+Dn9wSC1z5HScwWnMfn4hRlmxJWoc2KZ7I6ETSJdJeewtJm8EJGRkZkqOSfd31lRHxD4CLRv5WzOLDuRZQnvsQRuwBbnA+mU77osuMZrU5mTJOCR5UoZnz/4VRMyFnV1dVRUFDglS5cPhHIj+KUhKyeQ+iGVyk77Yc9bhH2hKW0n12HLi9Rho3fS8VTpsBmafNmOPxwjUkwb4atTRrSogJIjxI9zDhFp6GWmitHxQhHd+fClIeq63LcrykRPeyVe1BaspKPj0DefXg1YT9B7z9GiO8ThG2aS3mSP5a4pVjil2NM/BRdQQoDlckM3k3GqUqm02xEYoyPj8nZSb04Ayh5KDV1yKrHCVk/5aE7/l2cJ5dgPr1G9DCOiZpUJmvT6FGfw2H9R/KDBw+orKyUJ8a7bdIP+7HzNQF/sdIBHzxJUfQm2o+8jCn8dfTRS2m8GctAaRyDqngchXFilfVIIidEmDTL01eYDGxtuMuNxENkJYVRdDUJm64Sc+EZzHfO0FF5BZe5BadWibO5FKehSmzmHlmqFBJwuofS9TegpSOXvtuQuwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Diagram showing that as threshold decreases, likelihood of notes playing increases&quot;
        title=&quot;Diagram showing that as threshold decreases, likelihood of notes playing increases&quot;
        src=&quot;/tech-blog/static/3ef5e4599989b7deaf24e57f5da2660b/fcda8/threshold.png&quot;
        srcset=&quot;/tech-blog/static/3ef5e4599989b7deaf24e57f5da2660b/12f09/threshold.png 148w,
/tech-blog/static/3ef5e4599989b7deaf24e57f5da2660b/e4a3f/threshold.png 295w,
/tech-blog/static/3ef5e4599989b7deaf24e57f5da2660b/fcda8/threshold.png 590w,
/tech-blog/static/3ef5e4599989b7deaf24e57f5da2660b/efc66/threshold.png 885w,
/tech-blog/static/3ef5e4599989b7deaf24e57f5da2660b/f43e4/threshold.png 1120w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Just a disclaimer, this is more meant to be a conceptual example not a precise description of how the code works. Anyway let’s recap the ideas:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We have 25 (5x5) drum probability patterns that are formed to create a 4x4 grid&lt;/li&gt;
&lt;li&gt;We traverse this grid using an X and Y position&lt;/li&gt;
&lt;li&gt;We blend the 4 patterns that surround the X/Y position in a way that’s biased towards the patterns we’re closest to&lt;/li&gt;
&lt;li&gt;We read steps from this blended probability pattern and compare each step to a threshold to determine whether or not the step should trigger a gate&lt;/li&gt;
&lt;li&gt;We do this for 32 steps for 3 instruments (sharing the X/Y coordinate but with each instrument having its own fill setting)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;If things still aren’t clicking, play around with the visualizer that Adam Thomas made and which I modified to add a visualization of the coordinate grid: &lt;a href=&quot;https://handeyeco.github.io/mi-grids-viz/&quot;&gt;here’s that link again&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Whew that was a lot. What’s this blog post about again? Right, bit shifting.&lt;/p&gt;
&lt;h2&gt;Understanding Grids’ bit shifting&lt;/h2&gt;
&lt;p&gt;At this point you might be thinking we’re about to dig into an encyclopedia’s worth of code in order to work in this blended, multi-dimensional space - at least that’s what I was thinking. If so, you’ll be surprised to discover that the reading/blending code is relatively concise (if a little opaque).&lt;/p&gt;
&lt;p&gt;I’m sure a lot went into the machine learning data crunching, but accessing and blending the data can be cleverly done with a few lines of code thanks to some &lt;a href=&quot;https://en.wikipedia.org/wiki/Bitwise_operation&quot;&gt;bitwise operators&lt;/a&gt;. Coming from JavaScript this was a novel idea - it’s rare that we need the speed or control that bit manipulation offers and numbers in JS are floats anyway so it’s not as straightforward as it is in C++.&lt;/p&gt;
&lt;p&gt;Let’s look at the code. First we’ll make the 5x5 grid:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// pattern_generator.cc&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prog_uint8_t&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; drum_map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node_10&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_8&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_0&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_9&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_11 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node_15&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_7&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_13&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_12&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_6 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node_18&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_14&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_5&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_3 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node_23&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_16&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_21&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_2 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node_24&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_19&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_17&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_20&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; node_22 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Each node here is is an array of 96 probabilities - 3 instruments (BD, SD, HH) times 32 steps - and each probability is represented as a byte (0-255). Now we’ll read a specific step (0-31), for a specific instrument (0-2), for a specific X/Y position (0-255 / 0-255):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// pattern_generator.h&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; kStepsPerPattern &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// pattern_generator.cc&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; PatternGenerator&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ReadDrumMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; step&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; instrument&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prog_uint8_t&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; a_map &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; drum_map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prog_uint8_t&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; b_map &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; drum_map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prog_uint8_t&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; c_map &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; drum_map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prog_uint8_t&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; d_map &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; drum_map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instrument &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; kStepsPerPattern&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; step&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pgm_read_byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a_map &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pgm_read_byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;b_map &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pgm_read_byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c_map &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; d &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pgm_read_byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;d_map &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; d&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// In a shared utility repository&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; balance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; balance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; balance &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;If you look at this and think “yeah, that makes sense” then I wasted your time. I’m sorry. The rest of this article is just going to explain these 20-ish lines of code.&lt;/p&gt;
&lt;p&gt;First let’s describe this with pseudocode:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;We declare a function called &lt;code class=&quot;language-text&quot;&gt;ReadDrumMap&lt;/code&gt; that accepts 4 bytes: &lt;code class=&quot;language-text&quot;&gt;step&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;instrument&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;x&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;y&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;We use &lt;code class=&quot;language-text&quot;&gt;x&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;y&lt;/code&gt; to get indices (&lt;code class=&quot;language-text&quot;&gt;i&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;j&lt;/code&gt;) that we then use to get pointers to 4 patterns from &lt;code class=&quot;language-text&quot;&gt;drum_map&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Since each node in &lt;code class=&quot;language-text&quot;&gt;drum_map&lt;/code&gt; is an array of 96 probabilities and each of the three instruments takes up 32 of those 96 slots, we multiply &lt;code class=&quot;language-text&quot;&gt;instrument&lt;/code&gt; by &lt;code class=&quot;language-text&quot;&gt;kStepsPerPattern&lt;/code&gt; (32) and then apply the &lt;code class=&quot;language-text&quot;&gt;step&lt;/code&gt; offset to get our final index &lt;code class=&quot;language-text&quot;&gt;offset&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;We then get the probability for that instrument/step from each of the 4 patterns (&lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; - &lt;code class=&quot;language-text&quot;&gt;d&lt;/code&gt;).&lt;/li&gt;
&lt;li&gt;Finally we blend the 4 bytes representing the 4 probabilities into 1 byte.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;But wtf is &lt;code class=&quot;language-text&quot;&gt;x &amp;lt;&amp;lt; 2&lt;/code&gt;? How does &lt;code class=&quot;language-text&quot;&gt;x &amp;gt;&amp;gt; 6&lt;/code&gt; convert a byte into a 0-3 index? Why do we need &lt;code class=&quot;language-text&quot;&gt;&amp;gt;&amp;gt; 8&lt;/code&gt; at the end of &lt;code class=&quot;language-text&quot;&gt;U8Mix&lt;/code&gt;? This is the power of bit-shift operators. 🌈&lt;/p&gt;
&lt;h3&gt;Mapping 0-255 to 0-3&lt;/h3&gt;
&lt;p&gt;The first bit-shift operation we hit is &lt;code class=&quot;language-text&quot;&gt;uint8_t i = x &amp;gt;&amp;gt; 6;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;We know that &lt;code class=&quot;language-text&quot;&gt;x&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;y&lt;/code&gt; are values between 0 and 255, but we want to map this to 0-3 to get our first x- and y-patterns from &lt;code class=&quot;language-text&quot;&gt;drum_map&lt;/code&gt; (which we can use to get our second x- and y-patterns by adding 1 to the indices). What I probably would have done was use Arduino’s map:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; in_min&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; in_max&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; out_min&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; out_max&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; in_min&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;out_max &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; out_min&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;in_max &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; in_min&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; out_min&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;However, division is pretty inefficient which could be a problem in time-sensitive applications. Here’s a quote from Émilie that hints at her motivation for using bit shifting:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;…you need to divide by 255 instead of shifting by 8, and what took 1 CPU cycle will suddenly take 40+&lt;/p&gt;
&lt;p&gt;(&lt;a href=&quot;https://handeyeco.github.io/mi-grids-viz/&quot;&gt;source is on my visualizer clone&lt;/a&gt;)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;That’s where bit shifting comes in. But what does a right shift do? Let’s look at some code.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;byte a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// decimal 0   is 00000000 as a binary byte&lt;/span&gt;
byte b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// decimal 64  is 01000000&lt;/span&gt;
byte d &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;128&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// decimal 128 is 10000000&lt;/span&gt;
byte e &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;192&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// decimal 192 is 11000000&lt;/span&gt;
byte f &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// decimal 255 is 11111111&lt;/span&gt;

&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 11111111&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 01111111&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 00111111&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 00000001&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 00000000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Some things to note:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Bit-shifting right moves all of the existing bits right, drops the right-most bit, and prepends the byte with a 0.&lt;/li&gt;
&lt;li&gt;As we move from 0 to 255, the left-most two bits have 4 distict states: &lt;code class=&quot;language-text&quot;&gt;00&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;01&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;10&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;11&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Counting 4 steps is exactly what we need.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;So enough being coy, let’s do the thing.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;  &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 00000000 becomes 00000000 = 0&lt;/span&gt;
 &lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 01000000 becomes 00000001 = 1&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;128&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 10000000 becomes 00000010 = 2&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;192&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 11000000 becomes 00000011 = 3&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Since bit-shifting right drops the right-most bits and prepends the byte with 0, we will always end up with 0-3 when keeping only two of the bits. By using the most significant bits (MSB), 0-3 maps fairly evenly across 0-255&lt;/p&gt;
&lt;h3&gt;Reclaiming 6 bits&lt;/h3&gt;
&lt;p&gt;While we want to be able to blend our 5x5 grid, we don’t just want 16 (4x4) steps of resolution - that’d be boring! &lt;code class=&quot;language-text&quot;&gt;x&lt;/code&gt; is 0-255 and &lt;code class=&quot;language-text&quot;&gt;y&lt;/code&gt; is 0-255, so we &lt;em&gt;should&lt;/em&gt; have 65,025 possibilities. So that’s why we blend between patterns. However we’re already using 2 bits for the indicies.&lt;/p&gt;
&lt;p&gt;Here’s where the next shift happens: &lt;code class=&quot;language-text&quot;&gt;x &amp;lt;&amp;lt; 2&lt;/code&gt;. With a left bit shift, we drop the left-most bit and add a 0 to the right of the byte.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 11111111&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 11111110&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 11111100&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 10000000&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 00000000&lt;/span&gt;

  &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 00000001 becomes 00000100 = 4&lt;/span&gt;
  &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 00000010 becomes 00001000 = 8&lt;/span&gt;
  &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 00000011 becomes 00001100 = 12&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;253&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 11111101 becomes 11110100 = 244&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;254&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 11111110 becomes 11111000 = 248&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 11111111 becomes 11111100 = 252&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Note that it moves in increments of 4 when we shift by 2, which gives us 64 steps between 0 and 255. However this is 64 steps &lt;em&gt;per&lt;/em&gt; section in the 4x4 grid; 64*4 is 256 which is the number of steps from 0-255. We’re back baby!&lt;/p&gt;
&lt;p&gt;So &lt;code class=&quot;language-text&quot;&gt;x &amp;gt;&amp;gt; 6&lt;/code&gt; helps us break 0-255 into 0-3 and &lt;code class=&quot;language-text&quot;&gt;x &amp;lt;&amp;lt; 2&lt;/code&gt; helps us get a 64 step resolution within a single section of the 4x4 grid. Together they let us traverse seemlessly while also letting us access the &lt;code class=&quot;language-text&quot;&gt;drum_map&lt;/code&gt; gracefully.&lt;/p&gt;
&lt;h3&gt;Scaling up, scaling down&lt;/h3&gt;
&lt;p&gt;This final bit of bit shifting is &lt;code class=&quot;language-text&quot;&gt;balance &amp;gt;&amp;gt; 8&lt;/code&gt; in &lt;code class=&quot;language-text&quot;&gt;U8Mix&lt;/code&gt;. For that it’s useful to look at the whole function again:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; balance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; balance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; balance &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s a crossfade between &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;b&lt;/code&gt; where &lt;code class=&quot;language-text&quot;&gt;balance&lt;/code&gt; is the mix between the two. They’re all bytes, so they all have a range between 0 and 255.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 255 - balance = 255 - 0 = 255&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// a * 255 = 0 * 255 = 0&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// b * balance = 255 * 0 = 0&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 0 + 0 = 0&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 00000000 &gt;&gt; 8 = 00000000&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// U8Mix(0, 255, 0) = 0&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 255 - balance = 255 - 255 = 0&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// a * 0 = 0 * 0 = 0&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// b * balance = 255 * 255 = 65025&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 0 + 65025 = 65025&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//     65025 is bigger than a byte!!!&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//     We need two bytes to represent it&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 1111111000000001 &gt;&gt; 8 = 11111110&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// U8Mix(0, 255, 255) = 254&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;37&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;145&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;36&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 255 - balance = 255 - 36 = 219&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// a * 219 = 37 * 219 = 8103&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// b * balance = 145 * 36 = 5220&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 8103 + 5220 = 13323&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//     13323 is bigger than a byte!!!&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;//     We need two bytes to represent it&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 0011010000001011 &gt;&gt; 8 = 00110100&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// U8Mix(37, 145, 36) = 52&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So here’s what’s happening:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;We scale &lt;code class=&quot;language-text&quot;&gt;a&lt;/code&gt; up by the inverse of balance&lt;/li&gt;
&lt;li&gt;We scale &lt;code class=&quot;language-text&quot;&gt;b&lt;/code&gt; up by balance&lt;/li&gt;
&lt;li&gt;We add the two scaled numbers up, which may exceed a byte&lt;/li&gt;
&lt;li&gt;We shift the whole thing right by 8 bits, which scales the number back down to a byte&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;So in a sense, &lt;code class=&quot;language-text&quot;&gt;n &amp;gt;&amp;gt; 8&lt;/code&gt; is an imperfect equivalent of &lt;code class=&quot;language-text&quot;&gt;n / 256&lt;/code&gt;, one that’s close enough to use in exchange for the added performance boost that comes from avoiding division.&lt;/p&gt;
&lt;h2&gt;The whole thing&lt;/h2&gt;
&lt;p&gt;So let’s go through the whole thing.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ReadDrumMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// step (0-31)&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// instrument (0-2)&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;89&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// x (0-255)&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// y (0-255)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We’ll immediately hit the first bit shift:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 89 &gt;&gt; 6 = b01011001 &gt;&gt; 6 = b00000001 = 1&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// 30 &gt;&gt; 6 = b00011110 &gt;&gt; 6 = b00000000 = 0&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We can use those numbers to access &lt;code class=&quot;language-text&quot;&gt;drum_map&lt;/code&gt; now:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prog_uint8_t&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; a_map &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; drum_map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// drum_map[i][j] = drum_map[1][0] = node_15&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prog_uint8_t&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; b_map &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; drum_map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// drum_map[i + 1][j] = drum_map[2][0] = node_18&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prog_uint8_t&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; c_map &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; drum_map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// drum_map[i][j + 1] = drum_map[1][1] = node_7&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; prog_uint8_t&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; d_map &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; drum_map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// drum_map[i + 1][j + 1] = drum_map[2][1] = node_14&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we calculate the offset to access the specific probabilites. Note that &lt;code class=&quot;language-text&quot;&gt;a_map&lt;/code&gt; is a pointer to the first byte of the array; the address tells us where to look for the array and incrementing it tells us where in the array to look.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;instrument &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; kStepsPerPattern&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; step&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// offset = (2 * 32) + 2 = 64 + 2 = 66&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pgm_read_byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a_map &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// node_15[66] = 28&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pgm_read_byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;b_map &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// node_18[66] = 0&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pgm_read_byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c_map &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// node_7[66]  = 72&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;uint8_t&lt;/span&gt; d &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pgm_read_byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;d_map &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; offset&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// node_14[66] = 8&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then blend the four probabilities:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;U8Mix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; d&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// U8Mix(a, b, x &amp;lt;&amp;lt; 2) =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(28, 0, 89 &amp;lt;&amp;lt; 2) =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(28, 0, b01011001 &amp;lt;&amp;lt; 2) =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(28, 0, b01100100) =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(28, 0, 100)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// a * (255 - balance) + b * balance &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     28 * (255 - 100) + 0 * 100 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     28 * 155 + 0 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     4340 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     b0001000011110100 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     b00010000 = 16&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// U8Mix(a, b, x &amp;lt;&amp;lt; 2) = &lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(72, 8, 89 &amp;lt;&amp;lt; 2) =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(72, 8, b01011001 &amp;lt;&amp;lt; 2) = &lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(72, 8, b01100100) =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(72, 8, 100)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// a * (255 - balance) + b * balance &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     72 * (255 - 100) + 8 * 100 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     72 * 155 + 8 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     11168 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     b0010101110100000 &gt;&gt; 8 = &lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     b00101011 = 43&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// U8Mix(a, b, x &amp;lt;&amp;lt; 2) = U8Mix(16, 43, 30 &amp;lt;&amp;lt; 2) =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(16, 43, b00011110 &amp;lt;&amp;lt; 2) =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(16, 43, b01111000) =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     U8Mix(16, 43, 120)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// a * (255 - balance) + b * balance &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     16 * (255 - 120) + 43 * 120 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     16 * 135 + 5160 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     7320 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     b0001110010011000 &gt;&gt; 8 =&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;//     b00011100 = 28&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So…&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token function&quot;&gt;ReadDrumMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// step (0-31)&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// instrument (0-2)&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;89&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// x (0-255)&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// y (0-255)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// returns 28&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Fill is kind of a reverse threshold, so if it’s turn up enough that the threshold for instrument 2 at step 2 is below 28 then the step will play.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;There’s a bunch of other bitwise operators in Grids, but these are the ones that stood out to me as I was trying to understand how Grids works. I’m not sure I’ll be using the same approach as Grids when/if I do something similar with Grandbot, but it was fun learning about this.&lt;/p&gt;
&lt;p&gt;Again, my deepest gratitude to pichenettes and devdsp for sharing their knowledge.&lt;/p&gt;
&lt;p&gt;Happy hacking!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[From MIDI to Ripchord]]></title><description><![CDATA[tl;dr: if you typed “free ripchord presets” and landed here, here’s a bunch of free Ripchord presets thanks to SHLD. Ripchord is a free…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/shld-ripchord/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/shld-ripchord/</guid><pubDate>Thu, 09 Jan 2025 20:29:13 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;tl;dr&lt;/strong&gt;: if you typed “free ripchord presets” and landed here, here’s a &lt;a href=&quot;/tech-blog/2978c33d261d9941a02ee756507b1e21/shld-ripchord-progressions.zip&quot;&gt;bunch of free Ripchord presets&lt;/a&gt; thanks to &lt;a href=&quot;https://github.com/ldrolez/free-midi-chords&quot;&gt;SHLD&lt;/a&gt;.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;a href=&quot;https://trackbout.com/&quot;&gt;Ripchord&lt;/a&gt; is a free, open-source VST for mapping single note presses into chords. It uses XML to store presets in this format:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;xml&quot;&gt;&lt;pre class=&quot;language-xml&quot;&gt;&lt;code class=&quot;language-xml&quot;&gt;&lt;span class=&quot;token prolog&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ripchord&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;preset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- MIDI note to trigger the chord --&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;input&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;note&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;60&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;&amp;lt;!-- name of the chord and MIDI notes to play --&gt;&lt;/span&gt;
      &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;chord&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;C Major&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;notes&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;60;64;67&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;/&gt;&lt;/span&gt;&lt;/span&gt;
    &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;input&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;preset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ripchord&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;While working on &lt;a href=&quot;https://github.com/handeyeco/Grandbot&quot;&gt;Grandbot&lt;/a&gt;, I thought it would be cool if he could generate chord progressions. Rather than trying to program progressions into Grandbot directly though (which would be boring because I don’t know a ton of music theory), I decided to leverage the Ripchord preset format to make &lt;a href=&quot;https://github.com/handeyeco/norns-ripchord&quot;&gt;norns-ripchord&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Now Grandbot can make a sequence of notes and Norns can adapt those notes into chord progressions. With two Grandbots I can convert the chord progressions back into melodies!&lt;/p&gt;
&lt;p&gt;So far, so good. The only problem is that there isn’t a ton of Ripchord presets available online and I didn’t want to use proprietary formats like Scaler or Cthulhu. &lt;a href=&quot;https://www.patreon.com/musicianparadise&quot;&gt;Musician Paradise&lt;/a&gt; has a bunch of great Ripchord presets and I also found &lt;a href=&quot;https://github.com/ldrolez/free-midi-chords&quot;&gt;SHLD Free MIDI Chord Packs&lt;/a&gt; - the only problem with the latter is that my code reads XML and not MIDI files.&lt;/p&gt;
&lt;p&gt;So I wrote &lt;a href=&quot;https://github.com/handeyeco/shld-ripchord&quot;&gt;shld-ripchord&lt;/a&gt;. Here’s the basic idea of the script which is using &lt;a href=&quot;https://mido.readthedocs.io/en/stable/&quot;&gt;Mido&lt;/a&gt; for MIDI parsing:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# SHLD files are named like: Am - I IV V IV.mid&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# so we grab the roman numeral name of each chord&lt;/span&gt;
name_regex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; re&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;compile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;.+ - (.+).mid&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
name_match &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name_regex&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;match&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;source_path&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
chord_names &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; name_match&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;group&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;split&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# set some global variables&lt;/span&gt;
prog_dict &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
chord_count &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
chord_notes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# I wanted mappings to be on white keys&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# starting with middle C&lt;/span&gt;
white_key_intervals &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
trig_note &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# load the MIDI file and iterate over the MIDI messages&lt;/span&gt;
midi_file &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mido&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;MidiFile&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;source_path&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; msg &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; midi_file&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# accumulate all sequential &quot;note on&quot; notes&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;note_on&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        chord_notes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;note&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;# when we hit a &quot;note off&quot; MIDI message&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# convert collected &quot;note on&quot; messages into a chord&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;elif&lt;/span&gt; msg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;note_off&quot;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;and&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;chord_notes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;# create a new mapping: trigger + name + chord&lt;/span&gt;
        prog_dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;trig_note&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        prog_dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;trig_note&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;notes&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; chord_notes
        prog_dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;trig_note&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; chord_names&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;chord_count&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;# reset&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;# increment trig_note in a way that makes all triggers&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;# land on white keys&lt;/span&gt;
        trig_note &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; white_key_intervals&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;chord_count &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;white_key_intervals&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        chord_count &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
        chord_notes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Here’s the code explained:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Go through each MIDI message in a &lt;code class=&quot;language-text&quot;&gt;.mid&lt;/code&gt; file using Mido&lt;/li&gt;
&lt;li&gt;Collect all “note on” messages until we hit a “note off”&lt;/li&gt;
&lt;li&gt;When we hit “note off”, combine collected notes into a chord&lt;/li&gt;
&lt;li&gt;Use the SHLD file name convention as a way to name chords&lt;/li&gt;
&lt;li&gt;Increment the trigger note in a way that lands them on white keys&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;The reason I didn’t want to be clever about the which trigger note to use:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Progressions reuse chords; &lt;code class=&quot;language-text&quot;&gt;I IV V IV&lt;/code&gt; uses the &lt;code class=&quot;language-text&quot;&gt;IV&lt;/code&gt; chord twice&lt;/li&gt;
&lt;li&gt;The lowest note isn’t always the root note&lt;/li&gt;
&lt;li&gt;Placing chords on root notes doesn’t show the chord progression&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;So I just throw them on the white keys and &lt;code class=&quot;language-text&quot;&gt;norns-ripchord&lt;/code&gt; can lock stray notes onto the nearest mapping.&lt;/p&gt;
&lt;p&gt;Once I finished this project, &lt;strong&gt;I realized I had actually done this before in JavaScript&lt;/strong&gt; which is kind of embarrassing. It was part of my unfinished attempt to autogenerate Ripchord presets based on sets of chords: &lt;a href=&quot;https://github.com/handeyeco/ripchord-presets&quot;&gt;ripchord-presets&lt;/a&gt;. My life fluttering away one MIDI project at a time.&lt;/p&gt;
&lt;p&gt;Anyway, here’s a &lt;a href=&quot;/tech-blog/2978c33d261d9941a02ee756507b1e21/shld-ripchord-progressions.zip&quot;&gt;bunch of free Ripchord chord progression presets&lt;/a&gt; ala SHLD.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[SysEx and the Web MIDI API]]></title><description><![CDATA[Yesterday I wrote a blog post about how to send DX7 SysEx cartridges to the Korg Volca FM2. While I was writing it, I was thinking about how…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/web-midi-sysex/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/web-midi-sysex/</guid><pubDate>Sat, 14 Dec 2024 03:25:23 GMT</pubDate><content:encoded>&lt;p&gt;Yesterday I wrote &lt;a href=&quot;https://handeyeco.github.io/tech-blog/volca-fm2-cart/&quot;&gt;a blog post&lt;/a&gt; about how to send DX7 SysEx cartridges to the Korg Volca FM2. While I was writing it, I was thinking about how it was weird that SysEx Librarian only worked for OSX, MIDI-OX only worked for Windows, and there wasn’t a web-based solution for sending SysEx. It piqued my curiosity, so I thought I’d give it a go with the &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Web_MIDI_API&quot;&gt;Web MIDI API&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Introducing &lt;a href=&quot;https://handeyeco.github.io/sysex-send/&quot;&gt;SysEx Send&lt;/a&gt; (&lt;a href=&quot;https://github.com/handeyeco/sysex-send&quot;&gt;Source&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;For security reasons, Firefox has locked down the Web MIDI API so it’s kind of difficult to use. As a Google hater it’s with a heavy heart that I need to say this is a Chrome-focused solution.&lt;/p&gt;
&lt;p&gt;Anyway, with all that out of the way, here’s how sending SysEx works on the web.&lt;/p&gt;
&lt;h2&gt;Get MIDI access&lt;/h2&gt;
&lt;p&gt;The Web MIDI API can be abused by malicious assholes (for instance for &lt;a href=&quot;https://en.wikipedia.org/wiki/Device_fingerprint&quot;&gt;fingerprinting&lt;/a&gt;), part of why Firefox has locked it down. Chrome also locks it down to some extent, so we need to get permission from the user first before accessing MIDI devices.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;navigator
  &lt;span class=&quot;token comment&quot;&gt;// explicitly allow SysEx when requesting MIDI access&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;requestMIDIAccess&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; sysex&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;access&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// here you have access to a map of MIDI outputs&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;access&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;outputs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Get a SysEx file&lt;/h2&gt;
&lt;p&gt;I used a &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/HTML/Element/input/file&quot;&gt;file input&lt;/a&gt; that only allows files with &lt;code class=&quot;language-text&quot;&gt;.syx&lt;/code&gt; extensions:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleSelectSysex&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;e&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Get access to the first Sysex file selected&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; sysexFile &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;target&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;files&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sysexFile&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;input type&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;file&quot;&lt;/span&gt;
  accept&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;.syx&quot;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// I&apos;m using React, but you don&apos;t need to&lt;/span&gt;
  onChange&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;handleSelectSysex&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Send those bytes&lt;/h2&gt;
&lt;p&gt;There are several ways to read a file in the &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/File_API&quot;&gt;File API&lt;/a&gt;, but here’s what I did:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// load the file into a buffer&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; buffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; sysexFile&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;arrayBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// convert that buffer into an array a 8-bit unsigned ints&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; arr &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Uint8Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// use the MIDI output to send the array of bytes&lt;/span&gt;
output&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arr&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;That’s pretty much all there was to it, the rest of the code is building up the UI around it. Just took a couple of hours and I was loading DX7 carts to my Volca FM2 from the browser.&lt;/p&gt;
&lt;p&gt;Again, the project is open-source so if you’d like to know more &lt;a href=&quot;https://github.com/handeyeco/sysex-send&quot;&gt;check out the code here&lt;/a&gt;. Happy hacking!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Korg Volca FM2 Full Cart SysEx]]></title><description><![CDATA[Update 2024-12-14: I thought it was weird that I couldn’t find a web-based tool for sending SysEx, so I ended up making one: SysEx Send…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/volca-fm2-cart/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/volca-fm2-cart/</guid><pubDate>Fri, 13 Dec 2024 03:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;Update 2024-12-14:&lt;/strong&gt; I thought it was weird that I couldn’t find a web-based tool for sending SysEx, so I ended up making one: &lt;a href=&quot;https://handeyeco.github.io/sysex-send/&quot;&gt;SysEx Send&lt;/a&gt; (&lt;a href=&quot;https://github.com/handeyeco/sysex-send&quot;&gt;Source&lt;/a&gt;). The steps are basically the same as below except now you can use SysEx Send instead of SysEx Librarian.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Update 2024-12-15:&lt;/strong&gt; I noticed that the FM2 can store 64 presets, but a DX7 cart holds 32 presets. That means when sending a cart presets 1-32 are changed but presets 33-64 stay as factory presets. If anyone knows how to overwrite 33-64 via a SysEx dump, please let me know!&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;&lt;strong&gt;!! SENDING A CART WILL OVERWRITE THE PRESETS SAVED ON YOUR FM2 !!&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;Korg flexes the FM2’s compatibility with the DX7 quite a bit; right on the landing page for the FM2:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;“completely compatible with SYS-EX patches for the DX7”&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;“full classic Sys-Ex compatibility”&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;However the manual is a bit more obtuse:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;em&gt;“sound files (SYS-EX/SYX) created on the Yamaha DX7 can be converted and loaded into the volca fm”&lt;/em&gt;&lt;/li&gt;
&lt;li&gt;&lt;em&gt;“the MIDI IN jack can be used…to receive SYX (Yamaha DX7) sound data files”&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As I was writing an email to Korg I finally figured it out, and while it seems obvious now, I thought I’d share the process.&lt;/p&gt;
&lt;h2&gt;tl;dr&lt;/h2&gt;
&lt;p&gt;Just send the cart SysEx using something like &lt;a href=&quot;https://www.snoize.com/SysExLibrarian/&quot;&gt;SysEx Librarian&lt;/a&gt;.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Connect the FM2 to your MIDI interface&lt;/li&gt;
&lt;li&gt;Download a cart&lt;/li&gt;
&lt;li&gt;Drag it into SysEx Librarian&lt;/li&gt;
&lt;li&gt;Hit the “Play” button&lt;/li&gt;
&lt;li&gt;Go through the presets&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;It won’t be immediately obvious that anything happened because the current patch is in memory and loaded from the previous cart. When you change patches you’ll see the patches from the new cart.&lt;/p&gt;
&lt;h2&gt;A little more in-depth&lt;/h2&gt;
&lt;h3&gt;1. Connect the FM2 to your MIDI interface&lt;/h3&gt;
&lt;p&gt;Not all MIDI interfaces are created equally; the cheaper ones notoriously have trouble handling SysEx messages. MIDI interface out to FM2 MIDI in obviously.&lt;/p&gt;
&lt;h3&gt;2. Download a cart&lt;/h3&gt;
&lt;p&gt;This is about sending a full cart (32 presets as opposed to 1 preset) and there are plenty to choose from online. &lt;a href=&quot;https://asb2m10.github.io/dexed/&quot;&gt;Dexed&lt;/a&gt; comes with several and you can find a bunch at &lt;a href=&quot;https://yamahablackboxes.com/collection/yamaha-dx7-synthesizer/patches/&quot;&gt;Yamaha Black Boxes&lt;/a&gt;. The file type must be &lt;code class=&quot;language-text&quot;&gt;.syx&lt;/code&gt;.&lt;/p&gt;
&lt;h3&gt;3. Drag it into SysEx Librarian&lt;/h3&gt;
&lt;p&gt;Download, install, and open &lt;a href=&quot;https://www.snoize.com/SysExLibrarian/&quot;&gt;SysEx Librarian&lt;/a&gt; on Mac (&lt;a href=&quot;http://www.midiox.com/&quot;&gt;MIDI-OX&lt;/a&gt; might be a good option for Windows, as recommended by &lt;a href=&quot;https://www.sweetwater.com/sweetcare/articles/how-do-i-send-and-receive-sysex-on-pc-or-mac/#SysEx-MIDI-files-on-PC&quot;&gt;Sweetwater&lt;/a&gt;). Drag the &lt;code class=&quot;language-text&quot;&gt;.syx&lt;/code&gt; file into SysEx Librarian and make sure it’s set up to use your MIDI interface.&lt;/p&gt;
&lt;h3&gt;4. Hit the “Play” button&lt;/h3&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/8418e739e146429e26fa9bfcfd24482e/e9131/sysex-lib.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAACHUlEQVQoz52T3U/aUBjG+1/vYolRt1t3N++XuWxm8wND44hOJvgFlfIhjg+phZZCgYISgrSV9rcDanZjsrkmT99znvd5nrw5J0eKr3/ip7LNcS5DPpslnzojr6TJZzIUxD59espRMkkikSCdTlMoFMjm8iiZHBmhURSFrNCpqkosFkPa2Y1Riu9Ty5xTtWy6W5/pHnynk1Wxhah5fIRVKmH3+tidHo7joDUHyOkex0dJovIupXKVbxub7O3tIx0m45j7EYbRNaxKAaupYzeq2MYVLb3M1cU5dcHbZk1wNVqip1WKXFd/Ub1Uucym0Mp5ykWVQzGYtPjhnHc/Bix8bbG6esj7jzkWIgOWd/osCbyRb1mOOCxtdlja6rK40WYlorPwReP1usWrtWvebtusyF12EiWk4plK/+CAxgisG492sYJRqGI2HIEeptbGaI8w+i6GM8EUtTP0ad3483Vz4M357iigdKUjtQoqXCiEBIRTT1Tx3Tpg6tCxwLiG8VCQUwj8OYKpL7QP63C+90Q/pFEXgYamEYxGuK6L5/t4noc7neKGIW4QiAru/f2c9zz/WbiuRyD0uj4LbDbFbMI0M8wCH0P/wH2oT71nMPOGT4GmaRKISf5m+qfAeh2pLn6+IMd3d9xNJi/Ho+9eHFOtVkOajTk7v/F4/NB8AWaeiQgbDofzDE3chyTLMqlUilPxxP4X8Xick5MTotEovwHwPmjovViyAgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Location of important parts of SysEx Librarian&quot;
        title=&quot;Location of important parts of SysEx Librarian&quot;
        src=&quot;/tech-blog/static/8418e739e146429e26fa9bfcfd24482e/fcda8/sysex-lib.png&quot;
        srcset=&quot;/tech-blog/static/8418e739e146429e26fa9bfcfd24482e/12f09/sysex-lib.png 148w,
/tech-blog/static/8418e739e146429e26fa9bfcfd24482e/e4a3f/sysex-lib.png 295w,
/tech-blog/static/8418e739e146429e26fa9bfcfd24482e/fcda8/sysex-lib.png 590w,
/tech-blog/static/8418e739e146429e26fa9bfcfd24482e/e9131/sysex-lib.png 614w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Top left corner, it’s a big button that says “Play” on it. It’ll take a second to send the SysEx. If you have an indicator on your MIDI interface you should see activity on that, but the FM2 doesn’t hint that it’s receiving MIDI.&lt;/p&gt;
&lt;h3&gt;5. Go through the presets&lt;/h3&gt;
&lt;p&gt;This is where I got confused. SysEx Librarian send the &lt;code class=&quot;language-text&quot;&gt;.syx&lt;/code&gt;, my MIDI interface showed that it was sending the &lt;code class=&quot;language-text&quot;&gt;.syx&lt;/code&gt;, but nothing happened on the FM2 - the patch I had loaded from the old cartridge was still loaded after sending the new cartidge.&lt;/p&gt;
&lt;p&gt;I imagine what’s happening is that the patch is loaded into memory and hangs around regardless of what cart is loaded. When you change the patch, it’ll load them from the new cart and the in-memory patch will disappear.&lt;/p&gt;
&lt;h2&gt;Bonus: some carts I found online&lt;/h2&gt;
&lt;p&gt;I like to mirror things in case sites go down.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Finetales&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/2e13b7856d5ba1ad00623c831b9822fe/finetales1.syx&quot;&gt;1: EPs and bells&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/965917868cde7c09f8ea8953986a96d8/finetales2.syx&quot;&gt;2: plucks, basses, brass&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/8e0d5bb71759b6da4c49c332ed4045fd/finetales3.syx&quot;&gt;3: strings, pads, etc&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Yamaha Black Boxes&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Factory&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/4a0513cc8cf3b9ddfafb4cdcd9f9b4a9/rom1a.syx&quot;&gt;ROM1A Master&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/ddc88c9d55235f1546b499ad76431540/rom1b.syx&quot;&gt;ROM1B Keyboard &amp;#x26; Plucked&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/9e3da5e0b7c75834f95c1fcda25268a2/rom2a.syx&quot;&gt;ROM2A Orchestral &amp;#x26; Percussive&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/3b2a0479de029137cd32b6a8ed98ce9e/rom2b.syx&quot;&gt;ROM2B Synth, Complex &amp;#x26; Effects&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/d86d38f0db0b5158b9355a183467d96e/rom3a.syx&quot;&gt;ROM3A Master&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/e53fb9b59f50aaa67cd52c941d4b8b1f/rom3b.syx&quot;&gt;ROM3B Keyboard &amp;#x26; Plucked&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/00e4418d42bc4c5dc48ba3934a8a10fc/rom4a.syx&quot;&gt;ROM4A Orchestral &amp;#x26; Percussive&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/8fab437e457c807baf5f06d5198d9c6a/rom4b.syx&quot;&gt;ROM4B Synth, Complex &amp;#x26; Effects&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;VRC Voice ROMs&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/d75a1ac7a14c4701a75320d5f34601be/vrc101a.syx&quot;&gt;VRC101A Keyboard, Plucked &amp;#x26; Tuned Perc.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/77682e9dcd820b4b9b5e30d7a9287289/vrc101b.syx&quot;&gt;VRC101B Keyboard, Plucked &amp;#x26; Tuned Perc.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/6dd348a1bcab4280d283bb5fa6264194/vrc102a.syx&quot;&gt;VRC102A Wind Instrument&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/e9ca356aee89b859b50786cb2d121755/vrc102b.syx&quot;&gt;VRC102B Wind Instrument&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/e41cb92227dd6fabe9192d57ce4c36df/vrc103a.syx&quot;&gt;VRC103A Sustain&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/f59dee5f108bee8c51742e6dba2e2cb3/vrc103b.syx&quot;&gt;VRC103B Sustain&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/6bcfc4173b5a1c7741d815e0cef85846/vrc104a.syx&quot;&gt;VRC104A Percussion&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/53deea4d08fb00cc5b94199212c64764/vrc104b.syx&quot;&gt;VRC104B Percussion&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/5e0bcd0c67169157195bf4fe4355e1b9/vrc105a.syx&quot;&gt;VRC105A Sound Effect&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/8f58bf32a944bab0eef94dd633292422/vrc105b.syx&quot;&gt;VRC105B Sound Effect&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/2bfb353b9d18f6de0b9f97a18e4a353a/vrc106a.syx&quot;&gt;VRC106A Synthesizer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/2db2179f5b1d4d54d74c18ac0f8c2bb6/vrc106b.syx&quot;&gt;VRC106B Synthesizer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/9abac8ea417f81b41252957bf86fdcb1/vrc107a.syx&quot;&gt;VRC107A David Bristow Selection&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/6476e6f3dfcfee29491564fcb90b3bde/vrc107b.syx&quot;&gt;VRC107B David Bristow Selection&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/2b0914e424fe76143f373ea570315b63/vrc108a.syx&quot;&gt;VRC108A Gary Leuenberger Selection&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/6b42763f309de57cefbc73550e4f7dbf/vrc108b.syx&quot;&gt;VRC108B Gary Leuenberger Selection&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/a093d77caf59a4752e6042da7c446e75/vrc109a.syx&quot;&gt;VRC109A Studio 64&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/2ab2811b2e9b341333dc0c38e46b715e/vrc109b.syx&quot;&gt;VRC109B Studio 64&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/47821f812d008598a6231e99df056d9a/vrc110a.syx&quot;&gt;VRC110A Bo Tomlyn Selection&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/5f147c40495f9a301288b7e6020f65b0/vrc110b.syx&quot;&gt;VRC110B Bo Tomlyn Selection&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/f8dacea488f4e448db3aec93ab7534ff/vrc111a.syx&quot;&gt;VRC111A Bo Tomlyn Selection II&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/15e348209aa557e7b37953b71ff005e2/vrc111b.syx&quot;&gt;VRC111B Bo Tomlyn Selection II&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/0949a5eb06ace2e520d6b185781ed41f/vrc112a.syx&quot;&gt;VRC112A Live 64 - Akira Inoue&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/c2830c9df267e289b192d7b968a495e9/vrc112b.syx&quot;&gt;VRC112B Live 64 - Akira Inoue&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;GreyMatter E! Card&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/3d5439011d8d5c2e81a56382f390d6ce/greymatter2.syx&quot;&gt;Soundbank Disk #2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/bd9afa871cfd36195d2d27227486da85/greymatter5.syx&quot;&gt;Soundbank Disk #5&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/547ebb965a86d8580693c549b48dc15a/greymatter7.syx&quot;&gt;Soundbank Disk #7&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Bonus 2: SynprezFM carts&lt;/h2&gt;
&lt;p&gt;I went through the &lt;a href=&quot;https://www.synprez.com/SynprezFM&quot;&gt;SynprezFM&lt;/a&gt; carts and copied my favorites into three carts:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/a6847a41cfec261903c0739fbd119b37/SynprezFM_Faves1.syx&quot;&gt;SynprezFM Faves 1&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/f2ac815d057a593c81710829db51dc27/SynprezFM_Faves2.syx&quot;&gt;SynprezFM Faves 2&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/eea5adb82fb45b78f3630f596d13e329/SynprezFM_Faves3.syx&quot;&gt;SynprezFM Faves 3&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;/tech-blog/8dc5dcfe284d9c31f66d89addb293c33/SynprezFM.zip&quot;&gt;All SynprezFM presets zipped&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There’s no order to these favorites. I intentionally shuffled them so that I would have a good mixture of presets per cart.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Grandbot: Buttons]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/grandbot-update-buttons/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/grandbot-update-buttons/</guid><pubDate>Fri, 15 Nov 2024 03:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/e7948c7067beba4bebeb0ce8453fddb3/c58a3/grandbot-buttons.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAABAACA//EABUBAQEAAAAAAAAAAAAAAAAAAAIA/9oADAMBAAIQAxAAAAECsdSnzKP/xAAaEAACAwEBAAAAAAAAAAAAAAABAgADEiER/9oACAEBAAEFAgTim3oLtPNRVCyrlf8A/8QAFREBAQAAAAAAAAAAAAAAAAAAEBH/2gAIAQMBAT8Bh//EABURAQEAAAAAAAAAAAAAAAAAAAAS/9oACAECAQE/AVP/xAAZEAACAwEAAAAAAAAAAAAAAAAAEQECIRD/2gAIAQEABj8Ca5lWKTIKo//EABkQAQADAQEAAAAAAAAAAAAAAAEAEVEhQf/aAAgBAQABPyEy8olzjzIRZDZTJB7gAQoqf//aAAwDAQACAAMAAAAQ19//xAAXEQEBAQEAAAAAAAAAAAAAAAABABFB/9oACAEDAQE/EFdsL//EABYRAQEBAAAAAAAAAAAAAAAAAAEAIf/aAAgBAgEBPxAdlX//xAAbEAEBAQADAQEAAAAAAAAAAAABEQAhMUFhgf/aAAgBAQABPxBCxRF9/M6kCqxN4nGHjNNI7j3n5q8N9MdGVh953//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Grandbot with six buttons for controlling his sequencer&quot;
        title=&quot;Grandbot with six buttons for controlling his sequencer&quot;
        src=&quot;/tech-blog/static/e7948c7067beba4bebeb0ce8453fddb3/1c72d/grandbot-buttons.jpg&quot;
        srcset=&quot;/tech-blog/static/e7948c7067beba4bebeb0ce8453fddb3/a80bd/grandbot-buttons.jpg 148w,
/tech-blog/static/e7948c7067beba4bebeb0ce8453fddb3/1c91a/grandbot-buttons.jpg 295w,
/tech-blog/static/e7948c7067beba4bebeb0ce8453fddb3/1c72d/grandbot-buttons.jpg 590w,
/tech-blog/static/e7948c7067beba4bebeb0ce8453fddb3/a8a14/grandbot-buttons.jpg 885w,
/tech-blog/static/e7948c7067beba4bebeb0ce8453fddb3/fbd2c/grandbot-buttons.jpg 1180w,
/tech-blog/static/e7948c7067beba4bebeb0ce8453fddb3/c58a3/grandbot-buttons.jpg 1500w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Project originally inspired by the work of &lt;a href=&quot;https://twitter.com/MohitBhoite&quot;&gt;Mohit Bhoite&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;I’ve been having a lot of fun adding features to &lt;a href=&quot;https://github.com/handeyeco/Grandbot&quot;&gt;Grandbot&lt;/a&gt;’s generative sequencer and while each setting is adjustable with MIDI CC, it was becoming a pain in the ass to maintain the different tools I had for sending MIDI CC to Grandbot. I decided to make a menu system and add a new PCB with buttons for navigating the menu.&lt;/p&gt;
&lt;h2&gt;The PCB&lt;/h2&gt;
&lt;p&gt;The PCB is dead simple: 6 buttons. I added some pads on the back in case I wanted to add pull-up resistors, but the Arduino has built-in pull-up resistors so I don’t see the point. Debouncing the buttons has been a little bit of a pain (I’ll cover that in a bit), so I might eventually add hardware debouncing but that seems like it might be more trouble than it’s worth.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/983852102685fe347f93667e2e5d337c/94829/kicad-front.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAEW0lEQVQ4y5VU+08jVRSuj2gMuLtqTFygUGh59T2PTqcz7bTTUl4+eOwuD93VGAOscWFxRTcEZQEF2oFCaYEWcAOrq8ZE/Rc/vw7bRI0/6A8n99x7z/3ud75z7nUMuKKY7Uxg3K3hymt+NFzpRcNV73+yRsa+fM2HvrYo5joNjBDL8aEngY7yBSaMW3iloQeOV3v/p3lxqysJd/kJJtRROD72GXg4NIm5rgReIsNa0HN1u/IX/59z+s/XAK/6MOlS8UAfxYxHh2NWSuJpt4TPW0W8+HqAwT12oG3PDv3rnP4LNcBrfky1SvjFK2OhTYRjhoCnARXzLtnedDR0w9HY83erp1f3G+vWYzO82SrjcTCGezWMGsNTfxTLnJgdUZjcNJ0yUi0S0q0RmByNtwQkaWaLfOk3iUg1S0jRjzsjWGiP4IyA8+0EnBEMVEIx7DYFUG0OotghodQdQcWnotgq4FSK4/fpUfzxwRjOIgmO4/hpaBAXRhq/TY3gh0wWFuOOCLjgki5Tftwj4548jDt9t7HrCWI1K6LQJyInCNjrVvH90AAqcROHioHHBDsxMygT/Mzsx7GahEVmlYCG+zZDkYA+BV94M7irjWH/ehj5dhGPWsNYbxJQ8qqoxtMok+lpMoPjWBLVhIkDv4ZdWcQu5bKCEooBAfMtLMrss5StzgDKrgCDZGxoQWwpAeQUEXv+CE7SCZREDYdyggdjKFCSUlDHji5grTOE9WAQ1YyGB2429kzYQFWKYTUpYlOVsB2XkRNVHEZj2IxG8K0mYCsRxq5PRr5FQL5NgOXiSDZrCe51hbAphVFIqVhsi1wCnmsp5JwS1pxhrLwRwo/mIH6dvoncmzxAwZcJVAroNpBFOSz2m9UUxmEyhVMjg22PhJ1O6TLlOSmF41AUq+kQtmNhWGkR2zIrrSjYNiRsxEPIZ0LY8UmwnKLNsqgwiyil6YyiMqIj7xSwT+Z2lWdZlCpLvumWsNsh82AEa0otDbITFVhcK3Rx3S2TITX1UD/TwKPeENbawtgQhct1sl9oqwPypeR4s8Vb8nxGW+1hrDqD+M7NfmQhDsIsiBi3K10OxWHpEeSTzICXbbLF8pRgvw44xz48YuW2qdUO33POyzT72H9pMklqONHTqOgpVHXTHk+SaRT9MVZZs+Ot2hkSKVDb+TrDC34OVkvYrmCe/bffrbChFaYasfvuIKThKMr2YvGOlATKoo4DylRbL5F9jXm1OYD71NLxScDA4vA0VvnB7nlj2KPQm9fJkG+76FbIRkexR+U8ggL3DjxR6qjYzb/TfqlrrkPBXeMGZmvf1x3+1k2lJ1jkn/h0Oo2DqTTWB+MoTDLViRTObxg4er8PhXd0FPpVVD4ycT6VxV6vin2PjEM3u8JvoOXsZ0zypTne82j4zKVjScjgm5vDWBntw9rEIP1BLI9laf34dGQAX9H/ejyLlVu08XexnH0bS/EslhJZfKln8VAfwm1+1n8C2bvOjt0dhwIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Kicad design of the front of the PCB&quot;
        title=&quot;Kicad design of the front of the PCB&quot;
        src=&quot;/tech-blog/static/983852102685fe347f93667e2e5d337c/fcda8/kicad-front.png&quot;
        srcset=&quot;/tech-blog/static/983852102685fe347f93667e2e5d337c/12f09/kicad-front.png 148w,
/tech-blog/static/983852102685fe347f93667e2e5d337c/e4a3f/kicad-front.png 295w,
/tech-blog/static/983852102685fe347f93667e2e5d337c/fcda8/kicad-front.png 590w,
/tech-blog/static/983852102685fe347f93667e2e5d337c/94829/kicad-front.png 878w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/d93b51fa9d90f8e247b00e6750863f14/9c177/kicad-back.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAEiUlEQVQ4y42U+VPTVxTF0zp1rXamrcu0tmASCSaQsGUBooRFAgmECELIngj5hhCWAgliFVFAqYKKQMIidbDLP9FO/7ZPb5J2aqftTH+4c9963nnnnvdU5Y1RdN1ZNC1Jznxh46PzDRy/YP7vuPj3/okLDRQxXFmu2EdQVXTPcfrdr3wVW+PUJwZUZypQfVwpofsfUcmx01rKezKc/vE31P4VVCbXDMb5I9S3HnLqM6MsusYH5/Sozl1DdbbULvbP/tUvzJWynmNndWicM5RPHaDumkVl7cvQqhyi8yxx8rypuOlDYfon0D/D8F42CGCFXHcebXuWT7WdJUD72PdU9C5y7Jxc4/gVVCc1qE5oSvn9OKH+l7EyrjrnUHd/yyXTACqLAF5PHqK//ZSK5hAamx+1LYBWotzq57K5FGprgKuNAZkPFPtfmgOUWQIy7qP69ipXOue5ZCwAerJcV/YxhbdwjB3QMX5Aq+S21BualQNMsT1qJApz7TJWyHXxPLXRHayjuzhG97HEdvm6dZrPK92lKzeLhpX+nExsY43t05bYwTuRp2c8X8yN8W2qg5vogzls4UX6kgpd8RHawzNclgM0k7tUdN7lotGLqt5zF+f4K+yx+9RHt3Aq94rAHck8TXeERXwHc6wQexiGX3Ft4DvqIq+pCUsEttEkdylLFNYe0OxfLgAu4Eo/5+boLDWRbdyJFKbABg5lV5jtiBTb1Ea2sMdXMPbfo31kgS5llrboJM7EDNbwOo3BJeyjsmZo6Q/A1BM64ynZ+Bp3NIBpcBVHco9a0bVetKqPvMSTTNEaUHCNJGkdfUpLbBm3MkHHaBZnbITWxBr1A49RmfvmhY1sDDzGGM7RMHwf/eAzDKF8sVAFhjURYRraEiesofHlCM6+I5z5AbVvV0jsYAhuYbmzh3XwISqbN4tdqqnz7+EZz8gVHmMLPcSTzsjCfBHQFFynPyVFCI7gVeJ0KI9ovfOA22mFjmgaZ3BINF/DNrhcqHKWG2IbfWAHR/wuRm+GOt+itBeoDuWK7OzxTWr9q1SJ35pFS0dkjibfOPbwPNXDz4XAqjyOfcwDSyVjFwAr/XkpyBi2gUksvgw9SkoOyWEWn3XP/kRtLF+scOGA2tAGVaKXvn+FKv8mbUqONrFPs+9RiWHBwFWBTWqieXq/OcIcz1EtehY0rA0Lw+hLjMPrVA6+4LoUxKMk6Y6P0pFYEK33sIttbkwcYRlYLAE6RNDCSQXbtCT2MPk3MAw9kyJtFRk6029k7Lk8sRX0A08w+Dao7H8ie14WC9U18VY0PBRAKUqNexZD9i26iOgkBfBmfqZBDK7tXRZGmzTIs6qXV6Lr36BagCo8T9G4l6kaXEfjWqLO/0Ju94ry6X103gfywbrkc3z3C9rpQxoiuzSNHRVB3Iks4akUgxNz+CYz9CmT9IkLQjNZhsen8I+NMZSeljxBY/o1J+ST1hReSpk1hNYxjrYtzdWbU2gklzvS1Hf5sbu7sXT1YXH2UtfSJrmHRpeH5t5+bK5bWLu9kvvQ30ygcUxQ3hTjdyyO/NSpbvcAAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Kicad design of the back of the PCB&quot;
        title=&quot;Kicad design of the back of the PCB&quot;
        src=&quot;/tech-blog/static/d93b51fa9d90f8e247b00e6750863f14/fcda8/kicad-back.png&quot;
        srcset=&quot;/tech-blog/static/d93b51fa9d90f8e247b00e6750863f14/12f09/kicad-back.png 148w,
/tech-blog/static/d93b51fa9d90f8e247b00e6750863f14/e4a3f/kicad-back.png 295w,
/tech-blog/static/d93b51fa9d90f8e247b00e6750863f14/fcda8/kicad-back.png 590w,
/tech-blog/static/d93b51fa9d90f8e247b00e6750863f14/9c177/kicad-back.png 880w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Obviously I also needed to expose these pins from the main Grandbot PCB.&lt;/p&gt;
&lt;h2&gt;The menu tree&lt;/h2&gt;
&lt;p&gt;90% of the work was adding the code to support a menu tree (&lt;a href=&quot;https://github.com/handeyeco/Grandbot/pull/4&quot;&gt;here’s the PR&lt;/a&gt;).&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I refactored existing settings into a Setting struct so that settings could be responsible for themselves when it came to things like managing their MIDI CC number, incrementing/decrementing, displaying their name/value, and “rolling the dice” during sequence generation. A lot of this work had to do with mapping 0-127 (the MIDI CC range) into finite steps that made sense for each parameter; for example most chance parameters map 0-127 to 0-99% whereas the MIDI out option needed to map 0-127 to 1-16.&lt;/li&gt;
&lt;li&gt;Then there’s the SettingManager which holds a reference to each setting. It triages MIDI CC, but it also maintains the menu state so it knows what parameter to update and when.&lt;/li&gt;
&lt;li&gt;I refactored my original button logic since I went from 1 to 6+1 buttons. There’s a Button struct, which handles the individual button state, and a ButtonManager struct, which manages things like button combos.&lt;/li&gt;
&lt;li&gt;Stepper is a utility struct for doing the basic math I was repeatedly struggling with.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The tl;dr of how this all works:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;There’s a &lt;code class=&quot;language-text&quot;&gt;menuStage&lt;/code&gt; variable that determines if we’re out of the menu (0), choosing a submenu (1), or in either the sequence submenu (2) or the settings submenu (3)&lt;/li&gt;
&lt;li&gt;There’s a &lt;code class=&quot;language-text&quot;&gt;menuIndex&lt;/code&gt; variable that determines where in the menu we are&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;So when we hit the increment or decrement button:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Look at &lt;code class=&quot;language-text&quot;&gt;menuStage&lt;/code&gt; to see which submenu we’re in&lt;/li&gt;
&lt;li&gt;Use &lt;code class=&quot;language-text&quot;&gt;menuIndex&lt;/code&gt; to get a reference to the Setting struct stored in that submenu’s array of setting references&lt;/li&gt;
&lt;li&gt;We tell the Setting to increment or decrement&lt;/li&gt;
&lt;li&gt;We ask the Setting what should be rendered on the 4D7S display&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;By offloading a lot of this logic to the Setting structs, we don’t have to maintain complicated if/else/switch logic and it’s a breeze to add new parameters to the menu.&lt;/p&gt;
&lt;h2&gt;Debouncing&lt;/h2&gt;
&lt;p&gt;Debouncing sucks and it sucks even more when trying to do button combos. My dream was to be able to enter/exit the menu with a combo and to use things like combos to trigger events or speed up increment/decrement actions. I made it happen, but it was a pain!&lt;/p&gt;
&lt;p&gt;I ended up using the method explained by &lt;a href=&quot;https://hackaday.com/2015/12/10/embed-with-elliot-debounce-your-noisy-buttons-part-ii/&quot;&gt;Elliot Williams on Hackaday&lt;/a&gt;. Basically what it’s doing is maintaining a history of button reads and only considers it a press/release when the history matches a certain expected state. &lt;a href=&quot;https://github.com/handeyeco/Grandbot/pull/8&quot;&gt;Here’s the PR&lt;/a&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;cpp&quot;&gt;&lt;pre class=&quot;language-cpp&quot;&gt;&lt;code class=&quot;language-cpp&quot;&gt;&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; BUTTON_MASK 0b11000111&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Button&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;bool&lt;/span&gt; read &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;digitalRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Debounce method tracks state over several reads&lt;/span&gt;
  history &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; history &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  history &lt;span class=&quot;token operator&quot;&gt;|=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;read &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  released &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// handle press&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;history &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; BUTTON_MASK&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0b00000111&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    pressed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    history &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0b11111111&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// handle release&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;history &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; BUTTON_MASK&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0b11000000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    released &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ignoreRelease &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    ignoreRelease &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    history &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0b00000000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  held &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; history &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0b11111111&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It works &lt;em&gt;reasonably&lt;/em&gt; well, but it can still be a little flaky. Some possible solutions:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I used a bunch of analog pins on the Arduino for the buttons. I thought it would be nice to expose these pins because it meant that people could make their own custom Grandbot boards and they would be able to use the analog pins as both an analog and a digital input (because you can do &lt;code class=&quot;language-text&quot;&gt;digitalRead&lt;/code&gt; on analog pins). While this &lt;em&gt;is&lt;/em&gt; true, apparently analog pins can be slightly slower than digital pins when reading. I’m not confident this is part of the problem, but it’s just something I read about while researching the debouncing issues.&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://hackaday.com/2015/12/09/embed-with-elliot-debounce-your-noisy-buttons-part-i/&quot;&gt;In part 1 of Elliot’s writing on debouncing&lt;/a&gt;, he talks about adding a resistor and a cap to each button to smooth the transitions from high to low. This wouldn’t be the worst thing ever - I could add 6*2 SMT pads to the back of the new PCB - but if you continue reading he also recommends Schmitt-trigger inverter on each button. A single 74HC14 would do the trick (I think) since it has 6 inverters on it…I might still do this, but it’s a very small PCB already and adding 12-19 more components would get crowded.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Confusingly it seems to get better or worse depending on some unknown variable. Ultimately though the software debouncing has been working well enough.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Ultimately the new board has made playing with Grandbot even more fun and the refactored code has made adding features a breeze. Since adding the board:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Grandbot works with his own MIDI clock now&lt;/li&gt;
&lt;li&gt;I added a button combo for Drift mode (an endless Slip mode)&lt;/li&gt;
&lt;li&gt;I added a button combo for parameter randomization and reset&lt;/li&gt;
&lt;li&gt;There’s a 303-style legato parameter&lt;/li&gt;
&lt;li&gt;There’s a global output transpose setting&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I still have a lot of ideas to come!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[MiniDexed PCB]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/minidexed-pcb/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/minidexed-pcb/</guid><pubDate>Sun, 29 Sep 2024 03:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/d1772ca83631c2e1e89c19a721659e51/c58a3/header.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQCAwX/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABsXmiLxlEv//EABkQAAIDAQAAAAAAAAAAAAAAAAABAgMRMf/aAAgBAQABBQKdrQrMNLI6+Nz0/8QAFhEBAQEAAAAAAAAAAAAAAAAAABEx/9oACAEDAQE/AcV//8QAFhEBAQEAAAAAAAAAAAAAAAAAABES/9oACAECAQE/AbWX/8QAGxAAAgEFAAAAAAAAAAAAAAAAABEhARAxkaH/2gAIAQEABj8CXWKtsogl7P/EABwQAQACAgMBAAAAAAAAAAAAAAEAESFBUWFxgf/aAAgBAQABPyHBQK2g1zPyPRlE28SxQ0m3MajkqP/aAAwDAQACAAMAAAAQk+//xAAXEQEAAwAAAAAAAAAAAAAAAAABEBEh/9oACAEDAQE/EAVa5H//xAAXEQEAAwAAAAAAAAAAAAAAAAABEBFB/9oACAECAQE/EECth//EABkQAQADAQEAAAAAAAAAAAAAAAEAESExQf/aAAgBAQABPxA6lsQQPvOs35aI00vTu7LWxiIHk301zZQRhNkQc0LpE//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Complete MiniDexed build with custom PCB&quot;
        title=&quot;Complete MiniDexed build with custom PCB&quot;
        src=&quot;/tech-blog/static/d1772ca83631c2e1e89c19a721659e51/1c72d/header.jpg&quot;
        srcset=&quot;/tech-blog/static/d1772ca83631c2e1e89c19a721659e51/a80bd/header.jpg 148w,
/tech-blog/static/d1772ca83631c2e1e89c19a721659e51/1c91a/header.jpg 295w,
/tech-blog/static/d1772ca83631c2e1e89c19a721659e51/1c72d/header.jpg 590w,
/tech-blog/static/d1772ca83631c2e1e89c19a721659e51/a8a14/header.jpg 885w,
/tech-blog/static/d1772ca83631c2e1e89c19a721659e51/fbd2c/header.jpg 1180w,
/tech-blog/static/d1772ca83631c2e1e89c19a721659e51/c58a3/header.jpg 1500w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;&lt;a href=&quot;https://github.com/handeyeco/minidexed-pcb&quot;&gt;Link to the source files for the MiniDexed PCB.&lt;/a&gt;&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/probonopd/MiniDexed&quot;&gt;MiniDexed&lt;/a&gt; is a port of the open-source &lt;a href=&quot;https://asb2m10.github.io/dexed/&quot;&gt;Dexed synth VST&lt;/a&gt; (which itself is modeled after the &lt;a href=&quot;https://en.wikipedia.org/wiki/Yamaha_DX7&quot;&gt;Yamaha DX7&lt;/a&gt; 6-operator FM synth) to bare-metal Raspberry Pi. I have no involvement with the development of MiniDexed, but the project piqued my interest and I decided to try building one myself.&lt;/p&gt;
&lt;p&gt;Unfortunately, the hardware requirements aren’t very straight-forward: some people use 3 buttons, some use 5, and some use 0; you can use a USB audio interface or an external DAC or the built-in audio out (but only on RPi 4); hardware MIDI is optional, but there’s some debate what schematic works the best; etc. It’s designed to be customizable, but for beginners this might lead to analysis paralysis.&lt;/p&gt;
&lt;p&gt;Additionally there often seemed to be a mashup of custom PCBs (&lt;a href=&quot;https://diyelectromusic.com/&quot;&gt;diyelectromusic&lt;/a&gt; is the mecca for resources on those) and off-the-shelf modules. This felt a little too haphazard for my OCD, so I set out to build my own PCB.&lt;/p&gt;
&lt;h2&gt;Project Goals&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;I wanted as much as possible baked into the PCB. An LCD and Raspberry Pi hanging off were fine, but I wanted the main I/O firmly latched onto the PCB.&lt;/li&gt;
&lt;li&gt;I wanted good, built-in sound. This meant using a DAC for the audio.&lt;/li&gt;
&lt;li&gt;I wanted built-in MIDI in/out/thru just because it’s nice to have.&lt;/li&gt;
&lt;li&gt;I wanted an LCD for the screen (vs a tiny OLED) and buttons/encoder for input.&lt;/li&gt;
&lt;li&gt;I didn’t want to commit to doing a lot of work in MiniDexed code.&lt;/li&gt;
&lt;li&gt;Size wasn’t a huge factor, but I wanted it to be around the size of a &lt;a href=&quot;https://github.com/okyeron/shieldXL&quot;&gt;ShieldXL&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;One of the big deciding factors to how I approached this was the DAC. Increasingly DACs are hard to come by as THT components and the MiniDexed project seemed to be biased towards the SMT PCM5102A. Having never soldered SMT components, I decided this would be a good opportunity to try out a PCB assembly (PCBA) service. Overall it was a great success and having this skill really opens up the types of ICs I have access to in projects.&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;From here I’ll go over the schematics and then talk about the manufacturing process. Where possible, I tried to conform to the recommendations on the &lt;a href=&quot;https://github.com/probonopd/MiniDexed/wiki/Hardware&quot;&gt;MiniDexed Hardware&lt;/a&gt; page.&lt;/p&gt;
&lt;h2&gt;Audio out (DAC)&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/587884d52494f147df22dc86763e0740/ee3fb/schematic_audio-out.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAACG0lEQVQ4y41U227TQBT0//8Mb0D7gCKQ+lYJ0ZK2JI1d39Z7v9oB8TCc3RRIaRvxcOQ4uztz5sysq3l2OFU+Wiz7iP0+IHgNaQVs0EjJvri/OgW2LB5aj5j4Di5ISD8SgUFMeS0Ukv8CzEC5Zjo0jTW6m0sIxWCTpHWLGBWs5VB6Kp2Wva8B5sW8KVInae/hZ1Mq/2+jADMDus0XtLtrKCufgL0KmMEm3mNo1hj7LUxQCLOGShyROkzJQFtGCvxTVTSCFyXn2TgCkf099NQVY2aSKWmWTLQwTsIHU/Yt8+N4kkYkw54DLpnNFdmeKs+ur7cYmxVGcYZhOAfrbjB292C8hkgjBJGIr2+gd5eoMvr+0YQCFB3Fw5bfmSB3Og4N5LQC8IlkrSCba0jNIdstuOxhosTYfoZzDFWkLrRXRUKiOKQ5Uh3ikN+X7wF1t0b3cIaf+EiR+QDeXCEQcSSyurkD7zeIP1KJUhXIAEn268DBVAPOv5EhGyg1YNQME60J0UPzC3TyLfr+HBMROOoqAyo/0fmeGjo4Xh3y5ilvLdrbCwj3jmS8h2Q1zVDDGA7rFB3WEGxHRBOm2yvq+A7dbk3rghRRMh7z+MeUkK+TF3Bqi+QeyL2/t6FEKZtEajJ5djlRfIQZ6Xl0EX7nML84R91YA+cdPTOJL44fJyAd5zXHZfbPr15xk4bPmcXQGgryodhwMGlZTn88/q1fT6Ukyf8GHWcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of the audio output circuit&quot;
        title=&quot;Schematic of the audio output circuit&quot;
        src=&quot;/tech-blog/static/587884d52494f147df22dc86763e0740/fcda8/schematic_audio-out.png&quot;
        srcset=&quot;/tech-blog/static/587884d52494f147df22dc86763e0740/12f09/schematic_audio-out.png 148w,
/tech-blog/static/587884d52494f147df22dc86763e0740/e4a3f/schematic_audio-out.png 295w,
/tech-blog/static/587884d52494f147df22dc86763e0740/fcda8/schematic_audio-out.png 590w,
/tech-blog/static/587884d52494f147df22dc86763e0740/efc66/schematic_audio-out.png 885w,
/tech-blog/static/587884d52494f147df22dc86763e0740/ee3fb/schematic_audio-out.png 1144w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The audio circuit is based around the PCM5102A DAC. The MiniDexed project recommends some cheap modules you can find on Amazon/eBay/Alibaba/wherever, so that’s where I looked first. There’s a great writeup about this module on &lt;a href=&quot;https://todbot.com/blog/2023/05/16/cheap-stereo-line-out-i2s-dac-for-circuitpython-arduino-synths/&quot;&gt;todbot&lt;/a&gt; which itself references &lt;a href=&quot;https://macsbug.wordpress.com/2021/02/19/web-radio-of-m5stack-pcm5102a-i2s-dac/&quot;&gt;macsbug&lt;/a&gt;. The important part is this schematic:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/f4e2b9d7d1c0b731840596a40a6910db/59680/pcm5102a_circuit_diagram-1.webp&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 93.24324324324323%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/webp;base64,UklGRrwAAABXRUJQVlA4ILAAAAAQBQCdASoUABMAPtFeqE+oJKOiKAgBABoJQBnhkngw8WhRoEy1tFxqg8Sm/lxd5VMAAP72EqCRs9JPB7OO33okD64Dro+nM9i1sOUERd8BLZv7FQCOeHLJUa8/EfMGmUMmV31+BVmOD7JjV6fOCuLqdPPrzXkidIRozr0YtPc0Zr3umEUKONl/Hjla5DfDFxKrqHeosc0RQa3sVXUzZSU1guMQ/NV1rs2Wo8SEoEkAAA==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of the PCM5102A module&quot;
        title=&quot;Schematic of the PCM5102A module&quot;
        src=&quot;/tech-blog/static/f4e2b9d7d1c0b731840596a40a6910db/5ca24/pcm5102a_circuit_diagram-1.webp&quot;
        srcset=&quot;/tech-blog/static/f4e2b9d7d1c0b731840596a40a6910db/cbe2e/pcm5102a_circuit_diagram-1.webp 148w,
/tech-blog/static/f4e2b9d7d1c0b731840596a40a6910db/3084c/pcm5102a_circuit_diagram-1.webp 295w,
/tech-blog/static/f4e2b9d7d1c0b731840596a40a6910db/5ca24/pcm5102a_circuit_diagram-1.webp 590w,
/tech-blog/static/f4e2b9d7d1c0b731840596a40a6910db/59680/pcm5102a_circuit_diagram-1.webp 632w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;This module included a bunch of stuff I didn’t need:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;It supports both 5V and 3.3V and separates analog from digital circuits, so it uses two voltage regulators (the ME6211C33MSG)&lt;/li&gt;
&lt;li&gt;It has a bunch of jumpers to configure things that I didn’t care about&lt;/li&gt;
&lt;li&gt;It exposes a bunch of pins that I didn’t need exposed&lt;/li&gt;
&lt;li&gt;It has an LED which I didn’t want&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Also looking at the “Typical Applications” schematic in the &lt;a href=&quot;/tech-blog/750862398f8ea6ed08eb63ecf8fe224b/pcm5102a.pdf&quot;&gt;PCM5102A datasheet&lt;/a&gt; shows a similar (and luckily pared down) schematic:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/3cc5251ca4d19241f5c5d9d34630c0df/a3767/pcm5102a_datasheet_schematic.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABM0lEQVQoz42S646CQAyFef+3IyFgBBQiFy8IAgoCYt2vSZPd7P7YSQ5Np+3paQdHvs66rvJ8PmWeZ+n7Xuq6lqZp5Hq9KqZpUvznOHwej4cMw6B2v9/L5XLRIOSe56ntuk7u97vm0Pj9fquQ1+v1A0pYVZWqGsdRDoeD+hTfbjcJw1DattW7oijkeDzK+XzWCYjjI4A490po3elgyagCWZapTxxAzjQ0R8SvkSmyXVHAyJDYKlzXlbIsVQFEHPaJCKtFBCpR7LAHiEiggBFOp5MWomK73WohKu2xUEkxJPZgYFkWcSCBgCSI8zyXNE2VjO673U6TUQsJhBSa0j9HphNAnY3yHZADmvN7AXyzRszLO3w47CkIArVRFInv+xLHsY6MRSnxJEn05TebjVrybOdwfQDNE7CNzJM2/gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;PCM5102A schematic from the datasheet&quot;
        title=&quot;PCM5102A schematic from the datasheet&quot;
        src=&quot;/tech-blog/static/3cc5251ca4d19241f5c5d9d34630c0df/fcda8/pcm5102a_datasheet_schematic.png&quot;
        srcset=&quot;/tech-blog/static/3cc5251ca4d19241f5c5d9d34630c0df/12f09/pcm5102a_datasheet_schematic.png 148w,
/tech-blog/static/3cc5251ca4d19241f5c5d9d34630c0df/e4a3f/pcm5102a_datasheet_schematic.png 295w,
/tech-blog/static/3cc5251ca4d19241f5c5d9d34630c0df/fcda8/pcm5102a_datasheet_schematic.png 590w,
/tech-blog/static/3cc5251ca4d19241f5c5d9d34630c0df/efc66/pcm5102a_datasheet_schematic.png 885w,
/tech-blog/static/3cc5251ca4d19241f5c5d9d34630c0df/c83ae/pcm5102a_datasheet_schematic.png 1180w,
/tech-blog/static/3cc5251ca4d19241f5c5d9d34630c0df/a3767/pcm5102a_datasheet_schematic.png 1210w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;So I essentially just merged the two schematics I found. Overall, my understanding of what my final circuit is doing:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Hard codes the DAC configuration: FLT, DEMP, XSMT, FMT&lt;/li&gt;
&lt;li&gt;Runs 5V through a ME6211C33 for the analog 3.3V  to keep noise down (the digital 3.3V is just from the RPi)&lt;/li&gt;
&lt;li&gt;Kickback resistors for the I2S lines (shown in the RPi schematic since they need to be near the source)&lt;/li&gt;
&lt;li&gt;I believe those are RC filters on the audio output&lt;/li&gt;
&lt;li&gt;I believe the remaining capacitors are bypass caps&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;MIDI IO&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/9d0c1459e1b9017daf28a94b5baa7e40/5bf79/schematic_midi-io.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAACdElEQVQ4y31UyXLTQBT0/38LFFWcKC4cOJC4KiShsCExseVF1jb7jEYOl6ZnJBOWwOGVZu3Xr1+PZn1v8Hzo/I1TOC9hrETwFp7hnEEIf9+bPQsWPfrHiH7g5QQYHXw02B0rFEWHYlOjOozgMY7xG2BaCEHDOIFhCNDdA3aLdxDNEW1bYuAZUy+h6wWTWYh6i7Jcjwm9Ilv5E3QWey5GBWkaSFHh9P0EsZrjePUCot2h7g64+3IN9fUVdPEGQrcwoYOwNaSvodI9WcOYUYJZQta2g2kX0MfLkXrSZnBwKZEXaHUF220g2w00GaU7A2WwQeTzA8+e9ZzpoLC/XyGqC4K8RckSPVnHKQZefjx5WG9gncaJl8dm2cw0cu4JFrJ0k4baCuq2gKrmWcueh12QZNBlFsZ3nHcZIM1TJPaO7EV7wKH8BkG5EvNRw15B2RZaNbmUMTtLdYp7GoEH0zixcJxrAjfqmHXsaupcFVn/1LBfuqygTTvZwHFc4fBwBWvITpUo19e0iUJFgH21xvbjS1Sr9xhOkUnEU5fPgDJpNOnQJ9+xe25/C8evFXuE8hMcm+dkBSFL2Ooz9PqWDRybE6aHMEs0e2Zuilso6nE2amJpYp+7HQcPzXFqQGSDVN8yKMswgknfTMa2o20s9Wu2N9DtPlsmGdWTzXG3pL/IStco90t4rjddiU21wvrmNerNPL+qM7vR2AQ0vkV5uMtNSV2WNK/VR5j1JfWjabstbDHnGk3NKrpmC1V8gLy/zCVnmc6AyZRSHKDWF7B1kWmntSwys8fzmGUnGYZUMlmHtJfe/J8/h/GlCNpj1Offf5+nCP/Z+wFntHFChp9fogAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of the MIDI IO circuits&quot;
        title=&quot;Schematic of the MIDI IO circuits&quot;
        src=&quot;/tech-blog/static/9d0c1459e1b9017daf28a94b5baa7e40/fcda8/schematic_midi-io.png&quot;
        srcset=&quot;/tech-blog/static/9d0c1459e1b9017daf28a94b5baa7e40/12f09/schematic_midi-io.png 148w,
/tech-blog/static/9d0c1459e1b9017daf28a94b5baa7e40/e4a3f/schematic_midi-io.png 295w,
/tech-blog/static/9d0c1459e1b9017daf28a94b5baa7e40/fcda8/schematic_midi-io.png 590w,
/tech-blog/static/9d0c1459e1b9017daf28a94b5baa7e40/efc66/schematic_midi-io.png 885w,
/tech-blog/static/9d0c1459e1b9017daf28a94b5baa7e40/5bf79/schematic_midi-io.png 966w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The MIDI spec requires an optocoupler on MIDI inputs (H11L1) and MIDI thru needs to be buffered (74HCT14). Since the 74HCT14 has 6 inverters and I only needed 2 for MIDI thru, I buffered the output too. Like the DAC circuit, this circuit is also a merger of a couple of schematics.&lt;/p&gt;
&lt;p&gt;MIDI in is derived from the &lt;a href=&quot;https://github.com/probonopd/MiniDexed/wiki/Hardware#classic-midi-input&quot;&gt;MiniDexed hardware page&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/19d7c427a74ed80305040abfbd8fc2fa/4d383/minidexed-suggested-midi.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 41.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAA7CAAAOwgEVKEqAAAABU0lEQVQoz11SW07DMBDs/e+AuAEcgR/44gchVUigvmjiJmkeTh0/EtsZ1gkuKSutstn1jiczWY3jiGX+j2VH9T3MMNzM4k7cX92sUsOPHtZbejqY3uBU1xjcDCKkgTQ9PJ21obcAi7EKL9J6SD83tNVQzsCMFkoKtEkKLiqINkdzfEHJXmFo3vEKOWPwkY73M0NP4Pn5C/uPJ9T5GdJJiLxAlxXQzmJX5qiTBNV+jWZ7j8v3I4HXUKYDKxnaXk4k2jSB1Rorqx2KtwdU6zs0pxQZS8APB3SM6s0WtWkgjIC6lGh3zxDZO1jL0RMjR/Jw2d0ytKQJP37CqgxqUNNANxyStPPWTp8Xo207aP1nyiAEis0GHZ27arh0NACG4ET93M03y0HOolP23pFh/mqGo3NNShqT+9GYyZTAKrgcAAOAsmrKUEeGSydjbYhZ83tx/G1+AAOtbZcBpl2uAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Recommended MiniDexed MIDI input circuit&quot;
        title=&quot;Recommended MiniDexed MIDI input circuit&quot;
        src=&quot;/tech-blog/static/19d7c427a74ed80305040abfbd8fc2fa/fcda8/minidexed-suggested-midi.png&quot;
        srcset=&quot;/tech-blog/static/19d7c427a74ed80305040abfbd8fc2fa/12f09/minidexed-suggested-midi.png 148w,
/tech-blog/static/19d7c427a74ed80305040abfbd8fc2fa/e4a3f/minidexed-suggested-midi.png 295w,
/tech-blog/static/19d7c427a74ed80305040abfbd8fc2fa/fcda8/minidexed-suggested-midi.png 590w,
/tech-blog/static/19d7c427a74ed80305040abfbd8fc2fa/efc66/minidexed-suggested-midi.png 885w,
/tech-blog/static/19d7c427a74ed80305040abfbd8fc2fa/c83ae/minidexed-suggested-midi.png 1180w,
/tech-blog/static/19d7c427a74ed80305040abfbd8fc2fa/4d383/minidexed-suggested-midi.png 1195w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;I think I also referenced &lt;a href=&quot;https://www.smbaker.com/raspberry-pi-midi-hat-building-a-raspberry-pi-midi-jukebox&quot;&gt;Dr. Scott M. Baker&lt;/a&gt;, though most MIDI thru/out schematics you find online are roughly the same:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/46e828912369d232ac192c5ee36acf57/fb1d2/midi-thru-out-reference.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 82.43243243243244%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAQABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAECBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAe9NQoP/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAWEAADAAAAAAAAAAAAAAAAAAABECD/2gAIAQEAAT8hgL//2gAMAwEAAgADAAAAEMPP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAHBABAAIBBQAAAAAAAAAAAAAAEQABMRAhQXGB/9oACAEBAAE/EFcbRbqmnrQzMjn2M//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Reference schematic for MIDI thru/out&quot;
        title=&quot;Reference schematic for MIDI thru/out&quot;
        src=&quot;/tech-blog/static/46e828912369d232ac192c5ee36acf57/1c72d/midi-thru-out-reference.jpg&quot;
        srcset=&quot;/tech-blog/static/46e828912369d232ac192c5ee36acf57/a80bd/midi-thru-out-reference.jpg 148w,
/tech-blog/static/46e828912369d232ac192c5ee36acf57/1c91a/midi-thru-out-reference.jpg 295w,
/tech-blog/static/46e828912369d232ac192c5ee36acf57/1c72d/midi-thru-out-reference.jpg 590w,
/tech-blog/static/46e828912369d232ac192c5ee36acf57/a8a14/midi-thru-out-reference.jpg 885w,
/tech-blog/static/46e828912369d232ac192c5ee36acf57/fbd2c/midi-thru-out-reference.jpg 1180w,
/tech-blog/static/46e828912369d232ac192c5ee36acf57/fb1d2/midi-thru-out-reference.jpg 1213w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;I know it’s a controversial take, but I prefer TRS MIDI over DIN MIDI. I think DIN is better when performing or if you keep your stuff plugged in long-term, but I don’t perform and I don’t keep my stuff plugged in. Also these days it’s super easy to find cheap, used 3.5mm aux cables. The jacks are also smaller and cheaper.&lt;/p&gt;
&lt;p&gt;My limited understanding of the schematic:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Resistors are limiting current&lt;/li&gt;
&lt;li&gt;Diode protects against reverse polarity&lt;/li&gt;
&lt;li&gt;Optocoupler protects against ground loops&lt;/li&gt;
&lt;li&gt;Buffer makes sure the digital signals have sharp edges&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Interface&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/bf18cc45d7d2047bda5c4e8afd802d7d/32ac3/schematic_interface.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABNUlEQVQoz4VSS07DQAzN/Y/AaVgjLoBUKlGK0un87JlJKlaP5ykpFUrbhZXI9ryP7WGaBBZaEuZZUVSQovT/eVIs9VvR+xi1CloTDEsi5hFaAyNCCr8toE651+6BaU09JFEUxQxWyOJx+NoSIGGaycSoLUPFXRSsATYS5uSQs6NDz1zGoBqZOCLoiBD3SCwEZYMc4ccPZA20vqKO4zAXmX1CQZUqp8Xy6VQo2cF9bnAYt3CvTwjvzwSPnd2a/6s0QGm+1w1QSdzoqgOavTDuOLuIUsi4f4H6Nz4qJFu3bIB5AaRDUX8GLAQJ8QAXdkjtSBsR8/eJ4BnFlN3Y9HkhnFszq7mLsvxgqM0GTCC/2yD+zswG/uhcbJn2/npxl7MxFqHSP0vy8AbbSm64fqwrw7+rciX3A195/IGXQd2HAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic for the buttons and encoder&quot;
        title=&quot;Schematic for the buttons and encoder&quot;
        src=&quot;/tech-blog/static/bf18cc45d7d2047bda5c4e8afd802d7d/fcda8/schematic_interface.png&quot;
        srcset=&quot;/tech-blog/static/bf18cc45d7d2047bda5c4e8afd802d7d/12f09/schematic_interface.png 148w,
/tech-blog/static/bf18cc45d7d2047bda5c4e8afd802d7d/e4a3f/schematic_interface.png 295w,
/tech-blog/static/bf18cc45d7d2047bda5c4e8afd802d7d/fcda8/schematic_interface.png 590w,
/tech-blog/static/bf18cc45d7d2047bda5c4e8afd802d7d/efc66/schematic_interface.png 885w,
/tech-blog/static/bf18cc45d7d2047bda5c4e8afd802d7d/c83ae/schematic_interface.png 1180w,
/tech-blog/static/bf18cc45d7d2047bda5c4e8afd802d7d/32ac3/schematic_interface.png 1249w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;MiniDexed just recommends a modified KY-040 encoder. From the MiniDexed hardware page: “To improve precision, solder in 2 10nf capacitors: CLK to ground and DT to ground.”&lt;/p&gt;
&lt;p&gt;So pretty much it’s just:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;3 pullup resistors on the encoder (I maybe could have just used the internal pullups, but I was trying to conform with the module MiniDexed expects to avoid having to change the MiniDexed software)&lt;/li&gt;
&lt;li&gt;2 caps which I think are acting as bypass caps? Or maybe debouncing caps?&lt;/li&gt;
&lt;li&gt;The buttons are just using internal pullups&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;No major innovations here.&lt;/p&gt;
&lt;h2&gt;Screen&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/a75993e757f3e5f216cef3e0f1f77a7d/8efc2/schematic_screen.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 87.16216216216216%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAACXklEQVQ4y62UWU/bQBSF8/9/SdXtqaKItkDKWrWiiUAQJyHGu8eexfaMlwTK6bUTSlmrSjyczIw9+ebMPVfulWWGv1XXOZJYwZ4I5NlyXVX5nT3tOtcSac6X80JAG9XNe/eBVZVBCoUokNB6+aygP9dNsYTTuqk1lEzAQg9XiwrjJEBE8HldPAR20DrDfJ5jMdewYg+H51NIzpCqCKlm4IYhUg5sPoKQAfyf3xGcDTszDx3SKa0DkcaI6WTmnYPZfbjWOkJnE+HkK2TiIzERXDVDVnJ4R3vwpwOU969clTltdsByHxP3FMOLIWY/tnBy8grqchMLbIL7n2hPgJSAHgElOZY1pxLZyCS7BbYFNVTYmT3uisyYD5+5SN0xWLyBX9gBn2+BTdcgZxMogogiRlMZUgGfRxBUx1sgyZA4wdqxaTQWVzVSe4ZcfMb8uo8zsY7p8Xu69rBzpY38c7tm1Q299udGXdusxtZttShhbe/j9OwNgD3SLjTbRjAeUWhlZ+J+Br2btjCrPirL1QHtqW1LbB9gZL2jK7dACoSAM8+h8HI81iE9qRIMKPaT8QBB4XSF9pTdjX7pwepvUCivcb0ClnwXRomngULEONjfwdHxNzDjI8guEGYOQnWBqArhHH7BxHqLSwJeE7CSuygk79rrUaCm68aRh1h4CHNnCbuRpqTJuTv+gCBYg2AfYcId6OwZh2296rro1MZ/V5pConcFR+pZUMyBodZ4DHQnlH+prg1EmSCrBM31CwDJJdcxMpOiLvOXcEhfl8RFruInw/gvYEMQJ3AQJWE3f27vb41IAx0yFgoYAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic for the LCD screen&quot;
        title=&quot;Schematic for the LCD screen&quot;
        src=&quot;/tech-blog/static/a75993e757f3e5f216cef3e0f1f77a7d/fcda8/schematic_screen.png&quot;
        srcset=&quot;/tech-blog/static/a75993e757f3e5f216cef3e0f1f77a7d/12f09/schematic_screen.png 148w,
/tech-blog/static/a75993e757f3e5f216cef3e0f1f77a7d/e4a3f/schematic_screen.png 295w,
/tech-blog/static/a75993e757f3e5f216cef3e0f1f77a7d/fcda8/schematic_screen.png 590w,
/tech-blog/static/a75993e757f3e5f216cef3e0f1f77a7d/8efc2/schematic_screen.png 828w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/probonopd/MiniDexed/wiki/Hardware#pinout&quot;&gt;Here’s MiniDexed’s information on the LCD.&lt;/a&gt; Nothing really innovative here either. I could have used an LCD with an I2C backback or I could have reverse-engineered the components on one of the &lt;a href=&quot;https://www.adafruit.com/product/181&quot;&gt;common 16x2 modules&lt;/a&gt;, but I went with the middle ground: use a module, but a fairly generic one.&lt;/p&gt;
&lt;p&gt;The trim pot controls the screen’s contrast. I think it might be backwards but it works.&lt;/p&gt;
&lt;h2&gt;Raspberry Pi&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/b9f1f2e1d3ca742e653c6c10812171c5/90712/schematic_rpi.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 90.54054054054053%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAAClklEQVQ4y52Ue08aQRTF+f4fp6lSpIhIm6Zpai31UZSnLLs7s4/ZndkHKHJ6ZhFbEzXYP27Ihpnf3HPumanleYJdqihSJDqCSkNELPv93LrabkBFQAKdSGjCdBKgJLB4OOhtQLuhMCjKDEEmofIIXurDZAaG/5tsc5itV4H25LLUyE2ELB5Dh0P4kx8Ipj/hTE4h/D5kMIXScbXemFeAFpZSlvUsFVMsy0Msb9vc1ERaVQvrNb/ld+RaI+MepTad1raAbdlv25nn3sDxZ5CjM/hhHV72EeWqgzU+wSdQFAdw+23oOKYd6VPJxsSVF5Uf+UZqHAl4co6AQEFgdnfErroEdpGWbYQEyslnZAnXL/TfoViYx068mxFmg0tCKZOVaImQJUY9OGIfQdFCcXuE+/UxVHEImTcgCIzDAEHoPlpV0/RJsJP5+Bqjyx6UEYiMj1j7UAsednGCuf8e0/QAYd7CkrKdpAk3a2B23oQKGSUO7kls4lhCOhO4oz4SE0BlLC2qiMjROfygDpG1KPWwkmzBASX7g2PklLy8zR79r22HUGyDSg8XCwPpO5g4Y4jrUw5nD4YeggNZ3R9jHDUwTuqY9j5AevPKMqXkRvJzsbFAdz7B9eSKkr9h5LyDWrYrYMZfL21y6g3IYRsODx0Of1OleBloO45Cj8OYQQx7uPH2oJe2wy4Wdx1IxiYsmwR2oG3+yvSp5BdvS2mggxlWHMSKsHsL5JQjepksm4hmX2CSpALudJeLQsNEDm9KB76sw3X3Gfg9BLIBEFymZ8iMfgz1Do8DT2bYdegwoycYnHcx+MWh9L9CeFe8Jd7mvr/1tbHS01JRaoi4ZG5TD7Gkv/RYGfU/7+EmTuVDxUlURcw+Hrb+XfcH169L9UoXILIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic for how the Raspberry Pi connects to things&quot;
        title=&quot;Schematic for how the Raspberry Pi connects to things&quot;
        src=&quot;/tech-blog/static/b9f1f2e1d3ca742e653c6c10812171c5/fcda8/schematic_rpi.png&quot;
        srcset=&quot;/tech-blog/static/b9f1f2e1d3ca742e653c6c10812171c5/12f09/schematic_rpi.png 148w,
/tech-blog/static/b9f1f2e1d3ca742e653c6c10812171c5/e4a3f/schematic_rpi.png 295w,
/tech-blog/static/b9f1f2e1d3ca742e653c6c10812171c5/fcda8/schematic_rpi.png 590w,
/tech-blog/static/b9f1f2e1d3ca742e653c6c10812171c5/90712/schematic_rpi.png 882w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The only things interesting here are the kickback resistors for the I2S signal to the DAC. I read that they’re supposed to be close to the sending side of the signal, so that’s why they’re part of the RPi side of things.&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Manufacturing Notes&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;When laying out the PCB, I took a lot of care to try and separate the audio out functionality from the rest of the board to avoid noise from digital signals&lt;/li&gt;
&lt;li&gt;I used JLCPCB’s PCBA service. The boards cost $9 for 5 and the assembly (which included the SMT components) cost $57 for 5; so about $13/ea before shipping.&lt;/li&gt;
&lt;li&gt;Overall going through the process of making pick-and-place files was straight-forward. I &lt;em&gt;almost&lt;/em&gt; made a mistake by using an incorrect footprint, but caught it while triple-checking everything. &lt;a href=&quot;https://www.youtube.com/watch?v=VejO8rDdhzo&quot;&gt;Notes and Volts have an instruction video&lt;/a&gt; on designing a PCB for pick-and-place assembly.&lt;/li&gt;
&lt;li&gt;Originally I tried panel mount Cherry switches because that’s what I had. PCB mount switches look and feel &lt;strong&gt;much&lt;/strong&gt; nicer.&lt;/li&gt;
&lt;li&gt;Originally I used an RPi 4 but it was concerningly hot so I downgraded to a 3.&lt;/li&gt;
&lt;li&gt;To keep the height down I soldered the LCD directly into the PCB rather than use headers. I hope I don’t come to regret this.&lt;/li&gt;
&lt;li&gt;I ended up laser-cutting some acrylic panels for the top/bottom. It’s the &lt;code class=&quot;language-text&quot;&gt;acrylic-faceplates.svg&lt;/code&gt; file in the repo, but they might need tweaking depending on the laser cutter.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Things I would change:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I need to redo my 3.5mm jack footprint. The jacks have two plastic legs that I think are meant to brace the jack when plugging/unplugging, but I originally thought they were little standoffs so I didn’t make holes for them.&lt;/li&gt;
&lt;li&gt;Figure out how to keep the height low without soldering the LCD into the PCB.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;That’s all I can think of. I had to make some modifications to the MiniDexed config, but that’s outlined on &lt;a href=&quot;https://github.com/handeyeco/minidexed-pcb&quot;&gt;the Github page for the PCB&lt;/a&gt;. Overall pleased with the sound of this thing and happy that I didn’t make any major mistakes on my first PCBA project.&lt;/p&gt;
&lt;p&gt;Anyway, thanks to all the folks who have contributed to the Dexed/MiniDexed lineage; it’s wonderful to see so many people come together to make cool, open-source music projects.&lt;/p&gt;
&lt;h2&gt;Random Pictures&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/198de7da189c096829c64e35c6e56f88/4ef49/front-layout.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADB0lEQVQ4y2WTy28bZRTFB3ZQibQqDQSSEMfz8Ly+Gb/frfNonKQkJVDKAgESwlUaGtmxY8fPxHGaRrDrmu4Q/Ju/XpuuyuLoznyj79xzz7mj3fvcY3HBY/kLh8V5h5WvPL68J3VZzudtlhZcVpY8Plvw+XQ+4NZtR2D/Dx/P2dy9G6BVE2v082lGZYteymG05tJNOpyvu5wFgpTLRcnmsLiJbRTQPtH5cE7ng/egCW7d8dC+jQZcJ31GGZ+rks/NRpJJwWOc8RgmPK4ehPxRTdBTCnMxJRdNtDvWe4ih3Tb5aM5F2zEUl4UY43WdYcXgclNnVIlyvrFKT5T2zQRDO8HACvje32DTKbK7bLMT8dhecmd1d9nhYSzNelAVhTHF5L5JPYzR9GJ0VIyGsqn7Fh3boW36tC2Xju5xXfFm6oe6y3nM52VKMTIF8n1o+5ypEtqBHNwUdRqGJ/DpWIrjqM8LIejZAX03pOcq2rpYU43SLxvUV4Rsas92kus1T+74nBoOJ3YabS8S8CoRl7EznOcy9HNpxsUsrVSSEy9gEISMwviM8OWWTr9k0oj4jPOiKqf4c8enK2o7pkvTyaDtRxUXvs+klGWUTtEJ4jRVyKmoOoxKV0HLsWmGFtcP/yOsy2oNpNmknJAJps3EEusd4WM34FIS7Eo4XfGrKyOf6j4NwbGcNcSSqRXHq4qrLYth0aQlAd2sFRhnM7yq5BmIgLYxbZx9p1AMHaTT9GTstsjvqTjdUo6GH9IQH1vFDPUgxaRqclYwxJICb377mtffbfCmtierVqQZidFyhXBvZZqYS626w4+PDhhaEk6+yME3TzlOFOgJ6Q/7j/mltMvNI51WPsogleWf0yf8ffKEf9tPZ3a1VoVwOvKeHjJ2FOMwxWVc/hjx7sKLSxBpziThtqxVV4m3dpLLLQmibNOJuLzef8BfP29LrdAzHboyZUsV0UrqPodhjudC9LuoOfJCamLyM1mbaZ09y0o9i9r86pepCY5WfZ4bIS9k4Y+MuLwram6en5K7vAVP2Mh0sxwrMgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Front CAD view of PCB&quot;
        title=&quot;Front CAD view of PCB&quot;
        src=&quot;/tech-blog/static/198de7da189c096829c64e35c6e56f88/fcda8/front-layout.png&quot;
        srcset=&quot;/tech-blog/static/198de7da189c096829c64e35c6e56f88/12f09/front-layout.png 148w,
/tech-blog/static/198de7da189c096829c64e35c6e56f88/e4a3f/front-layout.png 295w,
/tech-blog/static/198de7da189c096829c64e35c6e56f88/fcda8/front-layout.png 590w,
/tech-blog/static/198de7da189c096829c64e35c6e56f88/efc66/front-layout.png 885w,
/tech-blog/static/198de7da189c096829c64e35c6e56f88/4ef49/front-layout.png 890w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/ab4c5deaa53da6218f70135e80c1fd7d/eac55/back-layout.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.21621621621621%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADKElEQVQ4y22R+0/bZRTGv7osWTbUOTNjFqGbygYt7bcUWqAVR8dGufT6pVd6gV6ggAwQRwChhQ5aaCltByrJjPFP/XhWTEyMPzx53/PmPc95nucotx+auPWgV6D/H/Ry+6GRDp2dzx+PcP+xnY7Om3tH1/c8eDIsp4P7Oql1Dj6Rf8qtLwwon37HR591/wdPUTq+4W6nFUO4zExii/HYLoPaodxf4wjtMZ1Yl3MX19wGI3NFnrnfoHz8ofFuJ8o9naDrX3RIfecRd75UGYlV8S7uMpU+YDRWYDp7hCe3z2S2jDt7IO9HTKSP6XXtoXw1HKLLPk+XLUnXUJKvbfPtUyd4NJTiycQaP8Sb2JPXjGb+whkv4E8v4U2v4M+s4plfxjefYzy+hTqxhNIztc1g7BJLqIk5dIkjXsUSbqEGr2TqPtrrAkPxa+zxC55n3vMy2xSbbxhLFBiL7zOWPOJl8hdeJTexelZRnjrXhewCm+TkjG7gSm3zPLaDwVvDl14mtZrGlvgT5+IfvMhd40j+hilQkyG/MyRCrNErbNF3eJd2GPRuCeH4BoORFiPRioSbZUTCHg1v0uer4c2sEVmcx6D9KpavMGtnqP4KaqDCQLCKyVtieK4hpC0swRp6184NYX+wLlPP6PMcYw/vYg68pcddlXzyBLMZnIki9kgRo79Kv5CatdM2sTlwitFdlHtZ3qr0TYpC/atNBkPnYrkm+TWxRQTRC7F8jjuVZ25lEXOwJUSVG4Vt1ETlDbFh5hCTDLIESgxMZVBMrp8I5d/hy9QJLTWI5hsMh8/o9V4QyP5ILJ9tK7Bqu/TPSqN2jHV2D8tsBaO3jEVyG9CO2sMMrm2UbucGL5INaa5LZnXiyw203Hmb0J9dJZJJ0BNrYMkfYvYfY9TKqMsV+sMHGKZLGBdOGciVMPvKkqEQ6ie26JctTy9cEFluEcg1WVhrMZG6RMv/TGxlhR6xr4pl1X/ShkmsmvwfFlPDEqlLf12Wco5xWpbyrWsNg6+E6inKlo/b8KROCKVPsIZK6GdLWL0FVLcomimIqgJmd0GsFv+pDzAJ1Nm3dE+u8zeRdPbO5SZB0wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Back CAD view of PCB&quot;
        title=&quot;Back CAD view of PCB&quot;
        src=&quot;/tech-blog/static/ab4c5deaa53da6218f70135e80c1fd7d/fcda8/back-layout.png&quot;
        srcset=&quot;/tech-blog/static/ab4c5deaa53da6218f70135e80c1fd7d/12f09/back-layout.png 148w,
/tech-blog/static/ab4c5deaa53da6218f70135e80c1fd7d/e4a3f/back-layout.png 295w,
/tech-blog/static/ab4c5deaa53da6218f70135e80c1fd7d/fcda8/back-layout.png 590w,
/tech-blog/static/ab4c5deaa53da6218f70135e80c1fd7d/efc66/back-layout.png 885w,
/tech-blog/static/ab4c5deaa53da6218f70135e80c1fd7d/eac55/back-layout.png 887w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/96c816daf2093ac90da8a594164bfef8/dba9a/front-preview.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAC9ElEQVQ4y01TW08aQRjdv9NyXxZ2YbmDSLmDVWOtWLSAICywRbEt+NaXNjVpapM+tH0wGuMlNbZEi6ZBG2N86kP7g06/GV76cDKz882cOed8s0L9VR2ZThIz3Qzi7TgKvRkk9DgWaMyupZGiGpunO2lsfdnC1egKw4shhsMhzn+c4+zsDIPBAKffTnFycgIhoSehlkVE6y5MECJ1NyKrCqIEb0WCd8WJrB6EWDSit93H399/cHd7x3F7c4ubXze4Hl1j9HOEy+ElhKluDm46GKy5OJJ6BIGqgvCqCs+KDGfZiYl2BMZFA1pvW7i4usTh4BBHgyMcfD/A/uk+9r7uYed4B7vHuxAK/UeIkZpsw4X4qoys5uZjTiO1NRmWJRssTyywFK2QGbkWgrlohnXJSqMFJsJ4boZaVSFMb2ShLptgWjSTCjMVrDAUTLj32EBkVojLNtiI1EpwVxyYaftgWxZp3U7xqIhpXv5tf2qnNRFCbj0DV0mEXJEh0SalosBZckBcorWyDNeKC+6qGxKpc5eJUPfzi32Ubazpx4NWEKmmSheKkIhUiOsJKFWyux5HVI8i0Ahg8tkkgloQtqKNZ8hIFSJzEfItH8wUATvMFCb1ENSKk6tjKoX53iyfMCKmjhWYOmbTRNZZfjay7ilL9BocmOtQhqSQnQk3Q7xhdnLE9nPChf4cz8nID5s5IQvZWDByQgbDghH3KVOJ8s1qHsrbhOyLDGKdGBFOIPcyB6kkjTNMdlJkwUxZRJCkIltUyWJ+LUFWFN7dWDNM1qLwUM6zlCFriL6to/Ohg/b7Nrofu/DUPFyIwP4Epia/nsXURh4iyfZRcb43h0A9ACtTtZbCw+fT1DwH0nWFu6m8KWPz8yb6n/rQ3mncro2cUpdznFmizUy2g3JiCkykmuXH8mJPykCXOkh9punjNX/Dj9LrEgezzVyyVyEUegV4a14EG0GEtTBC9HCVssIhl+QxaKOz5ISn6kGsFePf8v/10rgeqofwD2fKDViAjPn3AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Front preview view of PCB&quot;
        title=&quot;Front preview view of PCB&quot;
        src=&quot;/tech-blog/static/96c816daf2093ac90da8a594164bfef8/fcda8/front-preview.png&quot;
        srcset=&quot;/tech-blog/static/96c816daf2093ac90da8a594164bfef8/12f09/front-preview.png 148w,
/tech-blog/static/96c816daf2093ac90da8a594164bfef8/e4a3f/front-preview.png 295w,
/tech-blog/static/96c816daf2093ac90da8a594164bfef8/fcda8/front-preview.png 590w,
/tech-blog/static/96c816daf2093ac90da8a594164bfef8/dba9a/front-preview.png 652w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/314ead0bfe459966efcb613109139631/a6d36/back-preview.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 62.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAC/ElEQVQ4yzWTe08TQRTF9+P4Kn1tu9vdtnT72HYL2EChlEJLgT6gL1oeURRB0fiPXwMSQkAIIKJgNIQQ0A91PLPVPyb33pmd35x7ZlY6OTnB6dkpzr+c4+LrBS4vL/Ht+zdcXV3h+voKvU8rmNgYQ2WnCGtlCJMbWUxv5pBZH0FpK48hzk1tjCL7Iss4Ben6+zV+/viJm183uL25xd3tHe7v7vFw/4A/D78x/moC4boXyVYA4SU/DI54M8BaQ6qtw2SMNRREGgE459yQdg93sfd5D/sn+zg4O8Dh+SGOLo5wfHmMLz8uqCjHDQaGuhYizTCizSDGVi1keiZGGdPLBqyOAZNDrfkhuefdcM274F5wY2DOybxfyxUvhtcswqIwG3EYhKY7cWSWgxjt6hjtaBih6sJqjFG1FScJlcRmhWQBGu6GoFRl5h7oi36UNwhsRjFYDyG1HKfKJNS6wsO9PCACtapSNdcbQZhNBb6KDMlX9SFU12A1/fSh74eHavVFBbME6jWdvkWQaMcQWgpCdCQECKCv4sPz3jD0egCDS4pdSzKpGif8Cy4qjECryTTXaQNzazHIC0KtCm9Ftq3wsHbPuTBQHrDhwboODzv6b5f0pPQEAuosu+HjgjhF5AG2XnyZRJDgWIvKCPLSV3sw9wivBXi2DxbtitalcDsMkzc2tJpGqpdCoKZCnpc5XMivJ/hUwnAINf+AQqGTayIXIAEUtbjhRDsCaWJrAvm3eRR2Cih/LMNat2xAiG1OExjgh2Z7kGANLnobpdoEa6HSVXYi3goh3NBtm+yWNV7E5HYe2c0sCu8KKL6fQagV5g3KyHYZ6yrKb0uI8XRxUHolzT9lEk4q8/K2p98UkOombE9FLTnKDiRXk4ROIreVQ/HDDHLMDSrJrSXwtPgMj6Yf42npmd2eiKIWivpvdwCOWYdthb/Kh63WFPavYnxzHNnX/B+3pzCzM4PMywysnoXBVgTRTpRPRbE3KFUFRtuAtqjZFyjmRBdxPnqzY+IvQcsMOyfSV+gAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Back preview view of PCB&quot;
        title=&quot;Back preview view of PCB&quot;
        src=&quot;/tech-blog/static/314ead0bfe459966efcb613109139631/fcda8/back-preview.png&quot;
        srcset=&quot;/tech-blog/static/314ead0bfe459966efcb613109139631/12f09/back-preview.png 148w,
/tech-blog/static/314ead0bfe459966efcb613109139631/e4a3f/back-preview.png 295w,
/tech-blog/static/314ead0bfe459966efcb613109139631/fcda8/back-preview.png 590w,
/tech-blog/static/314ead0bfe459966efcb613109139631/a6d36/back-preview.png 650w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/e30909d6b94a1f30ab4b2b0b1d707ac7/d2602/front-manufactured.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAMBAgQF/8QAFAEBAAAAAAAAAAAAAAAAAAAAAv/aAAwDAQACEAMQAAABlL8BXUKgX//EABkQAAMBAQEAAAAAAAAAAAAAAAECAwAEE//aAAgBAQABBQKtmRx16b+i3iSw5zooZz//xAAWEQEBAQAAAAAAAAAAAAAAAAABAhD/2gAIAQMBAT8BCs//xAAVEQEBAAAAAAAAAAAAAAAAAAAQIf/aAAgBAgEBPwGH/8QAGRABAQEAAwAAAAAAAAAAAAAAAQAREiJB/9oACAEBAAY/AkLsbcpS8sb/xAAbEAADAQEAAwAAAAAAAAAAAAAAAREhMUFhcf/aAAgBAQABPyFlii9GXRfGColPpLLRHtCxJu3D/9oADAMBAAIAAwAAABCPD//EABcRAAMBAAAAAAAAAAAAAAAAAAABITH/2gAIAQMBAT8QaqFlP//EABcRAAMBAAAAAAAAAAAAAAAAAAABITH/2gAIAQIBAT8QwN2H/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARITFBUf/aAAgBAQABPxDAs678GVMZaGcVDayqV1ku7jOvMqMWU+LjECsLcaz/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Front manufactured view of PCB&quot;
        title=&quot;Front manufactured view of PCB&quot;
        src=&quot;/tech-blog/static/e30909d6b94a1f30ab4b2b0b1d707ac7/1c72d/front-manufactured.jpg&quot;
        srcset=&quot;/tech-blog/static/e30909d6b94a1f30ab4b2b0b1d707ac7/a80bd/front-manufactured.jpg 148w,
/tech-blog/static/e30909d6b94a1f30ab4b2b0b1d707ac7/1c91a/front-manufactured.jpg 295w,
/tech-blog/static/e30909d6b94a1f30ab4b2b0b1d707ac7/1c72d/front-manufactured.jpg 590w,
/tech-blog/static/e30909d6b94a1f30ab4b2b0b1d707ac7/a8a14/front-manufactured.jpg 885w,
/tech-blog/static/e30909d6b94a1f30ab4b2b0b1d707ac7/fbd2c/front-manufactured.jpg 1180w,
/tech-blog/static/e30909d6b94a1f30ab4b2b0b1d707ac7/d2602/front-manufactured.jpg 4032w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/f7371c3b32d7ec34b277679a89566802/d2602/back-manufactured.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAQD/8QAFQEBAQAAAAAAAAAAAAAAAAAAAgD/2gAMAwEAAhADEAAAAdItpC7wL//EABsQAQACAgMAAAAAAAAAAAAAAAIBAwQSABET/9oACAEBAAEFAlkapZE90OUbqVt4cqqkH//EABcRAAMBAAAAAAAAAAAAAAAAAAECEBL/2gAIAQMBAT8Byxn/xAAWEQEBAQAAAAAAAAAAAAAAAAAAASH/2gAIAQIBAT8BxX//xAAcEAEAAgEFAAAAAAAAAAAAAAABABEQEjEyQVH/2gAIAQEABj8CTTtOTG3uPjimf//EABkQAAMBAQEAAAAAAAAAAAAAAAABESFhMf/aAAgBAQABPyF8JqelnDlGkx9DD6qUt2yscWLXcP/aAAwDAQACAAMAAAAQGP8A/8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EA2hA5f/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEh/9oACAECAQE/EBqN5f/EABwQAQADAAIDAAAAAAAAAAAAAAEAESExQVFh0f/aAAgBAQABPxAMMJbvUWpdWhg9ReqIFdUTZ6AjSRW/EI8R8FUawo+T/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Back manufactured view of PCB&quot;
        title=&quot;Back manufactured view of PCB&quot;
        src=&quot;/tech-blog/static/f7371c3b32d7ec34b277679a89566802/1c72d/back-manufactured.jpg&quot;
        srcset=&quot;/tech-blog/static/f7371c3b32d7ec34b277679a89566802/a80bd/back-manufactured.jpg 148w,
/tech-blog/static/f7371c3b32d7ec34b277679a89566802/1c91a/back-manufactured.jpg 295w,
/tech-blog/static/f7371c3b32d7ec34b277679a89566802/1c72d/back-manufactured.jpg 590w,
/tech-blog/static/f7371c3b32d7ec34b277679a89566802/a8a14/back-manufactured.jpg 885w,
/tech-blog/static/f7371c3b32d7ec34b277679a89566802/fbd2c/back-manufactured.jpg 1180w,
/tech-blog/static/f7371c3b32d7ec34b277679a89566802/d2602/back-manufactured.jpg 4032w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Grandbot: Arp]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/grandbot-update-arp/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/grandbot-update-arp/</guid><pubDate>Thu, 02 May 2024 03:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Project originally inspired by the work of &lt;a href=&quot;https://twitter.com/MohitBhoite&quot;&gt;Mohit Bhoite&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Code references the state as of &lt;a href=&quot;https://github.com/handeyeco/Grandbot/releases/tag/2024-05-01&quot;&gt;this tag&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;h2&gt;Introduction&lt;/h2&gt;
&lt;p&gt;So I put Grandbot down for awhile, explored other hobbies, and found my way back to tinkering with electronics. I started looking at open source projects for synths and learned how to design PCBs for my own projects. Realizing I could make a custom PCB for Grandbot (who had been living in a breadboard for years) while also realizing that Grandbot still had a lot of spare memory, I thought I would make Grandbot play synths using MIDI.&lt;/p&gt;
&lt;p&gt;I’m not going to waste time explaining &lt;a href=&quot;https://github.com/handeyeco/Grandbot&quot;&gt;Grandbot&lt;/a&gt;, &lt;a href=&quot;https://en.wikipedia.org/wiki/MIDI&quot;&gt;MIDI&lt;/a&gt;, &lt;a href=&quot;https://en.wikipedia.org/wiki/Synthesizer&quot;&gt;synthesizers&lt;/a&gt;, &lt;a href=&quot;https://www.soundonsound.com/techniques/making-most-arpeggiators&quot;&gt;arpeggiators&lt;/a&gt;, or the &lt;a href=&quot;https://github.com/handeyeco/Grandbot/blob/f3aa1b55b50c097ed3ffdcc1509db3f21eb60274/circuit/ALPHA-grandbot-midi/grandbot-midi-schematic.png&quot;&gt;circuit&lt;/a&gt; (based on &lt;a href=&quot;https://www.pjrc.com/teensy/td_libs_MIDI.html&quot;&gt;this&lt;/a&gt; and &lt;a href=&quot;https://www.notesandvolts.com/2015/02/midi-and-arduino-build-midi-input.html&quot;&gt;this&lt;/a&gt;). I’m going to jump straight into explaining how Grandbot’s new generative, pattern-based arpeggiator works.&lt;/p&gt;
&lt;h2&gt;Concept&lt;/h2&gt;
&lt;p&gt;Most arps have preset patterns: up, down, up-down, etc. Occasionally arps will have a random setting that’s usually chaotic fun albeit a little unmusical. The idea behind Grandbot’s arp is essentially: what if we used randomness to generate a sequence and then repeat it to make it more musical. However, as opposed to sequences that are musical intervals relative to a root note, this arp basically stores array indexes to retrieve individual notes from an array of active notes.&lt;/p&gt;
&lt;p&gt;Okay some pseudocode (using &lt;a href=&quot;https://audiodev.blog/midi-note-chart/&quot;&gt;MIDI note numbers&lt;/a&gt; to represent notes):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Random arp&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// randomly plays one of the four pressed notes&lt;/span&gt;
pressed_notes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;67&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;71&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    note &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pressed_notes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;note&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Sequence, relative to a root note&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// loops 60 71 64 67&lt;/span&gt;
sequence &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
pressed_note &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;interval &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; sequence&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pressed_note &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; interval&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Grandbot&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// loops 60 71 67 60&lt;/span&gt;
indexes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
pressed_notes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;67&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;71&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;index &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; indexes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;active_notes&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;index &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; active_notes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So that’s the basic idea: it’s not random notes and it’s not a sequence of intervals. It’s a randomly selected sequence of indexes used to access an array of notes.&lt;/p&gt;
&lt;h2&gt;The data&lt;/h2&gt;
&lt;p&gt;The above pseudocode is all well-and-good, but I wanted to do a couple of other things with the arp:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Allow for octaves: we’ll use +/- numbers as note offsets (+12 up an octave, -12 down an octave)&lt;/li&gt;
&lt;li&gt;Allow for variation in note lengths: we’ll track when a note should start using &lt;a href=&quot;https://en.wikipedia.org/wiki/MIDI_beat_clock&quot;&gt;MIDI clock pulses&lt;/a&gt; (24 pulses per quarter note)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Let’s make the pseudocode a little more realistic:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;current_note &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;
current_pulse &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

pressed_notes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;67&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;71&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

indexes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
offsets &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
start_pulses &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;36&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

total_length &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;84&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleClock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    current_pulse &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current_pulse &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; total_length
    step_index &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; start_pulses&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;indexOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current_pulse&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// return early if we&apos;re not on a new step&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;step_index &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current_note&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;stop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current_note&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// wrap the index in the sequence&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// around the length of pressed_notes&lt;/span&gt;
    note_index &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; indexes&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;step_index&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; pressed_notes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length

    &lt;span class=&quot;token comment&quot;&gt;// get the note and apply the octave offset&lt;/span&gt;
    current_note &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; pressed_notes&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;note_index&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    current_note &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; offsets&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;step_index&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;current_note&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That should loop &lt;code class=&quot;language-text&quot;&gt;60 71 55 60&lt;/code&gt; (&lt;code class=&quot;language-text&quot;&gt;60 71 67 60&lt;/code&gt; before the octave transform). It should play it in a &lt;code class=&quot;language-text&quot;&gt;quarter-eighth-quarter-quarter&lt;/code&gt; pattern (in pulses: &lt;code class=&quot;language-text&quot;&gt;24 12 24 24&lt;/code&gt; from 0-83 pulses).&lt;/p&gt;
&lt;h2&gt;Generating a sequence&lt;/h2&gt;
&lt;p&gt;At this point we have most of what we need to generate a new sequence, we just need to add some thresholds for randomness and do the thing. Grandbot stores these randomness threshold values using 7-bit numbers (0-127; since that’s what &lt;a href=&quot;https://en.wikipedia.org/wiki/MIDI#Messages&quot;&gt;MIDI messages&lt;/a&gt; use).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;octave_chance &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;
max_pressed_notes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;
possible_lengths &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// 16th&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 8th&lt;/span&gt;
    &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;// Quarter&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

indexes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
offsets &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
start_pulses &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;

total_length &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;84&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;generate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    new_length &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
    step &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;new_length &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; total_length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// get a random length from the array of options&lt;/span&gt;
        note_length &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;possible_lengths&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// get a random number between&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// 0 (inclusive) and 16 (exclusive)&lt;/span&gt;
        index &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;max_pressed_notes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// get a random octave up or down&lt;/span&gt;
        offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;127&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; octave_chance&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                offset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

        indexes&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;step&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; index
        offsets&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;step&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; offset
        start_pulses&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;step&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; new_length
        new_length &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; note_length
        step &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Besides handling the actual MIDI messages (I used &lt;a href=&quot;https://github.com/FortySevenEffects/arduino_midi_library&quot;&gt;Arduino MIDI library&lt;/a&gt;), that’s pretty close to all we need.&lt;/p&gt;
&lt;h2&gt;Visualizing the note wrapping&lt;/h2&gt;
&lt;p&gt;Okay, so let’s try to make the structure of this a little easier to grok.&lt;/p&gt;
&lt;p&gt;Say for each step we pick a random index (in this example &lt;code class=&quot;language-text&quot;&gt;max_pressed_notes&lt;/code&gt; will be 7) but only press one note. Even if the random index &lt;em&gt;never&lt;/em&gt; lands on the one note being pressed, it will &lt;em&gt;always&lt;/em&gt; play that note.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/tech-blog/be0b82c52aa5d58c7e8572175a2fb35c/one.svg&quot; alt=&quot;Sequence of notes if only one note is pressed&quot;&gt;&lt;/p&gt;
&lt;p&gt;Now if we do this for a couple of notes, sometimes the index will land on a pressed note and sometime it will have to wrap.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/tech-blog/8382d56f9f7ab5ec3c578ba49887f576/three.svg&quot; alt=&quot;Sequence of notes if three notes are pressed&quot;&gt;&lt;/p&gt;
&lt;p&gt;For the last one we press all seven notes available and get the full range of the sequence.&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;/tech-blog/e6a0303c669e8d7688e9f0ac66d92b84/seven.svg&quot; alt=&quot;Sequence of notes if all notes are pressed&quot;&gt;&lt;/p&gt;
&lt;p&gt;So even though the sequence is the same for all three example, we get three very different results:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;With only one notes pressed, we always get that one note&lt;/li&gt;
&lt;li&gt;With only a couple of notes pressed, we sometimes land on a pressed note and sometimes we have to wrap&lt;/li&gt;
&lt;li&gt;With all notes pressed, we always land on a pressed note and never have to wrap&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;All of this is happening before we transform the notes with varying rhythms and offsets (i.e. octaves). So even if we only press one note, we could still have a lot of interesting variations.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;The real code for the arp does a lot more, for example:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Rests&lt;/li&gt;
&lt;li&gt;Fifths&lt;/li&gt;
&lt;li&gt;Ratchets&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;There’s also a fun feature called “Slip” that gently transforms the existing sequence by randomly swapping notes. If you’d like to know more about the project, it’s all &lt;a href=&quot;https://github.com/handeyeco/Grandbot&quot;&gt;open source&lt;/a&gt;! Sharing is caring!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Grandbot: MIDI & Misc]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/grandbot-update-midi/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/grandbot-update-midi/</guid><pubDate>Wed, 01 May 2024 03:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Project originally inspired by the work of &lt;a href=&quot;https://twitter.com/MohitBhoite&quot;&gt;Mohit Bhoite&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Code references the state as of &lt;a href=&quot;https://github.com/handeyeco/Grandbot/releases/tag/2024-05-01&quot;&gt;this tag&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;Just a couple of random thoughts about Grandbot.&lt;/p&gt;
&lt;h2&gt;Custom PCB&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/8299933cf0839392f31cd687a1f09883/e628c/grandbot.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAEmUlEQVQ4yy1V13LiWBDVz8wM2ESTo0QQGJNkghHCCmRMMMZDNBinsWdnw2zVPEztVm3VVO3T7leebYl96Lr3qu/tPt19usV0n7o4X5yjdidC3jew/TbH7NcxunsRy1cV81cFq88aiYrF22E/eZFxsa1B3Iqo7+qGlBYlNLYSmNqmhm8/viE2iSM08KD8kUXxloWvZYVXeQe/ZoJP+wCf8h6RthXRjhWhrgMWzQqLaoGtaYN/4MfXv76isWuAqawrYEcsYtcxuLse+AZBuhAEdx3H4OsY+Y2A9s89SIQqMUshNuURHIbh7Xng6rjgoTfchENsHEP6Jg1GWAowy2aEhiHjgqNpN9YIPRL3VXCjKArLHIqrPFwtB7yks1we0T0H3TuBm87shDXQcgSMKa1KxiE+jSM6jhoeI+RRuI2jPPFCGOviwTlJZRrAxU0QmaEX76Vj2FsncHW9CJJTq2ZHeEgGy5uykQOOvKRuk+BvU+BnCQyfyhg9l9B/KKJ/n8f4uYwhnUcvZfT2BTS3WXR2WVw9FiGvePAjL1qbDBj1SYGtfYLC2A2BEFmaJ0hcc6guUshNw8heh5C7Pqz5acQQfV+csRBIhq8iLtYZ8JMwpE0OjPaiwXRpoqJwVAgO5kszEtMEAsMojlQ7VdN5kKYTx6oDx9pBLCRmxYYYFap6V8ApRVddF8A0dYPyEbKUs9MpC1PDTEoe008VDO4zGDzk0N/Ruj/D8CFLK8lDHr3dGTqbJDr3OWgbHmzXiv5WD/lZgb3jhngbRPXGhw+qE9wwCInycr4tobZK4WxCuo8cSncCKstTZMd+CDcRiIRM2aTgaDkhU+oKKwFMdVslbsWJ+QJBz0OYpyl3LFpUCGlfQZMKUF0koO1yaDxUoOwFiOREJTSNbZ46JGWk6fs/f6D31gUj7mrwXwWh3mXQJOiXyzihZdFYJSHTXlknjW/ymof6v76xTlOFM7h9LcPTD+L6tz7kR+LsJAam9amFyDhiGI0QdVwdD96JH4hjVASF2kuzEYJjg2f6N2fbRXubcT5puxGljvrx7yu+/73G6TwPRn6UYafu0FtP52OQDJvqJqMTAn0/Ol/ayFOXNN80g/g21QYHGdPFplK/9wOUEp4kTjzOHAw6204icxIBMugnI2bJZLSgr+eD9qbibH4G+ZOM4CAAq2KBXUerGyanboqoOOeRHFOEeuspVB0jZLocoKHgIGIfUYhOCs9KPNRDtBASOz3Wz1YydEx6m85FSokOQh8g8RlRh1qQKa9L8F35cblOHYpB40umgkjLBOq0V1dxSPMYaqRTVgk05hwkCk9ecFSwlNHH5/MkkkMPQlfRw/hKU+zi+gxX+zzkZwndBwETInJzfw7lRUKPyNvbnhJtamg9VojIKQozhTbp6o91sMTbNNWAn6b0AXtBw/F3hCm5kYELwTGL8JUX0Z6DchKCeF8iJDw6d2lUFkmER2FDd7OLY3bPY/OShbttx09//oJLfcD2nnvEeBGlZQn5eZE8F1BYCLQ/yOhJws1TA7NH+iW80KhfVZD/WIC2r2P6ZYjBawdlGoG6DXkn4z92OCJ8lu1GSwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Grandbot&amp;#39;s custom PCB&quot;
        title=&quot;Grandbot&amp;#39;s custom PCB&quot;
        src=&quot;/tech-blog/static/8299933cf0839392f31cd687a1f09883/fcda8/grandbot.png&quot;
        srcset=&quot;/tech-blog/static/8299933cf0839392f31cd687a1f09883/12f09/grandbot.png 148w,
/tech-blog/static/8299933cf0839392f31cd687a1f09883/e4a3f/grandbot.png 295w,
/tech-blog/static/8299933cf0839392f31cd687a1f09883/fcda8/grandbot.png 590w,
/tech-blog/static/8299933cf0839392f31cd687a1f09883/e628c/grandbot.png 619w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Grandbot was looking a little sad in the breadboard and I kept accidentally unplugging things. I thought it was time to move him into a permanent home, so I downloaded &lt;a href=&quot;https://www.kicad.org/&quot;&gt;KiCad&lt;/a&gt; and &lt;a href=&quot;https://www.youtube.com/playlist?list=PLEBQazB0HUyR24ckSZ5u05TZHV9khgA1O&quot;&gt;learned&lt;/a&gt; how to make my own PCBs.&lt;/p&gt;
&lt;p&gt;After a couple rounds of mistakes, I ended up in a good place. Gerber files are part of the &lt;a href=&quot;https://github.com/handeyeco/Grandbot&quot;&gt;source&lt;/a&gt; now.&lt;/p&gt;
&lt;h2&gt;MIDI&lt;/h2&gt;
&lt;p&gt;After learning a little about how MIDI works, I thought it would be fun to make Grandbot &lt;a href=&quot;https://handeyeco.github.io/tech-blog/grandbot-update-arp/&quot;&gt;play synths&lt;/a&gt;. In order to do that I needed to have MIDI in and out, so I added an add-on MIDI board.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/2a195/grandbot-midi.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAEfUlEQVQ4yz1V2VbjRhDVz8w8MGDjfZEteZMty5blVUCMF7yA8QJe8D7AAMNkkgPJByTnzB/kF2+uNCd5qNPt6lJ31b23ysLgZYDquoL6fR3lVRntpzYGvw7+35/tzzB9n2Lx5xyn+1M0H5uobWuY/zGjbwFza9oxtU0NzfsmBMvx/vc7EjcJHLUPcdx1wXcV4P4I8o3M38fwXHoh38bh7XshjkR4em6EhmFEJxJcjA8w/u2vN/tSobqpInWTQmwSg7PrgToOoTqXcNg+RnqmwNnxIEtfYRLEp7YTyWkS7r4f6igIfRyAg+fRURTKrYLsLAvBWBr4UP8AaRxF8MqHCC05DsPfd6OwznH1QLoOIDYMIMBMtTsV4UEAMn3ywA/xOshkJBw0DxAfxyHUH35BnK8mWd7yOcfsokiPg1g+aRg8VzF7zKI8iyB7I2JF38WDwbg8CtMIMhMRD686jEUSn1oOVpqE0P/WR/O1CQ+xUCdhKJMI0raJiA9D9InMWKSfxsyT44jti4/CyFiVXPqJoR/OC8JhXdj52oGxM+BjacY8hhSDCvME9Hmce9H25eZJaLcR5KYS9DsFxUXCflifyUhOopBIkOO/CxtfGogSv/B1GOZTnfs4tFUBmTsNiakChWt+U0BqoSKzzEHfFpHbGIjzY3maRv+xiOaTiSNeqNymIFx9v4L5eAJ/z8PDPFLDIPJWJjSFEBTnMvLM2M6QphOv4kxCgiSV7xKQRxGEKJuP9Y9ITBIQuq9dFPcleDtOiF0HQpc+iBbbZDLENdxzcvWzrBDZDiJir2S850VsFMJB4xCujgut5xZKmxKE5lMD0k2cuMRxss6gtU6ivVXQ3qSIYwJnGxXnWxW9zyo6+wy6+zQudml0dxlUVwo+8UJ3x40f//xA66kFofeth873LgpLFUXqztt1I0i9eTrH7J4Yzh+rUCgrV9thZxpkBVbmXp5LQ8JAXH1sCB/95r0Jobav2a2WofZONhqy0wR8BFgilvJQRJG4nd2XEeUlAUorQjGH+bGfEMkUdPtLDRdbDWmSN3y7hlDZVnDUOiRLLmhTGaOHDM5ZtlWieiuz3Y5tCPost0kYOjvF/t2hlUhKlTKqk6TS1sDlb1cQ2i9t5FiqttTYpymkF1nqsgRtrUOayMgus5SSzEGR4LkClZlI7Hud0pHIanOtYvxZZ5fEkJlnf+rQ+qi4K6JEttUFwb6vwHwwYfDVwrYAkaVHKA+dj+T4cHqetldlnkFtmSaRaepWRYME2xcae35I8VqXWBefUJe1hxrKn8v2XpmlkOFDFmaW33w0Ga9T5AY1mkSFakjxfPA7Sz7ZnyDLVPOrPPLrPHKrnG3lfZkwZBEmkw7qLMoyU8zIqqC0sypR7bg8sw4xRltoJO+MLHMoWgNWHIgk5ojzz2k3urvngouDVL2N2j17Si3qnDDWQD2mZKwYx4UDHs4AN33vHLCVVQXC5fOlPWmtkV9cEsdlyTZrX1yVMH5uYMoev3uhvZ7D3J3+jFv9jDPuDHs1Nyb/Ahr4F7XyIwrqCgVuAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Grandbot&amp;#39;s custom MIDI PCB&quot;
        title=&quot;Grandbot&amp;#39;s custom MIDI PCB&quot;
        src=&quot;/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/fcda8/grandbot-midi.png&quot;
        srcset=&quot;/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/12f09/grandbot-midi.png 148w,
/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/e4a3f/grandbot-midi.png 295w,
/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/fcda8/grandbot-midi.png 590w,
/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/2a195/grandbot-midi.png 620w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;One inspiration was &lt;a href=&quot;https://www.pjrc.com/teensy/td_libs_MIDI.html&quot;&gt;PJRC’s design for Teensys&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/82158/teensy-midi.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 32.43243243243243%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVQY02WQ2wrDIBBE/f+PC+QxhLyE3CTaXCwxxmh7UAqlnYdl3Z2Z3VW8/uC9fyQYY7Zt01oTnwnOuXVdj+MgiTGKHxk8NG3bEmEQq6oax5E6dvu+hxBgKqWstcIkYM8bEjIY0zQRYTNknuc87b5vElxgdl0HQdR1XZYl7GEYYF/XxT60YZ/niS9dKaVOwIgu5KIo0AumNU2DJY2+71mV5UmymGeebz9gZyKEZVkEbcT5Zr4k34wRdSrMyYJvcDYfwdpvsb1URUw7sZwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Teensy&amp;#39;s MIDI schematic&quot;
        title=&quot;Teensy&amp;#39;s MIDI schematic&quot;
        src=&quot;/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/fcda8/teensy-midi.png&quot;
        srcset=&quot;/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/12f09/teensy-midi.png 148w,
/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/e4a3f/teensy-midi.png 295w,
/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/fcda8/teensy-midi.png 590w,
/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/82158/teensy-midi.png 696w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;The other was &lt;a href=&quot;https://www.notesandvolts.com/2015/02/midi-and-arduino-build-midi-input.html&quot;&gt;Notes and Volts design for Arduino&lt;/a&gt;:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/7fee5/n-and-v-midi.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 69.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABiUlEQVQoz32S64/BQBTF+///K+KbBJtIEEpFvFpBvdf73bKRNig/HVuTZu35MJ25Pffcc++McpfgeR7rbrcrl8u9Xm+9Xn/7WK1WwV8Ziny43W6spEUiEVVVWTVNSyQSxWJRECzLqlargvZK9nzcP0P8PRwOpmm2Wq0googPq23b3W4Xxul0arfb/X5/OBxCNQyDY6fTmUwm+McFBIqT8qxMqFAowM5kMuPxGPlUKjWbzRCi7el0iko8HidOGuO4Xq8v25Zl5/NqLpefz+eO41CkUqlQp1QqIYcKcpvNJpvNNhqN5XLJRIgjRHHlfD5TFsZ2u8XJfr9vNpu4XSwWaGMyFotFo1Emh+JoNEIIMnYul8vTNqF6vQ4bq/hENZlMckQX54PBIJ1OY1vXdfaM5j0w+Z6A6AdjXz4oghymjscjQhSkqeB2lD9vH4kfH3KkVqtRGd33wO7/wvsFQoyGhuViSogUgvxIuFG54VeyuD3eHdqaD3qTSWLDg+Wdh5M/FQzBdd3gVQs8AEsVC9GleZxoAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Notes and Volts MIDI schematic&quot;
        title=&quot;Notes and Volts MIDI schematic&quot;
        src=&quot;/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/fcda8/n-and-v-midi.png&quot;
        srcset=&quot;/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/12f09/n-and-v-midi.png 148w,
/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/e4a3f/n-and-v-midi.png 295w,
/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/fcda8/n-and-v-midi.png 590w,
/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/7fee5/n-and-v-midi.png 781w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;Some thoughts on the design:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;MIDI In is buffered and sent to MIDI Thru&lt;/li&gt;
&lt;li&gt;MIDI In is also sent to the RX pin on the Nano&lt;/li&gt;
&lt;li&gt;The Nano’s TX pin is sent to the MIDI Out&lt;/li&gt;
&lt;li&gt;Using MIDI TRS to save space&lt;/li&gt;
&lt;li&gt;The 6N138 optocoupler is per the MIDI spec to isolate the MIDI In circuit from the outside world&lt;/li&gt;
&lt;li&gt;The 74HC14 inverters are also recommended by the spec, I believe to tighten up the HIGH/LOW signals to prevent noise in the signal&lt;/li&gt;
&lt;li&gt;The jumper is to bypass the 74HC14 is not using MIDI Thru (making the 74HC14 optional)&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;The switch is because the Nano shares it’s serial TX/RX lines with it’s USB connection&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Both USB and MIDI are serial&lt;/li&gt;
&lt;li&gt;The Nano only has one serial connection&lt;/li&gt;
&lt;li&gt;Programming Grandbot while MIDI was active caused connection issues&lt;/li&gt;
&lt;li&gt;The switch breaks the MIDI connection when set to PROG&lt;/li&gt;
&lt;li&gt;This is also true for &lt;a href=&quot;https://www.sparkfun.com/products/12898&quot;&gt;Sparkfun’s MIDI Shield&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Gerber files for the MIDI board are also part of the &lt;a href=&quot;https://github.com/handeyeco/Grandbot&quot;&gt;source&lt;/a&gt; now.&lt;/p&gt;
&lt;h2&gt;Arduino Nano vs Arduino Nano Every&lt;/h2&gt;
&lt;p&gt;I built this whole project using a cheap Arduino Nano clone. It was never really a problem until I got to the Arp/MIDI at which point I couldn’t use &lt;code class=&quot;language-text&quot;&gt;Serial.print&lt;/code&gt; anymore because the serial connection was being used by MIDI. Despite not having a way to debug, &lt;strong&gt;&lt;em&gt;I still continued to use the Nano&lt;/em&gt;&lt;/strong&gt; because I am dumb. Talk about painful troubleshooting!&lt;/p&gt;
&lt;p&gt;Turns out there’s a thing called an Arduino Nano Every that works as a drop-in replacement for the Nano, but with additional serial ports and a ton more memory. I only looked into it at the end of the Arp feature when I surpassed the Nano’s memory limits. Ironically I had been using the Nano Every footprint in KiCad the whole time - I just thought it meant “every Nano.” 🤦&lt;/p&gt;
&lt;p&gt;My understanding is the Nano Every uses different TX/RX connections for USB and pins 1/2 (the pins I had been using for MIDI). That should mean:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I can &lt;code class=&quot;language-text&quot;&gt;Serial.print&lt;/code&gt; while debugging MIDI&lt;/li&gt;
&lt;li&gt;I don’t need the switch on the MIDI board&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;I haven’t confirmed yet though.&lt;/p&gt;
&lt;p&gt;Anyway, the positives:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Official Nano Every is cheaper than the official Nano&lt;/li&gt;
&lt;li&gt;More memory means more steps in the arpeggiator&lt;/li&gt;
&lt;li&gt;Separate serial lines for MIDI and debugging&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;The negatives:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Nano clone is cheaper than official Nano Every&lt;/li&gt;
&lt;li&gt;If you’re not using the MIDI board, a Nano clone would be fine&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;So right now I’m trying to continue support for both Nano and Nano Every.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Inkscape Tips for Technical Drawing]]></title><description><![CDATA[While working on Grandbot, I had the idea that I would laser cut acrylic for a make-shift enclosure. I’m no fan of Adobe and their business…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/inkscape-notes/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/inkscape-notes/</guid><pubDate>Thu, 11 Apr 2024 21:25:23 GMT</pubDate><content:encoded>&lt;p&gt;While working on &lt;a href=&quot;https://github.com/handeyeco/Grandbot&quot;&gt;Grandbot&lt;/a&gt;, I had the idea that I would laser cut acrylic for a make-shift enclosure. I’m no fan of Adobe and their business model (so Illustrator was out) and most of the alternatives were also prohibitively expensive, so I landed on &lt;a href=&quot;https://inkscape.org/&quot;&gt;Inkscape&lt;/a&gt;: an open-source vector illustration software.&lt;/p&gt;
&lt;p&gt;The software is meant to be for making art and several people online said that using Inkscape for precision work would end in heartache. However I found a few tricks that helped during the process and I’m happy to say that I’ve designed several acrylic enclosures using Inkscape without any issues.&lt;/p&gt;
&lt;p&gt;My local library has an Epilog Zing 24 so I figured I’d use that. The PCB was designed in another wonderful open source software called &lt;a href=&quot;https://www.kicad.org/&quot;&gt;KiCad&lt;/a&gt;; I used its measuring tool to figure out where all my cuts would need to be.&lt;/p&gt;
&lt;p&gt;I just needed to learn a couple things about Inkscape and start drawing.&lt;/p&gt;
&lt;h2&gt;Display Mode&lt;/h2&gt;
&lt;p&gt;The way to tell the Epilog Zing to cut (vs engrave) is to set the stroke-width to 0.001. Unfortunately this makes it virtually impossible to see the design (since the lines were too small).&lt;/p&gt;
&lt;p&gt;Setting &lt;code class=&quot;language-text&quot;&gt;View &amp;gt; Display Mode &amp;gt; Outline&lt;/code&gt; allows me to see the lines of my design regardless of how small the lines are.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 451px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/e86fbe7169b17dd0853aa77e7598a7b7/38070/display-outline.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 108.78378378378379%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAAsSAAALEgHS3X78AAAD80lEQVQ4y51VWU+bRxT9/gpvlcpbSdWHJg+lCIjYbbekSqFASMLSNEDUPDTCEFbb4H3fsI2Xz8vnDTApiwETaKJUkFaV+tTfcnrvULuuCC99OBrPNzNn7rn33LH00fM/8en8X5iLXCKS3kPu4BJ+eV+gcPgbAvIBSpU/EM1VUCy/R1g5RmLrnNYuEUqXsZE6pPkZsnu/it9S6dUBPP4NxBNJlEq72Nvfx9HhIXZLO8gqCg4Oy6icnuGk8lqMxyenODqu4LhyivLRifh29stbnBNen7+BZE8cY8mewIItgVV3Bp5kGbbkKUybB9AHdvD0uRYD397H4HdDGBoewYPRUQyPjNDvYYyOPkRHRwfu3LmN5uYv0NLSAunz2QvcX39LeIevdG8waP0dn724wG3tBZrn3kFrV2AyGTG/uApvIIRkOoeYnEEkJkPJbeHre9+goaEBjY2N+JggJVMZmKxO2J1eMcaTCrK5AuJyCv5gCIFQBLo1E+YXVuD0+AVpMByFnMpCyW9jYHBIkDXduoVPmpog8YLd6RGw2l2IxpOCNBKV4aPDMTkNk8WBZd0a1owWLC7rsGowwuHyIUuEU9MzQrZKpUJfXx+kVCYvNujXzVhaNdAhK8w2JzYiMSEvGk/BQnMm1BlM2KQLw9EEgqEoijs/4+nUNNrb29HT04Pu7m5IfODl4orY7KVq8wXpbAGZbBHJzBUhS2SCWCItpPIejpwvffLDFO7ebUdvb+8VYSgSh4ty4/YGkMkVBVFaKQgkUgqRF4U8ziNLLGztorC9K0g36bLpmWciwhphSsnDbHXAQvkzkGyOgjfHKQJ/MEyRr2Pm2Y+YmHyCn17MQju/gNm5l9ASllZ0wk6cQ5bMkOR0lhb0WGQs60UknIJgaBMb4RgGBgbJX1+is7OTImlDW9u/aG1tFWQcWRWiKGwFluwiONw+2Bwe8EVclMdj42KjWq0hqK9BpVKLClch8aF1s41kO4XPOIdKfoss5BbVnpiYhEaj/iBZFRqNpoYrQpNN5M9ksYNzyh3AEXL040TY1dUlJN8EXmcVPApCjsztC8JDcLr9QjpXOUPETFjNTzXx9agS1YrChPo1MwzUBWxwI0XJ/mJCll4lrB6qLwDP+Xv9msTm9QXCoqJub5BaLiG8xtKZ9EOE9eN1QopQR5Fxn+rJMkazXVRdJlOzkf9XhC5PQHQDPwY+MjPnME5PFBdlbHziWp5uyuE/PswJ7/HzxZI5Ks4dX8S5fPR4DD20sbOuklXUz2uE/HpwdF5/SPwVcG/niyXkCjsobr+ilvv+PzLrCeuJa4SjDx/Rk/6gBp5z3sbHJ4Xc/v5+Mq/qRtvUS+fxb3DERMe5d7ZnAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;An example of the outline display mode&quot;
        title=&quot;An example of the outline display mode&quot;
        src=&quot;/tech-blog/static/e86fbe7169b17dd0853aa77e7598a7b7/38070/display-outline.png&quot;
        srcset=&quot;/tech-blog/static/e86fbe7169b17dd0853aa77e7598a7b7/12f09/display-outline.png 148w,
/tech-blog/static/e86fbe7169b17dd0853aa77e7598a7b7/e4a3f/display-outline.png 295w,
/tech-blog/static/e86fbe7169b17dd0853aa77e7598a7b7/38070/display-outline.png 451w&quot;
        sizes=&quot;(max-width: 451px) 100vw, 451px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Bounding Box&lt;/h2&gt;
&lt;p&gt;I’m not sure the bounding box setting made a huge difference, but I thought it was worth mentioning. What this does is change the reference point for where you’re positioning elements: visual bounding box includes the stroke width in calculating a shape’s position whereas geometric bounding box does not.&lt;/p&gt;
&lt;p&gt;If you’re positioning things before changing the stroke width and getting confused as to why your x/y position is changing, it’s probably because you need to switch to geometric bounding boxes.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Preferences &amp;gt; Tools &amp;gt; Bounding box to use&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/a9717c12cd9131fd0fac059062550973/0786c/bounding-box.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACZUlEQVQoz3WR6W5SQQCF74vIBYyR9bLJJshy2SlrgySFECPaipr4wyfwBZoqkmijaStIaQlVqLUpSwGBpIk2XfS3z3KcmcTaRP3xZebeOXPmzBnuTvkcxcp3PFubob0/Rrt7hIPJGfqzHzgYn2B/dIz94TGbd7+cokfW9gZf0Z2cokO0nw+/kf8nRH+Oo7Of4NqdT9iovke1Vkez9RGNZgudrS2MR7vojfuYTqaYTqeYzQjTP/PJZELGGUajIQaDPobDQ/R6PXCbWy28Wn1LTDfR+rCL5ecvsZBKobS0gGKpiAeLSygUCsjn8/8km80iRfSZTAbz8/Pg3tUaKFdeY/XNOhrbO1jbqMJ60wntDRcMFhc0Jgfk1xSQ8lfA81JIJBIGz/OQSqWQyWSQy+WQEejIrVfrWF4pY+VFBTRtrd6AxyPCaHNDIVhwXTBDbbBBo7fAaDLBbrfDarXCYrFAr9dDEATodLoLuGarDZqyVt/GTnuPJbzlDUIdWIQx+RSK0BNc9T+G1FGAzmCC0+lEKBRCMBiEy+ViJhqNBlqtlsHdJx1R7hbvofTwERttNhs5WYvs7QwS8Rh0JIVapYTeaII/kSeGQUQiEfh8PqZVqVQMasyJPhHxeByxWAxzc3OIRiMwm81s0ePxsDQ0iSDo2BW9okjMwogRrdvtZoZ2CqmCrnNhchJ9HfpSqVQaiUSCdaRQKFhP6XSaHUg3KpVKGAwGBAJ+iKKXJQyHw/D7/SwE65Aa0k3JZJJBN/82dDgcyOVyLCUV045ocrVa/RcXV45EoyzdZUOajIoCgQCDGtHvy+X/j1/vrssBiWlOEgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Bounding box setting in preferences&quot;
        title=&quot;Bounding box setting in preferences&quot;
        src=&quot;/tech-blog/static/a9717c12cd9131fd0fac059062550973/fcda8/bounding-box.png&quot;
        srcset=&quot;/tech-blog/static/a9717c12cd9131fd0fac059062550973/12f09/bounding-box.png 148w,
/tech-blog/static/a9717c12cd9131fd0fac059062550973/e4a3f/bounding-box.png 295w,
/tech-blog/static/a9717c12cd9131fd0fac059062550973/fcda8/bounding-box.png 590w,
/tech-blog/static/a9717c12cd9131fd0fac059062550973/0786c/bounding-box.png 663w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;XML Editor&lt;/h2&gt;
&lt;p&gt;No matter what I did, the stroke never really ended up being exactly 0.001. Luckily SVG is just XML and XML is relatively straight-forward to edit manually.&lt;/p&gt;
&lt;p&gt;To view the SVG output, you can go to &lt;code class=&quot;language-text&quot;&gt;Edit &amp;gt; XML Editor...&lt;/code&gt;. Digging through the markup will show you the individual elements and their styles. Inkscape also seems to save things as SVGs which you can open in a text editor. Personally I opened the SVG in VS Code and did a find-and-replace: something like find (regex) &lt;code class=&quot;language-text&quot;&gt;stroke-width=&amp;quot;\d\.?\d&amp;quot;&lt;/code&gt; replace &lt;code class=&quot;language-text&quot;&gt;stroke-width=&amp;quot;0.001&amp;quot;&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/9a11bdb502c1090210b1c73841490a6b/e185b/xml-editor.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 86.48648648648648%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsSAAALEgHS3X78AAADr0lEQVQ4y3VTaW8aVxSdv9LWZlgHmAEMDGYz4NZqEsm1qjZJq6iL2p9RdUud2FVqJ3W8grHZzAxgMIsBB4KN2zh2F0Vqq/6Z0/sesdWo6oej+2ZgzjvnnnuFOw9fYCk/xEHnFMX6MfTGMYq1pyg1T1BuDlFuDbHfPUN78Dv26dzqX6DZO0fvpxcYXvyNk+d/4fjsTwye/YFTehaazRZq9QYOO0/Q7vbQPuqjQ2gf9XBIz432E5w2KugOdAxOjtFpH6Lf7+HoqItOp83rcHiC8/Nz6LoGIbdXwm6uCFaL+j60chXFUpXXvFbByloSc+/MYva9Ocy9exPx6bcQDIUQeolwOIxIJIJ4PAFVDUDY2s5gYysNvXKAPSIcocLJs4USFr5fwmR0Gnb3JCSXCsnphdloxLhowLjBAFE0Ymx8DE6nE4EAESbTWVKxBb1c4ySX0PQqynoDm4/TmJqKw+3xkSKVqheyPAFZkeFSnHDKTtgkO1UFPp9/ZDmdKWAnu4dCscwVFrV9VLQ6OsUeqmt1hOmPituLBBHHoypUOofcdsQm7VA9VkgWERbjG3DTBcL2Tg5LDx8jQ30skW3WP12voal1cJp9htZCE2riExiiHyMy+zlic5/B9+ansIU/gi12B8boh3g9cBuvBT6APXANwmZyB4sPlrG+uY3V9SR2SG25VMdh8QgXuV+JsIVA8BrGHAGYXRGYCKIShkEOQeQIw0TPrMreIARmd3UjiTxZ55YpWV2robXXxS/539D5oYugV4XZNA7JaobNYiKL/4XVLJJlGUK2oIPZviTME5hlpvB55gJPlwcI+UmJ0QCr1QoLwWqzwWaTCLaXkPh7l8sFIUVky49W8WhlnfeRkZZKB2hQD38unKG71MXMzG24gwlEQlNQFRdku/1fZCOwy9xuN6VMCpM0i2y4WcJsfDQKhqdc6qOWbCAx8z4Rvk3zeAMBNUoDPAmHonCSS0KLxTIiTO/meRhrGynqZQorq5vI5jXopRpyWR0/Lm/gxvXrtBFBKESikC0GNsiMwOPxwOFw8N+uFDLbKRpwFhBTyggZ2IxupXZx89Ytvl6MRCI1ExMTiMVivKqqCr/ff0UuZOhDti2ckNSyLWFJM2hkn7UjMT1N2yFDkiRuzU499Pl88Hq9nOwVQr18QAmPNqRSa6JSbRCa/FymM7uEfSCK4isBmM1mDpPJdFV5yt9+dw9ffXOX4+78fczfX8T8vUVeFxYf4Isvv+ZKGAlT+H9gFzGV/wAUox0ahjbWiQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;An example of manually editing the SVG in the XML editor&quot;
        title=&quot;An example of manually editing the SVG in the XML editor&quot;
        src=&quot;/tech-blog/static/9a11bdb502c1090210b1c73841490a6b/fcda8/xml-editor.png&quot;
        srcset=&quot;/tech-blog/static/9a11bdb502c1090210b1c73841490a6b/12f09/xml-editor.png 148w,
/tech-blog/static/9a11bdb502c1090210b1c73841490a6b/e4a3f/xml-editor.png 295w,
/tech-blog/static/9a11bdb502c1090210b1c73841490a6b/fcda8/xml-editor.png 590w,
/tech-blog/static/9a11bdb502c1090210b1c73841490a6b/e185b/xml-editor.png 691w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;That’s it for now. It was otherwise pretty straight-forward to design my stuff in Inkscape and the laser cutting worked without a hitch. Very grateful to the maintainers and contributors of Inkscape and thrilled to live in a world where we have these tools freely available to us. Also very grateful to my local library for having a freggin’ laser cutter available!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Databending with Web APIs]]></title><description><![CDATA[An example of an image that was databent using my web-based databending application. Databending with Web APIs This repo hosts this blog…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/databend/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/databend/</guid><pubDate>Sat, 24 Feb 2024 03:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/d2c7ee658c299cd6400a5235cded5c34/00d43/graffiti_application.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAADUUlEQVQ4yw2T2VsadxSG57/uVW7adLFZatsYlxiNEJHFhR1lEXEcUPZhHWCiQFiEimA0IkZ/b+fi3J3nO8/7fd+RvkWSTE0dLrbiuF+qbK57hX3zAO+nKAfvg2TXitTnq0zmVHLuCNZQjNNKjJm5jPIijzwfIjEvs/GiiPZvEam5UhatRV3oS30RMDeExd8l5/sq7o66dFa/UHx3xnCpTmVP496boBH0cesPglWm8zpB2l5BbdQJeydUPOdI67YZumVM/n0Ph6NLNNdFKbToatDY/k7lL43xmxIFuUQzMaB4lGKwW2C6ecydNUJpv0Ql02W/MMbvuUOy+3+Q/jAm/rHGvqvHdqKNy5iL1j3tPePQusLDskrPfcbIesLQkaR1PKZtyTNYzqKYW8SLI5TchLzlBqmw00Ox5TjyjNkJDNhNdJGLQ8baA8WdMdXFGHeWDHWbjxtbhCt/iv4/V/RX0uQWYljnyhTrHSKpAcfbfaTLw3MUR58dxyP+Uo8DVxslfMn18ZSxa0DzbZraap07X5DnqMfAVGi/KnFtSZLeOMb3h+FjosS51qTqryDVTmv4vZd4whqaXsO7qpNZHjItPDILjygvqvg+Zfjq9HITDfNgaRhB5bnailIwxKMvL8jEe1QqBZKBFJKsqLiOavRO3VzFFC7XmkxXylwGm2R2+7gtZeS1OMIX4MkZFsSyPCvnPGxc01moEvnFsMiZQ1WT7GWzSJ9/LmNTNDqhCH1HiG8LOTAqkjzIY7LpOFfPSCxHGZvjYhJO079q0T8bI/99RX2uzsWvRfK5Y1JyjkhERdJfp9BMeW5WQoxMHmZ7GQjopOw1gpsZlECU6t4tUdME19yjWEo8iWx6gma+pvpxKJ42VNFvJUnEk0IL7iOpiy2KnjRP3m2+B7eY+mp8d2lY1y8wLVcJnsSIeCfCeXBH6PBRbDTuRazyg9G7B5F4O+TEWSNUSYm0nCYeSiM5PIK4v8fNfpunnQGYeox8VQ5/V5H3C5zounAocKQ/iy88Cx8Cdxohr8zw/lQTgdBARErG2yb/E1EDTpI/G4SJe/TwDGzA/IShq4j9wznujRz23xr8uQme8Y2oTm+F01gxui0svhnmVwfija2CPZgSVvlRRP3wP1w7Z27ZDknoAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Image that has been databent with my custom databend application&quot;
        title=&quot;Image that has been databent with my custom databend application&quot;
        src=&quot;/tech-blog/static/d2c7ee658c299cd6400a5235cded5c34/fcda8/graffiti_application.png&quot;
        srcset=&quot;/tech-blog/static/d2c7ee658c299cd6400a5235cded5c34/12f09/graffiti_application.png 148w,
/tech-blog/static/d2c7ee658c299cd6400a5235cded5c34/e4a3f/graffiti_application.png 295w,
/tech-blog/static/d2c7ee658c299cd6400a5235cded5c34/fcda8/graffiti_application.png 590w,
/tech-blog/static/d2c7ee658c299cd6400a5235cded5c34/efc66/graffiti_application.png 885w,
/tech-blog/static/d2c7ee658c299cd6400a5235cded5c34/00d43/graffiti_application.png 1000w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;An example of an image that was databent using my &lt;a href=&quot;https://handeyeco.github.io/databend/&quot;&gt;web-based databending application&lt;/a&gt;.&lt;/p&gt;
&lt;h1&gt;Databending with Web APIs&lt;/h1&gt;
&lt;p&gt;This repo hosts this blog post and a simplified example:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/handeyeco/databend-blog&quot;&gt;Source&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://handeyeco.github.io/databend-blog/&quot;&gt;Demo&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;It’s based on the work for a web application that builds a UI around this concept:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/handeyeco/databend&quot;&gt;Source&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://handeyeco.github.io/databend/&quot;&gt;Application&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Intro&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Databending&quot;&gt;Databending&lt;/a&gt;, like circuit bending, is a way of creatively breaking technology to generate unique and unexpected results. In circuit bending, the idea is to mess around with the underlying electronics: modding, jumping, and shorting to find interesting ways to break circuits. In databending the idea is to break things in the data layer.&lt;/p&gt;
&lt;p&gt;Computers operate in 1s and 0s. We might see an “a” in a text file, but a computer will see “01100001”. The fact that we’re just dealing with numbers is important to databending: when we run an audio file through an EQ or an image through a filter, we might think the application has some sense for what a song or a picture is, but ultimately it’s just doing math. So what happens when we run an image through an EQ? Or an audio file through an image filter? That’s one sure-fire way to break things!&lt;/p&gt;
&lt;p&gt;A common example of databending (and how I learned about it) is to take the free audio software &lt;a href=&quot;https://www.audacityteam.org/&quot;&gt;Audacity&lt;/a&gt;, use its “raw data” import option to load in an image, run some audio effects over the image, and export the bits back out as an image file. Here’s an example of an image bent with Audacity:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/1cbd3e47a52f647f28fe577c3e9b587a/00d43/graffiti_audacity.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAADiklEQVQ4yw2T61cSdgCGf16WJ++Wl9Q0Y5WXaZk67w5S8YJTCAS8EV4QTVRQ8IIEgogiiiKlaZrztK221Xa2T/uws3P2nz3jD3jfD8/7vEJZ20dRu5nspX3aVpwseXeoWzsi3ePDf3DCxdklu+ELLq++8FAXRFY2Q1XfOp1SI5/CByxaN3lunUS75WBwZweh06qo2ryiPXBO6t4+xVIT4vgKcfIRX/Qzhug1epuJ+YiLhslGpHodveMmWvVt+Gw9HG7NUvfgPol5KdQ57iEsi120bodRec4psU3zqOwBHcdRSg78VHiCTAfWGXG5sYXK8fpbGAwXIGlPIaL/jn9Cdv4LT6KWt5F/O4fi+QyEemKGDFuUbOs+qdP7pDUoCPjlXHzaodoTYc4pZ8Tdjd77NcZVOcOHJchNBcz3VHLsbGbPKmWopYLyOxKK1jIRje1zpK2+pmrMTvpQiGy9meCZi6nT15gmfFh8MbaDOpwRJ4EffNTOt/PG2MBh8FtOPWm89ar4XlpNQV4GObZUxLTSxjOVD+HfJKHdT/Ksn4bIrxRZ3JgHZ1mw7tK9sUvn3g6Vb07oG+0kOpLP4kwJ68ZSPmzWojM8Ii0thSxNSoxhywKdlWEy1pZIbxqg2XKE++BHbhk20TWpmTo6pufsHbLTa4bXrlnt0PKLWUaPS8OofoXoXhuNigYSs3LJVMcjlp92UVO/hah2ED+zjHj/B8nvh7m5IOGboR7UMW36t5cZ7zjFOrOB16Blu3ScLPcWZc5r8iNvuTHopLRaSZPJiBgN6HFp7FQ81vAwtEz9koK2dQlDbj11lmaK1/3c+zmC8sU+Nt0BJ1IDvhI9Of4ABSsfKXB9Rgy40T0fZuPyAtFveUVA+owvk4WcjpXx9/QTpgayuKutoXYim1sKLUmeWPhohcemKxoWTtnLNVCweM0dx5/kGQ4R+c1MOYIsbh8jFKoXeJ9I+H2winfKen6bl2KtTyBzopCOBTnzsgl6x/zUmB0Y6i3YO4y8uqsh035J0sJPJCuNJBU2Yz38l1D0L8ScSYm3Jh6nIg6HKpFzjcD5VNDqSULTO85wSiHqRjOr/TIUQmAX8fQX5yJW8kiYiHmnKyazXM7LLh2jLfLYKB+6CDUnEjYWMjcmiakgCCrjaTMnotWtsN3jQ70URF96G2WssDshDpkkgRvym8RNCsTYV+Q3GliM/f+ldYb/ASGCDlxvy0zzAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Image that has been databent with Audacity&quot;
        title=&quot;Image that has been databent with Audacity&quot;
        src=&quot;/tech-blog/static/1cbd3e47a52f647f28fe577c3e9b587a/fcda8/graffiti_audacity.png&quot;
        srcset=&quot;/tech-blog/static/1cbd3e47a52f647f28fe577c3e9b587a/12f09/graffiti_audacity.png 148w,
/tech-blog/static/1cbd3e47a52f647f28fe577c3e9b587a/e4a3f/graffiti_audacity.png 295w,
/tech-blog/static/1cbd3e47a52f647f28fe577c3e9b587a/fcda8/graffiti_audacity.png 590w,
/tech-blog/static/1cbd3e47a52f647f28fe577c3e9b587a/efc66/graffiti_audacity.png 885w,
/tech-blog/static/1cbd3e47a52f647f28fe577c3e9b587a/00d43/graffiti_audacity.png 1000w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;(&lt;a href=&quot;https://unsplash.com/photos/green-and-yellow-abstract-painting-WKQt_X-SKFI&quot;&gt;Original image source&lt;/a&gt;; &lt;a href=&quot;https://www.youtube.com/watch?v=cXjwJPz4qi0&quot;&gt;Audacity databending tutorial&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;It’s fairly easy to do, but it’s also fairly easy to do irreparable damage to the image file. That’s because in most files there’s a section of the bits devoted to the data and there’s a section of the bits devoted to metadata (the header). Running the header through the databending process can result in a file that can’t be opened because at a certain point applications can’t understand enough of the metadata to open the file.&lt;/p&gt;
&lt;p&gt;It’s also a long-ish iteration cycle. Audacity isn’t showing a preview of the image you’re destroying because it doesn’t know it’s working with an image; Audacity is just doing math with a bunch of bits you handed it.&lt;/p&gt;
&lt;h2&gt;The thing I made&lt;/h2&gt;
&lt;p&gt;As a kid I enjoyed breaking photos with Audacity to make pseudo-generative art and then I became a web developer. So after rediscovering databending, I decided to make my own application to speed up the process. In modern browsers we have a few tools that are relevant to this project:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API&quot;&gt;Canvas API&lt;/a&gt;: an API for working with images&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/Web_Audio_API&quot;&gt;Web Audio API&lt;/a&gt;: an API for working with audio&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tonejs.github.io/&quot;&gt;Tone.js&lt;/a&gt;: a library that takes the very low-level building blocks from the Web Audio API and abstracts them into higher-level audio tools (like BitCrusher and PitchShift).&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;With these tools, I made the &lt;a href=&quot;https://github.com/handeyeco/databend&quot;&gt;databend&lt;/a&gt; project. It uses the Canvas API to convert an image into a bunch of numbers, runs the numbers through different audio effects provided by Tone.js, and then converts the resulting audio data back into an image.&lt;/p&gt;
&lt;p&gt;It doesn’t muck with the headers because it’s just manipulating the actual image/audio data. It knows its job is to destroy images, so it provides some previews of how the image will look on the other side of the process.&lt;/p&gt;
&lt;h2&gt;How it works&lt;/h2&gt;
&lt;p&gt;The code here will be based on the demo in &lt;code class=&quot;language-text&quot;&gt;index.html&lt;/code&gt; (&lt;a href=&quot;https://handeyeco.github.io/databend-blog/&quot;&gt;shown here&lt;/a&gt;). To see the full application code, check out its &lt;a href=&quot;https://github.com/handeyeco/databend&quot;&gt;Github repo&lt;/a&gt;.&lt;/p&gt;
&lt;h3&gt;From image to audio&lt;/h3&gt;
&lt;p&gt;The first step is getting image data. We do this by creating a Canvas context, rendering an image with it, and then pulling out the image data.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// pretend you have an image object&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// like by using `new Image()`&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; width&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; height &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; image

&lt;span class=&quot;token comment&quot;&gt;// Create a canvas twice the height of the image&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// so we can show before/after&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; imageMount &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getElementById&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;image-mount&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; canvas &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; document&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createElement&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;canvas&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; width
canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;height &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; height &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
imageMount&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;appendChild&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Draw the original image&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2d&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;drawImage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;image&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; width&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; height&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Get the image data&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// this is confusing: getImageData returns an object&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// containing a property called data&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; imageDataContainer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getImageData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; width&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; height&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; imageData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; imageDataContainer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/getContext&quot;&gt;getContext&lt;/a&gt;, &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage&quot;&gt;drawImage&lt;/a&gt;, &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/getImageData&quot;&gt;getImageData&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;So what do you have at this point? You’re now the proud owner of a &lt;code class=&quot;language-text&quot;&gt;Uint8ClampedArray&lt;/code&gt; representing the image. It’s a 1D array that describes each pixel with four values: red, green, blue, and alpha (transparency). Each value is represented as a number between 0 and 255. So one pixel of fully opaque &lt;a href=&quot;https://www.color-hex.com/color/4682b4&quot;&gt;steelblue&lt;/a&gt; and one pixel of fully transparent &lt;a href=&quot;https://www.color-hex.com/color/fa8072&quot;&gt;salmon&lt;/a&gt; would be:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// R, G, B, A, R, G, B, A&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;70&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;130&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;180&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;250&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;128&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;114&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Audio works with floats between -1 and 1, so we need to do a conversion:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;scale&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;number&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; inMin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; inMax&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; outMin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; outMax&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;number &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; inMin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;outMax &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; outMin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inMax &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; inMin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; outMin&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Convert image (0 to 255) to audio (-1 to 1)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;convertImageDataToAudioData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;imageData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; audioData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Float32Array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;imageData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; imageData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        audioData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;scale&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;imageData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; audioData
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Through Tone.js&lt;/h3&gt;
&lt;p&gt;&lt;em&gt;I didn’t say this earlier, but thank you to the maintainers of and contributors to Tone.js. It’s just a gem of a library.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;At this point we have a Float32Array that looks enough like audio that we can pass it to Tone.js. In the application code, things gets a little convoluted here. I wrap each Tone.js module in a wrapper that allows me to apply a dry/wet mix.&lt;/p&gt;
&lt;p&gt;I also add an option to split the color channels before running the data through Tone.js: remember that the array is sorted as [R, G, B, A], this option creates four arrays ([R], [G], [B], [A]), runs them individually through the audio effects, and then merges them again on the other side. It’s hard to explain this, but think about a delay: a delay takes information from one position in the array and applies it to another position. By processing all the colors together, information from the red color might affect the blue color or alpha values. By splitting them, red will only affect red. Also it gives me the ability to only apply the effect to one color at a time.&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Anyway&lt;/em&gt; here’s what it looks like in the demo when we run the data through Tone.js (without all of that added complexity):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;processAudioData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;audioData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; audioContext &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Tone&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Create offline renderer so we don&apos;t have to wait for the &quot;audio&quot; to &quot;play&quot;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// before we get a buffer back that we can either manipulate more&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// or convert to an image&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; rendered &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; Tone&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Offline&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// Create a one channel Web audio buffer to load audio data into&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; buffer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; audioContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;createBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; audioData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; audioContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sampleRate&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; buffering &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; buffer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getChannelData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// Fill the buffer with our data&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; audioData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            buffering&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; audioData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;


        &lt;span class=&quot;token comment&quot;&gt;// Create the Tone buffer module to play the audio data&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; bufferNode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Tone&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;ToneBufferSource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buffer&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// Create some effects that will process the audio data&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; phaser &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Tone&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Phaser&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            frequency&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; chebyshev &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Tone&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Chebyshev&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            order&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// Connect all the pieces together,&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// including sending the data to the destination (output)&lt;/span&gt;
        bufferNode&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;phaser&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        phaser&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;chebyshev&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        chebyshev&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toDestination&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// Start the buffer playing&lt;/span&gt;
        bufferNode&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; audioData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; audioContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sampleRate&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; audioContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;sampleRate&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Pull the raw data out of the updated buffer&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; processedAudioData &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; rendered&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getChannelData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; processedAudioData
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(&lt;a href=&quot;https://tonejs.github.io/docs/14.7.77/fn/getContext&quot;&gt;Tone.getContext&lt;/a&gt;, &lt;a href=&quot;https://tonejs.github.io/docs/14.7.77/fn/Offline&quot;&gt;Tone.Offline&lt;/a&gt;, &lt;a href=&quot;https://tonejs.github.io/docs/14.7.77/ToneBufferSource&quot;&gt;Tone.ToneBufferSource&lt;/a&gt;, &lt;a href=&quot;https://tonejs.github.io/docs/14.7.77/Phaser&quot;&gt;Tone.Phaser&lt;/a&gt;, &lt;a href=&quot;https://tonejs.github.io/docs/14.7.77/Chebyshev&quot;&gt;Tone.Chebyshev&lt;/a&gt;, &lt;a href=&quot;https://tonejs.github.io/docs/14.7.77/Destination&quot;&gt;Tone.toDestination&lt;/a&gt;, &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/BaseAudioContext/createBuffer&quot;&gt;createBuffer&lt;/a&gt;, &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/AudioBuffer/getChannelData&quot;&gt;getChannelData&lt;/a&gt;, &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/AudioNode/connect&quot;&gt;connect&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Steps:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Since we don’t actually want to listen to the audio, we create an offline Tone instance. Besides saving us from harsh noise, it also speeds up the process since it can run as fast as possible to render audio (rather than have to play the audio at a normal speed).&lt;/li&gt;
&lt;li&gt;We create a &lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/AudioBuffer&quot;&gt;Web Audio API buffer&lt;/a&gt; and populate it with the data we generated in the image-to-audio step.&lt;/li&gt;
&lt;li&gt;We create a Tone.js ToneBufferSource (using the Web Audio buffer) and some effects, connect them, and start the buffer playing.&lt;/li&gt;
&lt;li&gt;Tone.Offline returns a promise containing the buffer which contains the data we’ll convert back into an image.&lt;/li&gt;
&lt;li&gt;Once it’s all processed, we pull out the raw data from the buffer: another Float32Array.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;This is where the bulk of the experimentation happens. Here you can tweak the settings for the effects or replace them with any number of other Tone.js modules. For each new module, just make an instance using the constructor and add connections using &lt;code class=&quot;language-text&quot;&gt;.connect&lt;/code&gt;. Dig through the original application code to see how I added dry/wet mixes (although some effects have this built in) and the option to process individual colors.&lt;/p&gt;
&lt;h3&gt;From audio to image&lt;/h3&gt;
&lt;p&gt;From here we’ll scale the audio data (from -1 to 1) back to image data (from 0 to 255) and drop the updated pixels back into the Canvas context:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Convert audio (-1 to 1) to image (0 to 255)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// (mutates the original imageData array with the new data)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;convertAudioDataToImageData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;imageData&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; audioData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; audioData&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        imageData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;scale&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;audioData&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Draw the modified image data&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// (offset by the height of the image,&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// so it doesn&apos;t overlap the &quot;before&quot; image)&lt;/span&gt;
context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;putImageData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;imageDataContainer&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; height&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;(&lt;a href=&quot;https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/putImageData&quot;&gt;putImageData&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;Here’s the same image from the Audacity experiment, databent by playing around with the demo code in this repo:&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/4890c354eb5f723d06e99504289310de/00d43/graffiti_databend.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 66.89189189189189%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAACkUlEQVQ4yyWTSVPbUBCE/f8P+QE5pHJPKlW5hVQoKJchLEECY4wxXvFuybtsY2x15xMcpp40munp6dfKKXqxtyO52ZdbV3b7RM7n7Zjc61Q+LOQh8eWvfFO17+7lRlkO2vYR+R794wf5z538M3DOKooOqxNbw47UubUK91I/kcZzaUY0F1JhZJXX0uSN+p012EmNjZQOeV9KW/Jxopy2PVsjKeoTfJgO5XBh3SbyyZJPK4YA2qVhvLciyg+yVoC3Y2k/AJQzXZM3gMsG6Bt72LJaLzR2JTbzAvAChX0KB4A9Ef+IsqlPGZxQD/N9JssUQIbuzcq7Dt2x/FSxgiaAkVxcWTOAx2OrWpeup1aeOGaTOqvOYAqeYlim5MQW6atg6JzWgKwAvebs3KFLj1V4H6LrnOKLF+uUhgA2YWT1aNwCtge0y3N3Lpu1UYEsgMkFgA2rTnLyKN93rLAl9dB0xkWdAHiO8MW2VHqGFVIopRspHgEMlgBNgELbNNPQNV5Ce9fACjwHFbk8/NCsxF7nW2lUtEd5aX1DbR05cMAdwN8AOgPQiKc5Q7oAJhNry/QElu3Su/8UoU2fNasH6RTt4oI8O7M3lx/rPaPj50j6HVoXffphunvmrAA4rTKZAbM9ohLZtA0Nb2t5gz8GmHePkWcMfCtlHpRHkDjHs1cBhNnmALsElyy6aBg9WntsMMSsLc4yYFG2GezaxBg/KmQAf0LaRymGhtjpE3/IUWDVpnaKNDFD4hjAB25pgJoQFRct5Hr34RMnttSGu8s+upndYyY98jD0kmHfUzuAyIYfYD0AMMKHIeK2qb2h6BdxTAsWdGYvCCnEPssHgA6ZK5T5A1XkCk9fSf+AzIg/q1ezz2r+D1ou3MNtF6qRAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Image that has been databent with Audacity&quot;
        title=&quot;Image that has been databent with Audacity&quot;
        src=&quot;/tech-blog/static/4890c354eb5f723d06e99504289310de/fcda8/graffiti_databend.png&quot;
        srcset=&quot;/tech-blog/static/4890c354eb5f723d06e99504289310de/12f09/graffiti_databend.png 148w,
/tech-blog/static/4890c354eb5f723d06e99504289310de/e4a3f/graffiti_databend.png 295w,
/tech-blog/static/4890c354eb5f723d06e99504289310de/fcda8/graffiti_databend.png 590w,
/tech-blog/static/4890c354eb5f723d06e99504289310de/efc66/graffiti_databend.png 885w,
/tech-blog/static/4890c354eb5f723d06e99504289310de/00d43/graffiti_databend.png 1000w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;This isn’t the most performant way to do this. It’s laggy and front-end JavaScript is probably the last place we want to be processing large numbers of bits. I’m sure WASM or Web Workers or C++ would be a better alternative. I am glad I made this though; it highlights how far web APIs have come and how many tools we have available to us on the front-end. Plus I used this to make art that landed me on the cover of a zine I admire!&lt;/p&gt;
&lt;p&gt;Anyway, hope this helps someone. Happy hacking!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Concurrent Arduino]]></title><description><![CDATA[For a more fleshed out example, you can see how Grandbot uses this behavior as of this tag for his light and voice. In an effort to create…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/concurrent-arduino/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/concurrent-arduino/</guid><pubDate>Wed, 27 May 2020 21:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;For a more fleshed out example, you can see how Grandbot uses this behavior as of this &lt;a href=&quot;https://github.com/handeyeco/Grandbot/tree/2020-05-27&quot;&gt;tag&lt;/a&gt; for his &lt;a href=&quot;https://github.com/handeyeco/Grandbot/blob/2020-05-27/src/Light.cpp&quot;&gt;light&lt;/a&gt; and &lt;a href=&quot;https://github.com/handeyeco/Grandbot/blob/2020-05-27/src/Voice.cpp&quot;&gt;voice&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;In an effort to create smooth RGB LED transitions in Arduino in a way that didn’t completely block the main thread, I explored tweening using a repeatedly called update method in the class controlling my LED. Unfortunately part of my project, a buzzer playing a little melody, also blocked the main thread and broke my LED tweening. This was an existing bug that also blocked interaction with the project, so it was an opportunity to learn more about keeping the main thread free while improving the project.&lt;/p&gt;
&lt;p&gt;In this post I’ll talk about creating long-running yet non-blocking transitions for RGB LEDs and also cover a strategy for playing melodies with the Arduino &lt;code class=&quot;language-text&quot;&gt;tone&lt;/code&gt; function without blocking the main thread.&lt;/p&gt;
&lt;h2&gt;RGB LED transition&lt;/h2&gt;
&lt;p&gt;A naive first try at an LED transition might look like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; currR &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; currG &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; currB &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; g&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...write to LED...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;transitionComplete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    currR &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; nextR &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
    currG &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; nextG &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
    currB &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; nextB
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sign&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Gets called once&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; nextR &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; nextG &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; nextB &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;transitionComplete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    currR &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sign&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextR &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; currR&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    currG &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sign&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextG &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; currG&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    currB &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sign&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;nextB &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; currB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currR&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; currG&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; currB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This should transition the LED correctly between two states, but unfortunately the &lt;code class=&quot;language-text&quot;&gt;while&lt;/code&gt; loop blocks the main thread preventing the Arduino from doing anything other than transitioning the LED.&lt;/p&gt;
&lt;p&gt;The solution that worked for me was setting the next state in a separate method and creating a frequently called &lt;code class=&quot;language-text&quot;&gt;update&lt;/code&gt; method that tweens between two states. Tweening is a technique in animation that is used to transition between two states based off of an animation length and the current progress.&lt;/p&gt;
&lt;p&gt;There’s a lot more to keep track of and some &lt;em&gt;math&lt;/em&gt;, but it’s an effective way to transition the LED.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; prevR &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; prevG &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; prevB &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; nextR &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; nextG &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; nextB &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Find the difference between the two states&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; deltaR &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextR &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; prevR&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; deltaG &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextG &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; prevG&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; deltaB &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextB &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; prevB&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Animation should last 2 seconds and start now&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; animationLength &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; animationStart &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; g&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...write to LED...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Gets called repeatedly in the main loop()&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Determine how long the animation has run&lt;/span&gt;
  unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; elapsed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; animationStart&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Determine progress through the animation&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// capped at 1 (100%)&lt;/span&gt;
  float progress &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;float&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; elapsed &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; animationLength&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  float capped &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;progress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Tween&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevR &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;capped &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; deltaR&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; g &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevG &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;capped &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; deltaG&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevB &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;capped &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; deltaB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; g&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we can create a swirling effect by adding a conditional to the &lt;code class=&quot;language-text&quot;&gt;update&lt;/code&gt; method.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Can be called repeatedly in the main loop()&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; elapsed &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; animationStart&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  float progress &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;float&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; elapsed &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; animationLength&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  float capped &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;progress&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevR &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;capped &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; deltaR&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; g &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevG &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;capped &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; deltaG&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prevB &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;capped &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; deltaB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; g&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;process&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    prevR &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextR&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    prevG &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextG&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    prevB &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextB&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    nextR &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    nextG &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    nextB &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    deltaR &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextR &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; prevR&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    deltaG &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextG &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; prevG&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    deltaB &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; nextB &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; prevB&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    animationStart &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; now&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This frees up the thread, but created two new problems:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;I change the next color state with a user interaction (pressing a button) which creates a hard transition when starting a new animation during a currently running animation. It’s not a huge problem, so I haven’t dived into fixing this.&lt;/li&gt;
&lt;li&gt;If something &lt;em&gt;else&lt;/em&gt; is blocking the main thread, two seconds can pass and the whole animation is skipped over. This was the case with my buzzer code as it played a little melody when a user interacted with the project. So I needed a way to play the melody in a non-blocking way!&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;Non-blocking melody&lt;/h2&gt;
&lt;p&gt;This was a little more tricky and the melody will have a slightly less precise rhythm. The upside however is that a user can continue to interact with the project while a melody is being played; a bonus feature for fixing the LED transition problem.&lt;/p&gt;
&lt;p&gt;Most examples for working with &lt;code class=&quot;language-text&quot;&gt;tone&lt;/code&gt; go something like this:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; tonePin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Gets called on user interaction&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// play 2kHz for 2 seconds&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;tone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tonePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// play 4kHz for 1 second&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;tone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tonePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;noTone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tonePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;But of course this will block the thread for 3 seconds - a lifetime for a process to run.&lt;/p&gt;
&lt;p&gt;My alternative solution requires a lot of code and definitely needs some refinement, but has been working for my basic needs:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; tonePin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// -1 means we haven&apos;t started the melody&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; currNoteIndex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// Timestamp when we started the last note&lt;/span&gt;
unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; noteStart &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; playing &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; melodyLength &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// Array of frequencies&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; melody&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4000&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// Array of times (beats)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; rhythm&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Gets called on user interaction&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  playing &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  currNoteIndex &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Gets called repeatedly in the main loop()&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;playing&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
 
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// If we&apos;re just starting the melody...&lt;/span&gt;
    currNoteIndex &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ... or we&apos;ve been playing the current note too long...&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; noteStart &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; rhythm&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;currNoteIndex&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...bump the note index.&lt;/span&gt;
    currNoteIndex&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// If the next note exists, play it...&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currNoteIndex &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; melodyLength&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;tone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tonePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; melody&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;currNoteIndex&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      noteStart &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; now&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...otherwise stop playing.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;noTone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tonePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      playing &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So the secret here is that &lt;code class=&quot;language-text&quot;&gt;tone&lt;/code&gt; doesn’t need the thread to run, people just tend to block the thread to keep track of how long we’ve been playing the tone. If we don’t care too much about precision we can start the tone, do other things, and check in regularly to see if we need to stop or change the tone.&lt;/p&gt;
&lt;p&gt;Obviously the code is chaotic and the way I’m managing the arrangement of notes/beats isn’t ideal, but this could all probably be cleaned up. For my own project I made the note/beat arrays pretty big and just rewrote the values when the melody needed to change.&lt;/p&gt;
&lt;p&gt;Unfortunately this created its own issue: since the button-press played a melody and the melody was blocking, the melody acted as a sort of debounce for the button. Now that the melody is non-blocking, the button-press is a little more jittery.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So the basic idea is pretty straight-forward, we have a master loop and several “services” (as feature-specific classes) that each have their own loops that run and release the thread as quickly as possible. With this paradigm we can start “multitasking” on a single thread!&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  light&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  sound&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// ...other things...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Note to Self - Nano Clone on High Sierra]]></title><description><![CDATA[I bought a couple of Arduino Nano clones and had some trouble getting them set up with my computer. Turns out Nano clones often use a…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/nts-nano-clone/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/nts-nano-clone/</guid><pubDate>Wed, 27 May 2020 01:25:23 GMT</pubDate><content:encoded>&lt;p&gt;I bought a couple of Arduino Nano clones and had some trouble getting them set up with my computer. Turns out Nano clones often use a replacement for the FT232 USB-to-serial chip called the CH340. These chips don’t have drivers on OSX High Sierra by default and the drivers provided by the clone manufacturer didn’t work for me.&lt;/p&gt;
&lt;p&gt;I eventually had to download drivers and follow the instructions from this &lt;a href=&quot;https://github.com/adrianmihalko/ch340g-ch34g-ch34x-mac-os-x-driver&quot;&gt;Github&lt;/a&gt; repo. Super sketchy and I probably have a virus now, but at least my Nano clone works.&lt;/p&gt;
&lt;p&gt;Switching from an Uno to a Nano I had to update my &lt;code class=&quot;language-text&quot;&gt;platformio.ini&lt;/code&gt; config:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;; before&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;[env:uno]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;platform&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; atmelavr&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; uno&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;framework&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; arduino&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;; after&lt;/span&gt;
&lt;span class=&quot;token selector&quot;&gt;[env:nanoatmega328new]&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;platform&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; atmelavr&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;board&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; nanoatmega328new&lt;/span&gt;
&lt;span class=&quot;token constant&quot;&gt;framework&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; arduino&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;There were some people who said to use the old bootloader, but that didn’t work for me. Anyway, wanted to save this for future me. Keep fighting the good fight future me!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Grandbot Update - Light]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/grandbot-update-light/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/grandbot-update-light/</guid><pubDate>Fri, 15 May 2020 03:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Project originally inspired by the work of &lt;a href=&quot;https://twitter.com/MohitBhoite&quot;&gt;Mohit Bhoite&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Code references the state as of &lt;a href=&quot;https://github.com/handeyeco/Grandbot/tree/2020-05-15&quot;&gt;this tag&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;The past week has been a big one for the newly named Grandbot project. I finally got to a place where I felt it was time to take a deep dive into C++ and implemented a bunch of new features while learning more about electronics and Arduino programming. Even though the hardware side of things is fairly straightforward, I’m breaking this post into several parts since the code is exponentially more complex now.&lt;/p&gt;
&lt;p&gt;I added an RGB LED to let Grandbot emote via light. Red means he’s unhappy, otherwise he generates random colors.&lt;/p&gt;
&lt;h2&gt;Adding an RGB LED&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/44af6/schematic.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 60.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwABBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB64seR2y//8QAGBABAAMBAAAAAAAAAAAAAAAAAAEREiH/2gAIAQEAAQUCd0lmLf/EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABYQAAMAAAAAAAAAAAAAAAAAAAAgQf/aAAgBAQAGPwIq/wD/xAAbEAACAgMBAAAAAAAAAAAAAAAAAREhEDFxkf/aAAgBAQABPyFvo4UfkTmxJ2OzGP/aAAwDAQACAAMAAAAQzy//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAbEAEBAQEAAwEAAAAAAAAAAAABEQAhMUFRsf/aAAgBAQABPxBkIFH0DcFeQKjZ+80fCX6TAAFzBTl5WZ4oHDf/2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of the build&quot;
        title=&quot;Schematic of the build&quot;
        src=&quot;/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/1c72d/schematic.jpg&quot;
        srcset=&quot;/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/a80bd/schematic.jpg 148w,
/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/1c91a/schematic.jpg 295w,
/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/1c72d/schematic.jpg 590w,
/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/a8a14/schematic.jpg 885w,
/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/fbd2c/schematic.jpg 1180w,
/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/44af6/schematic.jpg 2110w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;Schematic of the build&lt;/figcaption&gt;
&lt;h3&gt;Components&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Common cathode RGB LED&lt;/li&gt;
&lt;li&gt;3x 220 Ohm resistors&lt;/li&gt;
&lt;li&gt;Arduino Uno&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Component notes&lt;/h4&gt;
&lt;p&gt;An RGB LED is really just three LEDs in one container with a shared cathode. So just like with a regular LEDs, we need current-limiting resistors that will depend on your specific LED. In my case I used 220 Ohm resistors, but you should look into what your LED needs.&lt;/p&gt;
&lt;h3&gt;Code&lt;/h3&gt;
&lt;p&gt;This is just the general idea, not the complete code. There’s a link above to the full codebase.&lt;/p&gt;
&lt;p&gt;We pass the pins for the different colors to the Grandbot constructor and the constructor initializes an instance of the Light class. Whenever Grandbot updates the expression, he updates the light.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// main.cpp&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Needs PWM pins&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; redPin 5&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; greenPin 6&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; bluePin 9&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// ...set other pins...&lt;/span&gt;

Grandbot gb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Grandbot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; loadPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; voicePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Grandbot.cpp&lt;/span&gt;

Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Grandbot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; loadPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; voicePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;lc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;LedControl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; loadPin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;voice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Voice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;voicePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;light&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Light&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...initializing stuff...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  expression &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Expressions&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;writeExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  light&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The Light class is pretty basic right now:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Light.h&lt;/span&gt;

class &lt;span class=&quot;token class-name&quot;&gt;Light&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  private&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Keeps track of the LED pins&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; red&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; green&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; blue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; rValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; gValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; bValue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  public&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;Light&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Light.cpp&lt;/span&gt;

Light&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Light&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  red &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; redPin&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  green &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  blue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Constructor sets the pins as outputs&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;red&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;green&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;blue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Light&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; rValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; gValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; bValue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Use analog write (PWM)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// so we don&apos;t just have HIGH and LOW values&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;analogWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;red&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rValue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;analogWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;green&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; gValue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;analogWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;blue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bValue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Light&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; g &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; b &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Off when sleeping&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// (another reason to boot into sleep mode)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Random blue-ish when happy&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; g&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Random color when neutral&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; g&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Pure red when unhappy&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;255&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Code notes&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;It’s probably the most basic of the new features.&lt;/li&gt;
&lt;li&gt;Just like Voice, we use a switch based of the current &lt;code class=&quot;language-text&quot;&gt;mood&lt;/code&gt; (stored as an int) to make color selections.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I would like to do more with this feature. The main improvement I’d like in this department is to add a transition - which would require keeping track of current state and future state, transitioning between the two with some sort of &lt;code class=&quot;language-text&quot;&gt;void transition()&lt;/code&gt; function that can be called continuously in Grandbot’s &lt;code class=&quot;language-text&quot;&gt;update&lt;/code&gt; method.&lt;/p&gt;
&lt;p&gt;I would also like to have a more specific color palette. For instance I’d like to be able to pick a magenta-ish color. Right now the randomness usually results in green-ish and blue-ish colors.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Grandbot: Play]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/grandbot-update-play/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/grandbot-update-play/</guid><pubDate>Fri, 15 May 2020 02:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Project originally inspired by the work of &lt;a href=&quot;https://twitter.com/MohitBhoite&quot;&gt;Mohit Bhoite&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Code references the state as of &lt;a href=&quot;https://github.com/handeyeco/Grandbot/tree/2020-05-15&quot;&gt;this tag&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;The past week has been a big one for the newly named Grandbot project. I finally got to a place where I felt it was time to take a deep dive into C++ and implemented a bunch of new features while learning more about electronics and Arduino programming. Even though the hardware side of things is fairly straightforward, I’m breaking this post into several parts since the code is exponentially more complex now.&lt;/p&gt;
&lt;p&gt;As I mentioned in the last two posts, Grandbot now has “moods” that affect his sounds, expressions, and lights. So how is a mood set? By playing with him of course! Right now the only way to interact with him is with a push button, but hopefully in the future he’ll be more interactive.&lt;/p&gt;
&lt;h2&gt;Adding a button&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/3dd729ae92ad38af6b9fbd4ae2b2a157/6951b/schematic.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAIBAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAdet1zYED//EABgQAAIDAAAAAAAAAAAAAAAAAAABEDFB/9oACAEBAAEFAh3Gn//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABcQAAMBAAAAAAAAAAAAAAAAAAARIDH/2gAIAQEABj8C0U//xAAbEAEAAgIDAAAAAAAAAAAAAAABABEQITFBYf/aAAgBAQABPyGm+cSVLs8hdbZ3l//aAAwDAQACAAMAAAAQCO//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAcEAEAAgIDAQAAAAAAAAAAAAABABExQSFRcZH/2gAIAQEAAT8QovYOqOIWSsTbJ3Hkb6Q4+RwjlNvs/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of the build&quot;
        title=&quot;Schematic of the build&quot;
        src=&quot;/tech-blog/static/3dd729ae92ad38af6b9fbd4ae2b2a157/1c72d/schematic.jpg&quot;
        srcset=&quot;/tech-blog/static/3dd729ae92ad38af6b9fbd4ae2b2a157/a80bd/schematic.jpg 148w,
/tech-blog/static/3dd729ae92ad38af6b9fbd4ae2b2a157/1c91a/schematic.jpg 295w,
/tech-blog/static/3dd729ae92ad38af6b9fbd4ae2b2a157/1c72d/schematic.jpg 590w,
/tech-blog/static/3dd729ae92ad38af6b9fbd4ae2b2a157/a8a14/schematic.jpg 885w,
/tech-blog/static/3dd729ae92ad38af6b9fbd4ae2b2a157/fbd2c/schematic.jpg 1180w,
/tech-blog/static/3dd729ae92ad38af6b9fbd4ae2b2a157/6951b/schematic.jpg 1950w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;Schematic of the build&lt;/figcaption&gt;
&lt;h3&gt;Components&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Push button&lt;/li&gt;
&lt;li&gt;10k Ohm resistor&lt;/li&gt;
&lt;li&gt;Arduino Uno&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Component notes&lt;/h4&gt;
&lt;p&gt;There’s not much to this one. As far as I understand it, the resistor is a pull-down resistor to prevent the pin from floating when the button is not pressed.&lt;/p&gt;
&lt;h3&gt;Code&lt;/h3&gt;
&lt;p&gt;The code is pretty rough right now, but hopefully the idea is there. I’m not going to show everything, just the button-related stuff.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// main.cpp&lt;/span&gt;

&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; playPin 2&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// ...set other pins...&lt;/span&gt;

Grandbot gb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Grandbot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; loadPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; voicePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Used to track the transition&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// between on and off&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; lastPlayState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;playPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;INPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Get current state of button&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; playing &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;digitalRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;playPin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Do different things if button state changed&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;playing &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; lastPlayState &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    gb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    lastPlayState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;lastPlayState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;playing &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; lastPlayState &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    lastPlayState &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;lastPlayState&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;As I mentioned a previous post, Grandbot’s &lt;code class=&quot;language-text&quot;&gt;esteem&lt;/code&gt; is based on how often he’s played with, his &lt;code class=&quot;language-text&quot;&gt;mood&lt;/code&gt; is based off his &lt;code class=&quot;language-text&quot;&gt;esteem&lt;/code&gt;, and everything else is based on his &lt;code class=&quot;language-text&quot;&gt;mood&lt;/code&gt;.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Grandbot.cpp&lt;/span&gt;

class &lt;span class=&quot;token class-name&quot;&gt;Grandbot&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    private&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// -1 = uninitialized&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//  0 = sleeping&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//  1 = happy&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//  2 = neutral&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//  3 = unhappy&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; mood &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// between 0 (unhappiest) and 9 (happiest)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; esteem &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateEsteem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;updateMood&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; lastPlayTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    public&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; light&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We want to encourage regular interactions throughout the day, rather than just playing a bunch all at once. So we only bump &lt;code class=&quot;language-text&quot;&gt;esteem&lt;/code&gt; once for every hour of play (3,600,00ms).&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Grandbot.cpp&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; thresh &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; lastPlayTime &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3600000LL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// If last play was at least an hour ago,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// bump esteem&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;now &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; thresh&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    lastPlayTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; now&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Max esteem is 9&lt;/span&gt;
    esteem &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; esteem &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;updateMood&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  voice&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;emote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;updateMood&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; last &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mood&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;esteem &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;esteem &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  mood &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;setExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;last &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Known bug, double emote&lt;/span&gt;
    voice&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;emote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That’s the code to make him happier. The code to make him sadder (from being ignored):&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Grandbot.cpp&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Gets called every loop in main.cpp&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; light&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// ...sleep related stuff...&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;// If he&apos;s not sleeping or initializing&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;now &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; nextExpressionChange&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;updateEsteem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;setExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      nextExpressionChange &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getNextExpressionChange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// ...blinking related stuff...&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// ...more sleep related stuff...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;updateEsteem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  unsigned &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; thresh &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; lastPlayTime &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;21600000LL&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// If he hasn&apos;t been played with in the last 6 hours&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;now &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; thresh&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Need to update this&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// or he&apos;ll quickly go from 9 to 0&lt;/span&gt;
    lastPlayTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; now&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Minimum esteem is 0&lt;/span&gt;
    esteem &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; esteem &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;updateMood&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;So if you play with him once an hour, his esteem will go up by 1 to a max of 9. If you ignore him for six hours, his esteem will go down by 1 to a min of 0. These values need to be stored somewhere else so they’re easy to change.&lt;/p&gt;
&lt;p&gt;The bug I ran into was that he kept waking up unhappy. I intentionally skipped updating esteem while he was sleeping, but as soon as he woke up &lt;code class=&quot;language-text&quot;&gt;lastPlayTime&lt;/code&gt; was greater than 6 hours ago. So when he wakes up:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;wakeup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// So he doesn&apos;t wake up angry&lt;/span&gt;
  lastPlayTime &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// ...wakeup stuff...&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;It’s not a perfect solution, but it works well enough for me.&lt;/p&gt;
&lt;h4&gt;Code notes&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;The code really needs refactoring. Even though it works as I would hope, it’s a little hard to follow and uses some “magic numbers.”&lt;/li&gt;
&lt;li&gt;There’s a known bug where if you play with Grandbot and he changes moods, he’ll emote twice. Not the worst thing in the world.&lt;/li&gt;
&lt;li&gt;Trying to find the right balance for threshold times is an art not yet mastered. I think six hours is too long, so I’ll probably lower that and tweak the esteem-to-mood numbers.&lt;/li&gt;
&lt;li&gt;I only update esteem when updating expressions (&lt;code class=&quot;language-text&quot;&gt;nextExpressionChange&lt;/code&gt;) because the timing isn’t that important and I don’t want to run it every loop. It’s placing is a little confusing, so I may make a new variable like &lt;code class=&quot;language-text&quot;&gt;nextEsteemUpdate&lt;/code&gt; or rename &lt;code class=&quot;language-text&quot;&gt;nextExpressionChange&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;I’d like to add more interaction that contributes to his mood. Sensing movement, reacting to date/time, and maybe even making mini-games to play with people. For now though, this is a good start on giving Grandbot his own identity. More and more he’s controlling his own feelings and I’m just trying to keep up!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Grandbot: Voice]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/grandbot-update-voice/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/grandbot-update-voice/</guid><pubDate>Fri, 15 May 2020 01:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Project originally inspired by the work of &lt;a href=&quot;https://twitter.com/MohitBhoite&quot;&gt;Mohit Bhoite&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Code references the state as of &lt;a href=&quot;https://github.com/handeyeco/Grandbot/tree/2020-05-15&quot;&gt;this tag&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;The past week has been a big one for the newly named Grandbot project. I finally got to a place where I felt it was time to take a deep dive into C++ and implemented a bunch of new features while learning more about electronics and Arduino programming. Even though the hardware side of things is fairly straightforward, I’m breaking this post into several parts since the code is exponentially more complex now.&lt;/p&gt;
&lt;p&gt;This post is about using a passive buzzer to let Grandbot sing randomly generated melodies.&lt;/p&gt;
&lt;h2&gt;Adding a buzzer&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/ed9ed32c3a0583776b3f7c48032eae34/c8451/schematic.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAJABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAECAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAdSDM1lYf//EABgQAQADAQAAAAAAAAAAAAAAAAEAEBEh/9oACAEBAAEFAuzVdtn/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAWEAADAAAAAAAAAAAAAAAAAAAAIFH/2gAIAQEABj8CIv8A/8QAGxAAAgMAAwAAAAAAAAAAAAAAABEBMUFRYXH/2gAIAQEAAT8hfKF4JbTobScJssf/2gAMAwEAAgADAAAAEPsv/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAAMBAAMAAAAAAAAAAAAAAQAhMRFRYXH/2gAIAQEAAT8Qeg7sVDobD6P25ypi+SiYjGaz/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of the build&quot;
        title=&quot;Schematic of the build&quot;
        src=&quot;/tech-blog/static/ed9ed32c3a0583776b3f7c48032eae34/1c72d/schematic.jpg&quot;
        srcset=&quot;/tech-blog/static/ed9ed32c3a0583776b3f7c48032eae34/a80bd/schematic.jpg 148w,
/tech-blog/static/ed9ed32c3a0583776b3f7c48032eae34/1c91a/schematic.jpg 295w,
/tech-blog/static/ed9ed32c3a0583776b3f7c48032eae34/1c72d/schematic.jpg 590w,
/tech-blog/static/ed9ed32c3a0583776b3f7c48032eae34/a8a14/schematic.jpg 885w,
/tech-blog/static/ed9ed32c3a0583776b3f7c48032eae34/fbd2c/schematic.jpg 1180w,
/tech-blog/static/ed9ed32c3a0583776b3f7c48032eae34/c8451/schematic.jpg 1974w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;Schematic of the build&lt;/figcaption&gt;
&lt;h3&gt;Components&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Passive buzzer&lt;/li&gt;
&lt;li&gt;220 Ohm resistor&lt;/li&gt;
&lt;li&gt;Arduino Uno&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Component notes&lt;/h4&gt;
&lt;p&gt;I’m using a passive buzzer that came with a kit, but I can’t find any part number for it. The datasheet says it’s capable of handling 3-12V and its resistance is “16R” (16 Ohms?)&lt;/p&gt;
&lt;p&gt;From this thread &lt;a href=&quot;https://forum.arduino.cc/index.php?topic=16262.0&quot;&gt;this thread&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;According to the buzzer documentation, the ‘coil resistance’ is 42R +- (plus or minus) 6.3&lt;/p&gt;
&lt;p&gt;ohms law: voltage = current * resistance&lt;/p&gt;
&lt;p&gt;Other turn-arounds of this formula:&lt;/p&gt;
&lt;p&gt;resistance = voltage / current&lt;/p&gt;
&lt;p&gt;current = voltage / resistance (we’re using this one)&lt;/p&gt;
&lt;p&gt;Arduino voltage is 5 volts from USB (correct? does this change with plug up to 12v?)&lt;/p&gt;
&lt;p&gt;5 volts / 42R = .119A, or 119mA: That’s 79mA too much current.&lt;/p&gt;
&lt;p&gt;To fix:&lt;/p&gt;
&lt;p&gt;100R resistor + 42R buzzer = 142R&lt;/p&gt;
&lt;p&gt;5v / 142R = .0352Am, or 35.2mA: That’s less than the 40mA of the Arduino AVR: Success!&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;So for me &lt;code class=&quot;language-text&quot;&gt;5V / 16R = .312A&lt;/code&gt;. 312mA &gt; 40mA, so I need to limit the current. I added 220 Ohms: &lt;code class=&quot;language-text&quot;&gt;5V / (16R + 220) = .021A&lt;/code&gt;. 21mA &amp;#x3C; 40mA, so we’re good to go! I could have used less resistance, but I’m fine with the buzzer being a little quieter.&lt;/p&gt;
&lt;h3&gt;Code&lt;/h3&gt;
&lt;p&gt;This is just the general idea, not the complete code. There’s a link above to the full codebase.&lt;/p&gt;
&lt;p&gt;The code uses an array of pitches and the Tone library to create little melodies based on Grandbot’s mood. I want to improve the different mood sounds, but right now he plays the same two low frequencies when unhappy, a random note when in a neutral mood, a series of random notes when happy, and a random Major 7th chord when going to sleep.&lt;/p&gt;
&lt;p&gt;It’s all pretty straightforward, the only tricky part was getting true randomness. Arduino’s &lt;code class=&quot;language-text&quot;&gt;random&lt;/code&gt; function is a pseudorandom number generator, so Grandbot kept playing the same tunes. The solution was to use a floating analog pin as a seed.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// main.cpp&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Pin connected to buzzer&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// (needs to be a PWM pin)&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; voicePin 3&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Leave unconnected&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; randomPin A5&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// ...set other pins...&lt;/span&gt;

Grandbot gb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Grandbot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; loadPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; voicePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;randomSeed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;analogRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;randomPin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we have a &lt;code class=&quot;language-text&quot;&gt;Voice&lt;/code&gt; class:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Voice.h&lt;/span&gt;

class &lt;span class=&quot;token class-name&quot;&gt;Voice&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  private&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; m_voicePin&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    static const &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; pitches&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;playMajor7th&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;playRandomSequence&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;playRandomNote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; note&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; note&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  public&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;Voice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; voicePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;feedback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;emote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;This has some helper functions for using Tone:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Voice.cpp&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Voice&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; note&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;note&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;75&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Voice&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; note&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;tone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m_voicePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; note&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;noTone&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;m_voicePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;An array of pitches:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Voice.cpp&lt;/span&gt;

const &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; Voice&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;pitches&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;28&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; 
  &lt;span class=&quot;token number&quot;&gt;1047&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
  &lt;span class=&quot;token number&quot;&gt;1109&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
  &lt;span class=&quot;token number&quot;&gt;1175&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...etc...&lt;/span&gt;
  &lt;span class=&quot;token number&quot;&gt;4435&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
  &lt;span class=&quot;token number&quot;&gt;4699&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; 
  &lt;span class=&quot;token number&quot;&gt;4978&lt;/span&gt; 
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Some internal sound making fun:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Voice.cpp&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Voice&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;playMajor7th&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; duration &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;250&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Pick the chord&apos;s starting note&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Step through the Major 7th intervals&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pitches&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pitches&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;start&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pitches&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;start&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pitches&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;start&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; duration&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Voice&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;playRandomSequence&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; len &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;playRandomNote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Voice&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;playRandomNote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; rand &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;28&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; note &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Voice&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;pitches&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;rand&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;note&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;I’ve since found a better way to get a random entry from an array in C++ (by first determining array length), but this has been working for now.&lt;/p&gt;
&lt;p&gt;Last in this file are two public methods:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Voice.cpp&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Chirp when we want feedback&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// (not currently in use)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Voice&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;feedback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;playRandomNote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Play a melody based on mood (stored as an int)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Voice&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;emote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Sleeping&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;playMajor7th&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Happy&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;playRandomSequence&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Neutral&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;playRandomNote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Unhappy&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Grandbot stores an instance of Voice and calls it from time-to-time.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Grandbot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; loadPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; voicePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;lc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;LedControl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; loadPin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;voice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Voice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;voicePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;light&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Light&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// Initializing stuff&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;updateMood&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; last &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; mood&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// ...determine next mood...&lt;/span&gt;

  mood &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;last &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; next&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    voice&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;emote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...sleep stuff...&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// So we don&apos;t play a sound&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// if we reset at night&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lastMood &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    voice&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;emote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;play&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// ...playful stuff...&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;updateMood&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  voice&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;emote&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Code notes&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;I should probably have a separate Pitch file.&lt;/li&gt;
&lt;li&gt;Randomly selecting things should be done by determining the array length, rather than using a hard-coded value.&lt;/li&gt;
&lt;li&gt;I’d like to add more functions for specific chords and then auto-generate small chord progressions. I also think this is a good foundation for a game to play with Grandbot (like Simon).&lt;/li&gt;
&lt;li&gt;The instance of Voice created in the Grandbot constructor is made with an initializer list. The compiler threw an error because I didn’t have a default constructor for Voice, so I just initialized it in the initializer list. I’m not sure if there was something else I should have done.&lt;/li&gt;
&lt;li&gt;I’m considering creating the class instances outside of Grandbot and handing them to Grandbot’s constructor rather than creating them in the constructor. The downside is I wouldn’t be able to run to Grandbots on one Arduino that way. 🤷‍♀️&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Really love his random sequences. The Major 7th chord is pretty, but the random sequence makes it seem like he’s trying to communicate. I do want to make the neutral response better though, it’s a little boring right now.&lt;/p&gt;
&lt;p&gt;Another problem is that using &lt;code class=&quot;language-text&quot;&gt;delay&lt;/code&gt; for note length blocks the thread. For instance the sleep melody is 4 notes at 250ms; that means nothing else can happen for the 1 second it’s playing that tune. Not sure if there’s a pay to pass this functionality to an external IC like I did with multiplexing the 4D7S display.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Grandbot: Sleep]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/grandbot-update-sleep/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/grandbot-update-sleep/</guid><pubDate>Fri, 15 May 2020 00:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Project originally inspired by the work of &lt;a href=&quot;https://twitter.com/MohitBhoite&quot;&gt;Mohit Bhoite&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Code references the state as of &lt;a href=&quot;https://github.com/handeyeco/Grandbot/tree/2020-05-15&quot;&gt;this tag&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;hr&gt;
&lt;p&gt;The past week has been a big one for the newly named Grandbot project. I finally got to a place where I felt it was time to take a deep dive into C++ and implemented a bunch of new features while learning more about electronics and Arduino programming. Even though the hardware side of things is fairly straightforward, I’m breaking this post into several parts since the code is exponentially more complex now.&lt;/p&gt;
&lt;p&gt;This post is about putting Grandbot to sleep when it gets dark.&lt;/p&gt;
&lt;h2&gt;Adding a photoresistor&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/1332512bf33072f49df30ccd80ee79e7/e018a/schematic.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 59.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAgADBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB6uKOa4R//8QAGBABAQEBAQAAAAAAAAAAAAAAAREAECH/2gAIAQEAAQUCrqmG6+PP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAACBBIv/aAAgBAQAGPwKGiJ//xAAcEAACAgIDAAAAAAAAAAAAAAAAAREhMVFhcZH/2gAIAQEAAT8h4fQ78LxdD0ltuiQtD0Ns/9oADAMBAAIAAwAAABA4L//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EAB4QAQACAQQDAAAAAAAAAAAAAAEAESExQVGBYaHR/9oACAEBAAE/EBBsDbL5FlCnBxV15jXJKEte5yIm0t2ruKdZ/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of the build&quot;
        title=&quot;Schematic of the build&quot;
        src=&quot;/tech-blog/static/1332512bf33072f49df30ccd80ee79e7/1c72d/schematic.jpg&quot;
        srcset=&quot;/tech-blog/static/1332512bf33072f49df30ccd80ee79e7/a80bd/schematic.jpg 148w,
/tech-blog/static/1332512bf33072f49df30ccd80ee79e7/1c91a/schematic.jpg 295w,
/tech-blog/static/1332512bf33072f49df30ccd80ee79e7/1c72d/schematic.jpg 590w,
/tech-blog/static/1332512bf33072f49df30ccd80ee79e7/a8a14/schematic.jpg 885w,
/tech-blog/static/1332512bf33072f49df30ccd80ee79e7/fbd2c/schematic.jpg 1180w,
/tech-blog/static/1332512bf33072f49df30ccd80ee79e7/e018a/schematic.jpg 1876w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;Schematic of the build&lt;/figcaption&gt;
&lt;h3&gt;Components&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Photoresistor (I used an LXD5537; dark 20M Ohm, light 18-50k Ohm)&lt;/li&gt;
&lt;li&gt;10k Ohm resistor&lt;/li&gt;
&lt;li&gt;Arduino Uno&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Component notes&lt;/h4&gt;
&lt;p&gt;For reading different values (rather than just &lt;code class=&quot;language-text&quot;&gt;HIGH&lt;/code&gt;/&lt;code class=&quot;language-text&quot;&gt;LOW&lt;/code&gt;), we have to use an analog input on the Arduino.&lt;/p&gt;
&lt;p&gt;The resistor is a pull down resistor. I chose 10k Ohm according to &lt;a href=&quot;https://learn.adafruit.com/photocells/using-a-photocell&quot;&gt;this guide&lt;/a&gt; because I’m more concerned with darker values. From that page:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;If you’re planning to have the sensor in a bright area and use a 10KΩ pulldown, it will quickly saturate. That means that it will hit the ‘ceiling’ of 5V and not be able to differentiate between kinda bright and really bright. In that case, you should replace the 10KΩ pulldown with a 1KΩ pulldown. In that case, it will not be able to detect dark level differences as well but it will be able to detect bright light differences better. This is a tradeoff that you will have to decide upon&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://forum.arduino.cc/index.php?topic=18241.0&quot;&gt;This page&lt;/a&gt; was also a helpful resource. From it:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The analogue input is high impedance that means when you connect it to the +5 and the input virtually no current flows. If there is no current flowing through a resistor then there is no voltage drop across it, and so it always reads high.&lt;/p&gt;
&lt;p&gt;The pull down resistor makes current flow through the photo resistor and so different light levels result in different currents and hence different voltages (ohms law) which the analogue input can measure.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3&gt;Code&lt;/h3&gt;
&lt;p&gt;The code is still being refined, but the basic idea is that when we’re below a “sleep threshold” we should go to sleep and when we’re above a “wake threshold” we should wake. It’s important that these two thresholds are different. Initially I used a single threshold and when it reached that reading, slight fluctuations in light caused it to continuously switch between on and off. Keeping the two thresholds far away enough from each other allowed the switch to happen without immediately flapping back and forth.&lt;/p&gt;
&lt;p&gt;The code grew quite a bit, which is why I linked to the full code above. I’m just going to show the general concept.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// main.cpp&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Use the Analog 0 pin&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; lightPin A0&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// ...set other pins...&lt;/span&gt;

Grandbot gb &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Grandbot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; loadPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; voicePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; light &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;analogRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lightPin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Pass the light reading to Grandbot&apos;s update method&lt;/span&gt;
  gb&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;light&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Grandbot.h&lt;/span&gt;

class &lt;span class=&quot;token class-name&quot;&gt;Grandbot&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    private&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wakeup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// -1 = uninitialized&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//  0 = sleeping&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//  1 = happy&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//  2 = neutral&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;//  3 = unhappy&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; mood &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token comment&quot;&gt;// These thresholds need to be different&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// to prevent flapping between on/off&lt;/span&gt;
        static const &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; wakeThreshold &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        static const &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; sleepThreshold &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    public&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;Grandbot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; loadPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; voicePin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; redPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; greenPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; bluePin&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; light&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Grandbot.cpp&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;update&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; light&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; awake &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; light &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;wakeThreshold&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; asleep &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; light &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;sleepThreshold&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// If mood == sleep and light &gt; wakeThresh: wakeup.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;awake&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;wakeup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;// If mood != sleep or uninitialized...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;mood &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...and light &amp;lt; sleepThresh: go to sleep.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;asleep&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// ...do other stuff here...&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;// Otherwise we&apos;re uninitialized,&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// so we start in sleep mode.&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Dim the 4D7S display&lt;/span&gt;
  lc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setIntensity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Set mood to sleep&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// and update expression&lt;/span&gt;
  mood &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;setExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; Grandbot&lt;span class=&quot;token operator&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;wakeup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Kickstart blinking&lt;/span&gt;
  nextBlink &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getNextBlink&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  blinkLength &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getBlinkLength&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Brighten 4D7S display&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// and update expression&lt;/span&gt;
  lc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setIntensity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;14&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;updateMood&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Code notes&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;We keep track of state in the &lt;code class=&quot;language-text&quot;&gt;mood&lt;/code&gt; variable. The facial expressions, RGB LED colors, and sounds are all derived from &lt;code class=&quot;language-text&quot;&gt;mood&lt;/code&gt; and mood is mostly derived from &lt;code class=&quot;language-text&quot;&gt;esteem&lt;/code&gt; (not shown here; it’s based on how often Grandbot is played with). The exceptions are two states: &lt;code class=&quot;language-text&quot;&gt;uninitialized&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;sleeping&lt;/code&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;uninitialized&lt;/code&gt; (-1) is set when booting so I can have special behavior on initial loading.&lt;/li&gt;
&lt;li&gt;As you see here, &lt;code class=&quot;language-text&quot;&gt;sleep&lt;/code&gt; (0) is based on light input.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Grandbot wakes up if it’s been asleep and if light input is above the &lt;code class=&quot;language-text&quot;&gt;wakeThreshold&lt;/code&gt;. Waking up starts blinking behavior, turns up the brightness of the display, and updates &lt;code class=&quot;language-text&quot;&gt;mood&lt;/code&gt; (based on esteem). I didn’t show this, but it also updates &lt;code class=&quot;language-text&quot;&gt;lastPlayTime&lt;/code&gt; so it doesn’t wake up unhappy.&lt;/li&gt;
&lt;li&gt;Grandbot goes to sleep if it’s uninitialized or if it’s in a normal mood and the light reading is below the &lt;code class=&quot;language-text&quot;&gt;sleepThreshold&lt;/code&gt;. Sleep dims the 4D7S display and sets a sleep expression. I didn’t show this, but it also plays sleepy music if it’s going to sleep from a normal mood (not when it’s being initialized).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Hopefully this gets the idea across, but the link to the current state of the code is above. It might clear things up, but it’ll probably just make any sane developer sad.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;It’s really cute to see Grandbot go to sleep! As I’ll write about in other posts, it plays a little tune when going to bed: a random, arpeggiated, Major 7th chord.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Max7219 Emoji]]></title><description><![CDATA[Blinking expression on display Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/max7219-emoji/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/max7219-emoji/</guid><pubDate>Mon, 04 May 2020 21:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;img src=&quot;/tech-blog/d8b6a3d50c3450c853be0c122beb3950/blinking.gif&quot; alt=&quot;Blinking expression on display&quot;&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Project originally inspired by the work of &lt;a href=&quot;https://twitter.com/MohitBhoite&quot;&gt;Mohit Bhoite&lt;/a&gt;.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;In my last &lt;a href=&quot;https://handeyeco.github.io/tech-blog/seven-segment-emoji/&quot;&gt;post&lt;/a&gt; on 4-digit, 7-segment displays, I realized I would need help multiplexing if I wanted to free up the Arduino to do more complex things (like using sensors and changing expressions). In the end I decided to use the Max7219 display driver and the LedControl Arduino library.&lt;/p&gt;
&lt;p&gt;The Max7219 is a chip specifically designed to control LED matrices. It replaces the shift register, transistor driver circuits, and limiting resistors I used in the last 4D7S build. It also handles multiplexing so the Arduino doesn’t have to. Arduino has a great &lt;a href=&quot;https://playground.arduino.cc/Main/MAX72XXHardware/&quot;&gt;resource on using the Max7219&lt;/a&gt;; I’d recommend starting there if you’re interested in using the Max7219.&lt;/p&gt;
&lt;h2&gt;The Build&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/2d5050061315212f5f38a230af4ea573/0c969/schematic.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 76.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAgP/xAAVAQEBAAAAAAAAAAAAAAAAAAABAP/aAAwDAQACEAMQAAABeqvAsGAX/8QAGRAAAgMBAAAAAAAAAAAAAAAAABEBAhAS/9oACAEBAAEFAuybMY8Z/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGRAAAwEBAQAAAAAAAAAAAAAAAAERITFB/9oACAEBAAE/IXGI6KLHo62sTwUn/9oADAMBAAIAAwAAABCQ7//EABURAQEAAAAAAAAAAAAAAAAAAAEQ/9oACAEDAQE/ECf/xAAWEQEBAQAAAAAAAAAAAAAAAAABABH/2gAIAQIBAT8QW1v/xAAbEAEAAwEAAwAAAAAAAAAAAAABABExIUFRcf/aAAgBAQABPxBEaNUk1EfH1C8tS0YMqI98eyhWz//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of the build&quot;
        title=&quot;Schematic of the build&quot;
        src=&quot;/tech-blog/static/2d5050061315212f5f38a230af4ea573/1c72d/schematic.jpg&quot;
        srcset=&quot;/tech-blog/static/2d5050061315212f5f38a230af4ea573/a80bd/schematic.jpg 148w,
/tech-blog/static/2d5050061315212f5f38a230af4ea573/1c91a/schematic.jpg 295w,
/tech-blog/static/2d5050061315212f5f38a230af4ea573/1c72d/schematic.jpg 590w,
/tech-blog/static/2d5050061315212f5f38a230af4ea573/a8a14/schematic.jpg 885w,
/tech-blog/static/2d5050061315212f5f38a230af4ea573/fbd2c/schematic.jpg 1180w,
/tech-blog/static/2d5050061315212f5f38a230af4ea573/0c969/schematic.jpg 2411w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;Schematic of the build&lt;/figcaption&gt;
&lt;h3&gt;Components&lt;/h3&gt;
&lt;p&gt;I believe you could use any common cathode display, but be sure to check the display’s datasheet for forward voltage and DC forward current. Use those two values in the chart in the Max7219 datasheet to get the appropriate value for R1.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Arduino Uno R3&lt;/li&gt;
&lt;li&gt;TDCG1060M common cathode 4-digit, 7-segment (4D7S) display&lt;/li&gt;
&lt;li&gt;Max7219&lt;/li&gt;
&lt;li&gt;10uF electrolytic capacitor (C1)&lt;/li&gt;
&lt;li&gt;0.1uF ceramic capacitor (C2)&lt;/li&gt;
&lt;li&gt;22k ohm resistor (R1)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Component notes&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Max7219&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;As mentioned above, it’s a chip that’s specifically designed to drive a bunch of LEDs (up to 64 per chip).&lt;/li&gt;
&lt;li&gt;I believe Dout (pin 24) is used to chain several Max7219s together. Wasn’t needed in this case.&lt;/li&gt;
&lt;li&gt;I only used the first four digit pins. With all eight, you’d be able to control two 4D7S displays.&lt;/li&gt;
&lt;li&gt;Both grounds need to be connected.&lt;/li&gt;
&lt;li&gt;Just like the 74HC595, we’re using serial communication with the Load (12), Clock (13), and Din (1) pins. Doesn’t matter which Arduino pins you connect them to as long as you update the code.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;The capacitors are required by the Max7219 datasheet. They clean power-supply ripple…though I’m not 100% sure what that means.&lt;/li&gt;
&lt;li&gt;My understanding of the ISET resistor is that it limits the current going out to the LEDs. As mentioned above, the value depends on the 4D7S display being used.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Code&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;LedControl.h&quot;&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Arduino Pins&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; dataPin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; clockPin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; loadPin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;/* 
 * Initialize the LedControl object
 * it will set the pin directions for us
 * and provide us with controls for the Max7219
 */&lt;/span&gt;
LedControl lc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;LedControl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; loadPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Gives us a future timestamp&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// between 2 and 10 seconds in the future&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getNextBlink&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Random blink length between 100 and 300 ms&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getBlinkLength&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;random&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;300&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// State&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; nextBlink &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getNextBlink&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; blinkLength &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getBlinkLength&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;boolean&lt;/span&gt; isBlinking &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Expressions:&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;// 1 byte/digit describing segment data&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  B00000000&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  B11011101&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  B01011101&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  B00000000
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; blinking&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  B00000000&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  B10001000&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  B00001000&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  B00000000
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;writeExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; expr&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// For each digit in the display...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...send that digit&apos;s segment data&lt;/span&gt;
    lc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setRow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expr&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/*
   The MAX72XX is in power-saving mode on startup,
   we have to do a wakeup call
   */&lt;/span&gt;
  lc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;shutdown&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* Set the brightness to high */&lt;/span&gt;
  lc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setIntensity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;14&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* Only scan the first 4 digits */&lt;/span&gt;
  lc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setScanLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;/* Clear the display */&lt;/span&gt;
  lc&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;clearDisplay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;/* 
   * If not blinking, but should be
   * start blink
   */&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;isBlinking &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; nextBlink&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    isBlinking &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;writeExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;blinking&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;/*
   * If blinking, but we passed the blink length
   * end blink and set next blink times
   */&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;isBlinking &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; nextBlink &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; blinkLength&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    isBlinking &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;writeExpression&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;forward&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    nextBlink &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getNextBlink&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    blinkLength &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getBlinkLength&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Code notes&lt;/h4&gt;
&lt;p&gt;I used the &lt;a href=&quot;https://github.com/wayoda/LedControl&quot;&gt;LedControl library&lt;/a&gt;. I actually started writing my own code for the Max7219 since I wasn’t using a lot of the features in the LedControl lib, but eventually I realized I had rewritten almost every function provided by that lib. I learned a lot in the process but ultimately decided not to reinvent the wheel.&lt;/p&gt;
&lt;p&gt;Most of the code is initializing the Max7219 and creating helper functions for improved readability. The basic idea is simple:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- Create a future timestamp to determine when to blink
- Create a random blink length
- When we pass the timestamp, start blinking
- When we pass the timestamp + blink length, stop blinking
- Repeat&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;We want to keep track of whether we’re blinking or not so we only send data to the Max7219 when we need to.&lt;/p&gt;
&lt;p&gt;The only other weird part is the expressions. In my last 4D7S post, I talked about using 8 bits (a byte) to represent the state of each LED in a digit (7 segments + the decimal point). Since we have four digits, we use four bytes per expression. So:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; forward&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  B00000000&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// blank&lt;/span&gt;
  B11011101&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// small circle w/ eyebrow (decimal point)&lt;/span&gt;
  B01011101&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// small circle w/ eyebrow (no decimal point)&lt;/span&gt;
  B00000000  &lt;span class=&quot;token comment&quot;&gt;// blank &lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The difference from the last 4D7S post is that the Max7219 expects the decimal point first rather than last:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;B 0 0 0 0 0 0 0 0
 DP A B C D E F G&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Then we just iterate over the expression, setting each digit to each byte in order. This is done in &lt;code class=&quot;language-text&quot;&gt;writeExpression&lt;/code&gt; using the LedControl &lt;code class=&quot;language-text&quot;&gt;setRow&lt;/code&gt; function (if you think of the LEDs as being in a matrix, each digit is a row).&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;This was a fun extension to the last project and freed up even more Arduino pins for other things. My next step is to extract some of the expression logic into a class, add more expressions, and add some sort of sensor to determine which expression should show. I also plan to add a buzzer so it can start making cute sounds.&lt;/p&gt;
&lt;p&gt;Unfortunately it wasn’t all good news. For awhile I thought I had a hardware issue (it was actually a software issue before I started using the LedControl lib) and while tracking down the source of the bug I burnt out my original 4D7S display. It’s sad to lose a friend, but it will always be remembered. RIP.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Arduino Audio Alarm]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/audio-sensor/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/audio-sensor/</guid><pubDate>Sat, 18 Apr 2020 20:29:13 GMT</pubDate><content:encoded>&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;As a former Audio Engineer, I thought it would be fun to play with reading and making sound with Arduino. I bought a couple of sound detection modules and some ultra-loud piezo buzzers, so I thought I would make a simple alarm with them. Reading the sound was simple thanks to the modules, but I wasn’t sure how to power the buzzers to their full 24V potential since Arduino outputs a max of 5V.&lt;/p&gt;
&lt;p&gt;Seems like my options were using a MOSFET or a relay. I had a relay lying around thanks to the Arduino kit I bought, so that’s what I ended up using. Works like a charm, so I thought I would share what I learned!&lt;/p&gt;
&lt;h2&gt;The Build&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/3b7f2/schematic.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABYBAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAAB1vFihnM6/8QAGhAAAQUBAAAAAAAAAAAAAAAAAQACERIgIf/aAAgBAQABBQKUHdscf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAMAAwEAAAAAAAAAAAAAAAABESFBcVH/2gAIAQEAAT8hpZuCGzORo84Nun//2gAMAwEAAgADAAAAEFQv/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QGf/EABURAQEAAAAAAAAAAAAAAAAAAAEA/9oACAECAQE/EElv/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARIVFhccH/2gAIAQEAAT8QtnohIiCULEXS3TF3BrHL5LzZ/9k=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of the build&quot;
        title=&quot;Schematic of the build&quot;
        src=&quot;/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/1c72d/schematic.jpg&quot;
        srcset=&quot;/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/a80bd/schematic.jpg 148w,
/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/1c91a/schematic.jpg 295w,
/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/1c72d/schematic.jpg 590w,
/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/a8a14/schematic.jpg 885w,
/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/fbd2c/schematic.jpg 1180w,
/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/3b7f2/schematic.jpg 1987w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;Schematic of the build&lt;/figcaption&gt;
&lt;h3&gt;Components&lt;/h3&gt;
&lt;p&gt;Here are the parts I used for this:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Arduino Uno R3&lt;/li&gt;
&lt;li&gt;Sound detection module for Arduino&lt;/li&gt;
&lt;li&gt;SRD-05VDC-SL-C relay&lt;/li&gt;
&lt;li&gt;95db 3-24V piezo buzzer&lt;/li&gt;
&lt;li&gt;2N3904 NPN transistor&lt;/li&gt;
&lt;li&gt;1k ohm resistor&lt;/li&gt;
&lt;li&gt;1N4007 diode&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Component notes&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Split circuit&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I don’t know if this is the best way, but I basically made two separate circuits that each have their own power and their own ground. So in the schematic, the dotted line next to the relay specifies separate circuits.&lt;/li&gt;
&lt;li&gt;I use a 24V DC power input that I found at Goodwill with a standard barrel input. That goes through the piezo and is switched on/off by the relay.&lt;/li&gt;
&lt;li&gt;Everything else is part of the Arduino circuit.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Sound Detection&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I’m sure you could use anything for the sound detection module - it seems like they’re all clones of one another. I used this &lt;a href=&quot;https://www.amazon.com/Comidox-Sensitivity-Microphone-Detection-Arduino/dp/B07J6N734S&quot;&gt;Comidox Sound Detection Module for Arduino&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;It has both analog and digital outputs. Analog gives you a range of values; I didn’t use this. Digital gives you a HIGH or LOW based on a threshold controlled by a built-in trim potentiometer.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Relay&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The relay is used for switching higher voltage circuits (24V for the buzzer) with logic level controls (5V Arduino).&lt;/li&gt;
&lt;li&gt;It’s strongly encouraged to used a kickback diode with relays. When the relay switches, it can send a short, but very powerful, voltage through the circuit. My understanding is the diode protects the circuit from that voltage. This &lt;a href=&quot;https://www.youtube.com/watch?v=5kjtiY9gxGM&quot;&gt;video&lt;/a&gt; was a really great look at why you should use one.&lt;/li&gt;
&lt;li&gt;It was recommended to use a driver circuit for the relay. I tried without it and it sounded like the relay was struggling to switch. The transistor amplifies the current to help with that and the resistor is a current limiting resistor to protect the transistor.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Buzzer&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;This build could be greatly simplified if you’re fine using a 5V buzzer. I wanted it to be really loud though, so I used &lt;a href=&quot;https://www.amazon.com/DIKAVS-3-24V-Enclosed-Electronic-Buzzer/dp/B072HRZXLG&quot;&gt;this buzzer&lt;/a&gt;.&lt;/li&gt;
&lt;li&gt;To be as loud as possible I needed the voltage (I think), which means I needed the relay, which means I needed the driver circuit.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Code&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Pin variables&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; relay &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; input &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Variables we need for the logic&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; startBeep &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; beepLength &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Set pin direction&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;relay&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;INPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// If we&apos;re not currently beeping...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;startBeep &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...and we detect sound...&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; reading &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;digitalRead&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;input&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;reading &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// ...start beep and remember when we started.&lt;/span&gt;
      startBeep &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;relay&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;HIGH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Otherwise, if we are currently beeping...&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;// ...and we&apos;ve been beeping longer than beepLength...&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; now &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;millis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;startBeep &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; beepLength &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; now&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// ...reset startBeep and stop beep.&lt;/span&gt;
      startBeep &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;relay&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Code notes&lt;/h4&gt;
&lt;p&gt;The more correct way of doing things would be split &lt;code class=&quot;language-text&quot;&gt;startBeep&lt;/code&gt; into two variables: &lt;code class=&quot;language-text&quot;&gt;startBeep&lt;/code&gt; to track when we started beeping and &lt;code class=&quot;language-text&quot;&gt;isBeeping&lt;/code&gt; to track whether we’re currently beeping. I combined those concepts so that if &lt;code class=&quot;language-text&quot;&gt;startBeep == 0&lt;/code&gt; we are not beeping and if &lt;code class=&quot;language-text&quot;&gt;startBeep &amp;gt; 0&lt;/code&gt; we are beeping, while holding when we started beeping. The &lt;code class=&quot;language-text&quot;&gt;millis&lt;/code&gt; function is built in to Arduino and tracks the milliseconds since the sketch started running.&lt;/p&gt;
&lt;p&gt;The delays are probably too high, but they’re still essential. Without them the piezo doesn’t have time to stop beeping before we start reading the sensor input - creating an infinite beep. At 95db, you do not want an infinite loop.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;Despite being a fairly simple project, it took me a lot of time to understand switching on/off circuits with Arduino. This has been several months in the making as I watched just about every video on MOSFETs and relays. I learned a great deal in the process and hopefully will be well prepared for my next, hopefully less abrasive, audio project.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[4 Digit, 7 Segment Emoji]]></title><description><![CDATA[Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/seven-segment-emoji/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/seven-segment-emoji/</guid><pubDate>Mon, 13 Apr 2020 21:25:23 GMT</pubDate><content:encoded>&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/e1596/skeptical.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwb/xAAXAQADAQAAAAAAAAAAAAAAAAABAgMA/9oADAMBAAIQAxAAAAHn9K2DQhl0AvmDH//EABcQAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQEAAQUCLjITBYNuH//EABgRAAIDAAAAAAAAAAAAAAAAAAABEBFB/9oACAEDAQE/AUmUZH//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAXEAADAQAAAAAAAAAAAAAAAAAAEBEh/9oACAEBAAY/AiOrH//EABsQAQADAQADAAAAAAAAAAAAAAEAETEQIUGB/9oACAEBAAE/IZksGVvxkLT5OXQpGe4d5//aAAwDAQACAAMAAAAQtB9B/8QAFxEAAwEAAAAAAAAAAAAAAAAAARARIf/aAAgBAwEBPxCLEJmV/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQAQEf/aAAgBAgEBPxByF//EABoQAQACAwEAAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8Ql0gsON5idynAtsbQt8I1CGzV8jvJEpB0aiqLAmlxfs3tZ//Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Skeptical emoji on 4-digit, 7-segment display&quot;
        title=&quot;Skeptical emoji on 4-digit, 7-segment display&quot;
        src=&quot;/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/1c72d/skeptical.jpg&quot;
        srcset=&quot;/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/a80bd/skeptical.jpg 148w,
/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/1c91a/skeptical.jpg 295w,
/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/1c72d/skeptical.jpg 590w,
/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/a8a14/skeptical.jpg 885w,
/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/fbd2c/skeptical.jpg 1180w,
/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/e1596/skeptical.jpg 2048w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;Disclaimer:&lt;/strong&gt; I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I &lt;strong&gt;think&lt;/strong&gt; I learned, but that doesn’t make it the truth.&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;While at Eyeo Festival in 2019, I had the chance to hear &lt;a href=&quot;https://twitter.com/MohitBhoite&quot;&gt;Mohit Bhoite&lt;/a&gt; &lt;a href=&quot;https://vimeo.com/354276626&quot;&gt;talk&lt;/a&gt; about the beautiful freeform, electronic sculptures he creates. With just a few commonly found components and a microcontroller, he’s able to craft whimsical and charming creations that really resonated with me. The project that spoke to me the most was his &lt;a href=&quot;https://twitter.com/MohitBhoite/status/1241752124087660546&quot;&gt;Chintoo&lt;/a&gt; project, and I started to think “hey, I could make that! How hard could 4-digit, 7-segment displays be?”&lt;/p&gt;
&lt;p&gt;Apparently they’re pretty tricky. While this isn’t meant to explain 4-digit, 7-segment displays (that’s been covered extensively), hopefully this will augment existing resources that gloss over some things that tripped me up. I’m going to show off what I built and talk a little about what I learned afterwards.&lt;/p&gt;
&lt;h2&gt;The Build&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/tech-blog/static/2171b96c8cbbedde1c677facae80003a/e1596/schematic.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEEAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHouNmxMH//xAAYEAEAAwEAAAAAAAAAAAAAAAAAARESAv/aAAgBAQABBQK1plHTTT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAADAAMAAAAAAAAAAAAAAAAAASEQMUH/2gAIAQEAAT8hT8HGymFsOj//2gAMAwEAAgADAAAAEGAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAQEAAgMAAAAAAAAAAAAAAREAIUExcZH/2gAIAQEAAT8Qu5MlPeuFUU7xDBfudLkM684jk7//2Q==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Schematic of the build&quot;
        title=&quot;Schematic of the build&quot;
        src=&quot;/tech-blog/static/2171b96c8cbbedde1c677facae80003a/1c72d/schematic.jpg&quot;
        srcset=&quot;/tech-blog/static/2171b96c8cbbedde1c677facae80003a/a80bd/schematic.jpg 148w,
/tech-blog/static/2171b96c8cbbedde1c677facae80003a/1c91a/schematic.jpg 295w,
/tech-blog/static/2171b96c8cbbedde1c677facae80003a/1c72d/schematic.jpg 590w,
/tech-blog/static/2171b96c8cbbedde1c677facae80003a/a8a14/schematic.jpg 885w,
/tech-blog/static/2171b96c8cbbedde1c677facae80003a/fbd2c/schematic.jpg 1180w,
/tech-blog/static/2171b96c8cbbedde1c677facae80003a/e1596/schematic.jpg 2048w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
  &lt;/a&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;Schematic of the build&lt;/figcaption&gt;
&lt;h3&gt;Components&lt;/h3&gt;
&lt;p&gt;This is what I used. I’m sure you can swap out any of these parts, but this is what worked for me. The schematic I posted is written for simplicity, you’ll need to read the datasheets for the components you use to determine which pin is which.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Arduino Uno R3&lt;/li&gt;
&lt;li&gt;3461AS common cathode 4-digit, 7-segment (4D7S) display&lt;/li&gt;
&lt;li&gt;74HC595 shift register&lt;/li&gt;
&lt;li&gt;x4 2N3904 NPN transistors&lt;/li&gt;
&lt;li&gt;x8 220 ohm resistors (R1-R8)&lt;/li&gt;
&lt;li&gt;x4 1k ohm resistors (R9-R12)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;Component notes&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Display&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;The 4D7S display I’m using actually has 8 segments per digit (with the addition of the dot).&lt;/li&gt;
&lt;li&gt;Multiplexing is required for 4D7S displays or otherwise they would need a minimum of 28 pins. Multiplexing just means we’re lighting one digit at a time so fast that it seems like they’re all lit at once.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Shift register&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;I have no doubt this can be done without the shift register (using Arduino outputs to drive the segment state), but it’d use more pins and the code would be a little more verbose.&lt;/li&gt;
&lt;li&gt;The shift register takes serial data representing which pins on the chip should be on/off. So when I use Arduino’s builtin &lt;code class=&quot;language-text&quot;&gt;shiftOut&lt;/code&gt; function with &lt;code class=&quot;language-text&quot;&gt;shiftOut(dataPin, clockPin, LSBFIRST, B11000000)&lt;/code&gt;, A and B will be HIGH while C thru H will be LOW. &lt;code class=&quot;language-text&quot;&gt;LSBFIRST&lt;/code&gt; seems to specify order. &lt;code class=&quot;language-text&quot;&gt;shiftOut(dataPin, clockPin, MSBFIRST, B00000011)&lt;/code&gt; would be the same.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;SRCLR&lt;/code&gt; clears the shift register. I couldn’t get &lt;code class=&quot;language-text&quot;&gt;SRCLR&lt;/code&gt; working and it turns out I didn’t need it anyway. If unused, it needs to be connected to &lt;code class=&quot;language-text&quot;&gt;Vcc&lt;/code&gt;; otherwise it’ll be floating and you’ll see irregular flickering.&lt;/li&gt;
&lt;li&gt;I don’t know what &lt;code class=&quot;language-text&quot;&gt;OE&lt;/code&gt; is, but all the examples connected it to &lt;code class=&quot;language-text&quot;&gt;GND&lt;/code&gt; so that’s what I did too.&lt;/li&gt;
&lt;li&gt;The unused &lt;code class=&quot;language-text&quot;&gt;Qh&lt;/code&gt; is for chaining shift registers, which I didn’t need to do.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Other components&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;A lot of examples omit the current limiting resistors, but it seems like you’d run the risk of blowing out an LED, transistor, or an Arduino I/O pin. &lt;a href=&quot;https://www.onetransistor.eu/2018/12/wiring-of-4digit-7segment-display.html&quot;&gt;This&lt;/a&gt; article was really helpful.&lt;/li&gt;
&lt;li&gt;The transistors amplify current so that there’s enough to evenly light up the digits. For instance if there’s not an optimal amount of current and one digit has one segment lit while another digit has every segments lit, the digit with one segment lit will be brighter.&lt;/li&gt;
&lt;li&gt;I’m not sure if I picked the best resistor values, that’s why I didn’t write them in the schematic. I know I should be able to do the math, but I couldn’t figure out how to get all of the values I needed for the formula.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;Code&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;arduino&quot;&gt;&lt;pre class=&quot;language-arduino&quot;&gt;&lt;code class=&quot;language-arduino&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Digit selection to 4D7S&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; digit1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; digit2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; digit3 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; digit4 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// Serial to shift register&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; clockPin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; latchPin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; dataPin &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Initialize pins out outputs&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;latchPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;OUTPUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; digit&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; segmentData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Disable all digits&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  
  &lt;span class=&quot;token comment&quot;&gt;// Set segment data with shift register&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;latchPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;LOW&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;shiftOut&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dataPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; clockPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; LSBFIRST&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; segmentData&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;latchPin&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;HIGH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Enable specified digit&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;HIGH&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// Wait a bit for increased brightness&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Using binary to represent each segment&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// (1 = on, 0 = off)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// should draw: O . o&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit1&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; B11111100&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// big circle&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit2&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; B00000001&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// just the dot&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit3&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; B00000000&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// blank&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;digit4&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; B00111010&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// little circle&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;Code notes&lt;/h4&gt;
&lt;p&gt;We’re multiplexing, so the order of the code is important. I struggled for weeks trying to figure out why digits had a “ghosting” effect - meaning that they showed a dim residue of the shape from the previous digit. So in pseudocode the solution is:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- Initialize variables to help legibility
- Set the pins we&amp;#39;re using as outputs
- Loop:
  - Turn all digits off
  - Load the next digit segment data into the shift register
  - Turn the next digit on
  - Delay for a few microseconds
  - Repeat&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;The binary is just a way of keeping track of what segment is on and which is off. You can use decimal or hexadecimal, but binary made the most sense to me. With &lt;code class=&quot;language-text&quot;&gt;LSBFIRST&lt;/code&gt; the order is: A-B-C-D-E-F-G-DP. So a big circle is &lt;code class=&quot;language-text&quot;&gt;B11111100&lt;/code&gt; or A1-B1-C1-D1-E1-F1-G0-DP0.&lt;/p&gt;
&lt;p&gt;The delay is important and is a fine balance. Too small of a delay and the light won’t be on long enough for it to register as being bright. Too large of a delay and you’ll see the multiplexing in action. In fact it’s a good experiment to tinker with it, just remember to turn it back.&lt;/p&gt;
&lt;h2&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;While frustrating at times, this was a very enlightening project. In the end, I realized that I would need to separate multiplexing logic from the logic that determines the facial expression if I hope to have the expression respond to things. It seems there are chips specifically designed for multiplexing and maintaining current display state - the Max7219 seems promising in this regard. Using a chip like that would allow the microcontroller to do more complex processes without interrupting the multiplexing.&lt;/p&gt;
&lt;p&gt;Thanks for everyone who helped me! It actually took a number of people and just about every article on 4D7S with Arduino to get it through my thick skull. If I misspoke or just missed something, let me know!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[The Browser as a Medium]]></title><description><![CDATA[When we think of art we tend to think of New York museums and galleries, people pouring paint onto canvas to the sounds of bebop jazz, or…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/browser-as-a-medium/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/browser-as-a-medium/</guid><pubDate>Wed, 26 Feb 2020 20:29:13 GMT</pubDate><content:encoded>&lt;p&gt;When we think of art we tend to think of New York museums and galleries, people pouring paint onto canvas to the sounds of bebop jazz, or sculptors with rolled up sleeves and clay drying on their faces. We rarely picture computer screens being involved. Alternatively tools available to the artist might come to mind - Photoshop and Illustrator for the visual artists or Ableton and Reason for the sound artists.&lt;/p&gt;
&lt;p&gt;We’ll be taking a look at a different kind of art. Whereas photo editors might be used to make prints and digital audio workstations might be used to make songs, we’ll be looking at art where the program itself is the product.&lt;/p&gt;
&lt;p&gt;Specifically we’ll be looking through the lense of modern web browsers. Tools for making digital art have been available for decades (some notable examples being Processing and openFrameworks), but people, even people within the web development community, are often surprised by wealth of resources available to us natively in the browser.&lt;/p&gt;
&lt;h2&gt;Before We Start&lt;/h2&gt;
&lt;h3&gt;Why make art with code?&lt;/h3&gt;
&lt;p&gt;As a general rule, everyone should make art. It’s fun, therapeutic, and a great opportunity to join larger communities with similar interests. Everyone has the capacity for arts and crafts, and I’d argue that it’s a natural urge intrinsic to all people. By why digital art specifically?&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;It’s expressive.&lt;/strong&gt; We have the ability to create mixed media, immersive experiences and surprising, generative pieces.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;It’s open / distributed.&lt;/strong&gt; Open web standards means people around the world can easily access and interact with your art. The web also makes international collaboration a breeze.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;It’s a great way to get better at programming.&lt;/strong&gt; Since there’s not a ton of information available on creative coding for the web, it’s a pastime that forces people to experiment with bleeding edge technology.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;It can be a viral portfolio piece.&lt;/strong&gt; People love quirky web projects, so it’s a great way to have your portfolio spread across the web dev community.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Not enough people are doing it.&lt;/strong&gt; The world needs more web art - it’ll make the world better and it will push browsers to prioritize the development of these web standards.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;JavaScript vs. Browser APIs vs. Libraries&lt;/h3&gt;
&lt;p&gt;JavaScript is a general purpose programming language. It’s standards are guided by a committee and includes functionality that is useful to all programming environment (front-end, back-end, embedded, etc). These are things like &lt;code class=&quot;language-text&quot;&gt;if&lt;/code&gt;/&lt;code class=&quot;language-text&quot;&gt;else&lt;/code&gt; statements, &lt;code class=&quot;language-text&quot;&gt;function&lt;/code&gt; declarations, &lt;code class=&quot;language-text&quot;&gt;Array.map&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;Object.keys&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Then we have environment specific APIs. It doesn’t make sense to try and access GPIO pins from a browser. Similarly it doesn’t make sense to try to access DOM nodes in an embedded environment. We’ll be talking about Browser APIs - APIs agreed upon by committees usually made up of browser developers. These APIs give web developers access to features built into the browser (usually giving access to code written in lower-level languages such as C++ or Rust).&lt;/p&gt;
&lt;p&gt;Finally there are libraries. Libraries are chunks of reusable code that extend JavaScript the language and/or environment APIs. They can be created by anyone, to any specification that they prefer. We’ll be talking about these too.&lt;/p&gt;
&lt;h2&gt;Artistic Browser APIs&lt;/h2&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAEDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAADAQL/2gAMAwEAAhADEAAAAdOO4yRgXP8A/8QAGBABAQADAAAAAAAAAAAAAAAAAgEAAxD/2gAIAQEAAQUCaUuturJ3/8QAFhEAAwAAAAAAAAAAAAAAAAAAARAR/9oACAEDAQE/AaF//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFxAAAwEAAAAAAAAAAAAAAAAAAAEhIP/aAAgBAQAGPwKIqz//xAAaEAACAwEBAAAAAAAAAAAAAAABEQAQMVFx/9oACAEBAAE/IU5wXIhLHlYhyv/aAAwDAQACAAMAAAAQaA//xAAWEQEBAQAAAAAAAAAAAAAAAAARECH/2gAIAQMBAT8QyCf/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAaEAACAwEBAAAAAAAAAAAAAAABEQAhMRBx/9oACAEBAAE/EMVAW5Rg6U421iDJp6YFuf/Z&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Patatap Canvas API Example&quot;
        title=&quot;Patatap Canvas API Example&quot;
        src=&quot;/tech-blog/static/23f905904d5bd0c22ebbbfaf4d57ae5d/1c72d/patatap.jpg&quot;
        srcset=&quot;/tech-blog/static/23f905904d5bd0c22ebbbfaf4d57ae5d/a80bd/patatap.jpg 148w,
/tech-blog/static/23f905904d5bd0c22ebbbfaf4d57ae5d/1c91a/patatap.jpg 295w,
/tech-blog/static/23f905904d5bd0c22ebbbfaf4d57ae5d/1c72d/patatap.jpg 590w,
/tech-blog/static/23f905904d5bd0c22ebbbfaf4d57ae5d/a8a14/patatap.jpg 885w,
/tech-blog/static/23f905904d5bd0c22ebbbfaf4d57ae5d/fbd2c/patatap.jpg 1180w,
/tech-blog/static/23f905904d5bd0c22ebbbfaf4d57ae5d/eea4a/patatap.jpg 1280w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;
  &lt;a href=&quot;https://patatap.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;
    Patatap by Jono Brandel
  &lt;/a&gt;
&lt;/figcaption&gt;
&lt;h3&gt;Canvas API&lt;/h3&gt;
&lt;p&gt;The Canvas API is an API for “painting pixels” to a digital canvas - typically used for 2D art. It’s an extremely versatile and powerful tool for creating and editing raster images (images that are described in pixels). If we were to create a web version of Photoshop or MS Paint, it’d be with the Canvas API.&lt;/p&gt;
&lt;p&gt;The name of the API is very indicative of its use and makes for a great analogy. When using the Canvas API, the artist is layering “paint” (in the form of pixels, shapes, and paths) onto the canvas. The canvas can be reused just like a physical canvas can, but the paint layer has to be covered over before starting again.&lt;/p&gt;
&lt;p&gt;When looking at the underlying DOM of a Canvas API project, you’ll notice there’s just a &lt;code class=&quot;language-text&quot;&gt;&amp;lt;canvas&amp;gt;&lt;/code&gt; DOM node. This is a strength and weakness of the API. On the one hand it’s good: it means there aren’t a lot of DOM nodes to manage so it can be a very performant way to draw graphics or images. On the other hand, since there are no DOM nodes available to us, we aren’t able to manipulate specific parts of the image; if we want to change something we have to paint over and redraw the part we want to change.&lt;/p&gt;
&lt;p&gt;However due to its performant nature, it’s still a great way to animate an image. We can &lt;code class=&quot;language-text&quot;&gt;requestAnimationFrame&lt;/code&gt;, tween the animation, and redraw at around 50 frames per second (FPS depend on a large number of factors). Also thanks to its ability to give us pixel-by-pixel information of the canvas, we’re able to do complex image manipulation with the API.&lt;/p&gt;
&lt;h4&gt;P5&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://p5js.org/&quot;&gt;p5&lt;/a&gt; is an open source (LGPL) library created by &lt;a href=&quot;https://twitter.com/laurenleemack&quot;&gt;Lauren McCarthy&lt;/a&gt; to simplify working with the Canvas API. Probably the most accessible way to get started with creative coding in JavaScript, it handles things like creating the canvas, managing the &lt;code class=&quot;language-text&quot;&gt;canvasContext&lt;/code&gt; (the interface for manipulating the canvas), and requesting animation frames - all while providing helper functions that simplify drawing and math.&lt;/p&gt;
&lt;p&gt;It does a lot of other things too, including 3D and sound, so it’s possible to build an entire career in digital art just on p5.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 56.08108108108109%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC/ElEQVQozxWR20+aBwDF+Y+WZdnrnjbrxC6tAsIEQS4DUfFaUETgA76P+/VDOp2CSiZKXbWz4sZao229kXSZNk3aLnUva7a3JntbsuU39nBykpOTX05yFJZOkWVdJ+YODyVNF87PZ1nRd1OYkXng1hG2x9mZUFPzJTj19rIyLnHh72U/mOBwqo+6N8fXjjzxngCLugCK6JcO0noTPo2LrMFIQDdOfX6CdZ/A1pyLzZBAIzzG05iH54lRforM8zQyxqHo5VCwUItUqQTKFGwZvOooipr1Mya1STZsSu4YEjR9GsqxKge+HmShQsU5QI9yhSmVD3m6RCuupx5b4iys4nFmiWeSmZq0Qdm/RsqcQ3HHEKfq0BIaFNh0W6hGC3wfslMRM/isC9z8OIHywwSdHxTp/0ggbinwc9LAUbZAKzrIQTJBLbXHahu6Ga6iiJjnWLX3Iw4FaUgjVMJZfog4kP3rRJQ+hK446e4Aue4QuRtBFrs9NIQZfkyKPBEtfCstsyMVWY1usxbbQrE70sm0PsVDt4pCsEIzqKMkVjh0a9nSBGhoJthRB3isGuOR2svxbRd7vrs8T2rZji3zItZLVSxTj26wm2kDA1aRks3EXsjFacZKMxvgWdrOSXSYV5ZxfjUNcW0c4ve2/jDYeGeY4K14k1ZplsuslUt5nIa8Sj1RpRzfRjFnCrFmu0Xd4+Qq28tR0c+L9G3282HeT9/i78FhMOn4x2gBXT9/TWp5U1TRkj28yX7Bedtfyg6209+1oe2F95wdTA7EOZ/9hGYxxlWyi4NC21NKjosCf86oeW8186+jj3fzbq4zn9JaknibvcHZ3Si/5To4L0Wop7ZYT93//xQvpa8cPPSoOUkaOS2M0srbOMm7uJDtHOWdnKRNvF4c5XrZyi/FEa7yRi4XnLySTVy2u2elBPczVarxeyhmBkQ2h9X4zX4a8zrWYws8igxQFks0hX7KUp5jSc+DpMx5pI/9TI6zmJ6DVDsP97GbznEhtXtiHXnqG/4D0uA/BQL2OP4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Tangara Fastuosa SVG Example&quot;
        title=&quot;Tangara Fastuosa SVG Example&quot;
        src=&quot;/tech-blog/static/3903a0e2f0c075d30a3ab2bc3ccdef58/fcda8/tangara-fastuosa.png&quot;
        srcset=&quot;/tech-blog/static/3903a0e2f0c075d30a3ab2bc3ccdef58/12f09/tangara-fastuosa.png 148w,
/tech-blog/static/3903a0e2f0c075d30a3ab2bc3ccdef58/e4a3f/tangara-fastuosa.png 295w,
/tech-blog/static/3903a0e2f0c075d30a3ab2bc3ccdef58/fcda8/tangara-fastuosa.png 590w,
/tech-blog/static/3903a0e2f0c075d30a3ab2bc3ccdef58/efc66/tangara-fastuosa.png 885w,
/tech-blog/static/3903a0e2f0c075d30a3ab2bc3ccdef58/c83ae/tangara-fastuosa.png 1180w,
/tech-blog/static/3903a0e2f0c075d30a3ab2bc3ccdef58/f581c/tangara-fastuosa.png 3072w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;
  &lt;a href=&quot;https://vimeo.com/282220342&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;
    Tangara Fastuosa by Sarah GHP
  &lt;/a&gt;
&lt;/figcaption&gt;
&lt;h3&gt;SVG&lt;/h3&gt;
&lt;p&gt;Less an API than an addition to the HTML standard, SVG (Scalable Vector Graphics) is a way of describing 2D graphics; in this case vector graphics. Vector images differ from raster images in that rather than describe images on a pixel-by-pixel basis they describe images with shapes primitives. While you might use the Canvas API to make a web equivalent of Photoshop, you’d use the SVG standard to make a web equivalent of Illustrator.&lt;/p&gt;
&lt;p&gt;If you know HTML and CSS, you already know SVG. SVG is just a collection of DOM tags that describe shapes that can be styled with CSS. For instance there’s a &lt;code class=&quot;language-text&quot;&gt;&amp;lt;circle&amp;gt;&lt;/code&gt; for round ellipses and circles, &lt;code class=&quot;language-text&quot;&gt;&amp;lt;rect&amp;gt;&lt;/code&gt; for squares and rectangles, and &lt;code class=&quot;language-text&quot;&gt;&amp;lt;path&amp;gt;&lt;/code&gt; for arbitrary shapes. They can also contain text or images. Similar to Illustrator, you can group shapes (with the &lt;code class=&quot;language-text&quot;&gt;&amp;lt;g&amp;gt;&lt;/code&gt; tag) to manipulate them together.&lt;/p&gt;
&lt;p&gt;Since these are just DOM nodes, they can be animated with CSS transitions or keyframes. More complex behavior can be programmed with JavaScript using &lt;code class=&quot;language-text&quot;&gt;requestAnimationFrame&lt;/code&gt; or an animation library. They can be themed with different CSS classes or resized with CSS media queries.&lt;/p&gt;
&lt;p&gt;The strengths and weaknesses foil those of the Canvas API. All the DOM nodes are there to be pushed around or modified, but manipulating the DOM directly is process intensive. We gain flexibility at the cost of performance. This isn’t much of a problem for simple graphics, but for complex animations or graphics with hundreds of layers it’ll likely be better to use the Canvas API.&lt;/p&gt;
&lt;h4&gt;d3&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://d3js.org/&quot;&gt;d3&lt;/a&gt; is an open source (BSD) library created by &lt;a href=&quot;https://twitter.com/mbostock&quot;&gt;Mike Bostock&lt;/a&gt; that controls SVG generation and provides useful math functionality. It’s used primarily for advanced data visualizations. While d3 should not be someone’s first introduction to SVG (SVG is easy enough to get started with directly), d3 is an amazing tool to generate complex graphics and behaviors with SVG.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8UlEQVQoz42TWxKDIAxF3b3Wt1Xb+tXVWUWFLiG9QRlRdOpHJhDI5QSCpx4pqVdOqk5IVrHjjc1zGLziGPsD89ykrVdNoZP1fDEjakSkNfZsdXm06ZmtsXolNMJ7Ym+PLC2CCSWKMqYexn7UlfDaLPQtXeJDQiM6IKHLA/pkPrWpT+M9xCG8hn289s5obNJzQluQaURxI5H7sECPxzLSpDqZya8IGjqJ5GERmRayDqV2RYjYTHmpZJtyYjEWrlMSfJ84YID4/OLJ9UexxZmsRXLPlGw4QNXnrXN6hxtqiMgqcio46uG/hKb/zvp1E8OP+wH0aJ8CDSJ6FQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Bellwoods WebGL Example&quot;
        title=&quot;Bellwoods WebGL Example&quot;
        src=&quot;/tech-blog/static/cde58bbb239bef31f4f46393a4931016/fcda8/bellwoods.png&quot;
        srcset=&quot;/tech-blog/static/cde58bbb239bef31f4f46393a4931016/12f09/bellwoods.png 148w,
/tech-blog/static/cde58bbb239bef31f4f46393a4931016/e4a3f/bellwoods.png 295w,
/tech-blog/static/cde58bbb239bef31f4f46393a4931016/fcda8/bellwoods.png 590w,
/tech-blog/static/cde58bbb239bef31f4f46393a4931016/efc66/bellwoods.png 885w,
/tech-blog/static/cde58bbb239bef31f4f46393a4931016/c83ae/bellwoods.png 1180w,
/tech-blog/static/cde58bbb239bef31f4f46393a4931016/d6853/bellwoods.png 3070w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;
  &lt;a href=&quot;https://bellwoods.xyz/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;
    Bellwoods by Matt DesLauriers
  &lt;/a&gt;
&lt;/figcaption&gt;
&lt;h3&gt;WebGL&lt;/h3&gt;
&lt;p&gt;WebGL (Web Graphics Library) is an API for generating 3D graphics in the browser. It is as wonderful as it is difficult. This is no fault of WebGL - 3D graphics are difficult to work with in general. The 3D artist has to account for perspective, lighting, materials, and geometries among many other things. However the payoff for working with WebGL can be immense. While writing this, I took a quick peek at &lt;a href=&quot;https://www.awwwards.com/&quot;&gt;awwwards&lt;/a&gt; and the first 6 sites they listed were built using WebGL. WebGL is the stuff dreams are made of.&lt;/p&gt;
&lt;p&gt;At the most fundamental level, when working directly with WebGL, you’ll be working with shaders. Shaders are programs written in a C-like language that determine where each pixel should be in a 3D space and the color the pixel should be based on a number of factors.&lt;/p&gt;
&lt;p&gt;While WebGL is pretty standard now, a lot of devices still struggle with it. The fans on most MacBooks will sound like they’re lifting off for an interstellar space mission and phones can hang or blow up. Be smart with WebGL and only re-render when there’s a reason to re-render. Actually this is just good advice for any type of re-rendering.&lt;/p&gt;
&lt;p&gt;I could go on like I know what I’m talking about, but I would recommend skipping right past vanilla WebGL and starting with THREE.&lt;/p&gt;
&lt;h4&gt;THREE&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://threejs.org/&quot;&gt;THREE&lt;/a&gt; is an open source (MIT) library created by &lt;a href=&quot;https://twitter.com/mrdoob&quot;&gt;Ricardo Cabello&lt;/a&gt; that creates a much friendlier WebGL development experience. THREE gives you constructors for cameras with differing perspectives, geometries/materials/meshes, and different types of lights. It’ll handle rendering for you so all you need to manage is animation frames and tweening - things that can be outsourced to animation libraries.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACWUlEQVQoz1WSWU8TYRSGuTcIlEWWzrTTmeks7eydbiwFCqWkEKAsAsFITFSg7KtemPgnTLwx8Z8+fi0k6vX35TnnPc/b9zSe5NHM8fv+kU5cov6qn5aqUdd0SoqCLcnIExNMTsokkyayFKCkZ8ikl0kMLFApfubp4ReBc4uSvKbvi/h4ncrwVJnmnaKx/HqQDdNixXGYMU0CTUNLp1HEm6p6ZPQShr5AVmsyOlwnqx4wN3OPoZ6jyrddYIrLZJpTzeBgSqIxMMSaAB0nDGqKjqNmUAVQEkMNxWPTaKCrNbRMg7GRJdLSDjnzE7pyhpZ6AV5JCpe2w2Ey1QOuZw1amkVVxA5VnUOtjKnbGEZIZNfI6vOoL0AltYfvnv0LFJHlDHdhzJHYYlkANwyLVc9jOpsltiwqjo8tBjpOGdedJwpb5Oz1XmRN2accX2FkOs/Ar1MpLgT0w6TE3ptJGoMJtnJ5NgsxjTBiMSjgO3lMAfTMmPbYDHG4hudu9jZMTrRR5PfififoqTv6nsYlHrI2P087nIaFnuUdz2e7XKEZx5wPBVRzHlkrj5Mv4dtzxNE6hXCnZ7kYfeSi8wM/f0MmeSMiT8jcCIPfG02OdYOl/gG2XY92qcxKVKAm4uYNg7T4Y1kFXH+R6uwO5eJbRobq2OYRreY3LP3ir+WulGs36Enp3rAL3CqWaEQRs1FI4HbvF+B5VdG7VVYqu1QrB4wm6qKPexSCi/8tXwpQx7BFbeQesJ132YyLLAchs34gYkUEvtgumKbmNbgdblIp7/ekpKVd3NyJ6Ooz8A8XG0XV3o09pwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;Latent Cycles Web Audio Example&quot;
        title=&quot;Latent Cycles Web Audio Example&quot;
        src=&quot;/tech-blog/static/c94a153d5db0157065b932716fd968f2/fcda8/latent-cycles.png&quot;
        srcset=&quot;/tech-blog/static/c94a153d5db0157065b932716fd968f2/12f09/latent-cycles.png 148w,
/tech-blog/static/c94a153d5db0157065b932716fd968f2/e4a3f/latent-cycles.png 295w,
/tech-blog/static/c94a153d5db0157065b932716fd968f2/fcda8/latent-cycles.png 590w,
/tech-blog/static/c94a153d5db0157065b932716fd968f2/efc66/latent-cycles.png 885w,
/tech-blog/static/c94a153d5db0157065b932716fd968f2/c83ae/latent-cycles.png 1180w,
/tech-blog/static/c94a153d5db0157065b932716fd968f2/d6853/latent-cycles.png 3070w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;
  &lt;a href=&quot;https://codepen.io/teropa/full/rdoPbG&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;
    Latent Cycles by Tero Parviainen
  &lt;/a&gt;
&lt;/figcaption&gt;
&lt;h3&gt;Web Audio API&lt;/h3&gt;
&lt;p&gt;The Web Audio API is a tool useful for playing audio files, analyzing audio, and generating audio. Playing audio has its uses for streaming music or for game development. Analyzing audio can be useful for creating visualizers or for machine learning purposes (think of having a chat bot that you can actually talk to). What excites me the most however is that all modern browser have a fully functioning synthesizer in them!&lt;/p&gt;
&lt;p&gt;The API provides low-level building blocks such as &lt;code class=&quot;language-text&quot;&gt;OscillatorNode&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;GainNode&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;BiquadFilterNode&lt;/code&gt;, and &lt;code class=&quot;language-text&quot;&gt;DelayNode&lt;/code&gt; that can be used to create oscillators, envelope generators, amplifiers, filters, delays, and reverbs. Imagine being able to control a big Moog-style modular synthesizer with JavaScript - that’s now a reality. &lt;/p&gt;
&lt;p&gt;Working with the Web Audio API can be a little tough, but groups are starting to come together to build web-based digital audio workstations, plugin effect and instrument standards, and experimental projects combining machine learning and browser-specific interfaces. It’s likely we’ll see something akin to Ableton Live in the browser before too long.&lt;/p&gt;
&lt;h4&gt;Tone&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://tonejs.github.io/&quot;&gt;Tone&lt;/a&gt; is an open source (MIT) library created by &lt;a href=&quot;https://twitter.com/yotammann&quot;&gt;Yotam Mann&lt;/a&gt; that abstracts away a lot of the low level Web Audio API into virtual modules that can be combined into instruments. In fact, the library comes with several pre-built synths such as a &lt;code class=&quot;language-text&quot;&gt;FMSynth&lt;/code&gt; and a &lt;code class=&quot;language-text&quot;&gt;PolySynth&lt;/code&gt;. It also handles a lot of the general complexity that comes with music programming such as timing and note-to-frequency conversions.&lt;/p&gt;
&lt;p&gt;&lt;span
      class=&quot;gatsby-resp-image-wrapper&quot;
      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;&quot;
    &gt;
      &lt;span
    class=&quot;gatsby-resp-image-background-image&quot;
    style=&quot;padding-bottom: 52.02702702702703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAACbElEQVQozz2Q3UuTYRiHX+wgrDSdqWEazknh/NYVZOJRdVBBOT9qlinYX1AHdWIdZGWU1jItSZNCJ25Ks+xDISrTOTRb03JLJdGj6MCgPMu9V/e7aQcX98N981zP734UvdGE3pgfJNG4h3hDNkmGTFJTM0lJN5Ek8/ysHJaPR0FpBGpJBFTErhEHp4TSSND6UpWU9Hw09HK5KDODSvMRisrK0R2rINWYtybMZbk4Goo3oZ5JgKYTUH8Ymk/CbTNYYsC8JSQ0iChZyMrKx30wmuGW85yztaLcfMju9Dx2SmqTJjTrRBhOoCYZ9U4JqrUUtbUStdmCeno7qgjV0q0o6+tqYkvuLmrKj3KgspKokqpgwsQ0SZiZw69gwnDU6iRJZgml7DgLbdWhtc2b11c2Bf9KWzk+bS9xKdkk6DNINaQHH/mfUBPKHwYkhSZVLbGoIlKrdqCWRcnfRkpCEU44bzEuTPQ3MDXQyPQrK1OC56WVcelNyuyts5FDjifsc3RR6OikoLeLgr5uwRY8F9o72e8IobDYC0t98N3OzLsHeAfv4h26x5c3LbCgzXr5veAk/KNPXp9HcftRXoygDAiv3aE6MYcyvsaqz8bqbA+rnnZWntXyp1/ovcBK30X++rvB38WPGTuxo5MimyGyf4jE2jpiG1uIr2sg4dI1woY9hI16CRv5jKJ+k0tzPQSmHzP//Dp+51V89svMPb3Cqt8Gs9389DuIcXlE6GPj4Ai6G01s7rCja7zPtnorG4ZcMvuKMjq1JpRLAalL7kcsutpCdaw92FsX6sZEODqN4hI+SJL3n1BGvKGz1tNkUv8B5VPwkEYWUOcAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
  &gt;&lt;/span&gt;
  &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        alt=&quot;A Single Div CSS Example&quot;
        title=&quot;A Single Div CSS Example&quot;
        src=&quot;/tech-blog/static/de01ebc5bd346291f07b1a2deea8ef94/fcda8/single-div.png&quot;
        srcset=&quot;/tech-blog/static/de01ebc5bd346291f07b1a2deea8ef94/12f09/single-div.png 148w,
/tech-blog/static/de01ebc5bd346291f07b1a2deea8ef94/e4a3f/single-div.png 295w,
/tech-blog/static/de01ebc5bd346291f07b1a2deea8ef94/fcda8/single-div.png 590w,
/tech-blog/static/de01ebc5bd346291f07b1a2deea8ef94/efc66/single-div.png 885w,
/tech-blog/static/de01ebc5bd346291f07b1a2deea8ef94/c83ae/single-div.png 1180w,
/tech-blog/static/de01ebc5bd346291f07b1a2deea8ef94/d6853/single-div.png 3070w&quot;
        sizes=&quot;(max-width: 590px) 100vw, 590px&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;
        loading=&quot;lazy&quot;
      /&gt;
    &lt;/span&gt;&lt;/p&gt;
&lt;figcaption&gt;
  &lt;a href=&quot;https://a.singlediv.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener noreferrer&quot;&gt;
    A Single Div by Lynn Fisher
  &lt;/a&gt;
&lt;/figcaption&gt;
&lt;h3&gt;CSS&lt;/h3&gt;
&lt;p&gt;People like to lament about working with CSS (Cascading Style Sheets), so much so that it’s almost a rite of passage in the web dev community. However CSS is amazingly powerful with baked-in support for transitions, animations, and responsive behavior. Now that we have Flexbox and CSS Grid, we have even more tools available to us to create beautiful and responsive pieces without needing to venture into the world or JavaScript.&lt;/p&gt;
&lt;p&gt;On top of which making CSS art is a great way to sharpen your web dev skills, and the intrinsic limitations will sharpen your creative muscles.&lt;/p&gt;
&lt;h2&gt;Other Browser APIs&lt;/h2&gt;
&lt;p&gt;There are plenty of other APIs available or soon-to-be available to the artists of the web. Here are a few:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Gamepad API:&lt;/strong&gt; use a standard video controller to control your game or installation.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Web MIDI API:&lt;/strong&gt; (Musical Instrument Digital Interface) use a keyboard, drum pad, or other MIDI device to control your web synth or interactive piece.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Web Bluetooth API:&lt;/strong&gt; an experimental API that could be used trigger interactive elements in an installation.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;WebXR API:&lt;/strong&gt; an experimental API for developing VR (virtual reality) or AR (augmented reality) experiences.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Machine Learning and Web Art&lt;/h2&gt;
&lt;p&gt;This is a whole other topic, but I couldn’t talk about digital art without bringing up two very cool libraries that help make machine learning available to web artists.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://ml5js.org/&quot;&gt;ml5&lt;/a&gt;&lt;/strong&gt; is an open source (MIT) library created by &lt;a href=&quot;https://twitter.com/ahandvanish&quot;&gt;Hannah Davis&lt;/a&gt; and built on Google’s TensorFlow to simplify working with models in the web. Leans more towards visual models.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://magenta.tensorflow.org/&quot;&gt;Magenta&lt;/a&gt;&lt;/strong&gt; is an open source (Apache License 2.0) library created by Google and built on Google’s TensorFlow. It has several handy composition models leaning towards the audio side of things.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;Additional Resources&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://www.youtube.com/channel/UCvjgXvBlbQiydffZU7m1_aw&quot;&gt;The Coding Train&lt;/a&gt;&lt;/strong&gt; a great YouTube channel that dives into Processing, p5, and ml5 among other things.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://thebookofshaders.com/&quot;&gt;The Book of Shader&lt;/a&gt;&lt;/strong&gt; a free, online book that walks readers through the usage of fragment shaders in WebGL.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;a href=&quot;https://webaudioapi.com/book/&quot;&gt;Web Audio API&lt;/a&gt;&lt;/strong&gt; a free, online book that goes through some basic uses for the Web Audio API. Doesn’t cover much synthesis, but touches on playback and analysis.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Thanks for reading. If this talk inspired you to try out some Browser APIs in your own creative practice, I’d love to see what you made!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Guiding Principles of Austin Code Mentorship]]></title><description><![CDATA[Within a couple of months after starting Austin Code Mentorship, our now co-organizer Alex Doll contacted me offering to provide support. At…]]></description><link>https://gatsby-starter-blog-demo.netlify.com/acm-principles/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.com/acm-principles/</guid><pubDate>Wed, 22 Jan 2020 20:29:13 GMT</pubDate><content:encoded>&lt;p&gt;Within a couple of months after starting &lt;a href=&quot;https://www.meetup.com/Austin-Code-Mentorship&quot;&gt;Austin Code Mentorship&lt;/a&gt;, our now co-organizer &lt;a href=&quot;https://www.linkedin.com/in/alexander-doll/&quot;&gt;Alex Doll&lt;/a&gt; contacted me offering to provide support. At the time I was terrified of the offer. I was afraid that without a strong focus, the group would collapse into an aimless social group of clicks and language-bashing and I was worried that distributing responsibility would lead to a “design by committee”-style catastrophe. ACM was inspired by Portland’s long-running &lt;a href=&quot;https://www.meetup.com/Mentorship-Saturdays/&quot;&gt;Mentorship Saturdays&lt;/a&gt; and I wanted to create a similarly encouraging and welcoming community. While I had a general idea of what I wanted the group to stand for, I hadn’t ever organized these thoughts into cohesive directives. &lt;/p&gt;
&lt;p&gt;I didn’t respond to Alex for several days. Instead I took time to analyze what I liked about Mentorship Saturdays and what I considered “success” for Austin Code Mentorship. Eventually I responded with an outline of four ideals that really all boiled down to one core goal: to try to make Austin Code Mentorship as inclusive as possible to everyone interested in programming.&lt;/p&gt;
&lt;p&gt;Recently these guiding principles came up again with another member of the group. That, plus our group passing 2000 members, made me think that it might be beneficial to share an outline of these ideals with the members of Austin Code Mentorship.&lt;/p&gt;
&lt;h2&gt;Four Guiding Principles&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Inclusive:&lt;/strong&gt; We want to create a safe, welcoming environment for anyone interested in programming. We recognize that inclusivity means more than just opening the door - it’s a lofty and worthy goal that requires proactive attention. It affects everything we do and everyone involved.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Language agnostic:&lt;/strong&gt; While we think groups that specialize are great, we also think there’s great value in chatting with someone from a different tech stack. People can take over rooms and do talks about niche tech, but those are opt-in activities for people rather than the default.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Loosely structured:&lt;/strong&gt; Similarly, we think hackathons and lectures are invaluable resources for developing as a developer; however they can be daunting to newbies or irrelevant to people in different stacks.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Everyone’s a mentor, everyone’s a mentee:&lt;/strong&gt; We believe everyone has something to contribute to the community. Even people who haven’t written a single line of code can give feedback on projects or just provide encouragement to others. At the same time, we believe everyone still has something to learn.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;As you can see, these all circle back to inclusivity - inclusive of people, their tech preference, and their level of experience.&lt;/p&gt;
&lt;h2&gt;Inclusivity’s Effect on Structure&lt;/h2&gt;
&lt;p&gt;Just to illustrate how Austin Code Mentorship is almost self-organizing once there’s a clear priority in place, I wanted to detail how we made some of our decisions.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;We start each event with introductions. This is to reinforce everyone’s value and contribution to the group as well as helps us find people to chat with later.&lt;/li&gt;
&lt;li&gt;People are welcome to come and go as they need to. We realize that people have families and lives outside of tech. We also realize that there are introverts that don’t like doing the introductions: that’s cool too.&lt;/li&gt;
&lt;li&gt;We don’t charge members ever. This can be prohibitive to people who are currently struggling with finances and thus non-inclusive. We believe in socioeconomic inclusivity, especially since many of our members are working on improving their socioeconomic position.&lt;/li&gt;
&lt;li&gt;Our events are on Saturday mornings. Not everyone can make it, but we feel like it’s a time when a majority of people are off from work, when traffic is a little more bearable, and still gives people most of their weekend. Plus this gives an alternative to the typical weekday afternoon tech event.&lt;/li&gt;
&lt;li&gt;Our events repeat like clockwork: every first Saturday of the month from 10am-2pm, except December. This helps people plan accordingly and anticipate future events.&lt;/li&gt;
&lt;li&gt;We don’t organize lectures as we like to keep things language agnostic and loosely structured. However since it &lt;em&gt;&lt;strong&gt;is&lt;/strong&gt;&lt;/em&gt; loosely structured and everyone’s a mentor, we’re happy when members take a room over to make a presentation - as long as there’s still space for others to do their own thing.&lt;/li&gt;
&lt;li&gt;We work hard at crafting language and branding that is inclusive. This affects our aesthetic more than any other factor.&lt;/li&gt;
&lt;li&gt;We realize there is no true inclusivity. Paradoxically, to be inclusive means being non-inclusive of those that are non-inclusive. With every rule there are exceptions. That’s why we encourage all members to read our &lt;a href=&quot;https://berlincodeofconduct.org/&quot;&gt;code of conduct&lt;/a&gt; so they know in advance what behavior is acceptable.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;We’re not perfect. In fact we are quite imperfect. We try, we fail, and we try again. However having codified principles helps us keep focused on what’s important when things start to get foggy.&lt;/p&gt;
&lt;p&gt;I’m very grateful to be a part of a community that shares these ideals. Alex was on-board with these core values from the beginning and we’ve only grown in the number of people who take these principles to heart.&lt;/p&gt;</content:encoded></item></channel></rss>