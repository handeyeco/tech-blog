{"componentChunkName":"component---src-templates-blog-post-js","path":"/pro-micro-midi-interface/","result":{"data":{"site":{"siteMetadata":{"title":"Tech Blog"}},"markdownRemark":{"id":"875da31b-aecd-5681-a018-770e62457a34","excerpt":"Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned, but that doesn’t…","html":"<p><em><strong>Disclaimer:</strong> I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I <strong>think</strong> I learned, but that doesn’t make it the truth.</em></p>\n<p>Quick note: diyelectromusic.com has <a href=\"https://diyelectromusic.com/2022/03/22/arduino-and-usb-midi/\">a bunch of writeups</a> on doing stuff like this, so those posts would be good references too.</p>\n<hr>\n<p><strong>Update 2025-03-24:</strong> I mentioned below that while I had a working prototype with the Pro Micro, I decided to get a Zoom LiveTrak L6 for mixing duties and that it includes a USB-to-TRS MIDI interface. Just wanted to update for the curious that the L6 works great as a MIDI interface for the Norns.</p>\n<hr>\n<p>It’s been fun working with the <a href=\"https://www.denki-oto.com/store/p98/shieldXL_(DIY_norns_synthesizer_kit).html\">Denki Oto shieldXL</a> - a small, scriptable computer for music and a clone of the <a href=\"https://monome.org/docs/norns/\">Monome Norns</a>. As a programmer it’s great to have an idea for some MIDI utility and, after a little bit of Lua programming, have the utility running on real hardware.</p>\n<p>I found a deal on an older model Norns, so I decided to splurge on a fixer-upper; you can see <a href=\"https://www.youtube.com/watch?v=3S8zLlK_vk0\">my video for that here</a>. While an authentic Norns has a lot of benefits over the shieldXL, one of the major problems with the Norns is that it doesn’t have hardware MIDI I/O.</p>\n<p>So I decided to tinker around to see if I could make a USB-to-TRS MIDI interface.</p>\n<p>Goals:</p>\n<ul>\n<li>TRS MIDI since I want to use it for a portable rig and most of my small synths use TRS MIDI (FM2, NTS-1, S-1, Micromonsta, and <a href=\"https://github.com/handeyeco/Grandbot\">Grandbot</a>)</li>\n<li>Small-ish, again since it’s for a portable rig</li>\n<li>Ideally using stuff I had lying around the house</li>\n</ul>\n<h2>Microcontroller</h2>\n<p>Not all microcontrollers are up for this task since they need to be able to act as a USB device, which disqualifies the trusty Arduino Uno and Arduino Nano.</p>\n<p>Luckily I happened to have an unused <a href=\"https://www.sparkfun.com/pro-micro-5v-16mhz.html\">Pro Micro</a> lying around. They come in 5V and 3.3V variants, but I used the 5V for this one.</p>\n<p>To be honest, using a Pro Micro is probably massive overkill for this project. I’m only using 4 of the 24 pins, so the dev board is probably 2x or even 3x the size of just embedding an MCU. For the price of a Pro Micro, I could buy a USB-to-DIN cable.</p>\n<p><em>However</em>, I haven’t found a commercial USB-to-TRS interface, I already had the parts, and if I just bought something I wouldn’t have been able to write this blog post.</p>\n<h2>Schematic</h2>\n<p>If you’ve read any post on this blog, the schematic will likely bore you. If you haven’t done a MIDI circuit before, <a href=\"https://www.notesandvolts.com/2015/02/midi-and-arduino-build-midi-input.html\">Notes and Volts has a good overview</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/e49e346a4c76d3bb82d786f76da629e4/e671a/schematic.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 36.486486486486484%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABaUlEQVQoz2WRyW7bQBBE+f+/kJOP+YcglyCAD9mAxI61kKLEnbOTHFL25aUpKkCAHAoz6K6u6qlJ5jmwzJ45eqLcx7jd1/okWGvD5JimO+feGwaD9T3L64SxLfnlQG0akjA63BiYl4EQNHVXcr0Ot6GiyVFCMqYWjuIqnDmGTXQJXPIX0vSZuvyF+vZAaH6SdLYkP37Bm57gWnSR0ZoLpj8T1Qf86SOdPtNVKcoq3NSjhwY/a5oy43R4wtoCl31CH7+TuOwz6us7unJPP7Vk3Znz6Tem2GN3D6gf7+nFtG1TeteIoGKKjkW2HeQVfrBo03F9XWTrkcQWB4YulZw0QbCePgpkOOpH3OWR4vREqQps7DG+pqlydHNB17mIb5lGMVmjSJa3yHyNt+JfLPOa4SCEkeVtpqp2YiCRRItxFXm242X/jCqPN5F/kWzK7r/GBncz0LZjHK0YbYZBft3LZ2qvGCd333Cb+QP1gA6wXsNTxwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Schematic of the USB-to-TRS interface\"\n        title=\"Schematic of the USB-to-TRS interface\"\n        src=\"/tech-blog/static/e49e346a4c76d3bb82d786f76da629e4/fcda8/schematic.png\"\n        srcset=\"/tech-blog/static/e49e346a4c76d3bb82d786f76da629e4/12f09/schematic.png 148w,\n/tech-blog/static/e49e346a4c76d3bb82d786f76da629e4/e4a3f/schematic.png 295w,\n/tech-blog/static/e49e346a4c76d3bb82d786f76da629e4/fcda8/schematic.png 590w,\n/tech-blog/static/e49e346a4c76d3bb82d786f76da629e4/efc66/schematic.png 885w,\n/tech-blog/static/e49e346a4c76d3bb82d786f76da629e4/c83ae/schematic.png 1180w,\n/tech-blog/static/e49e346a4c76d3bb82d786f76da629e4/e671a/schematic.png 2896w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>A typical MIDI input circuit attached to the Pro Micro’s RX, a typical MIDI output circuit attached to the Pro Micro’s TX, and power.</p>\n<h2>The Code</h2>\n<p>The circuit was easy (I actually have an Arduino MIDI test circuit I keep around for this kind of experiment) but the code was a little trickier.</p>\n<p>Some Arduino libraries I looked at:</p>\n<ul>\n<li><a href=\"https://github.com/FortySevenEffects/arduino_midi_library\">Arduino MIDI Library</a>: this is what I use for Grandbot. It deals with hardware MIDI.</li>\n<li><a href=\"https://github.com/arduino-libraries/MIDIUSB\">MIDIUSB</a>: this is the official library for MIDI over USB.</li>\n<li><a href=\"https://github.com/lathoub/Arduino-USBMIDI\">Arduino-USBMIDI</a>: this was built to act as an intermediary between the hardware and USB MIDI libraries.</li>\n</ul>\n<p>Unfortunately in the short amount of time I looked at these I couldn’t get them to play nice together. USBMIDI has an example called <code class=\"language-text\">MIDI_DIN2USB</code> which didn’t work for me. Trying to connect the hardware MIDI library with the USB MIDI library was frustrating because the Arduino MIDI Library doesn’t seem to expose the raw status byte, so I couldn’t figure out how to just forward the raw data.</p>\n<p>Eventually I ran into <a href=\"https://github.com/tttapa/Control-Surface\">Control Surface</a> which has a <code class=\"language-text\">USBMIDI-Adapter</code> example which worked for me:</p>\n<div class=\"gatsby-highlight\" data-language=\"cpp\"><pre class=\"language-cpp\"><code class=\"language-cpp\"><span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">include</span> <span class=\"token string\">&lt;Control_Surface.h></span></span>\n\n<span class=\"token comment\">// Instantiate a MIDI over USB interface</span>\nUSBMIDI_Interface midi_usb<span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Instantiate a 5-pin DIN MIDI interface (on the TX and RX pins of Serial1)</span>\nHardwareSerialMIDI_Interface midi_ser <span class=\"token punctuation\">{</span>Serial1<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// Instantiate the pipe to connect the two interfaces</span>\nBidirectionalMIDI_Pipe pipes<span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Manually route MIDI input from the serial interface to the USB interface,</span>\n  <span class=\"token comment\">// and the MIDI input from the USB interface to the serial interface</span>\n  midi_ser <span class=\"token operator\">|</span> pipes <span class=\"token operator\">|</span> midi_usb<span class=\"token punctuation\">;</span>\n  <span class=\"token comment\">// Initialize the MIDI interfaces</span>\n  <span class=\"token class-name\">MIDI_Interface</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">beginAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Continuously poll all interfaces and route the traffic between them</span>\n  <span class=\"token class-name\">MIDI_Interface</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">updateAll</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Very magical code to me, but it works.</p>\n<h2>Conclusion</h2>\n<p>That’s it! A microcontroller, a couple of common components, and a few lines of code!</p>\n<p>Connecting the Pro Micro to the Norns provides power and sets up the USB connection. The device shows up as “Arduino Micro” in the Norns. Haven’t spotted any issues, but some people talk about problems with SysEx when doing this kind of thing; I haven’t tried that yet since that’s not what I’m using this for.</p>\n<p>I <em>did</em> finally break last night and ordered a Zoom L6 which seems to have a USB-to-TRS interface built in. I wanted something I could use to mix these synths but originally planned to DIY a small mixer; I still might because I want 3.5mm TRS audio I/O, but I’m moving so I don’t have a lot of time to design/order PCBs for that. Plus the L6 has the MIDI…and can record…and has effects..and is pretty small…and it’s not <em>that</em> expensive…</p>\n<p>Either way, this was a fun diversion. Hope this writeup helps. Happy hacking!</p>","frontmatter":{"title":"DIY MIDI Interface: USB to TRS","date":"March 20, 2025","description":"I made a MIDI interface for my Monome Norns."}}},"pageContext":{"slug":"/pro-micro-midi-interface/","previous":{"fields":{"slug":"/eleventy-date/"},"frontmatter":{"title":"11ty Off-By-One Date"}},"next":{"fields":{"slug":"/m8-basic-midi/"},"frontmatter":{"title":"Dirtywave M8 Basic MIDI Implementation"}}}},"staticQueryHashes":["63159454"]}