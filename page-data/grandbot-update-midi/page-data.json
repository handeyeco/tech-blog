{"componentChunkName":"component---src-templates-blog-post-js","path":"/grandbot-update-midi/","result":{"data":{"site":{"siteMetadata":{"title":"Tech Blog"}},"markdownRemark":{"id":"6bb17fd3-38c3-5f33-b23b-8d50f68e6764","excerpt":"Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned, but that doesn’t…","html":"<p><em><strong>Disclaimer:</strong> I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I <strong>think</strong> I learned, but that doesn’t make it the truth.</em></p>\n<p><em>Project originally inspired by the work of <a href=\"https://twitter.com/MohitBhoite\">Mohit Bhoite</a>.</em></p>\n<p><em>Code references the state as of <a href=\"https://github.com/handeyeco/Grandbot/releases/tag/2024-05-01\">this tag</a>.</em></p>\n<hr>\n<p>Just a couple of random thoughts about Grandbot.</p>\n<h2>Custom PCB</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/8299933cf0839392f31cd687a1f09883/e628c/grandbot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEm0lEQVQ4yzVVZ08jZxD2j0kEBjeMe6+4gHvBZdfrXnDBHWMwBsxFyUUXcSdFkRIl9/X+5ZNnN5cPo3nL7Lwz8zwzq2rum8iusyjcF1DdlbD9PMP4lz5aj3ks36qYU1YfRIqAhbIWMHgpI7vJI3+fR2FbwPW2iNw6h8q2AlV5W8aXr1/gGXrhHliQnXuQnHlgaWphrv0Ia10Ni3QES+0IrpYW7rYWjo4BmroWGkkDXUMHx40D73+/Q/alyqwzcA1c8E/8MHXMsPYdivhvgxi9T5HYpNH7NETlVURoFuF5GHbam7tmnLfPYela4Bv74LnxIHIbgSq5SuCkdgLnjRPGlhGGhl4x9AxdKDxm4Bk4kFjFcbWMwsg7C200VTXtDDjn2tQ2wTv2MGIN/CM/VKlVSgk9OA3CM/YqL3oZbXYRQH5iQ3YsiwW5iRXFqQOlmQvRGyuOqqcwtM5h6trgGLqhresZBB1mNhnYBnb46exiFkJofoHILIjha06R/j6F3lMSo4O8z1LnlX37MYHe7opnaYh3IUSGVnQeLqESnqvQNs+QGZuRHFmgaZwhdMsIlyHExk5ERw5qh6LjExdiFHl9NSV4lP5bCbm7KEJjN8r3CdmhALVwTFACSspqQc3ih4mcXJczomhURN88h7bx//5MkVNJz4yiuH5IIjYPobRNQyW+CDgWT5BkzSITN2ujRnxxgdu3HAZPcQz2V+jvYsp6uL+kvlTOuo9xdLdhtJ8STDlIOp2i+xD/L2VD24zKwok0C38sGeEnr8p3YaS2WRTXYaZoR3HpR5oR5NYRxFiv9NRNQqcgbsIwNI3o/NRF6i4LVfY+iwARLpEi19sEMssLpKZeNFn46j6n6OI6hOYuAWGfR/0pjfImggYjFB4SSC1COK1p8Pu3P9A8NKAqPBRIVAekbRTSJoTKyo8iO6WyDqLKtcB0KqsAqkRS/H5fvoug/RDD5JCBuefE6vMI4nOeTAlAJR0kuEcudocdbjL+rGXCD6Uj6Fn0E1Gr8EstnBIQPXRkg8w9jaSDloAYCJCfAH79dsD7PytEl1dQlTgQDE0DAqSKrU+S0rG6cqx0jHPgRPdX1maTQuvnFtzsHp2kVbrEwIf0dR0stC+QYtmFDxfzGIfDrgxj26h0ip2X1q5VcainQ3vPBvFNRGwRRfW1qtxp6VAvO2OU8qPmjgXp1QUCQzu8Qx9R3gtM2c3o7IzOQSPySzxV+lrHD8+YovZ7VPJeR0caUcMHDcq5g12WJPr+aQg+TixVep1m/Wyo3UdQXnghsugSqSCDUF360NgQHFKmvPCjTlAEGSgCJq18kPiNnU5yyyD8/XO4bugwd5fD5TKB600MfZJUYGrtpxRGJHP9KQPxUEV3d8k+jaK8v0bzOYcaH0stI2i9VVB5LnEi2RGfhhGZRgnKfQmf/voNNs5CZ9/EF91w9ExwdvRwDZ0o7zKoMeL2NoL8KqgMU0/XgPkugNkujPVLDKaWAR///ATZl6r72uXiGvlNgcXN8neQQYbjPE2R9YSDdcb2nL9UsD4ItCvSLoMGaz/9OELvQxsF/g5K2xKknYR/AflPIiNg8CCRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Grandbot&#39;s custom PCB\"\n        title=\"Grandbot&#39;s custom PCB\"\n        src=\"/tech-blog/static/8299933cf0839392f31cd687a1f09883/fcda8/grandbot.png\"\n        srcset=\"/tech-blog/static/8299933cf0839392f31cd687a1f09883/12f09/grandbot.png 148w,\n/tech-blog/static/8299933cf0839392f31cd687a1f09883/e4a3f/grandbot.png 295w,\n/tech-blog/static/8299933cf0839392f31cd687a1f09883/fcda8/grandbot.png 590w,\n/tech-blog/static/8299933cf0839392f31cd687a1f09883/e628c/grandbot.png 619w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Grandbot was looking a little sad in the breadboard and I kept accidentally unplugging things. I thought it was time to move him into a permanent home, so I downloaded <a href=\"https://www.kicad.org/\">KiCad</a> and <a href=\"https://www.youtube.com/playlist?list=PLEBQazB0HUyR24ckSZ5u05TZHV9khgA1O\">learned</a> how to make my own PCBs.</p>\n<p>After a couple rounds of mistakes, I ended up in a good place. Gerber files are part of the <a href=\"https://github.com/handeyeco/Grandbot\">source</a> now.</p>\n<h2>MIDI</h2>\n<p>After learning a little about how MIDI works, I thought it would be fun to make Grandbot <a href=\"https://handeyeco.github.io/tech-blog/grandbot-update-arp/\">play synths</a>. In order to do that I needed to have MIDI in and out, so I added an add-on MIDI board.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/2a195/grandbot-midi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEaklEQVQ4y1VV2VYiSRSsn+l+cEEQ2aHYqqCgqGIZFjdkB2VRKWVTQXRaT/c5Y//ATP/C/GJMZDnzMA/3ZJKVeTNuRORFGrwOUF6Ucfp0iuK8iOZLA4P3gT1vbBs4fjzGzccNrJ9T1B5qqD/XUV6WMeVv66eFyrJi7xHjxfoCUm1Vw8dfH4hP4thv7sHZccEz8HK+j+h1FM62E+7eEecxHPXcCI1CcHcP4b8KIDyW4eo44b/04+PPDzupJG5LThKITWI46LiRmQRQtmTsNZ1IWSoc7UNkxwGYEz92mwdQbpNw9bzIjP0wxj5+d0MeRaBcK9CmGiRzZuLL2RfI4wgCAw/CjMQoAC/RmIucPUavfIgx/P0j6DMNwUufvSZfcj+RRicydi52EB/HIZ1uThHnrQrLm73qRBdBmohmL1lcvpKr5wyK0zD06xDmXGtt8tyXg3kbhnYdxubNgHmXxG7DwRxJSL33HupvF3CTO20chDoJI2VHCLFhABrH5DgEVQSRi7lYi4+CvDgID8v39r04aB0gKRK2vrVgrvJ2aXkrZh80rQQMKw6Fc7GmW0lkbiLQp1EY9yoK9wmoRGdMY1BYrkyhHEwoeJTOt+eIkL/gVQjVFzGPIzs3kb7PInGrQOWYW5pQ7jSkZzqMVQH6Mo840URv0+hti6hvK9hnQvVGhTT4PkDluWoj7G1yUIY+5G5kGLcy0QZRsKLIEXGWHOo3REW+8lMZCe4rEak8DFFML76efUXiOgGp89ZG4aGAo/YBQh0HAn0PQkJtKilUD3YPEOQBmXzKV36E7dEHH70ZI6c79T0c0lrN35soLouQ6i91mjaOwl0Cx4s0GoskmqsUmkuFPCZwstJwzug+aWg/ptBhtB5S6D6mUZ6pdkI3/fvr71+42PKldN+7aH1vw6S/CgudSA/t290tJ0uI4fy5/GnmpgN+IvbRi35W4eYLkkdh5Mirhwk9XKuta3wpD2UcDXxIj/yorbLIThPwsPzo0M8IoUDeTjYlRJjMT2uFL702JT7uiVHh1rbMajIULIvhH0NIpWUJ+409quRisihG6zTOWbYoMU1xdpsuUqCixxIvSEOb5YrfbYagqUwbnVKkEnXo/+hDar42obNUnTckaZPUXQb5xxKtk4M8iSIzy7AJRMlzgt9VaLSRPI7BoHVkNpQG0Y2fDJo6Cs3KUJRt3T4klC4+FnmAZK/LqG4qyNPwJj0YYukR8mUsDPvilJWyR9VKozKjkPMUfauh/lqnsZ/PiejzYHVTtRPXnmuorCsoPZXsuTpVkL5LE5mMCi+q0rdiv8HI8RWV6AaF3y9/DNgP2TSzd1noc/1/IdBm7jMI8AU52i5E2N4UItJ4UFwqLtDnfEVEHRhS7XsdJ+sTSNVl1W6wgUGAwuzbj1yEi4q62Eg1CmNSLOFHgx1GNGBn+3OPo+Wwm60I0WBL8xKk/msflUUFv/FHYVawW78d9ryEMXm5fTnD/TfGWx3Vh+N/v33u+++MACb+Av4BQJYiwMl8ikwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Grandbot&#39;s custom MIDI PCB\"\n        title=\"Grandbot&#39;s custom MIDI PCB\"\n        src=\"/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/fcda8/grandbot-midi.png\"\n        srcset=\"/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/12f09/grandbot-midi.png 148w,\n/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/e4a3f/grandbot-midi.png 295w,\n/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/fcda8/grandbot-midi.png 590w,\n/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/2a195/grandbot-midi.png 620w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>One inspiration was <a href=\"https://www.pjrc.com/teensy/td_libs_MIDI.html\">PJRC’s design for Teensys</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/82158/teensy-midi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.43243243243243%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA0ElEQVQY01WQyQ6DMAxE8/9fxwEhgcQiAWJJgBL2re1TfGnnENmTsWcS9Xb4/OA8z6ZphmGw1vZ9XxSF1vrlsG0b/Lquy7I8z6NkgIoTtm3bcRzzPJ+mad/3eZ7jOIaktQ7ixDpuVdd12gG3qqrqumZA1NjiICkoruvCnBpZkiTUKoqiIAhQlGWJ+r5vdhtjULObFJ7nsQsP44AtYt/30SsuwjDEjZX0JGeGdx7HweNxE08BDMNcZVlGNEWPVF4OC4WaCPyN/AXM5x+kS9OU2F/84lQecqU8tAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Teensy&#39;s MIDI schematic\"\n        title=\"Teensy&#39;s MIDI schematic\"\n        src=\"/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/fcda8/teensy-midi.png\"\n        srcset=\"/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/12f09/teensy-midi.png 148w,\n/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/e4a3f/teensy-midi.png 295w,\n/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/fcda8/teensy-midi.png 590w,\n/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/82158/teensy-midi.png 696w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The other was <a href=\"https://www.notesandvolts.com/2015/02/midi-and-arduino-build-midi-input.html\">Notes and Volts design for Arduino</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/7fee5/n-and-v-midi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVQoz42SV2/CQBCE/f//Cq8gjBAIkE0xvUYU03szosmm5hN2LsZRouyDdd7dmZudPenpisfjwXc2m8Xj8Xq93u/32+12s9kcjUaiervdRL8kYMT9fufc7XYDgUA+n/f7/eVyORaLFYtF8lRXqxV5u80B28jn72FXN5sNQlqtlsg4N0O2Xq+r1SpfwzBKpVKn09F1HfGca7VapVIZDoeLxUJRlMPh8A0ej8eJRIIJVVVlPLiROplMYIELAA2yLMN1PB7hEkql7XarKGomk5lOp5ZlNRqNXC6HSZqm9Xo9G0MJC4HBiKKPVyBWMk0znU7TBwv/+/2eAjqXyyXchUIhGAz6fD7YUYQu2lgHVWx3ZHMhKYjn8znc4XB4MBjQh72Mk0wmQ6EQjqCCpNcw8S+2FYlEotEodIwN4Hw+YwE3Z7PZN/DPVSGJcbBAZACjnOnAv+357w3bj+d0OnGnW7MDpnZ5hfUV1+vVLUc8291u5wXjMI+OTWC79gpGdTfZh1QqhbVe8D8DgR5rPgHwRAuWrmbXLAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Notes and Volts MIDI schematic\"\n        title=\"Notes and Volts MIDI schematic\"\n        src=\"/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/fcda8/n-and-v-midi.png\"\n        srcset=\"/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/12f09/n-and-v-midi.png 148w,\n/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/e4a3f/n-and-v-midi.png 295w,\n/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/fcda8/n-and-v-midi.png 590w,\n/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/7fee5/n-and-v-midi.png 781w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Some thoughts on the design:</p>\n<ul>\n<li>MIDI In is buffered and sent to MIDI Thru</li>\n<li>MIDI In is also sent to the RX pin on the Nano</li>\n<li>The Nano’s TX pin is sent to the MIDI Out</li>\n<li>Using MIDI TRS to save space</li>\n<li>The 6N138 optocoupler is per the MIDI spec to isolate the MIDI In circuit from the outside world</li>\n<li>The 74HC14 inverters are also recommended by the spec, I believe to tighten up the HIGH/LOW signals to prevent noise in the signal</li>\n<li>The jumper is to bypass the 74HC14 is not using MIDI Thru (making the 74HC14 optional)</li>\n<li>\n<p>The switch is because the Nano shares it’s serial TX/RX lines with it’s USB connection</p>\n<ul>\n<li>Both USB and MIDI are serial</li>\n<li>The Nano only has one serial connection</li>\n<li>Programming Grandbot while MIDI was active caused connection issues</li>\n<li>The switch breaks the MIDI connection when set to PROG</li>\n<li>This is also true for <a href=\"https://www.sparkfun.com/products/12898\">Sparkfun’s MIDI Shield</a></li>\n</ul>\n</li>\n</ul>\n<p>Gerber files for the MIDI board are also part of the <a href=\"https://github.com/handeyeco/Grandbot\">source</a> now.</p>\n<h2>Arduino Nano vs Arduino Nano Every</h2>\n<p>I built this whole project using a cheap Arduino Nano clone. It was never really a problem until I got to the Arp/MIDI at which point I couldn’t use <code class=\"language-text\">Serial.print</code> anymore because the serial connection was being used by MIDI. Despite not having a way to debug, <strong><em>I still continued to use the Nano</em></strong> because I am dumb. Talk about painful troubleshooting!</p>\n<p>Turns out there’s a thing called an Arduino Nano Every that works as a drop-in replacement for the Nano, but with additional serial ports and a ton more memory. I only looked into it at the end of the Arp feature when I surpassed the Nano’s memory limits. Ironically I had been using the Nano Every footprint in KiCad the whole time - I just thought it meant “every Nano.” 🤦</p>\n<p>My understanding is the Nano Every uses different TX/RX connections for USB and pins 1/2 (the pins I had been using for MIDI). That should mean:</p>\n<ul>\n<li>I can <code class=\"language-text\">Serial.print</code> while debugging MIDI</li>\n<li>I don’t need the switch on the MIDI board</li>\n</ul>\n<p>I haven’t confirmed yet though.</p>\n<p>Anyway, the positives:</p>\n<ul>\n<li>Official Nano Every is cheaper than the official Nano</li>\n<li>More memory means more steps in the arpeggiator</li>\n<li>Separate serial lines for MIDI and debugging</li>\n</ul>\n<p>The negatives:</p>\n<ul>\n<li>Nano clone is cheaper than official Nano Every</li>\n<li>If you’re not using the MIDI board, a Nano clone would be fine</li>\n</ul>\n<p>So right now I’m trying to continue support for both Nano and Nano Every.</p>","frontmatter":{"title":"Grandbot: MIDI & Misc","date":"May 01, 2024","description":"Random updates about Grandbot (new MIDI board)."}}},"pageContext":{"slug":"/grandbot-update-midi/","previous":{"fields":{"slug":"/inkscape-notes/"},"frontmatter":{"title":"Inkscape Tips for Technical Drawing"}},"next":{"fields":{"slug":"/grandbot-update-arp/"},"frontmatter":{"title":"Grandbot: Arp"}}}},"staticQueryHashes":["63159454"]}