{"componentChunkName":"component---src-templates-blog-post-js","path":"/grandbot-update-midi/","result":{"data":{"site":{"siteMetadata":{"title":"Tech Blog"}},"markdownRemark":{"id":"90813b97-414e-531d-99fb-74de2d1a77df","excerpt":"Disclaimer: I don‚Äôt know what I‚Äôm talking about. I‚Äôm a JavaScript dev who‚Äôs just learning this stuff too. I‚Äôm sharing what I think I learned, but that doesn‚Äôt‚Ä¶","html":"<p><em><strong>Disclaimer:</strong> I don‚Äôt know what I‚Äôm talking about. I‚Äôm a JavaScript dev who‚Äôs just learning this stuff too. I‚Äôm sharing what I <strong>think</strong> I learned, but that doesn‚Äôt make it the truth.</em></p>\n<p><em>Project originally inspired by the work of <a href=\"https://twitter.com/MohitBhoite\">Mohit Bhoite</a>.</em></p>\n<p><em>Code references the state as of <a href=\"https://github.com/handeyeco/Grandbot/releases/tag/2024-05-01\">this tag</a>.</em></p>\n<hr>\n<p>Just a couple of random thoughts about Grandbot.</p>\n<h2>Custom PCB</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/8299933cf0839392f31cd687a1f09883/e628c/grandbot.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAEmUlEQVQ4yy1V13LiWBDVz8wM2ESTo0QQGJNkghHCCmRMMMZDNBinsWdnw2zVPEztVm3VVO3T7leebYl96Lr3qu/tPt19usV0n7o4X5yjdidC3jew/TbH7NcxunsRy1cV81cFq88aiYrF22E/eZFxsa1B3Iqo7+qGlBYlNLYSmNqmhm8/viE2iSM08KD8kUXxloWvZYVXeQe/ZoJP+wCf8h6RthXRjhWhrgMWzQqLaoGtaYN/4MfXv76isWuAqawrYEcsYtcxuLse+AZBuhAEdx3H4OsY+Y2A9s89SIQqMUshNuURHIbh7Xng6rjgoTfchENsHEP6Jg1GWAowy2aEhiHjgqNpN9YIPRL3VXCjKArLHIqrPFwtB7yks1we0T0H3TuBm87shDXQcgSMKa1KxiE+jSM6jhoeI+RRuI2jPPFCGOviwTlJZRrAxU0QmaEX76Vj2FsncHW9CJJTq2ZHeEgGy5uykQOOvKRuk+BvU+BnCQyfyhg9l9B/KKJ/n8f4uYwhnUcvZfT2BTS3WXR2WVw9FiGvePAjL1qbDBj1SYGtfYLC2A2BEFmaJ0hcc6guUshNw8heh5C7Pqz5acQQfV+csRBIhq8iLtYZ8JMwpE0OjPaiwXRpoqJwVAgO5kszEtMEAsMojlQ7VdN5kKYTx6oDx9pBLCRmxYYYFap6V8ApRVddF8A0dYPyEbKUs9MpC1PDTEoe008VDO4zGDzk0N/Ruj/D8CFLK8lDHr3dGTqbJDr3OWgbHmzXiv5WD/lZgb3jhngbRPXGhw+qE9wwCInycr4tobZK4WxCuo8cSncCKstTZMd+CDcRiIRM2aTgaDkhU+oKKwFMdVslbsWJ+QJBz0OYpyl3LFpUCGlfQZMKUF0koO1yaDxUoOwFiOREJTSNbZ46JGWk6fs/f6D31gUj7mrwXwWh3mXQJOiXyzihZdFYJSHTXlknjW/ymof6v76xTlOFM7h9LcPTD+L6tz7kR+LsJAam9amFyDhiGI0QdVwdD96JH4hjVASF2kuzEYJjg2f6N2fbRXubcT5puxGljvrx7yu+/73G6TwPRn6UYafu0FtP52OQDJvqJqMTAn0/Ol/ayFOXNN80g/g21QYHGdPFplK/9wOUEp4kTjzOHAw6204icxIBMugnI2bJZLSgr+eD9qbibH4G+ZOM4CAAq2KBXUerGyanboqoOOeRHFOEeuspVB0jZLocoKHgIGIfUYhOCs9KPNRDtBASOz3Wz1YydEx6m85FSokOQh8g8RlRh1qQKa9L8F35cblOHYpB40umgkjLBOq0V1dxSPMYaqRTVgk05hwkCk9ecFSwlNHH5/MkkkMPQlfRw/hKU+zi+gxX+zzkZwndBwETInJzfw7lRUKPyNvbnhJtamg9VojIKQozhTbp6o91sMTbNNWAn6b0AXtBw/F3hCm5kYELwTGL8JUX0Z6DchKCeF8iJDw6d2lUFkmER2FDd7OLY3bPY/OShbttx09//oJLfcD2nnvEeBGlZQn5eZE8F1BYCLQ/yOhJws1TA7NH+iW80KhfVZD/WIC2r2P6ZYjBawdlGoG6DXkn4z92OCJ8lu1GSwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Grandbot&#39;s custom PCB\"\n        title=\"Grandbot&#39;s custom PCB\"\n        src=\"/tech-blog/static/8299933cf0839392f31cd687a1f09883/fcda8/grandbot.png\"\n        srcset=\"/tech-blog/static/8299933cf0839392f31cd687a1f09883/12f09/grandbot.png 148w,\n/tech-blog/static/8299933cf0839392f31cd687a1f09883/e4a3f/grandbot.png 295w,\n/tech-blog/static/8299933cf0839392f31cd687a1f09883/fcda8/grandbot.png 590w,\n/tech-blog/static/8299933cf0839392f31cd687a1f09883/e628c/grandbot.png 619w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Grandbot was looking a little sad in the breadboard and I kept accidentally unplugging things. I thought it was time to move him into a permanent home, so I downloaded <a href=\"https://www.kicad.org/\">KiCad</a> and <a href=\"https://www.youtube.com/playlist?list=PLEBQazB0HUyR24ckSZ5u05TZHV9khgA1O\">learned</a> how to make my own PCBs.</p>\n<p>After a couple rounds of mistakes, I ended up in a good place. Gerber files are part of the <a href=\"https://github.com/handeyeco/Grandbot\">source</a> now.</p>\n<h2>MIDI</h2>\n<p>After learning a little about how MIDI works, I thought it would be fun to make Grandbot <a href=\"https://handeyeco.github.io/tech-blog/grandbot-update-arp/\">play synths</a>. In order to do that I needed to have MIDI in and out, so I added an add-on MIDI board.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/2a195/grandbot-midi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 99.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsSAAALEgHS3X78AAAEfUlEQVQ4yz1V2VbjRhDVz8w8MGDjfZEteZMty5blVUCMF7yA8QJe8D7AAMNkkgPJByTnzB/kF2+uNCd5qNPt6lJ31b23ysLgZYDquoL6fR3lVRntpzYGvw7+35/tzzB9n2Lx5xyn+1M0H5uobWuY/zGjbwFza9oxtU0NzfsmBMvx/vc7EjcJHLUPcdx1wXcV4P4I8o3M38fwXHoh38bh7XshjkR4em6EhmFEJxJcjA8w/u2vN/tSobqpInWTQmwSg7PrgToOoTqXcNg+RnqmwNnxIEtfYRLEp7YTyWkS7r4f6igIfRyAg+fRURTKrYLsLAvBWBr4UP8AaRxF8MqHCC05DsPfd6OwznH1QLoOIDYMIMBMtTsV4UEAMn3ywA/xOshkJBw0DxAfxyHUH35BnK8mWd7yOcfsokiPg1g+aRg8VzF7zKI8iyB7I2JF38WDwbg8CtMIMhMRD686jEUSn1oOVpqE0P/WR/O1CQ+xUCdhKJMI0raJiA9D9InMWKSfxsyT44jti4/CyFiVXPqJoR/OC8JhXdj52oGxM+BjacY8hhSDCvME9Hmce9H25eZJaLcR5KYS9DsFxUXCflifyUhOopBIkOO/CxtfGogSv/B1GOZTnfs4tFUBmTsNiakChWt+U0BqoSKzzEHfFpHbGIjzY3maRv+xiOaTiSNeqNymIFx9v4L5eAJ/z8PDPFLDIPJWJjSFEBTnMvLM2M6QphOv4kxCgiSV7xKQRxGEKJuP9Y9ITBIQuq9dFPcleDtOiF0HQpc+iBbbZDLENdxzcvWzrBDZDiJir2S850VsFMJB4xCujgut5xZKmxKE5lMD0k2cuMRxss6gtU6ivVXQ3qSIYwJnGxXnWxW9zyo6+wy6+zQudml0dxlUVwo+8UJ3x40f//xA66kFofeth873LgpLFUXqztt1I0i9eTrH7J4Yzh+rUCgrV9thZxpkBVbmXp5LQ8JAXH1sCB/95r0Jobav2a2WofZONhqy0wR8BFgilvJQRJG4nd2XEeUlAUorQjGH+bGfEMkUdPtLDRdbDWmSN3y7hlDZVnDUOiRLLmhTGaOHDM5ZtlWieiuz3Y5tCPost0kYOjvF/t2hlUhKlTKqk6TS1sDlb1cQ2i9t5FiqttTYpymkF1nqsgRtrUOayMgus5SSzEGR4LkClZlI7Hud0pHIanOtYvxZZ5fEkJlnf+rQ+qi4K6JEttUFwb6vwHwwYfDVwrYAkaVHKA+dj+T4cHqetldlnkFtmSaRaepWRYME2xcae35I8VqXWBefUJe1hxrKn8v2XpmlkOFDFmaW33w0Ga9T5AY1mkSFakjxfPA7Sz7ZnyDLVPOrPPLrPHKrnG3lfZkwZBEmkw7qLMoyU8zIqqC0sypR7bg8sw4xRltoJO+MLHMoWgNWHIgk5ojzz2k3urvngouDVL2N2j17Si3qnDDWQD2mZKwYx4UDHs4AN33vHLCVVQXC5fOlPWmtkV9cEsdlyTZrX1yVMH5uYMoev3uhvZ7D3J3+jFv9jDPuDHs1Nyb/Ahr4F7XyIwrqCgVuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Grandbot&#39;s custom MIDI PCB\"\n        title=\"Grandbot&#39;s custom MIDI PCB\"\n        src=\"/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/fcda8/grandbot-midi.png\"\n        srcset=\"/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/12f09/grandbot-midi.png 148w,\n/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/e4a3f/grandbot-midi.png 295w,\n/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/fcda8/grandbot-midi.png 590w,\n/tech-blog/static/d1e0a7070715b0fec691c075e0a23bd9/2a195/grandbot-midi.png 620w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>One inspiration was <a href=\"https://www.pjrc.com/teensy/td_libs_MIDI.html\">PJRC‚Äôs design for Teensys</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/82158/teensy-midi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.43243243243243%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxUlEQVQY02WQ2wrDIBBE/f+PC+QxhLyE3CTaXCwxxmh7UAqlnYdl3Z2Z3VW8/uC9fyQYY7Zt01oTnwnOuXVdj+MgiTGKHxk8NG3bEmEQq6oax5E6dvu+hxBgKqWstcIkYM8bEjIY0zQRYTNknuc87b5vElxgdl0HQdR1XZYl7GEYYF/XxT60YZ/niS9dKaVOwIgu5KIo0AumNU2DJY2+71mV5UmymGeebz9gZyKEZVkEbcT5Zr4k34wRdSrMyYJvcDYfwdpvsb1URUw7sZwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Teensy&#39;s MIDI schematic\"\n        title=\"Teensy&#39;s MIDI schematic\"\n        src=\"/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/fcda8/teensy-midi.png\"\n        srcset=\"/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/12f09/teensy-midi.png 148w,\n/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/e4a3f/teensy-midi.png 295w,\n/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/fcda8/teensy-midi.png 590w,\n/tech-blog/static/9b3bb532ad21aacc5ea6c9a9277f5b34/82158/teensy-midi.png 696w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The other was <a href=\"https://www.notesandvolts.com/2015/02/midi-and-arduino-build-midi-input.html\">Notes and Volts design for Arduino</a>:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/7fee5/n-and-v-midi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 69.5945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsSAAALEgHS3X78AAABiUlEQVQoz32S64/BQBTF+///K+KbBJtIEEpFvFpBvdf73bKRNig/HVuTZu35MJ25Pffcc++McpfgeR7rbrcrl8u9Xm+9Xn/7WK1WwV8Ziny43W6spEUiEVVVWTVNSyQSxWJRECzLqlargvZK9nzcP0P8PRwOpmm2Wq0googPq23b3W4Xxul0arfb/X5/OBxCNQyDY6fTmUwm+McFBIqT8qxMqFAowM5kMuPxGPlUKjWbzRCi7el0iko8HidOGuO4Xq8v25Zl5/NqLpefz+eO41CkUqlQp1QqIYcKcpvNJpvNNhqN5XLJRIgjRHHlfD5TFsZ2u8XJfr9vNpu4XSwWaGMyFotFo1Emh+JoNEIIMnYul8vTNqF6vQ4bq/hENZlMckQX54PBIJ1OY1vXdfaM5j0w+Z6A6AdjXz4oghymjscjQhSkqeB2lD9vH4kfH3KkVqtRGd33wO7/wvsFQoyGhuViSogUgvxIuFG54VeyuD3eHdqaD3qTSWLDg+Wdh5M/FQzBdd3gVQs8AEsVC9GleZxoAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Notes and Volts MIDI schematic\"\n        title=\"Notes and Volts MIDI schematic\"\n        src=\"/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/fcda8/n-and-v-midi.png\"\n        srcset=\"/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/12f09/n-and-v-midi.png 148w,\n/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/e4a3f/n-and-v-midi.png 295w,\n/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/fcda8/n-and-v-midi.png 590w,\n/tech-blog/static/34dd6c8dd199c93388d669fc71f17e01/7fee5/n-and-v-midi.png 781w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Some thoughts on the design:</p>\n<ul>\n<li>MIDI In is buffered and sent to MIDI Thru</li>\n<li>MIDI In is also sent to the RX pin on the Nano</li>\n<li>The Nano‚Äôs TX pin is sent to the MIDI Out</li>\n<li>Using MIDI TRS to save space</li>\n<li>The 6N138 optocoupler is per the MIDI spec to isolate the MIDI In circuit from the outside world</li>\n<li>The 74HC14 inverters are also recommended by the spec, I believe to tighten up the HIGH/LOW signals to prevent noise in the signal</li>\n<li>The jumper is to bypass the 74HC14 is not using MIDI Thru (making the 74HC14 optional)</li>\n<li>\n<p>The switch is because the Nano shares it‚Äôs serial TX/RX lines with it‚Äôs USB connection</p>\n<ul>\n<li>Both USB and MIDI are serial</li>\n<li>The Nano only has one serial connection</li>\n<li>Programming Grandbot while MIDI was active caused connection issues</li>\n<li>The switch breaks the MIDI connection when set to PROG</li>\n<li>This is also true for <a href=\"https://www.sparkfun.com/products/12898\">Sparkfun‚Äôs MIDI Shield</a></li>\n</ul>\n</li>\n</ul>\n<p>Gerber files for the MIDI board are also part of the <a href=\"https://github.com/handeyeco/Grandbot\">source</a> now.</p>\n<h2>Arduino Nano vs Arduino Nano Every</h2>\n<p>I built this whole project using a cheap Arduino Nano clone. It was never really a problem until I got to the Arp/MIDI at which point I couldn‚Äôt use <code class=\"language-text\">Serial.print</code> anymore because the serial connection was being used by MIDI. Despite not having a way to debug, <strong><em>I still continued to use the Nano</em></strong> because I am dumb. Talk about painful troubleshooting!</p>\n<p>Turns out there‚Äôs a thing called an Arduino Nano Every that works as a drop-in replacement for the Nano, but with additional serial ports and a ton more memory. I only looked into it at the end of the Arp feature when I surpassed the Nano‚Äôs memory limits. Ironically I had been using the Nano Every footprint in KiCad the whole time - I just thought it meant ‚Äúevery Nano.‚Äù ü§¶</p>\n<p>My understanding is the Nano Every uses different TX/RX connections for USB and pins 1/2 (the pins I had been using for MIDI). That should mean:</p>\n<ul>\n<li>I can <code class=\"language-text\">Serial.print</code> while debugging MIDI</li>\n<li>I don‚Äôt need the switch on the MIDI board</li>\n</ul>\n<p>I haven‚Äôt confirmed yet though.</p>\n<p>Anyway, the positives:</p>\n<ul>\n<li>Official Nano Every is cheaper than the official Nano</li>\n<li>More memory means more steps in the arpeggiator</li>\n<li>Separate serial lines for MIDI and debugging</li>\n</ul>\n<p>The negatives:</p>\n<ul>\n<li>Nano clone is cheaper than official Nano Every</li>\n<li>If you‚Äôre not using the MIDI board, a Nano clone would be fine</li>\n</ul>\n<p>So right now I‚Äôm trying to continue support for both Nano and Nano Every.</p>","frontmatter":{"title":"Grandbot: MIDI & Misc","date":"May 01, 2024","description":"Random updates about Grandbot (new MIDI board)."}}},"pageContext":{"slug":"/grandbot-update-midi/","previous":{"fields":{"slug":"/inkscape-notes/"},"frontmatter":{"title":"Inkscape Tips for Technical Drawing"}},"next":{"fields":{"slug":"/grandbot-update-arp/"},"frontmatter":{"title":"Grandbot: Arp"}}}}}