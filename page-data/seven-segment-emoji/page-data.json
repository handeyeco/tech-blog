{"componentChunkName":"component---src-templates-blog-post-js","path":"/seven-segment-emoji/","result":{"data":{"site":{"siteMetadata":{"title":"Tech Blog"}},"markdownRemark":{"id":"b509bba9-5afa-57f6-a078-d1da7a44e512","excerpt":"Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned, but that doesn’t…","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/e1596/skeptical.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAUABQDASIAAhEBAxEB/8QAGAABAAMBAAAAAAAAAAAAAAAAAAECAwb/xAAXAQADAQAAAAAAAAAAAAAAAAABAgMA/9oADAMBAAIQAxAAAAHn9K2DQhl0AvmDH//EABcQAAMBAAAAAAAAAAAAAAAAAAABESH/2gAIAQEAAQUCLjITBYNuH//EABgRAAIDAAAAAAAAAAAAAAAAAAABEBFB/9oACAEDAQE/AUmUZH//xAAUEQEAAAAAAAAAAAAAAAAAAAAg/9oACAECAQE/AR//xAAXEAADAQAAAAAAAAAAAAAAAAAAEBEh/9oACAEBAAY/AiOrH//EABsQAQADAQADAAAAAAAAAAAAAAEAETEQIUGB/9oACAEBAAE/IZksGVvxkLT5OXQpGe4d5//aAAwDAQACAAMAAAAQtB9B/8QAFxEAAwEAAAAAAAAAAAAAAAAAARARIf/aAAgBAwEBPxCLEJmV/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQAQEf/aAAgBAgEBPxByF//EABoQAQACAwEAAAAAAAAAAAAAAAEAESExQVH/2gAIAQEAAT8Ql0gsON5idynAtsbQt8I1CGzV8jvJEpB0aiqLAmlxfs3tZ//Z'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Skeptical emoji on 4-digit, 7-segment display\"\n        title=\"Skeptical emoji on 4-digit, 7-segment display\"\n        src=\"/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/1c72d/skeptical.jpg\"\n        srcset=\"/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/a80bd/skeptical.jpg 148w,\n/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/1c91a/skeptical.jpg 295w,\n/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/1c72d/skeptical.jpg 590w,\n/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/a8a14/skeptical.jpg 885w,\n/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/fbd2c/skeptical.jpg 1180w,\n/tech-blog/static/b886b3b169ef8c3a019d28ce6c78f6e3/e1596/skeptical.jpg 2048w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p><em><strong>Disclaimer:</strong> I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I <strong>think</strong> I learned, but that doesn’t make it the truth.</em></p>\n<p>While at Eyeo Festival in 2019, I had the chance to hear <a href=\"https://twitter.com/MohitBhoite\">Mohit Bhoite</a> <a href=\"https://vimeo.com/354276626\">talk</a> about the beautiful freeform, electronic sculptures he creates. With just a few commonly found components and a microcontroller, he’s able to craft whimsical and charming creations that really resonated with me. The project that spoke to me the most was his <a href=\"https://twitter.com/MohitBhoite/status/1241752124087660546\">Chintoo</a> project, and I started to think “hey, I could make that! How hard could 4-digit, 7-segment displays be?”</p>\n<p>Apparently they’re pretty tricky. While this isn’t meant to explain 4-digit, 7-segment displays (that’s been covered extensively), hopefully this will augment existing resources that gloss over some things that tripped me up. I’m going to show off what I built and talk a little about what I learned afterwards.</p>\n<h2>The Build</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/2171b96c8cbbedde1c677facae80003a/e1596/schematic.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEEAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHouNmxMH//xAAYEAEAAwEAAAAAAAAAAAAAAAAAARESAv/aAAgBAQABBQK1plHTTT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAZEAADAAMAAAAAAAAAAAAAAAAAASEQMUH/2gAIAQEAAT8hT8HGymFsOj//2gAMAwEAAgADAAAAEGAP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAQEAAgMAAAAAAAAAAAAAAREAIUExcZH/2gAIAQEAAT8Qu5MlPeuFUU7xDBfudLkM684jk7//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Schematic of the build\"\n        title=\"Schematic of the build\"\n        src=\"/tech-blog/static/2171b96c8cbbedde1c677facae80003a/1c72d/schematic.jpg\"\n        srcset=\"/tech-blog/static/2171b96c8cbbedde1c677facae80003a/a80bd/schematic.jpg 148w,\n/tech-blog/static/2171b96c8cbbedde1c677facae80003a/1c91a/schematic.jpg 295w,\n/tech-blog/static/2171b96c8cbbedde1c677facae80003a/1c72d/schematic.jpg 590w,\n/tech-blog/static/2171b96c8cbbedde1c677facae80003a/a8a14/schematic.jpg 885w,\n/tech-blog/static/2171b96c8cbbedde1c677facae80003a/fbd2c/schematic.jpg 1180w,\n/tech-blog/static/2171b96c8cbbedde1c677facae80003a/e1596/schematic.jpg 2048w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<figcaption>Schematic of the build</figcaption>\n<h3>Components</h3>\n<p>This is what I used. I’m sure you can swap out any of these parts, but this is what worked for me. The schematic I posted is written for simplicity, you’ll need to read the datasheets for the components you use to determine which pin is which.</p>\n<ul>\n<li>Arduino Uno R3</li>\n<li>3461AS common cathode 4-digit, 7-segment (4D7S) display</li>\n<li>74HC595 shift register</li>\n<li>x4 2N3904 NPN transistors</li>\n<li>x8 220 ohm resistors (R1-R8)</li>\n<li>x4 1k ohm resistors (R9-R12)</li>\n</ul>\n<h4>Component notes</h4>\n<ul>\n<li>\n<p>Display</p>\n<ul>\n<li>The 4D7S display I’m using actually has 8 segments per digit (with the addition of the dot).</li>\n<li>Multiplexing is required for 4D7S displays or otherwise they would need a minimum of 28 pins. Multiplexing just means we’re lighting one digit at a time so fast that it seems like they’re all lit at once.</li>\n</ul>\n</li>\n<li>\n<p>Shift register</p>\n<ul>\n<li>I have no doubt this can be done without the shift register (using Arduino outputs to drive the segment state), but it’d use more pins and the code would be a little more verbose.</li>\n<li>The shift register takes serial data representing which pins on the chip should be on/off. So when I use Arduino’s builtin <code class=\"language-text\">shiftOut</code> function with <code class=\"language-text\">shiftOut(dataPin, clockPin, LSBFIRST, B11000000)</code>, A and B will be HIGH while C thru H will be LOW. <code class=\"language-text\">LSBFIRST</code> seems to specify order. <code class=\"language-text\">shiftOut(dataPin, clockPin, MSBFIRST, B00000011)</code> would be the same.</li>\n<li><code class=\"language-text\">SRCLR</code> clears the shift register. I couldn’t get <code class=\"language-text\">SRCLR</code> working and it turns out I didn’t need it anyway. If unused, it needs to be connected to <code class=\"language-text\">Vcc</code>; otherwise it’ll be floating and you’ll see irregular flickering.</li>\n<li>I don’t know what <code class=\"language-text\">OE</code> is, but all the examples connected it to <code class=\"language-text\">GND</code> so that’s what I did too.</li>\n<li>The unused <code class=\"language-text\">Qh</code> is for chaining shift registers, which I didn’t need to do.</li>\n</ul>\n</li>\n<li>\n<p>Other components</p>\n<ul>\n<li>A lot of examples omit the current limiting resistors, but it seems like you’d run the risk of blowing out an LED, transistor, or an Arduino I/O pin. <a href=\"https://www.onetransistor.eu/2018/12/wiring-of-4digit-7segment-display.html\">This</a> article was really helpful.</li>\n<li>The transistors amplify current so that there’s enough to evenly light up the digits. For instance if there’s not an optimal amount of current and one digit has one segment lit while another digit has every segments lit, the digit with one segment lit will be brighter.</li>\n<li>I’m not sure if I picked the best resistor values, that’s why I didn’t write them in the schematic. I know I should be able to do the math, but I couldn’t figure out how to get all of the values I needed for the formula.</li>\n</ul>\n</li>\n</ul>\n<h3>Code</h3>\n<div class=\"gatsby-highlight\" data-language=\"arduino\"><pre class=\"language-arduino\"><code class=\"language-arduino\"><span class=\"token comment\">// Digit selection to 4D7S</span>\n<span class=\"token keyword\">int</span> digit1 <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> digit2 <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> digit3 <span class=\"token operator\">=</span> <span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> digit4 <span class=\"token operator\">=</span> <span class=\"token number\">5</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Serial to shift register</span>\n<span class=\"token keyword\">int</span> clockPin <span class=\"token operator\">=</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> latchPin <span class=\"token operator\">=</span> <span class=\"token number\">11</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> dataPin <span class=\"token operator\">=</span> <span class=\"token number\">12</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token keyword\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Initialize pins out outputs</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>digit1<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>digit2<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>digit3<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>digit4<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>clockPin<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>latchPin<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>dataPin<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token function\">display</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> digit<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> segmentData<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Disable all digits</span>\n  <span class=\"token function\">digitalWrite</span><span class=\"token punctuation\">(</span>digit1<span class=\"token punctuation\">,</span> <span class=\"token constant\">LOW</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">digitalWrite</span><span class=\"token punctuation\">(</span>digit2<span class=\"token punctuation\">,</span> <span class=\"token constant\">LOW</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">digitalWrite</span><span class=\"token punctuation\">(</span>digit3<span class=\"token punctuation\">,</span> <span class=\"token constant\">LOW</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">digitalWrite</span><span class=\"token punctuation\">(</span>digit4<span class=\"token punctuation\">,</span> <span class=\"token constant\">LOW</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n  <span class=\"token comment\">// Set segment data with shift register</span>\n  <span class=\"token function\">digitalWrite</span><span class=\"token punctuation\">(</span>latchPin<span class=\"token punctuation\">,</span> <span class=\"token constant\">LOW</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">shiftOut</span><span class=\"token punctuation\">(</span>dataPin<span class=\"token punctuation\">,</span> clockPin<span class=\"token punctuation\">,</span> LSBFIRST<span class=\"token punctuation\">,</span> segmentData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">digitalWrite</span><span class=\"token punctuation\">(</span>latchPin<span class=\"token punctuation\">,</span> <span class=\"token constant\">HIGH</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Enable specified digit</span>\n  <span class=\"token function\">digitalWrite</span><span class=\"token punctuation\">(</span>digit<span class=\"token punctuation\">,</span> <span class=\"token constant\">HIGH</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Wait a bit for increased brightness</span>\n  <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Using binary to represent each segment</span>\n  <span class=\"token comment\">// (1 = on, 0 = off)</span>\n  <span class=\"token comment\">// should draw: O . o</span>\n  <span class=\"token function\">display</span><span class=\"token punctuation\">(</span>digit1<span class=\"token punctuation\">,</span> B11111100<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// big circle</span>\n  <span class=\"token function\">display</span><span class=\"token punctuation\">(</span>digit2<span class=\"token punctuation\">,</span> B00000001<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// just the dot</span>\n  <span class=\"token function\">display</span><span class=\"token punctuation\">(</span>digit3<span class=\"token punctuation\">,</span> B00000000<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// blank</span>\n  <span class=\"token function\">display</span><span class=\"token punctuation\">(</span>digit4<span class=\"token punctuation\">,</span> B00111010<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// little circle</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Code notes</h4>\n<p>We’re multiplexing, so the order of the code is important. I struggled for weeks trying to figure out why digits had a “ghosting” effect - meaning that they showed a dim residue of the shape from the previous digit. So in pseudocode the solution is:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- Initialize variables to help legibility\n- Set the pins we&#39;re using as outputs\n- Loop:\n  - Turn all digits off\n  - Load the next digit segment data into the shift register\n  - Turn the next digit on\n  - Delay for a few microseconds\n  - Repeat</code></pre></div>\n<p>The binary is just a way of keeping track of what segment is on and which is off. You can use decimal or hexadecimal, but binary made the most sense to me. With <code class=\"language-text\">LSBFIRST</code> the order is: A-B-C-D-E-F-G-DP. So a big circle is <code class=\"language-text\">B11111100</code> or A1-B1-C1-D1-E1-F1-G0-DP0.</p>\n<p>The delay is important and is a fine balance. Too small of a delay and the light won’t be on long enough for it to register as being bright. Too large of a delay and you’ll see the multiplexing in action. In fact it’s a good experiment to tinker with it, just remember to turn it back.</p>\n<h2>Conclusion</h2>\n<p>While frustrating at times, this was a very enlightening project. In the end, I realized that I would need to separate multiplexing logic from the logic that determines the facial expression if I hope to have the expression respond to things. It seems there are chips specifically designed for multiplexing and maintaining current display state - the Max7219 seems promising in this regard. Using a chip like that would allow the microcontroller to do more complex processes without interrupting the multiplexing.</p>\n<p>Thanks for everyone who helped me! It actually took a number of people and just about every article on 4D7S with Arduino to get it through my thick skull. If I misspoke or just missed something, let me know!</p>","frontmatter":{"title":"4 Digit, 7 Segment Emoji","date":"April 13, 2020","description":"Using an Arduino and a 4 digit, 7 segment display to make emojis."}}},"pageContext":{"slug":"/seven-segment-emoji/","previous":{"fields":{"slug":"/browser-as-a-medium/"},"frontmatter":{"title":"The Browser as a Medium"}},"next":{"fields":{"slug":"/audio-sensor/"},"frontmatter":{"title":"Arduino Audio Alarm"}}}}}