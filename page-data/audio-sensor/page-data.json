{"componentChunkName":"component---src-templates-blog-post-js","path":"/audio-sensor/","result":{"data":{"site":{"siteMetadata":{"title":"Tech Blog"}},"markdownRemark":{"id":"546e0ec4-aa76-5960-9854-4d9a09874e13","excerpt":"Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned, but that doesn’t…","html":"<p><em><strong>Disclaimer:</strong> I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I <strong>think</strong> I learned, but that doesn’t make it the truth.</em></p>\n<p>As a former Audio Engineer, I thought it would be fun to play with reading and making sound with Arduino. I bought a couple of sound detection modules and some ultra-loud piezo buzzers, so I thought I would make a simple alarm with them. Reading the sound was simple thanks to the modules, but I wasn’t sure how to power the buzzers to their full 24V potential since Arduino outputs a max of 5V.</p>\n<p>Seems like my options were using a MOSFET or a relay. I had a relay lying around thanks to the Arduino kit I bought, so that’s what I ended up using. Works like a charm, so I thought I would share what I learned!</p>\n<h2>The Build</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 590px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/3b7f2/schematic.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.05405405405405%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIDBP/EABYBAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAAB1vFihnM6/8QAGhAAAQUBAAAAAAAAAAAAAAAAAQACERIgIf/aAAgBAQABBQKUHdscf//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAMAAwEAAAAAAAAAAAAAAAABESFBcVH/2gAIAQEAAT8hpZuCGzORo84Nun//2gAMAwEAAgADAAAAEFQv/8QAFREBAQAAAAAAAAAAAAAAAAAAARD/2gAIAQMBAT8QGf/EABURAQEAAAAAAAAAAAAAAAAAAAEA/9oACAECAQE/EElv/8QAGxABAAMAAwEAAAAAAAAAAAAAAQARIVFhccH/2gAIAQEAAT8QtnohIiCULEXS3TF3BrHL5LzZ/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Schematic of the build\"\n        title=\"Schematic of the build\"\n        src=\"/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/1c72d/schematic.jpg\"\n        srcset=\"/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/a80bd/schematic.jpg 148w,\n/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/1c91a/schematic.jpg 295w,\n/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/1c72d/schematic.jpg 590w,\n/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/a8a14/schematic.jpg 885w,\n/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/fbd2c/schematic.jpg 1180w,\n/tech-blog/static/630406e39f09350b81902cbbfe2d7c3e/3b7f2/schematic.jpg 1987w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<figcaption>Schematic of the build</figcaption>\n<h3>Components</h3>\n<p>Here are the parts I used for this:</p>\n<ul>\n<li>Arduino Uno R3</li>\n<li>Sound detection module for Arduino</li>\n<li>SRD-05VDC-SL-C relay</li>\n<li>95db 3-24V piezo buzzer</li>\n<li>2N3904 NPN transistor</li>\n<li>1k ohm resistor</li>\n<li>1N4007 diode</li>\n</ul>\n<h4>Component notes</h4>\n<ul>\n<li>\n<p>Split circuit</p>\n<ul>\n<li>I don’t know if this is the best way, but I basically made two separate circuits that each have their own power and their own ground. So in the schematic, the dotted line next to the relay specifies separate circuits.</li>\n<li>I use a 24V DC power input that I found at Goodwill with a standard barrel input. That goes through the piezo and is switched on/off by the relay.</li>\n<li>Everything else is part of the Arduino circuit.</li>\n</ul>\n</li>\n<li>\n<p>Sound Detection</p>\n<ul>\n<li>I’m sure you could use anything for the sound detection module - it seems like they’re all clones of one another. I used this <a href=\"https://www.amazon.com/Comidox-Sensitivity-Microphone-Detection-Arduino/dp/B07J6N734S\">Comidox Sound Detection Module for Arduino</a>.</li>\n<li>It has both analog and digital outputs. Analog gives you a range of values; I didn’t use this. Digital gives you a HIGH or LOW based on a threshold controlled by a built-in trim potentiometer.</li>\n</ul>\n</li>\n<li>\n<p>Relay</p>\n<ul>\n<li>The relay is used for switching higher voltage circuits (24V for the buzzer) with logic level controls (5V Arduino).</li>\n<li>It’s strongly encouraged to used a kickback diode with relays. When the relay switches, it can send a short, but very powerful, voltage through the circuit. My understanding is the diode protects the circuit from that voltage. This <a href=\"https://www.youtube.com/watch?v=5kjtiY9gxGM\">video</a> was a really great look at why you should use one.</li>\n<li>It was recommended to use a driver circuit for the relay. I tried without it and it sounded like the relay was struggling to switch. The transistor amplifies the current to help with that and the resistor is a current limiting resistor to protect the transistor.</li>\n</ul>\n</li>\n<li>\n<p>Buzzer</p>\n<ul>\n<li>This build could be greatly simplified if you’re fine using a 5V buzzer. I wanted it to be really loud though, so I used <a href=\"https://www.amazon.com/DIKAVS-3-24V-Enclosed-Electronic-Buzzer/dp/B072HRZXLG\">this buzzer</a>.</li>\n<li>To be as loud as possible I needed the voltage (I think), which means I needed the relay, which means I needed the driver circuit.</li>\n</ul>\n</li>\n</ul>\n<h3>Code</h3>\n<div class=\"gatsby-highlight\" data-language=\"arduino\"><pre class=\"language-arduino\"><code class=\"language-arduino\"><span class=\"token comment\">// Pin variables</span>\n<span class=\"token keyword\">int</span> relay <span class=\"token operator\">=</span> <span class=\"token number\">2</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> input <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Variables we need for the logic</span>\n<span class=\"token keyword\">int</span> startBeep <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">int</span> beepLength <span class=\"token operator\">=</span> <span class=\"token number\">1000</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token keyword\">setup</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Set pin direction</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>relay<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">,</span> <span class=\"token constant\">INPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token keyword\">loop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// If we're not currently beeping...</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>startBeep <span class=\"token operator\">==</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...and we detect sound...</span>\n    <span class=\"token keyword\">int</span> reading <span class=\"token operator\">=</span> <span class=\"token function\">digitalRead</span><span class=\"token punctuation\">(</span>input<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>reading <span class=\"token operator\">==</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...start beep and remember when we started.</span>\n      startBeep <span class=\"token operator\">=</span> <span class=\"token function\">millis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">digitalWrite</span><span class=\"token punctuation\">(</span>relay<span class=\"token punctuation\">,</span> <span class=\"token constant\">HIGH</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token comment\">// Otherwise, if we are currently beeping...</span>\n  <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...and we've been beeping longer than beepLength...</span>\n    <span class=\"token keyword\">int</span> now <span class=\"token operator\">=</span> <span class=\"token function\">millis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>startBeep <span class=\"token operator\">+</span> beepLength <span class=\"token operator\">&lt;</span> now<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// ...reset startBeep and stop beep.</span>\n      startBeep <span class=\"token operator\">=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">digitalWrite</span><span class=\"token punctuation\">(</span>relay<span class=\"token punctuation\">,</span> <span class=\"token constant\">LOW</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token function\">delay</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Code notes</h4>\n<p>The more correct way of doing things would be split <code class=\"language-text\">startBeep</code> into two variables: <code class=\"language-text\">startBeep</code> to track when we started beeping and <code class=\"language-text\">isBeeping</code> to track whether we’re currently beeping. I combined those concepts so that if <code class=\"language-text\">startBeep == 0</code> we are not beeping and if <code class=\"language-text\">startBeep &gt; 0</code> we are beeping, while holding when we started beeping. The <code class=\"language-text\">millis</code> function is built in to Arduino and tracks the milliseconds since the sketch started running.</p>\n<p>The delays are probably too high, but they’re still essential. Without them the piezo doesn’t have time to stop beeping before we start reading the sensor input - creating an infinite beep. At 95db, you do not want an infinite loop.</p>\n<h2>Conclusion</h2>\n<p>Despite being a fairly simple project, it took me a lot of time to understand switching on/off circuits with Arduino. This has been several months in the making as I watched just about every video on MOSFETs and relays. I learned a great deal in the process and hopefully will be well prepared for my next, hopefully less abrasive, audio project.</p>","frontmatter":{"title":"Arduino Audio Alarm","date":"April 18, 2020","description":"Creating an alarm with Arduino, an audio sensor, and a buzzer."}}},"pageContext":{"slug":"/audio-sensor/","previous":{"fields":{"slug":"/seven-segment-emoji/"},"frontmatter":{"title":"4 Digit, 7 Segment Emoji"}},"next":{"fields":{"slug":"/max7219-emoji/"},"frontmatter":{"title":"Max7219 Emoji"}}}}}