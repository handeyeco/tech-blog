{"componentChunkName":"component---src-templates-blog-post-js","path":"/grandbot-update-light/","result":{"data":{"site":{"siteMetadata":{"title":"Tech Blog"}},"markdownRemark":{"id":"70f4e353-401d-5db2-b1c6-6f36dc115f11","excerpt":"Disclaimer: I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I think I learned, but that doesn’t…","html":"<p><em><strong>Disclaimer:</strong> I don’t know what I’m talking about. I’m a JavaScript dev who’s just learning this stuff too. I’m sharing what I <strong>think</strong> I learned, but that doesn’t make it the truth.</em></p>\n<p><em>Project originally inspired by the work of <a href=\"https://twitter.com/MohitBhoite\">Mohit Bhoite</a>.</em></p>\n<p><em>Code references the state as of <a href=\"https://github.com/handeyeco/Grandbot/tree/2020-05-15\">this tag</a>.</em></p>\n<p>The past week has been a big one for the newly named Grandbot project. I finally got to a place where I felt it was time to take a deep dive into C++ and implemented a bunch of new features while learning more about electronics and Arduino programming. Even though the hardware side of things is fairly straightforward, I’m breaking this post into several parts since the code is exponentially more complex now.</p>\n<p>I added an RGB LED to let Grandbot emote via light. Red means he’s unhappy, otherwise he generates random colors.</p>\n<h2>Adding an RGB LED</h2>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/44af6/schematic.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 60.13513513513513%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAMABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMCBf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAAB68bTywF//8QAGBABAQADAAAAAAAAAAAAAAAAAAEREkH/2gAIAQEAAQUCdVrMv//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABYQAAMAAAAAAAAAAAAAAAAAAAAgQf/aAAgBAQAGPwIq/wD/xAAcEAACAgIDAAAAAAAAAAAAAAAAAREhEDFxkcH/2gAIAQEAAT8hb5HKr2QnNiTsdn3H/9oADAMBAAIAAwAAABDML//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8QP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8QP//EABoQAQEBAQADAAAAAAAAAAAAAAERIQBBcaH/2gAIAQEAAT8QZCBR8A3q9SipX7c6fCeycAIvMwcHKm84oGHf/9k='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Schematic of the build\"\n        title=\"Schematic of the build\"\n        src=\"/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/1c72d/schematic.jpg\"\n        srcset=\"/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/a80bd/schematic.jpg 148w,\n/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/1c91a/schematic.jpg 295w,\n/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/1c72d/schematic.jpg 590w,\n/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/a8a14/schematic.jpg 885w,\n/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/fbd2c/schematic.jpg 1180w,\n/tech-blog/static/b095b8d4a63caf2817d402c6e26d02d2/44af6/schematic.jpg 2110w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<figcaption>Schematic of the build</figcaption>\n<h3>Components</h3>\n<ul>\n<li>Common cathode RGB LED</li>\n<li>3x 220 Ohm resistors</li>\n<li>Arduino Uno</li>\n</ul>\n<h4>Component notes</h4>\n<p>An RGB LED is really just three LEDs in one container with a shared cathode. So just like with a regular LEDs, we need current-limiting resistors that will depend on your specific LED. In my case I used 220 Ohm resistors, but you should look into what your LED needs.</p>\n<h3>Code</h3>\n<p>This is just the general idea, not the complete code. There’s a link above to the full codebase.</p>\n<p>We pass the pins for the different colors to the Grandbot constructor and the constructor initializes an instance of the Light class. Whenever Grandbot updates the expression, he updates the light.</p>\n<div class=\"gatsby-highlight\" data-language=\"arduino\"><pre class=\"language-arduino\"><code class=\"language-arduino\"><span class=\"token comment\">// main.cpp</span>\n\n<span class=\"token comment\">// Needs PWM pins</span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">redPin</span> <span class=\"token expression\"><span class=\"token number\">5</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">greenPin</span> <span class=\"token expression\"><span class=\"token number\">6</span></span></span>\n<span class=\"token macro property\"><span class=\"token directive-hash\">#</span><span class=\"token directive keyword\">define</span> <span class=\"token macro-name\">bluePin</span> <span class=\"token expression\"><span class=\"token number\">9</span></span></span>\n\n<span class=\"token comment\">// ...set other pins...</span>\n\nGrandbot gb <span class=\"token operator\">=</span> <span class=\"token function\">Grandbot</span><span class=\"token punctuation\">(</span>dataPin<span class=\"token punctuation\">,</span> clockPin<span class=\"token punctuation\">,</span> loadPin<span class=\"token punctuation\">,</span> voicePin<span class=\"token punctuation\">,</span> redPin<span class=\"token punctuation\">,</span> greenPin<span class=\"token punctuation\">,</span> bluePin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"arduino\"><pre class=\"language-arduino\"><code class=\"language-arduino\"><span class=\"token comment\">// Grandbot.cpp</span>\n\n<span class=\"token class-name\">Grandbot</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Grandbot</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> dataPin<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> clockPin<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> loadPin<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> voicePin<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> redPin<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> greenPin<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> bluePin<span class=\"token punctuation\">)</span>\n  <span class=\"token operator\">:</span> <span class=\"token function\">lc</span><span class=\"token punctuation\">(</span><span class=\"token function\">LedControl</span><span class=\"token punctuation\">(</span>dataPin<span class=\"token punctuation\">,</span> clockPin<span class=\"token punctuation\">,</span> loadPin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">voice</span><span class=\"token punctuation\">(</span><span class=\"token function\">Voice</span><span class=\"token punctuation\">(</span>voicePin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">light</span><span class=\"token punctuation\">(</span><span class=\"token function\">Light</span><span class=\"token punctuation\">(</span>redPin<span class=\"token punctuation\">,</span> greenPin<span class=\"token punctuation\">,</span> bluePin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ...initializing stuff...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">Grandbot</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">setExpression</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  expression <span class=\"token operator\">=</span> <span class=\"token class-name\">Expressions</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">getExpression</span><span class=\"token punctuation\">(</span>mood<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">writeExpression</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  light<span class=\"token punctuation\">.</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span>mood<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The Light class is pretty basic right now:</p>\n<div class=\"gatsby-highlight\" data-language=\"arduino\"><pre class=\"language-arduino\"><code class=\"language-arduino\"><span class=\"token comment\">// Light.h</span>\n\nclass <span class=\"token class-name\">Light</span> <span class=\"token punctuation\">{</span>\n  private<span class=\"token operator\">:</span>\n    <span class=\"token comment\">// Keeps track of the LED pins</span>\n    <span class=\"token keyword\">int</span> red<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> green<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> blue<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">void</span> <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> rValue<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> gValue<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> bValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  public<span class=\"token operator\">:</span>\n    <span class=\"token function\">Light</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> redPin<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> greenPin<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> bluePin<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> mood<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"arduino\"><pre class=\"language-arduino\"><code class=\"language-arduino\"><span class=\"token comment\">// Light.cpp</span>\n\n<span class=\"token class-name\">Light</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">Light</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> redPin<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> greenPin<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> bluePin<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  red <span class=\"token operator\">=</span> redPin<span class=\"token punctuation\">;</span>\n  green <span class=\"token operator\">=</span> greenPin<span class=\"token punctuation\">;</span>\n  blue <span class=\"token operator\">=</span> bluePin<span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// Constructor sets the pins as outputs</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>green<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">pinMode</span><span class=\"token punctuation\">(</span>blue<span class=\"token punctuation\">,</span> <span class=\"token constant\">OUTPUT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">Light</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> rValue<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> gValue<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> bValue<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Use analog write (PWM)</span>\n  <span class=\"token comment\">// so we don't just have HIGH and LOW values</span>\n  <span class=\"token function\">analogWrite</span><span class=\"token punctuation\">(</span>red<span class=\"token punctuation\">,</span> rValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">analogWrite</span><span class=\"token punctuation\">(</span>green<span class=\"token punctuation\">,</span> gValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">analogWrite</span><span class=\"token punctuation\">(</span>blue<span class=\"token punctuation\">,</span> bValue<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">void</span> <span class=\"token class-name\">Light</span><span class=\"token double-colon punctuation\">::</span><span class=\"token function\">update</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> mood<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">int</span> r <span class=\"token operator\">=</span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> g <span class=\"token operator\">=</span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">int</span> b <span class=\"token operator\">=</span> <span class=\"token function\">random</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">256</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">switch</span><span class=\"token punctuation\">(</span>mood<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// Off when sleeping</span>\n    <span class=\"token comment\">// (another reason to boot into sleep mode)</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">0</span><span class=\"token operator\">:</span>\n      <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Random blue-ish when happy</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span>\n      <span class=\"token function\">write</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">,</span> <span class=\"token number\">255</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Random color when neutral</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span>\n      <span class=\"token function\">write</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> g<span class=\"token punctuation\">,</span> b<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n    <span class=\"token comment\">// Pure red when unhappy</span>\n    <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span>\n      <span class=\"token function\">write</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>Code notes</h4>\n<ul>\n<li>It’s probably the most basic of the new features.</li>\n<li>Just like Voice, we use a switch based of the current <code class=\"language-text\">mood</code> (stored as an int) to make color selections.</li>\n</ul>\n<h2>Conclusion</h2>\n<p>I would like to do more with this feature. The main improvement I’d like in this department is to add a transition - which would require keeping track of current state and future state, transitioning between the two with some sort of <code class=\"language-text\">void transition()</code> function that can be called continuously in Grandbot’s <code class=\"language-text\">update</code> method.</p>\n<p>I would also like to have a more specific color palette. For instance I’d like to be able to pick a magenta-ish color. Right now the randomness usually results in green-ish and blue-ish colors.</p>","frontmatter":{"title":"Grandbot Update - Light","date":"May 15, 2020","description":"Setting lighting based on Grandbot's mood."}}},"pageContext":{"slug":"/grandbot-update-light/","previous":{"fields":{"slug":"/grandbot-update-play/"},"frontmatter":{"title":"Grandbot Update - Play"}},"next":{"fields":{"slug":"/nts-nano-clone/"},"frontmatter":{"title":"Note to Self - Nano Clone on High Sierra"}}}},"staticQueryHashes":["2893060334","63159454"]}